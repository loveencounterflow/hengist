{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/rpc.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'HENGIST/DEV/INTERSHOP/RPC'\ndebug                     = CND.get_logger 'debug',     badge\nalert                     = CND.get_logger 'alert',     badge\nwhisper                   = CND.get_logger 'whisper',   badge\nwarn                      = CND.get_logger 'warn',      badge\nhelp                      = CND.get_logger 'help',      badge\nurge                      = CND.get_logger 'urge',      badge\ninfo                      = CND.get_logger 'info',      badge\necho                      = CND.echo.bind CND\n#...........................................................................................................\ntest                      = require 'guy-test'\n\n# #-----------------------------------------------------------------------------------------------------------\n# @[ \"_XEMITTER: _\" ] = ( T, done ) ->\n#   DATOM                     = require '../../../apps/datom'\n#   { new_datom\n#     select }                = DATOM.export()\n#   #.........................................................................................................\n#   probes_and_matchers = [\n#     [['^foo', { time: 1500000, value: \"msg#1\", }],{\"time\":1500000,\"value\":\"msg#1\",\"$key\":\"^foo\"},null]\n#     ]\n#   #.........................................................................................................\n#   for [ probe, matcher, error, ] in probes_and_matchers\n#     await T.perform probe, matcher, error, -> return new Promise ( resolve, reject ) ->\n#       [ key, value, ] = probe\n#       resolve new_datom key, value\n#   done()\n#   return null\n\n#-----------------------------------------------------------------------------------------------------------\n@_serve = ->\n  Rpc                       = require '../../../apps/intershop-rpc'\n  DB                        = require '../../../apps/intershop/intershop_modules/db'\n  DATOM                     = require '../../../apps/datom'\n  rpc                       = new Rpc 23001\n  await rpc.start()\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"INTERSHOP-RPC basics\" ] = ( T, done ) ->\n  Rpc                       = require '../../../apps/intershop-rpc'\n  DB                        = require '../../../apps/intershop/intershop_modules/db'\n  DATOM                     = require '../../../apps/datom'\n  #.........................................................................................................\n  settings =\n    logging: ( d ) ->\n      echo CND.grey '^hengist@11^ contract', d;\n      echo ( CND.grey rpc.settings.address + ' RPC:' ), ( CND.steel d.$value ? d )\n  #.........................................................................................................\n  rpc = await Rpc.create settings\n  rpc.contract '^add-42', (       d ) -> help '^hengist@10^ contract', d; return ( ( d ? {} ).x ? 0 ) + 42\n  rpc.listen_to_all       ( key,  d ) -> urge \"^hengist@12^ listen_to_all     \", d\n  rpc.listen_to_unheard   ( key,  d ) -> warn \"^hengist@13^ listen_to_unheard \", d\n  await rpc.emit '^foobar', 108\n  help '^hengist@14^', await rpc.delegate '^add-42', { x: 123, }\n  # help '^hengist@15^', await rpc.delegate { '^add-42', x: 123, }\n  # help '^hengist@16^', await rpc.delegate { '^add-42', $value: { x: 123, }, }\n  # debug '^hengist@17^', await rpc.delegate '^add-42', 123\n  T.eq ( await rpc.delegate DATOM.new_datom '^add-42', 123          ), 42\n  T.eq ( await rpc.delegate DATOM.new_datom '^add-42', { x: 123, }  ), 165\n  T.eq ( await DB.query         [ \"select IPC.server_is_online()\"                       ] ), [ { server_is_online: true } ]\n  # T.eq ( await DB.query         [ \"select IPC.send( $1, $2 );\", '^add-42', '{\"x\":1000}' ] ), [ { send: '' } ] ### TAINT should be `null` ###\n  T.eq ( await DB.query         [ \"select IPC.rpc( $1, $2 );\", '^add-42', '{\"x\":1000}'  ] ), [ { rpc: 1042 } ]\n  T.eq ( await DB.query_single  [ \"select IPC.server_is_online()\"                       ] ), true\n  # T.eq ( await DB.query_single  [ \"select IPC.send( $1, $2 );\", '^add-42', '{\"x\":1000}' ] ), '' ### TAINT should be `null` ###\n  T.eq ( await DB.query_single  [ \"select IPC.rpc( $1, $2 );\", '^add-42', '{\"x\":1000}'  ] ), 1042\n  info rpc.counts\n  await DB.query [ \"\"\"select IPC.send( '^log', '\"send message #1\"' );\"\"\", ]\n  # await DB.query [ \"\"\"select IPC.rpc( '^log', '\"RPC message #2\"' );\"\"\", ]\n  await DB.query [ \"\"\"select log( 'helo' )\"\"\", ]\n  info rpc.counts\n  # debug '^hengist@18^', await DB.query [ \"select * from IPC.send( $1, $2 );\", '^add-42', '{\"x\":1000}' ]\n  # debug '^hengist@19^', await DB.query [ \"select * from CATALOG.catalog;\", $key, ]\n  # for row in await DB.query [ \"select * from CATALOG.catalog order by schema, name;\", ]\n  #   whisper '^hengist@20^', \"#{row.schema}/#{row.name}\"\n  await rpc.stop()\n  done()\n  # process.exit 0\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"INTERSHOP-RPC logging\" ] = ( T, done ) ->\n  DB                        = require '../../../apps/intershop/intershop_modules/db'\n  Rpc                       = require '../../../apps/intershop-rpc'\n  rpc                       = await Rpc.create()\n  rpc.contract '^log', ( d ) -> info d\n  debug '^3344-1^'\n  rpc.listen_to_all       ( key,  d ) -> urge \"^hengist@21^ listen_to_all     \", d\n  debug '^3344-2^'\n  rpc.listen_to_unheard   ( key,  d ) -> warn \"^hengist@22^ listen_to_unheard \", d\n  debug '^3344-3^'\n  debug '^547221^', await DB.query [ \"select IPC.server_is_online()\", ]\n  T.eq ( await DB.query [ \"select IPC.server_is_online()\", ] ), [ { server_is_online: true } ]\n  debug '^3344-4^'\n  await DB.query [ \"select log( 'helo' )\", ]\n  debug '^3344-5^'\n  setTimeout ( -> help 'ok'; await rpc.stop(); done() ), 2000\n\n\n\n############################################################################################################\nif module is require.main then do =>\n  # test @, { timeout: 5000, }\n  test @[ \"INTERSHOP-RPC basics\" ], { timeout: 5000, }\n  # test @[ \"INTERSHOP-RPC logging\" ], { timeout: 5000, }\n  # @_serve()\n\n\n"
  ]
}
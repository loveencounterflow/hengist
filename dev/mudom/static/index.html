<!doctype html>
<html lang="en">
<head>
  <title>µDOM/KB Keyboard Events Demo</title>
  <meta charset="utf-8">
  <script src='browserified/cnd.js'></script>
  <!-- <script src='browserified/util.js'></script> -->
  <script src='browserified/intertype.js'></script>
  <script src='browserified/intermatic.js'></script>
  <script src='browserified/mudom.js'></script>
  <script src='lib/ops.js'></script>
  <link rel="stylesheet" href="reset.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<h1>µDOM/KB Keyboard Events Demo</h1>

<p>µDOM/KB offers higher order keyboard event detection for specific keys.</p>

<p>All behaviors are boolean, i.e. their corresponding state is always true (on) or false (off).</p>

<p>Implemented behaviors include:</p>

  <ul>

    <li><p><code class=push>push</code>, corresponding to the <code>keyup</code> and <code>keydown</code> DOM
    events. This state switches to on when the key is pressed and to off when it is released; the only
    difference to the DOM events is that the callback is called not when any key is pressed or released, but
    only when the key specified is pressed or released.</p></li>

    <li><p>A <code class=toggle>toggle</code> switches to on when its state is off and the key is pressed; it
    switches back to off when it is on and the key is pressed and released.</p></li>

    <li><p>A <code class=latch>latch</code> switches between on and off when the key is pressed twice in rapid
    succession. It is unaffected by single key presses.</p></li>

    <li><p>A <code class=tlatch>tlatch</code> ('toggling latch') is like a latch, but it temporarily switches
    to the opposite state whenever the key is pressed and back again when the key is released, that is, when
    the state is latched, the state 'takes a break' (set to off) as long a the key is pressed; conversely,
    when the state is unlatched and the key is pressed, the state is momentarily set to on.</p>

    <p>Toggling latches therefore allow to implement a CapsLock-like functionality with a single key, say,
    the Shift key: when it is pressed once and held while pressing another key, that will select the
    corresponding uppercase letter (or symbol on a numeric key). When it is pressed twice, that shift state
    is latched, so one can effortlessly write IN SCREAMING CAPS. That state can then temporarily paused by
    pressing the Shift key to insert digits or lowercase letters; to get back to the 'ground' state, Shift
    must be tapped twice in succession.</p></li>

    <li><p>A <code class=ptlatch>ptlatch</code> ('positive toggling latch') is a toggling latch that only
    switches to the on state; it does not switch temporarily off.</p></li>

    <li><p>A <code class=ntlatch>ntlatch</code> ('negative toggling latch') is a toggling latch that can only
    be paused; it does not switch temporarily on.</p></li>
  </ul>

<p>The callback associated with a given key and behavior will be called when the corresponding state has
changed. They will be called with a single argument, a frozen object <code>{ keyname, behavior, state,
event, }</code>. The <code>state</code> attribute is either <code>true</code> or <code>false</code>; the
<code>event</code> attribute contains the most recent event that triggered the event.</p>

<p>Browsers can only detect keyboard events while they are the focused (active) application (otherwise, each
website in the world could be a potential key logger). Therefore, when you press keys such as Alt, Shift or
CapsLock, there's no way to detect that (and update the below display) based on keyboard events unless this
page is in focus. However, <em>mouse</em> events (and the more modern pointer events) are still detected
<em>as long as the mouse (pointer) is over the content section of the browser</em>, and it turns out once you
receive such a mouse event, you <em>can</em> query it for the modifier key status (and only the modifier keys such
as Alt, AltGraph, Shift and so on).</p>

<p>Based on this, µDOM/KB offers Mouse-Based Modifier Change Detection (MBMCD). With MBMCD, you can receive
events that detail changes in the current status of modifier keys; these then can be used to generate
<code>keydown</code> and <code>keyup</code> events that work exactly as if you had pressed the respective keys
with the application in focus.</p>

<p>The MBMCD switch below allows you to select whether to use mouse-based updates to the right-hand part of
the table. The leftmost column (with rounded corners) always shows the effects of MBMCD events with a red
border where a modifier is pressed, and a grey border when it is released. To observe the effect, focus the
window of another application (or the browser's dev tools) and press a modifier key such as Control or
Shift. Then, while holding that key, move the mouse pointer back. As soon as the mouse re-enters the content
area, the respective cells will be updated as if the key action had just occurred. This feature, therefore,
can make key-based state management a bit more reliable.</p>

<label class=switchbox for=mbmcd><div id=modblink>MBMCD event</div><label class=switch><input
type=checkbox id=mbmcd><span class='slider round'></span></label><div class=text>Use mouse-based modifier
change detection (MBMCD)</div></label>


<table>
<tr><th class=omit></th><!-- <th class=none>none</th> --><th class=toggle>toggle</th><!-- <th class=both>both</th> --><th class=latch>latch</th><th class=ptlatch>ptlatch</th><th class=tlatch>tlatch</th><th class=ntlatch>ntlatch</th></tr>
<tr><td class=lamp name=Alt>Alt           </td><!-- <td class='btn' latching=none name=Alt>Alt           </td> --><td class='btn' latching=toggle name=Alt>Alt           </td><!-- <td class='btn' latching=both name=Alt>Alt           </td> --><td class='btn' latching=latch name=Alt>Alt           </td><td class='btn' latching=ptlatch name=Alt>Alt           </td><td class='btn' latching=tlatch name=Alt>Alt           </td><td class='btn' latching=ntlatch name=Alt>Alt           </td></tr>
<tr><td class=lamp name=AltGraph>AltGraph </td><!-- <td class='btn' latching=none name=AltGraph>AltGraph </td> --><td class='btn' latching=toggle name=AltGraph>AltGraph </td><!-- <td class='btn' latching=both name=AltGraph>AltGraph </td> --><td class='btn' latching=latch name=AltGraph>AltGraph </td><td class='btn' latching=ptlatch name=AltGraph>AltGraph </td><td class='btn' latching=tlatch name=AltGraph>AltGraph </td><td class='btn' latching=ntlatch name=AltGraph>AltGraph </td></tr>
<tr><td class=lamp name=Control>Control   </td><!-- <td class='btn' latching=none name=Control>Control   </td> --><td class='btn' latching=toggle name=Control>Control   </td><!-- <td class='btn' latching=both name=Control>Control   </td> --><td class='btn' latching=latch name=Control>Control   </td><td class='btn' latching=ptlatch name=Control>Control   </td><td class='btn' latching=tlatch name=Control>Control   </td><td class='btn' latching=ntlatch name=Control>Control   </td></tr>
<tr><td class=lamp name=Meta>Meta         </td><!-- <td class='btn' latching=none name=Meta>Meta         </td> --><td class='btn' latching=toggle name=Meta>Meta         </td><!-- <td class='btn' latching=both name=Meta>Meta         </td> --><td class='btn' latching=latch name=Meta>Meta         </td><td class='btn' latching=ptlatch name=Meta>Meta         </td><td class='btn' latching=tlatch name=Meta>Meta         </td><td class='btn' latching=ntlatch name=Meta>Meta         </td></tr>
<tr><td class=lamp name=Shift>Shift       </td><!-- <td class='btn' latching=none name=Shift>Shift       </td> --><td class='btn' latching=toggle name=Shift>Shift       </td><!-- <td class='btn' latching=both name=Shift>Shift       </td> --><td class='btn' latching=latch name=Shift>Shift       </td><td class='btn' latching=ptlatch name=Shift>Shift       </td><td class='btn' latching=tlatch name=Shift>Shift       </td><td class='btn' latching=ntlatch name=Shift>Shift       </td></tr>
<tr><td class=lamp name=CapsLock>CapsLock </td><!-- <td class='btn' latching=none name=CapsLock>CapsLock </td> --><td class='btn' latching=toggle name=CapsLock>CapsLock </td><!-- <td class='btn' latching=both name=CapsLock>CapsLock </td> --><td class='btn' latching=latch name=CapsLock>CapsLock </td><td class='btn' latching=ptlatch name=CapsLock>CapsLock </td><td class='btn' latching=tlatch name=CapsLock>CapsLock </td><td class='btn' latching=ntlatch name=CapsLock>CapsLock </td></tr>
<tr><td class=lamp name=Space>Space       </td><!-- <td class='btn' latching=none name=Space>Space       </td> --><td class='btn' latching=toggle name=Space>Space       </td><!-- <td class='btn' latching=both name=Space>Space       </td> --><td class='btn' latching=latch name=Space>Space       </td><td class='btn' latching=ptlatch name=Space>Space       </td><td class='btn' latching=tlatch name=Space>Space       </td><td class='btn' latching=ntlatch name=Space>Space       </td></tr>
<tr><td class=lamp name=y>y               </td><!-- <td class='btn' latching=none name=y>y               </td> --><td class='btn' latching=toggle name=y>y               </td><!-- <td class='btn' latching=both name=y>y               </td> --><td class='btn' latching=latch name=y>y               </td><td class='btn' latching=ptlatch name=y>y               </td><td class='btn' latching=tlatch name=y>y               </td><td class='btn' latching=ntlatch name=y>y               </td></tr>
<tr><td class=lamp name=Y>Y               </td><!-- <td class='btn' latching=none name=Y>Y               </td> --><td class='btn' latching=toggle name=Y>Y               </td><!-- <td class='btn' latching=both name=Y>Y               </td> --><td class='btn' latching=latch name=Y>Y               </td><td class='btn' latching=ptlatch name=Y>Y               </td><td class='btn' latching=tlatch name=Y>Y               </td><td class='btn' latching=ntlatch name=Y>Y               </td></tr>
</table>

<p>Latest <code class=toggle>toggle</code> event:</p>

<div id=eventdetail>&nbsp;</div>

</body>
</html>



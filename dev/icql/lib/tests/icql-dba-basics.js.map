{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../../src/tests/icql-dba-basics.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n\n'use strict'\n\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'ICQL-DBA/TESTS'\ndebug                     = CND.get_logger 'debug',     badge\nwarn                      = CND.get_logger 'warn',      badge\ninfo                      = CND.get_logger 'info',      badge\nurge                      = CND.get_logger 'urge',      badge\nhelp                      = CND.get_logger 'help',      badge\nwhisper                   = CND.get_logger 'whisper',   badge\necho                      = CND.echo.bind CND\n#...........................................................................................................\ntest                      = require '../../../../apps/guy-test'\nPATH                      = require 'path'\nH                         = require './helpers'\ntypes                     = new ( require 'intertype' ).Intertype\n{ isa\n  type_of\n  validate\n  validate_list_of }      = types.export()\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"DBA: as_sql\" ] = ( T, done ) ->\n  T.halt_on_error()\n  ICQLDBA           = require '../../../../apps/icql-dba'\n  dba               = new ICQLDBA.Dba()\n  probes_and_matchers = [\n    [true,'1',]\n    [false,'0',]\n    [42,'42',]\n    ['text',\"'text'\",]\n    [\"text with 'quotes'\",\"'text with ''quotes'''\",]\n    [[1,2,3],\"'[1,2,3]'\",]\n    [[],\"'[]'\",]\n    ]\n  #.........................................................................................................\n  for [ probe, matcher, error, ] in probes_and_matchers\n    await T.perform probe, matcher, error, -> return new Promise ( resolve, reject ) ->\n      resolve dba.as_sql probe\n  done()\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"DBA: interpolate\" ] = ( T, done ) ->\n  T.halt_on_error()\n  ICQLDBA           = require '../../../../apps/icql-dba'\n  dba               = new ICQLDBA.Dba()\n  probes_and_matchers = [\n    [[\"foo, $bar, baz\",{bar:42,}],\"foo, 42, baz\"]\n    [[\"select * from t where d = $d;\",{bar:42,}],null,\"unable to express 'undefined' as SQL literal\"]\n    [[\"select * from t where d = $d;\",{d:true,}],\"select * from t where d = 1;\"]\n    ]\n  #.........................................................................................................\n  for [ probe, matcher, error, ] in probes_and_matchers\n    await T.perform probe, matcher, error, -> return new Promise ( resolve, reject ) ->\n      [ sql, Q, ] = probe\n      resolve dba.interpolate sql, Q\n  done()\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"DBA: toposort is removed\" ] = ( T, done ) ->\n  T.halt_on_error()\n  ICQLDBA           = require '../../../../apps/icql-dba'\n  dba               = new ICQLDBA.Dba()\n  T.eq dba.get_toposort, undefined\n  ### removed b/c stops working when tables refer to each other cyclical fashion:\n  dba.execute \"create table main.k1 ( id integer primary key, fk_k2 integer references k2 ( id ) );\"\n  dba.execute \"create table main.k2 ( id integer primary key, fk_k1 integer references k1 ( id ) );\"\n  debug '^568^', dba.get_toposort()\n  # => \"Error: detected cycle involving node 'K1'\"\n  ###\n  done()\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"DBA: clear()\" ] = ( T, done ) ->\n  T.halt_on_error()\n  ICQLDBA           = require '../../../../apps/icql-dba'\n  dba               = new ICQLDBA.Dba()\n  #.........................................................................................................\n  # Create tables, indexes:\n  dba.execute \"create table main.k1 ( id integer primary key, fk_k2 integer unique references k2 ( id ) );\"\n  dba.execute \"create table main.k2 ( id integer primary key, fk_k1 integer unique references k1 ( id ) );\"\n  #.........................................................................................................\n  for d from dba.walk_objects()\n    info \"^557-300^\", { type: d.type, name: d.name, }\n  #.........................................................................................................\n  # Insert rows:\n  T.eq dba.get_foreign_key_state(), true\n  dba.set_foreign_key_state off\n  T.eq dba.get_foreign_key_state(), false\n  for id in [ 1 .. 9 ]\n    dba.execute \"insert into main.k1 values ( #{id}, #{id} );\"\n    dba.execute \"insert into main.k2 values ( #{id}, #{id} );\"\n  dba.set_foreign_key_state on\n  T.eq dba.get_foreign_key_state(), true\n  #.........................................................................................................\n  debug '^544734^', ( d.name for d from dba.walk_objects() )\n  T.eq ( d.name for d from dba.walk_objects() ), [ 'sqlite_autoindex_k1_1', 'sqlite_autoindex_k2_1', 'k1', 'k2' ]\n  T.eq ( dba.list dba.query \"select * from k1 join k2 on ( k1.fk_k2 = k2.id );\" ), [\n    { id: 1, fk_k2: 1, fk_k1: 1 },\n    { id: 2, fk_k2: 2, fk_k1: 2 },\n    { id: 3, fk_k2: 3, fk_k1: 3 },\n    { id: 4, fk_k2: 4, fk_k1: 4 },\n    { id: 5, fk_k2: 5, fk_k1: 5 },\n    { id: 6, fk_k2: 6, fk_k1: 6 },\n    { id: 7, fk_k2: 7, fk_k1: 7 },\n    { id: 8, fk_k2: 8, fk_k1: 8 },\n    { id: 9, fk_k2: 9, fk_k1: 9 } ]\n  #.........................................................................................................\n  dba.clear()\n  T.eq ( d.name for d from dba.walk_objects() ), []\n  #.........................................................................................................\n  done()\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"DBA: open from DB file\" ] = ( T, done ) ->\n  T.halt_on_error()\n  ICQLDBA               = require '../../../../apps/icql-dba'\n  cfg                   = H.get_cfg()\n  cfg.size              = 'small'\n  cfg.mode              = 'fle'\n  cfg.ref               = 'dba-open-from-file'\n  cfg.pragmas           = 'fle'\n  cfg.db_template_path  = H.interpolate cfg.db.templates[  cfg.size ], cfg\n  cfg.db_work_path      = H.interpolate cfg.db.work[       cfg.mode ], cfg\n  path                  = cfg.db_work_path\n  help \"^77-300^ cfg.db_template_path:  \", cfg.db_template_path\n  help \"^77-300^ cfg.db_work_path:      \", cfg.db_work_path\n  await H.copy_over cfg.db_template_path, cfg.db_work_path\n  dba                   = new ICQLDBA.Dba { path, }\n  #.........................................................................................................\n  T.eq ( type_of ( s = dba.walk_objects() ) ), 'statementiterator'\n  ignore            = [ s..., ]\n  objects           = ( \"#{d.type}:#{d.name}\" for d from dba.walk_objects { schema: 'main', } )\n  T.eq objects, [\n    'index:sqlite_autoindex_keys_1',\n    'index:sqlite_autoindex_realms_1',\n    'index:sqlite_autoindex_sources_1',\n    'table:keys',\n    'table:main',\n    'table:realms',\n    'table:sources',\n    'view:dest_changes_backward',\n    'view:dest_changes_forward' ]\n  #.........................................................................................................\n  done()\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"_DBA: copy file DB to memory\" ] = ( T, done ) ->\n  T.halt_on_error()\n  ICQLDBA               = require '../../../../apps/icql-dba'\n  cfg                   = H.get_cfg()\n  cfg.size              = 'small'\n  cfg.mode              = 'fle'\n  cfg.ref               = 'dba-open-from-file'\n  cfg.pragmas           = 'fle'\n  cfg.db_template_path  = H.interpolate cfg.db.templates[  cfg.size ], cfg\n  cfg.db_work_path      = H.interpolate cfg.db.work[       cfg.mode ], cfg\n  path                  = cfg.db_work_path\n  await H.copy_over cfg.db_template_path, cfg.db_work_path\n  cfg.mem_schema        = 'x'\n  info JSON.stringify cfg, null, '  '\n  dba                   = new ICQLDBA.Dba { path, echo: true, debug: true, }\n  #.........................................................................................................\n  debug '^300^', cfg\n  debug '^301^', dba.get_schemas()\n  dba.attach { path: ':memory:', schema: cfg.mem_schema, }\n  debug '^302^', dba.get_schemas()\n  for d from dba.walk_objects()\n    debug '^303^', \"#{d.type}:#{d.name}\"\n  dba.copy_schema { to_schema: cfg.mem_schema, }\n  #.........................................................................................................\n  done()\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"DBA: copy file DB to memory\" ] = ( T, done ) ->\n  T.halt_on_error()\n  ICQLDBA               = require '../../../../apps/icql-dba'\n  #.........................................................................................................\n  cfg                   =\n    pragmas: [\n      'page_size = 4096'\n      'cache_size = 16384'\n      'temp_store = MEMORY'\n      'journal_mode = WAL'\n      'locking_mode = EXCLUSIVE'\n      'synchronous = OFF' ]\n    db_template_path: H.resolve_path 'assets/icql/small-datamill.db'\n    db_work_path:     H.resolve_path 'data/icql/icql-dba-copy-schema.db'\n    mem_schema:       'x'\n  #.........................................................................................................\n  help '^3387^', \"cfg.db_template_path: \", cfg.db_template_path\n  help '^3387^', \"cfg.db_work_path:     \", cfg.db_work_path\n  await H.copy_over cfg.db_template_path, cfg.db_work_path\n  #.........................................................................................................\n  dba_cfg               = { path: cfg.db_work_path, }\n  # dba_cfg               = { path: cfg.db_work_path, echo: true, debug: true, }\n  dba                   = new ICQLDBA.Dba dba_cfg\n  #.........................................................................................................\n  debug '^301^', dba.get_schemas()\n  dba.attach { path: ':memory:', schema: cfg.mem_schema, }\n  debug '^302^', dba.get_schemas()\n  for d from dba.walk_objects()\n    debug '^303^', \"#{d.type}:#{d.name}\"\n  dba.copy_schema { to_schema: cfg.mem_schema, }\n  # #.........................................................................................................\n  # objects               = ( \"#{d.type}:#{d.name}\" for d from dba.walk_objects { schema: cfg.mem_schema, } )\n  # T.eq objects, [\n  #   'index:sqlite_autoindex_keys_1',\n  #   'index:sqlite_autoindex_realms_1',\n  #   'index:sqlite_autoindex_sources_1',\n  #   'table:keys',\n  #   'table:main',\n  #   'table:realms',\n  #   'table:sources',\n  #   'view:dest_changes_backward',\n  #   'view:dest_changes_forward' ]\n  #.........................................................................................................\n  done()\n\n\n\n############################################################################################################\nunless module.parent?\n  # test @\n  test @[ \"DBA: copy file DB to memory\" ]\n  # test @[ \"DBA: as_sql\" ]\n  # test @[ \"DBA: interpolate\" ]\n  # test @[ \"DBA: clear()\" ]\n  # test @[ \"toposort with schema\" ]\n  # @[ \"toposort with schema\" ]()\n\n\n"
  ]
}
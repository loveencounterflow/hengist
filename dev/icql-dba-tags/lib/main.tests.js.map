{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/main.tests.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'ICQL-DBA-TAGS/TESTS'\ndebug                     = CND.get_logger 'debug',     badge\nwarn                      = CND.get_logger 'warn',      badge\ninfo                      = CND.get_logger 'info',      badge\nurge                      = CND.get_logger 'urge',      badge\nhelp                      = CND.get_logger 'help',      badge\nwhisper                   = CND.get_logger 'whisper',   badge\necho                      = CND.echo.bind CND\n#...........................................................................................................\ntest                      = require '../../../apps/guy-test'\nPATH                      = require 'path'\ntypes                     = new ( require 'intertype' ).Intertype\n{ isa\n  type_of\n  validate\n  validate_list_of }      = types.export()\n# { to_width }              = require 'to-width'\non_process_exit           = require 'exit-hook'\nsleep                     = ( dts ) -> new Promise ( done ) => setTimeout done, dts * 1000\nSQL                       = String.raw\njr                        = JSON.stringify\njp                        = JSON.parse\ndba_path                  = '../../../apps/icql-dba'\n{ lets\n  freeze }                = require 'letsfreezethat'\n\n\n\n\n#===========================================================================================================\nclass Ncr\n  # constructor: ->\n  #---------------------------------------------------------------------------------------------------------\n  parse_multirange_declaration: ( range_declaration ) ->\n    validate.text range_declaration\n    R = []\n    return R if range_declaration is ''\n    for part in range_declaration.split /,\\s+/\n      if ( match = part.match /^(?<lo>.+)\\.\\.(?<hi>.+)/ )?\n        lo  = match.groups.lo.codePointAt 0\n        hi  = match.groups.hi.codePointAt 0\n      else\n        validate.chr part\n        lo = hi = part.codePointAt 0\n      R.push { lo, hi, }\n    return R\nNCR = new Ncr()\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\n@[ \"tags: tags_from_tagexchain\" ] = ( T, done ) ->\n  T?.halt_on_error()\n  #.........................................................................................................\n  probes_and_matchers = [\n    [ [ '+foo',                             ],  { foo: true,          }, ]\n    [ [ '+foo:\"abc\"',                       ],  { foo: 'abc',         }, ]\n    [ [ '+font:\"superset\"',                 ],  { font: 'superset',   }, ]\n    [ [ '+font:\"font1\"',                    ],  { font: 'font1',      }, ]\n    [ [ '+font:\"font1\"',  '+font:\"Arial\"',  ],  { font: 'Arial',      }, ]\n    [ [ '+rounded', '-rounded',             ],  {},                      ]\n    [ [ '+shape/ladder', '+shape/pointy',   ],  { 'shape/ladder': true, 'shape/pointy': true, }, ]\n    ]\n  { Dtags, }  = require '../../../apps/icql-dba-tags'\n  dtags       = new Dtags()\n  for [ probe, matcher, error, ] in probes_and_matchers\n    await T.perform probe, matcher, error, -> new Promise ( resolve ) ->\n      result = dtags.tags_from_tagexchain { tagexchain: probe, }\n      resolve result\n  #.........................................................................................................\n  done?()\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"tags: add_tag with value\" ] = ( T, done ) ->\n  # T?.halt_on_error()\n  #.........................................................................................................\n  get_tags = ( dtags ) ->\n    R = []\n    for row from dtags.dba.query \"select * from t_tags;\"\n      # row.value = jp row.value\n      R.push row\n    return R\n  #.........................................................................................................\n  probes_and_matchers = [\n    [ { tag: 'foo',                        },  [ { nr: 1, tag: 'foo',          value: 'false',    } ], ]\n    [ { tag: 'foo', value: 'abc',          },  [ { nr: 1, tag: 'foo',          value: '\"abc\"',   } ], ]\n    [ { tag: 'font', value: 'font1',       },  [ { nr: 1, tag: 'font',         value: '\"font1\"', } ], ]\n    [ { tag: 'rounded', value: false,      },  [ { nr: 1, tag: 'rounded',      value: 'false',   } ], ]\n    [ { tag: 'shape/ladder',               },  [ { nr: 1, tag: 'shape/ladder', value: 'false',    } ], ]\n    ]\n  { Dtags, }  = require '../../../apps/icql-dba-tags'\n  for [ probe, matcher, error, ] in probes_and_matchers\n    await T.perform probe, matcher, error, -> new Promise ( resolve ) ->\n      dtags = new Dtags()\n      dtags.add_tag probe\n      result  = get_tags dtags\n      resolve result\n  #.........................................................................................................\n  done?()\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"tags: parse_tagex\" ] = ( T, done ) ->\n  # T?.halt_on_error()\n  #.........................................................................................................\n  probes_and_matchers = [\n    [ { tagex: '+foo',                          },  { mode: '+', tag: 'foo', value: true,    }, ]\n    [ { tagex: '-foo',                          },  { mode: '-', tag: 'foo', value: false,    }, ]\n    [ { tagex: '+shape/excentricity:0.2',       },  { mode: '+', tag: 'shape/excentricity', value: 0.2,    }, ]\n    [ { tagex: '+css/font-family:\"Helvetica\"',  },  { mode: '+', tag: 'css/font-family', value: 'Helvetica',    }, ]\n    [ { tagex: '-css/font-family:\"Helvetica\"',  },  null, \"Dtags_subtractive_value\", ]\n    [ { tagex: '*bar',                          },  null, \"Dtags_invalid_tagex\", ]\n    [ { tagex: '+bar:blah',                     },  null, \"Dtags_illegal_tagex_value_literal\", ]\n    ]\n  { Dtags, }  = require '../../../apps/icql-dba-tags'\n  dtags       = new Dtags()\n  for [ probe, matcher, error, ] in probes_and_matchers\n    await T.perform probe, matcher, error, -> new Promise ( resolve ) ->\n      result = dtags.parse_tagex probe\n      resolve result\n  #.........................................................................................................\n  done?()\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"tags: fallbacks\" ] = ( T, done ) ->\n  # T?.halt_on_error()\n  { Dtags, }  = require '../../../apps/icql-dba-tags'\n  #.........................................................................................................\n  add_some_tags_and_ranges = ( dtags ) ->\n    dtags.add_tag { tag: 'foo', value: true, }\n    dtags.add_tag { tag: 'bar', value: false, }\n    dtags.add_tag { tag: 'baz', value: 42, }\n    dtags.add_tagged_range { lo: 10, hi: 10, tag: 'foo', }\n    dtags.add_tagged_range { lo: 11, hi: 11, mode: '-', tag: 'foo', }\n    dtags.add_tagged_range { lo: 12, hi: 12, tag: 'bar', }\n    dtags.add_tagged_range { lo: 13, hi: 13, mode: '-', tag: 'bar', }\n    dtags.add_tagged_range { lo: 14, hi: 14, tag: 'baz', value: 108, }\n    dtags.add_tagged_range { lo: 15, hi: 15, mode: '-', tag: 'baz', }\n    return null\n  do => #...................................................................................................\n    dtags = new Dtags(); add_some_tags_and_ranges dtags\n    T.eq dtags.get_fallbacks(), { foo: true, bar: false, baz: 42 }\n    T.eq dtags.get_filtered_fallbacks(), {}\n    T.eq ( dtags.tags_from_id { id: 10, } ), { foo: true }\n    T.eq ( dtags.tags_from_id { id: 11, } ), {}\n    T.eq ( dtags.tags_from_id { id: 12, } ), { bar: true }\n    T.eq ( dtags.tags_from_id { id: 13, } ), {}\n    T.eq ( dtags.tags_from_id { id: 14, } ), { baz: 108 }\n    T.eq ( dtags.tags_from_id { id: 15, } ), {}\n  do => #...................................................................................................\n    dtags = new Dtags { fallbacks: true, }; add_some_tags_and_ranges dtags\n    T.eq dtags.get_fallbacks(), { foo: true, bar: false, baz: 42 }\n    T.eq dtags.get_filtered_fallbacks(), { foo: true, baz: 42 }\n    T.eq ( dtags.tags_from_id { id: 10, } ), { foo: true, baz: 42 }\n    T.eq ( dtags.tags_from_id { id: 11, } ), { foo: true, baz: 42 }\n    T.eq ( dtags.tags_from_id { id: 12, } ), { foo: true, baz: 42, bar: true }\n    T.eq ( dtags.tags_from_id { id: 13, } ), { foo: true, baz: 42 }\n    T.eq ( dtags.tags_from_id { id: 14, } ), { foo: true, baz: 108 }\n    T.eq ( dtags.tags_from_id { id: 15, } ), { foo: true, baz: 42 }\n  do => #...................................................................................................\n    dtags = new Dtags { fallbacks: 'all', }; add_some_tags_and_ranges dtags\n    T.eq dtags.get_fallbacks(), { foo: true, bar: false, baz: 42 }\n    T.eq dtags.get_filtered_fallbacks(), { foo: true, bar: false, baz: 42 }\n    T.eq ( dtags.tags_from_id { id: 10, } ), { foo: true, bar: false, baz: 42 }\n    T.eq ( dtags.tags_from_id { id: 11, } ), { foo: true, bar: false, baz: 42 }\n    T.eq ( dtags.tags_from_id { id: 12, } ), { foo: true, bar: true, baz: 42 }\n    T.eq ( dtags.tags_from_id { id: 13, } ), { foo: true, bar: false, baz: 42 }\n    T.eq ( dtags.tags_from_id { id: 14, } ), { foo: true, bar: false, baz: 108 }\n    T.eq ( dtags.tags_from_id { id: 15, } ), { foo: true, bar: false, baz: 42 }\n  #.........................................................................................................\n  done?()\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"tags: add_tagged_range\" ] = ( T, done ) ->\n  # T?.halt_on_error()\n  #.........................................................................................................\n  { Dtags, }  = require '../../../apps/icql-dba-tags'\n  prefix        = 't_'\n  #.........................................................................................................\n  get_tagged_ranges = ( dtags ) ->\n    R = []\n    for row from dtags.dba.query SQL\"select * from t_tagged_ranges order by lo, hi, tag;\"\n      row.value = jp row.value\n      R.push row\n    return R\n  #.........................................................................................................\n  probes_and_matchers = [\n    [ { lo: 1, hi: 11,  mode: '+', tag: 'foo',                        },  [ { nr: 1, lo: 1, hi: 11, mode: '+', tag: 'foo', value: true, } ], ]\n    [ { lo: 2, hi: 12,  mode: '+', tag: 'foo', value: 'abc',          },  [ { nr: 1, lo: 2, hi: 12, mode: '+', tag: 'foo', value: 'abc', } ], ]\n    [ { lo: 5, hi: 15,  mode: '+', tag: 'font', value: 'font1',       },  [ { nr: 1, lo: 5, hi: 15, mode: '+', tag: 'font', value: 'font1', } ], ]\n    [ { lo: 6, hi: 16,  mode: '-', tag: 'rounded',                    },  [ { nr: 1, lo: 6, hi: 16, mode: '-', tag: 'rounded', value: false, } ],                      ]\n    [ { lo: 7, hi: 17,  mode: '+', tag: 'shape/ladder',               },  [ { nr: 1, lo: 7, hi: 17, mode: '+', tag: 'shape/ladder', value: true, } ],                      ]\n    ]\n  dtags       = new Dtags()\n  for [ probe, matcher, error, ] in probes_and_matchers\n    await T.perform probe, matcher, error, -> new Promise ( resolve ) ->\n      dtags   = new Dtags { prefix, }\n      dtags.add_tag probe\n      dtags.add_tagged_range probe\n      result  = get_tagged_ranges dtags\n      resolve result\n  #.........................................................................................................\n  done()\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"tags: caching (1)\" ] = ( T, done ) ->\n  # T?.halt_on_error()\n  #.........................................................................................................\n  { Dba }           = require '../../../apps/icql-dba'\n  { Dtags, }        = require '../../../apps/icql-dba-tags'\n  # E                 = require '../../../apps/icql-dba/lib/errors'\n  prefix            = 't_'\n  dba               = new Dba()\n  dtags             = new Dtags { dba, prefix, }\n  #.........................................................................................................\n  get_tagged_ranges = -> dba.list dba.query SQL\"select * from t_tagged_ranges order by nr;\"\n  get_cache         = -> dba.list dba.query SQL\"select * from t_tagged_ids_cache order by id;\"\n  # get_tagchain      = ( id ) -> dba.list dba.query SQL\"\"\"\n  #   select mode, tag, value from t_tagged_ranges where $id between lo and hi order by nr asc;\"\"\", { id, }\n  #.........................................................................................................\n  do =>\n    dtags.add_tag { tag: 'first', }\n    dtags.add_tag { tag: 'second', }\n    dtags.add_tagged_range { mode: '+', lo: 10, hi: 20, tag: 'first',  }\n    dtags.add_tagged_range { mode: '+', lo: 10, hi: 15, tag: 'second', }\n    dtags.add_tagged_range { mode: '-', lo: 12, hi: 12, tag: 'second', }\n    T.eq get_cache(), []\n    T.eq get_tagged_ranges(), [\n      { nr: 1, lo: 10, hi: 20, mode: '+', tag: 'first', value: 'true' },\n      { nr: 2, lo: 10, hi: 15, mode: '+', tag: 'second', value: 'true' },\n      { nr: 3, lo: 12, hi: 12, mode: '-', tag: 'second', value: 'false' } ]\n    T.eq ( dtags.tagchain_from_id { id: 10, } ), [\n      { nr: 1, mode: '+', tag: 'first', value: true },\n      { nr: 2, mode: '+', tag: 'second', value: true }, ]\n    T.eq ( dtags.tagchain_from_id { id: 12, } ), [\n      { nr: 1, mode: '+', tag: 'first', value: true },\n      { nr: 2, mode: '+', tag: 'second', value: true },\n      { nr: 3, mode: '-', tag: 'second', value: false } ]\n    T.eq ( dtags.tagchain_from_id { id: 16, } ), [\n      { nr: 1, mode: '+', tag: 'first', value: true } ]\n    T.eq get_cache(), []\n    T.eq ( dtags.tags_from_id { id: 10, } ), { first: true, second: true }\n    T.eq ( dtags.tags_from_id { id: 12, } ), { first: true, }\n    T.eq ( dtags.tags_from_id { id: 16, } ), { first: true }\n    T.eq get_cache(), [\n      { id: 10, tags: '{\"first\":true,\"second\":true}' },\n      { id: 12, tags: '{\"first\":true}' },\n      { id: 16, tags: '{\"first\":true}' } ]\n  #.........................................................................................................\n  done?()\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"DBA: ranges (1)\" ] = ( T, done ) ->\n  T?.halt_on_error()\n  { Dba }           = require '../../../apps/icql-dba'\n  { Dtags, }        = require '../../../apps/icql-dba-tags'\n  # E                 = require '../../../apps/icql-dba/lib/errors'\n  prefix            = 't_'\n  dba               = new Dba()\n  dtags             = new Dtags { dba, prefix, }\n  cid_from_chr      = ( chr ) -> chr.codePointAt 0\n  chr_from_cid      = ( cid ) -> String.fromCodePoint cid\n  dba.create_function name: 'chr_from_cid', call: chr_from_cid\n  first_cid         = cid_from_chr 'A'\n  last_cid          = cid_from_chr 'Z'\n  #.........................................................................................................\n  rules = [\n    # [ '+superset',      'A..Z',               ]\n    [ '+font:\"fallback\"', 'A..Z',               ]\n    # [ '+script:\"latin\"',  'A..Z',               ]\n    [ '+font:\"font1\"',    'B..H, J, L, N..X',   ]\n    [ '+font:\"font2\"',    'B..D',               ]\n    [ '+font:\"font3\"',    'G..I',               ]\n    [ '+font:\"font4\"',    'M..Q',               ]\n    [ '+font:\"font5\"',    'M, O..T',            ]\n    [ '+font:\"font6\"',    'M, U, X..Y',         ]\n    [ '+vowel',           'A, E, I, O, U',      ]\n    [ '+shape/pointy',    'A, V',               ]\n    [ '+shape/crossed',   'X',                  ]\n    [ '+shape/ladder',    'A, H',               ]\n    ]\n  seen_tags = new Set()\n  for [ tagex, ranges, ] in rules\n    { mode, tag, value, } = dtags.parse_tagex { tagex, }\n    unless seen_tags.has tag\n      seen_tags.add tag\n      dtags.add_tag { tag, value: ( if value is true then false else value ), }\n    for { lo, hi, } in NCR.parse_multirange_declaration ranges\n      dtags.add_tagged_range { mode, tag, value, lo, hi, }\n  #.........................................................................................................\n  console.table dba.list dba.query SQL\"\"\"\n    select\n        nr                      as nr,\n        chr_from_cid( lo )      as chr_lo,\n        chr_from_cid( hi )      as chr_hi,\n        tag                     as tag,\n        value                   as value\n      from #{prefix}tagged_ranges\n      order by nr;\"\"\"\n  console.table dba.list dba.query SQL\"\"\"select * from #{prefix}tags order by tag;\"\"\"\n  # console.table dba.list dba.query SQL\"\"\"select * from #{prefix}tags_by_cid order by tag, cid, nr;\"\"\"\n  #.........................................................................................................\n  for cid in [ first_cid .. last_cid ]\n    chr       = String.fromCodePoint cid\n    tags      = dtags.tags_from_id { id: cid, }\n    info ( CND.gold chr ), ( CND.blue tags )\n  console.table dba.list dba.query SQL\"\"\"select * from #{prefix}tagged_ids_cache order by id;\"\"\"\n  # console.table dba.list dba.query SQL\"\"\"select #{prefix}tags_from_cid( $cid );\"\"\", { cid: 65, }\n  done?() #..................................................................................................\n\n\n\n############################################################################################################\nif module is require.main then do =>\n  test @, { timeout: 10e3, }\n  # test @[ \"DBA: ranges (1)\" ]\n  # test @[ \"tags: tags_from_tagexchain\" ]\n  # test @[ \"tags: add_tagged_range\" ]\n  # test @[ \"tags: add_tag with value\" ]\n  # test @[ \"tags: parse_tagex\" ]\n  # @[ \"DBA: ranges (1)\" ]()\n  # test @[ \"tags: caching (1)\" ]\n  # test @[ \"tags: fallbacks\" ]\n  # @[ \"tags: fallbacks\" ]()\n\n\n\n\n###\n# from https://github.com/loveencounterflow/hengist/tree/master/dev/kitty-font-config-writer-kfcw\n\nsuperset          ABCDEFGHIJKLMNOPQRSTUVWXYZ  │ CSS-like Configuration with Overlapping Ranges\n————————————————— ——————————————————————————  ——————————————————————————————————————————————————————————————\nfont1             BCDEFGH J L NOPQRSTUVWX    │ [B-H] [J] [L] [N-X]                      ◮ least precedence\nfont2             BCD                        │ [B-D]                                    │\nfont3                  GHI                   │ [G-I]                                    │\nfont4                        MNOPQ           │ [M-Q]                                    │\nfont5                        M OPQRST        │ [M] [O-T]                                │\nfont6                        M       U  XY   │ [M] [U] [X-Y]                            │ most precedence\n###\n\n\n\n\n"
  ]
}
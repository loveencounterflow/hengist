{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/basics.test.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'ICQL-DBA/TESTS/BASICS'\ndebug                     = CND.get_logger 'debug',     badge\nwarn                      = CND.get_logger 'warn',      badge\ninfo                      = CND.get_logger 'info',      badge\nurge                      = CND.get_logger 'urge',      badge\nhelp                      = CND.get_logger 'help',      badge\nwhisper                   = CND.get_logger 'whisper',   badge\necho                      = CND.echo.bind CND\n#...........................................................................................................\ntest                      = require '../../../apps/guy-test'\ntypes                     = new ( require 'intertype' ).Intertype\n{ isa\n  type_of\n  validate\n  validate_list_of }      = types.export()\n# { to_width }              = require 'to-width'\n# on_process_exit           = require 'exit-hook'\n# sleep                     = ( dts ) -> new Promise ( done ) => setTimeout done, dts * 1000\n{ SQL, I, L, X, }         = new ( require '../../../apps/icql-dba/lib/sql' ).Sql\njr                        = JSON.stringify\njp                        = JSON.parse\nPATH                      = require 'path'\nH                         = require './test-helpers'\n\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"Graphdb: create\" ] = ( T, done ) ->\n  # T.halt_on_error()\n  { Graphdb } = require './graph-db'\n  path        = '/tmp/icql-graph.db'\n  schema      = 'main'\n  gdb         = new Graphdb { ram: true, schema, }\n  #.........................................................................................................\n  T.eq ( d.name for d from gdb.dba.walk_objects { schema, } ).sort(), [ 'edges', 'id_idx', 'nodes', 'source_idx', 'sqlite_autoindex_edges_1', 'sqlite_autoindex_nodes_1', 'target_idx' ]\n  #.........................................................................................................\n  done()\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"Graphdb: insert_node()\" ] = ( T, done ) ->\n  # T.halt_on_error()\n  { Graphdb } = require './graph-db'\n  path        = '/tmp/icql-graph.db'\n  schema      = 'main'\n  gdb         = new Graphdb { ram: true, schema, }\n  #.........................................................................................................\n  # gdb.dba.run SQL\"insert into nodes ( body ) values ( ? )\", [ ( jr { id: '123', } ), ]\n  for nr in [ 1 .. 10 ]\n    gdb.insert_node { id: \"node#{nr}\", nr, text: \"<#{nr}>\", }\n  result = gdb.dba.list gdb.dba.query SQL\"select * from #{I schema}.nodes order by id;\"\n  result = ( [ d.id, ( jp d.body ).text, ] for d from result )\n  urge result\n  T.eq result, [ [ 'node1', '<1>' ], [ 'node10', '<10>' ], [ 'node2', '<2>' ], [ 'node3', '<3>' ], [ 'node4', '<4>' ], [ 'node5', '<5>' ], [ 'node6', '<6>' ], [ 'node7', '<7>' ], [ 'node8', '<8>' ], [ 'node9', '<9>' ] ]\n  #.........................................................................................................\n  done?()\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"Graphdb: insert_edge()\" ] = ( T, done ) ->\n  # T.halt_on_error()\n  { Graphdb } = require './graph-db'\n  # path        = '/tmp/icql-graph.db'\n  schema      = 'main'\n  gdb         = new Graphdb { schema, ram: true, }\n  nr_max      = 20\n  #.........................................................................................................\n  # gdb.dba.run SQL\"insert into nodes ( body ) values ( ? )\", [ ( jr { id: '123', } ), ]\n  H.insert_arithmetic_edges gdb, nr_max\n  urge '^3343^', node for node from gdb.dba.query SQL\"select * from nodes order by id;\"\n  edge_count = 0\n  for edge from gdb.dba.query SQL\"select * from edges order by source, target;\"\n    edge_count++\n    d = jp edge.properties\n    urge '^3343^', d.a, d.type, d.b\n  T.eq edge_count, 54\n  #.........................................................................................................\n  done?()\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"Graphdb: {update, upsert, upmerge} {node, edge} atrs\" ] = ( T, done ) ->\n  # T.halt_on_error()\n  { Graphdb }   = require './graph-db'\n  # path          = '/tmp/icql-graph.db'\n  schema        = 'main'\n  gdb           = new Graphdb { schema, ram: true, }\n  nr_max        = 20\n  get_node_atr  = ( id ) -> jp gdb.dba.first_value gdb.dba.query SQL\"select * from nodes where id = ?;\", [ id, ]\n  get_edge      = ( s, t ) -> gdb.dba.first_row gdb.dba.query SQL\"select * from edges where source = ? and target = ?;\", [ s, t, ]\n  get_edge_atr  = ( s, t ) -> jp ( get_edge s, t ).properties\n  show_nodes    = -> urge '^44554^', gdb.dba.list gdb.dba.query SQL\"select * from nodes;\"\n  show_edges    = -> urge '^44554^', gdb.dba.list gdb.dba.query SQL\"select * from edges;\"\n  #.........................................................................................................\n  gdb.insert_node { id: '1', en: 'one', zh: '一', };  show_nodes(); T.eq ( get_node_atr '1' ), { id: '1', en: 'one', zh: '一', }\n  gdb.upsert_node { id: '1', fr: 'un', };             show_nodes(); T.eq ( get_node_atr '1' ), { id: '1', fr: 'un', }\n  gdb.upmerge_node { id: '1', de: 'eins', };          show_nodes(); T.eq ( get_node_atr '1' ), { id: '1', de: 'eins', fr: 'un', }\n  #.........................................................................................................\n  gdb.insert_node { id: '2', en: 'two', zh: '二', };  show_nodes(); T.eq ( get_node_atr '2' ), { id: '2', en: 'two', zh: '二', }\n  gdb.update_node { id: '2', fr: 'deux', };           show_nodes(); T.eq ( get_node_atr '2' ), { id: '2', fr: 'deux', }\n  gdb.upmerge_node { id: '2', de: 'zwei', };          show_nodes(); T.eq ( get_node_atr '2' ), { id: '2', de: 'zwei', fr: 'deux', }\n  #.........................................................................................................\n  gdb.upsert_node { id: '3', fr: 'trois', };          show_nodes(); T.eq ( get_node_atr '3' ), { id: '3', fr: 'trois', }\n  #.........................................................................................................\n  gdb.insert_edge '1', '3', { d: '13', };  show_edges(); T.eq ( get_edge_atr '1', '3' ), { d: '13', }\n  gdb.update_edge '1', '3', { e: '13', };  show_edges(); T.eq ( get_edge_atr '1', '3' ), { e: '13', }\n  gdb.upsert_edge '1', '2', { e: '12', };  show_edges(); T.eq ( get_edge_atr '1', '2' ), { e: '12', }\n  gdb.upmerge_edge '1', '2', { d: '12', }; show_edges(); T.eq ( get_edge_atr '1', '2' ), { e: '12', d: '12', }\n  #.........................................................................................................\n  done?()\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"___ Graphdb: bfsvtab\" ] = ( T, done ) ->\n  ### https://github.com/abetlen/sqlite3-bfsvtab-ext ###\n  # T.halt_on_error()\n  { Graphdb } = require './graph-db'\n  path        = '/tmp/icql-graph.db'\n  schema      = 'main'\n  gdb         = new Graphdb { path, schema, }\n  nr_max      = 20\n  #.........................................................................................................\n  H.reinitialize_db gdb\n  #.........................................................................................................\n  gdb.dba.load_extension PATH.resolve PATH.join __dirname, '../bfsvtab.so'\n  H.insert_arithmetic_edges gdb, nr_max\n  gdb.dba.execute SQL\"create table edges_g ( source integer, target integer );\"\n  edges = [ ( gdb.dba.query SQL\"select * from edges;\" )..., ]\n  for edge from edges\n    debug '^197^', edge\n    source = parseInt ( edge.source.replace 'node', '' ), 10\n    target = parseInt ( edge.target.replace 'node', '' ), 10\n    gdb.dba.run SQL\"insert into edges_g ( source, target ) values ( ?, ? );\", [ source, target, ]\n  debug '^509^', edge for edge from gdb.dba.query SQL\"select * from edges_g order by source, target;\"\n  #.........................................................................................................\n  sql = SQL\"\"\"\n    select\n        -- b.root            as source,\n        -- b.id              as target,\n        n2.body           as source_node,\n        b.distance        as distance,\n        b.shortest_path   as shortest_path,\n        -- b.parent          as parent,\n        n1.body           as target_node\n      from bfsvtab as b\n      left join nodes as n1 on ( n1.id = 'node' || b.id )\n      left join nodes as n2 on ( n2.id = 'node' || b.root )\n      where true\n        and tablename  = 'edges_g'\n        and fromcolumn = 'source'\n        and tocolumn   = 'target'\n        and root       = ?\n        -- and id         = 4;\n      order by distance\n    \"\"\"\n  for source in [ 1 .. 20 ]\n    whisper '^665^', '-'.repeat 108\n    for row from gdb.dba.query sql, [ source, ]\n      row.source_node = jp row.source_node\n      row.target_node = jp row.target_node\n      info '^665^', \"#{row.source_node.text} #{row.shortest_path} #{row.target_node.text}\"\n  #.........................................................................................................\n  done?()\n\n\n\n############################################################################################################\nif module is require.main then do =>\n  test @, { timeout: 10e3, }\n  # test @[ \"Graphdb: {update, upsert, upmerge} {node, edge} atrs\" ]\n  # test @[ \"Graphdb: deleting edges and nodes\" ]\n  # test @[ \"Graphdb: insert_node()\" ]\n  # test @[ \"Graphdb: insert_edge()\" ]\n  # @[ \"Graphdb: insert_node()\" ]()\n  # test @[ \"Graphdb: bfsvtab\" ]\n"
  ]
}
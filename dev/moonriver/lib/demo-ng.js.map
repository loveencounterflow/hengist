{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/demo-ng.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'xxxxxxxxxuse strict'\n\n\n############################################################################################################\nGUY                       = require 'guy'\n{ alert\n  debug\n  help\n  info\n  plain\n  praise\n  urge\n  warn\n  whisper }               = GUY.trm.get_loggers 'MOONRIVER/NG'\n{ rpr\n  inspect\n  echo\n  log     }               = GUY.trm\n#...........................................................................................................\ntypes                     = new ( require 'intertype' ).Intertype()\n{ isa\n  type_of\n  validate\n  validate_optional }     = types\nUTIL                      = require 'node:util'\n{ hide\n  def }                   = GUY.props\nnameit                    = ( name, f ) -> def f, 'name', { value: name, }\n\n#===========================================================================================================\nclass Segment\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( cfg ) ->\n    @input      = cfg.input  ? []\n    @output     = cfg.output ? []\n    hide @, 'transform', @_as_transform cfg.fitting\n    hide @, '_send', send = ( d ) => @output.push d; d ### 'inner' send method ###\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  _as_transform: ( fitting ) ->\n    ###\n\n    * `fitting`: a value that may be used as (the central part of) a transform in a pipeline. This may be a\n      function of arity 2 (a transducer), a list (a source) &c.\n    * `transform`: one of the serial elements that constitute a pipeline. While a `fitting` may be of\n      various types, a `transform` is always a function. `transform`s have a `type` attribute which takes\n      one of the following values:\n      * `source`: a `transform` that does not take any arguments and will yield one value per call\n      * `observer`: a `transform` that takes one argument (the current value) and does not send any values\n        into the pipeline; the value an observer gets called with will be the same value that the next\n        transformer will be called with. Note that if an observer receives a mutable value it can modify it\n        and thereby affect one data item at a time.\n      * `transducer`: a `transform` that takes two arguments, the current data item and a `send()` function\n        that can be used any number of times to send values to the ensuing transform.\n\n    ###\n    transform_type = null\n    switch fitting_type = type_of fitting\n      when 'function'\n        ### TAINT validate arity ###\n        R = fitting\n      when 'list'\n        R       = ( -> yield d for d in fitting )()\n      else\n        throw new Error \"unable to use a #{rpr fitting_type} as a fitting\"\n    #.......................................................................................................\n    switch arity = R.length ? 0\n      when 0 then transform_type = 'source'\n      when 1 then transform_type = 'observer'\n      when 2 then transform_type = 'transducer'\n      else throw new Error \"fittings with arity #{arity} not implemented\"\n    #.......................................................................................................\n    nameit 'ƒ', R if R.name is ''\n    R.type = transform_type\n    return R\n\n  #---------------------------------------------------------------------------------------------------------\n  ### 'outer' send method ###\n  send: ( d ) -> @input.push d; d\n\n  #---------------------------------------------------------------------------------------------------------\n  process: ->\n    if @input.length > 0\n      @transform.call null, @input.shift(), @_send\n      return 1\n    return 0\n\n  #---------------------------------------------------------------------------------------------------------\n  [UTIL.inspect.custom]:  -> @toString()\n  toString:               -> \"#{rpr @input} ▶ #{@transform.name} ▶ #{rpr @output}\"\n\n#===========================================================================================================\nclass Reporting_collector\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( callback ) ->\n    hide @, 'callback', callback\n    hide @, 'd',        []\n    GUY.props.def @,  'length',   get: -> @d.length\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  push:     ( d ) -> @callback +1; @d.push d\n  unshift:  ( d ) -> @callback +1; @d.unshift d\n  pop:            -> @callback -1; @d.pop()\n  shift:          -> @callback -1; @d.shift()\n\n  #---------------------------------------------------------------------------------------------------------\n  [UTIL.inspect.custom]:  -> @toString()\n  toString:               -> rpr @d\n\n\n#===========================================================================================================\nclass Pipeline\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( cfg ) ->\n    cfg                 = { {}..., cfg..., }\n    # cfg                 = types.create.mr_pipeline_cfg cfg\n    @datacount          = 0\n    @input              = @_new_collector()\n    @output             = [] ### pipeline output buffer does not participate in datacount ###\n    @segments           = []\n    @on_before_step     = cfg.on_before_step ? null\n    @on_after_step      = cfg.on_after_step  ? null\n    @on_before_process  = cfg.on_before_process ? null\n    @on_after_process   = cfg.on_after_process  ? null\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  _new_collector: -> new Reporting_collector ( delta ) => @datacount += delta\n\n  #---------------------------------------------------------------------------------------------------------\n  push: ( fitting ) ->\n    if ( count = @segments.length ) is 0\n      input               = @input\n    else\n      prv_segment         = @segments[ count - 1 ]\n      prv_segment.output  = @_new_collector()\n      input               = prv_segment.output\n    R = new Segment { input, fitting, output: @output, }\n    @segments.push R\n    return R\n\n  #---------------------------------------------------------------------------------------------------------\n  send: ( d ) -> @input.push d; d\n\n  #---------------------------------------------------------------------------------------------------------\n  process: ->\n    @on_before_process() if @on_before_process?\n    for segment, segment_idx in @segments\n      @on_before_step segment_idx if @on_before_step?\n      segment.process()\n      @on_after_step segment_idx if @on_after_step?\n    @on_after_process() if @on_after_process?\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  run: -> ( d for d from @walk() )\n\n  #---------------------------------------------------------------------------------------------------------\n  walk: ->\n    loop\n      @process()\n      yield d for d in @output\n      @output.length = []\n      # yield @output.shift() while @output.length > 0\n      break if @datacount < 1\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  [UTIL.inspect.custom]:  -> @toString()\n  toString:               ->\n    R = []\n    for segment in @segments\n      R.push rpr segment.input\n      R.push '▶'\n      R.push segment.transform.name\n      R.push '▶'\n    R.push rpr @output\n    return R.join ' '\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\ndemo_1 = ->\n  echo '—————————————————————————————————————————————'\n  on_before_process = -> help '^97-1^', @\n  on_after_process  = -> warn '^97-2^', @\n  on_before_step    =  ( sidx ) -> urge '^97-3^', sidx, @\n  on_after_step     =  ( sidx ) -> urge '^97-4^', sidx, @\n  on_before_step    = null\n  # on_after_step     = null\n  on_after_process  = null\n  p = new Pipeline { on_before_process, on_before_step, on_after_step, on_after_process, }\n  p.push times_2 = ( d, send ) ->\n    if isa.float d\n      # send '('\n      send d * 2\n      # send ')'\n    else\n      send d\n  p.push plus_2  = ( d, send ) ->\n    if isa.float d\n      # send '['\n      send d + 2\n      # send ']'\n    else\n      send d\n  p.push times_3 = ( d, send ) ->\n    if isa.float d\n      # send '{'\n      send d * 3\n      # send '}'\n    else\n      send d\n  p.send 1\n  p.send 2\n  p.send 3\n  # urge '^97-4^', d for d from p.walk()\n  info '^97-4^', p.run()\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\ndemo_2 = ->\n  echo '—————————————————————————————————————————————'\n  on_before_process = -> help '^97-1^', @\n  on_after_process  = -> warn '^97-2^', @\n  on_before_step    =  ( sidx ) -> urge '^97-3^', sidx, @\n  on_after_step     =  ( sidx ) -> urge '^97-4^', sidx, @\n  on_before_step    = null\n  # on_after_step     = null\n  on_after_process  = null\n  p = new Pipeline { on_before_process, on_before_step, on_after_step, on_after_process, }\n  p.push [ 1, 2, 3, ]\n  info '^97-4^', p.run()\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\nmodel_1 = ->\n  echo '—————————————————————————————————————————————'\n  ### use a transform of arity 0 whose return value is the next data item. Must use special value `nothing`\n  to unambiguously decide between 'has value', has no value'. Flag `done` could be made attribute of `tf`\n  so unwarranted calls can be avoided. ###\n  s       = [ 5, 6, 7, ]\n  # g       = ( -> yield from s )() # the more general formulation\n  g       = s.values()\n  nothing = Symbol 'nothing'\n  $tf     = ( g ) ->\n    done = false\n    return ->\n      return nothing if done\n      { value\n        done }      = g.next()\n      whisper '^59-1^', { value, done, }\n      return if done then nothing else value\n  tf    = $tf g\n  info '^59-2^', tf() for _ in [ 1 .. 5 ]\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\nmodel_2a = ->\n  echo '—————————————————————————————————————————————'\n  ### use a transform of arity 0, to be called with `send()` method as other transforms are, too. ###\n  s     = [ 5, 6, 7, ]\n  # gf  = -> yield from s # s.values()\n  # g   = gf()\n  send  = ( d ) -> info '^60-1^', d; d\n  $tf   = ( source ) ->\n    idx       = -1\n    last_idx  = s.length - 1\n    return ( send ) ->\n      return null if idx >= last_idx\n      idx++\n      send s[ idx ]\n      return null\n  tf = $tf s\n  debug tf send for _ in [ 1 .. 5 ]\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\nmodel_2b = ->\n  echo '—————————————————————————————————————————————'\n  ### Same as `model_2a()`, but using a generator as the more general solution. ###\n  s     = [ 5, 6, 7, ]\n  # gf  = -> yield from s # s.values()\n  # g   = gf()\n  send  = ( d ) -> info '^61-1^', d; d\n  mr =\n    get_tf: ( s ) ->\n      type = type_of s\n      unless ( method = @[ \"tf_from_#{type}\"] )?\n        throw new Error \"unable to convert a #{type} to a transform\"\n      return method.call @, s\n    tf_from_generator: ( s ) ->\n      debug '^61-2^', s\n      done = false\n      return ( send ) ->\n        return null if done\n        { value: d\n          done      } = s.next()\n        send d unless done\n        return null\n    tf_from_generatorfunction: ( s ) -> debug '^61-3^', type_of s; @get_tf s()\n    tf_from_list:              ( s ) -> debug '^61-4^', type_of s; @get_tf s.values()\n    tf_from_arrayiterator:     ( s ) -> debug '^61-4^', type_of s; @tf_from_generator s\n  debug '^61-5^', type_of s\n  debug '^61-6^', type_of s.values\n  debug '^61-7^', type_of s.values()\n  debug '^61-8^', type_of ( -> yield 1 )\n  debug '^61-9^', type_of ( -> yield 1 )()\n  do ->\n    whisper '...................'\n    tf = mr.get_tf s\n    debug tf send for _ in [ 1 .. 5 ]\n  do ->\n    whisper '...................'\n    tf = mr.get_tf ( -> yield from 'ABC' )\n    debug tf send for _ in [ 1 .. 5 ]\n  do ->\n    whisper '...................'\n    tf = mr.get_tf s.values()\n    debug tf send for _ in [ 1 .. 5 ]\n  return null\n\n\n############################################################################################################\nif module is require.main then do =>\n  demo_1()\n  demo_2()\n  model_1()\n  model_2a()\n  model_2b()\n"
  ]
}
{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/basic.tests.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'MOONRIVER/BASICS'\ndebug                     = CND.get_logger 'debug',     badge\nwarn                      = CND.get_logger 'warn',      badge\ninfo                      = CND.get_logger 'info',      badge\nurge                      = CND.get_logger 'urge',      badge\nhelp                      = CND.get_logger 'help',      badge\nwhisper                   = CND.get_logger 'whisper',   badge\necho                      = CND.echo.bind CND\n#...........................................................................................................\ntest                      = require '../../../apps/guy-test'\nPATH                      = require 'path'\n# FS                        = require 'fs'\ntypes                     = new ( require 'intertype' ).Intertype\n{ isa\n  equals\n  type_of\n  validate\n  validate_list_of }      = types.export()\nSQL                       = String.raw\nguy                       = require '../../../apps/guy'\nH                         = require '../../../lib/helpers'\n\n\n  # #.........................................................................................................\n  # probes_and_matchers = [\n  #   ]\n  # #.........................................................................................................\n  # for [ probe, matcher, error, ] in probes_and_matchers\n  #   await T.perform probe, matcher, error, -> return new Promise ( resolve, reject ) ->\n\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"send.call_count\" ] = ( T, done ) ->\n  # T?.halt_on_error()\n  { Moonriver\n    $once     } = require '../../../apps/moonriver'\n  #.........................................................................................................\n  do =>\n    collector = []\n    mr        = new Moonriver()\n    mr.push [ 1, 2, 3, 5, ]\n    mr.push ( d, send ) -> send d * 2\n    mr.push ( d, send ) -> send d #; urge d\n    mr.push ( d, send ) -> collector.push d #; help collector\n    mr.drive()\n    T?.eq collector, [ 2, 4, 6, 10, ]\n  #.........................................................................................................\n  do =>\n    collector = []\n    mr        = new Moonriver()\n    mr.push [ 'a', 'b', ]\n    mr.push ( d, send ) -> urge '^598^', d; send d\n    mr.push ( d, send ) ->\n      send d\n      if @call_count is 1\n        send e for e from [ 1, 2, 3, 5, ].values()\n      return null\n    mr.push ( d, send ) -> send if isa.float d then d * 2 else d\n    mr.push ( d       ) -> urge d\n    mr.push ( d, send ) -> collector.push d #; help collector\n    mr.drive()\n    T?.eq collector, [ 'a', 2, 4, 6, 10, 'b' ]\n  #.........................................................................................................\n  done?()\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"modifiers\" ] = ( T, done ) ->\n  # T?.halt_on_error()\n  { Moonriver   }   = require '../../../apps/moonriver'\n  { $           }   = Moonriver\n  first             = Symbol 'first'\n  last              = Symbol 'last'\n  once_before_first = true\n  once_after_last   = true\n  collector         = []\n  protocol          = []\n  mr                = new Moonriver { protocol, }\n  #.........................................................................................................\n  mr.push [ 1, 2, 3, 5, ]\n  mr.push                             ( d, send ) -> send d * 2\n  mr.push $ { first,              },  ( d, send ) -> send d\n  mr.push $ { once_before_first,  },  ( d       ) -> debug '^987^', 'once_before_first'\n  # mr.push $ { once_after_last,    },  ( d       ) -> debug '^987^', 'once_after_last'\n  mr.push $ { last,               },  ( d, send ) -> send d\n  mr.push                             ( d       ) -> urge '^309^', d\n  mr.push                             ( d, send ) -> collector.push d #; help collector\n  mr.drive()\n  T?.eq collector, [ first, 2, 4, 6, 10, last, ]\n  # debug '^453^', d for d in protocol\n  # console.table protocol\n  H.tabulate 'protocol', protocol\n  #.........................................................................................................\n  done?()\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"can access pipeline from within transform, get user area\" ] = ( T, done ) ->\n  # T?.halt_on_error()\n  { Moonriver } = require '../../../apps/moonriver'\n  #.........................................................................................................\n  do =>\n    collector = []\n    pipeline  = [\n      [ '^4564^', ]\n      ( d ) -> urge d\n      #.....................................................................................................\n      can_access_pipeline_1 = ( d ) ->\n        if @ is mr then T?.ok true\n        else            T?.fail \"^478-1^ not ok\"\n        return null\n      #.....................................................................................................\n      can_access_pipeline_2 = ( d, send ) ->\n        send d\n        if @ is mr then T?.ok true\n        else            T?.fail \"^478-2^ not ok\"\n        return null\n      #.....................................................................................................\n      has_user_area = ( d, send ) ->\n        send d\n        if isa.object @user then  T?.ok true\n        else                      T?.fail \"^478-3^ not ok\"\n        return null\n      #.....................................................................................................\n      ]\n    mr = new Moonriver pipeline\n    debug '^558^', mr\n    mr.drive()\n    # T?.eq collector, [ 2, 4, 6, 10, ]\n  #.........................................................................................................\n  done?()\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"resettable state shared across transforms\" ] = ( T, done ) ->\n  # T?.halt_on_error()\n  { Moonriver } = require '../../../apps/moonriver'\n  { $ }         = Moonriver\n  #.........................................................................................................\n  source = [\n    '<h1>'\n    'The Opening'\n    '</h1>'\n    '<p>'\n    'Twas brillig, and the slithy toves Did gyre and gimble in the'\n    '<em>'\n    'wabe'\n    '</p>'\n    '</body>'\n    '</html>'\n    ]\n  #.........................................................................................................\n  do =>\n    first             = Symbol 'first'\n    last              = Symbol 'last'\n    once_before_first = true\n    once_after_last   = true\n    collector         = []\n    counts            =\n      once_before_first:  0\n      first:              0\n      last:               0\n      once_after_last:    0\n    mr                = new Moonriver()\n    #.......................................................................................................\n    mr.push source\n    #.......................................................................................................\n    mr.push $ { once_before_first, }, on_first = ( d ) ->\n      debug '^373^', 'once_before_first'\n      debug '^336^', @\n      debug '^336^', type_of @\n      debug '^336^', ( k for k of @ )\n      counts.once_before_first++\n    #.......................................................................................................\n    mr.push $ { first, }, initialize_stack = ( d ) ->\n      debug '^487^', @call_count\n      debug '^487^', d\n      counts.first++\n      if d is first\n        mr.user.stack = []\n        urge '^3487^', 'initialize_stack()', @.user\n      return null\n    #.......................................................................................................\n    mr.push push_opening_to_stack = ( d, send ) ->\n      return send d if  not isa.text d\n      return send d if  not d.startsWith '<'\n      return send d if      d.startsWith '</'\n      left_d  = d.replace /^<([^\\s>]+).*$/, '$1'\n      # debug '^039850^', { left_d, }\n      mr.user.stack.push left_d\n      send d\n    #.......................................................................................................\n    mr.push pop_closing_from_stack = ( d, send ) ->\n      return send d if  not isa.text d\n      return send d if  not d.startsWith '</'\n      # debug '^4564^', 'pop_closing_from_stack', mr.user.stack, d\n      if mr.user.stack.length < 1\n        send \"error: extraneous closing tag #{rpr d}\"\n        return send d\n      left_d  = mr.user.stack.pop()\n      right_d = d.replace /^<\\/([^\\s>]+).*$/, '$1'\n      # debug '^039850^', { left_d, right_d, }\n      unless left_d is right_d\n        send \"error: expected closing tag for <#{rpr left_d}>, got #{rpr d}\"\n        return send d\n      send d\n    #.......................................................................................................\n    mr.push $ { once_after_last, }, pop_remaining_from_stack = ( d ) ->\n      debug '^309-1^', d\n      # counts.last++\n      # send d\n    #.......................................................................................................\n    mr.push collect = ( d ) ->\n      debug '^309-1^', d\n      collector.push d\n    #.......................................................................................................\n    mr.push $ { once_after_last, }, cleanup = ( d ) ->\n      debug '^309-2^', d\n      counts.once_after_last++\n    #.......................................................................................................\n    mr.push $ { last, }, cleanup = ( d ) ->\n      debug '^309-2^', d\n      counts.last++\n    #.......................................................................................................\n    mr.drive()\n    debug '^558^', mr.user\n    echo rpr d for d in collector\n    T?.eq collector, [\n      '<h1>'\n      'The Opening'\n      '</h1>'\n      '<p>'\n      'Twas brillig, and the slithy toves Did gyre and gimble in the'\n      '<em>'\n      'wabe'\n      \"error: expected closing tag for <'em'>, got '</p>'\"\n      '</p>'\n      \"error: expected closing tag for <'p'>, got '</body>'\"\n      '</body>'\n      \"error: extraneous closing tag '</html>'\"\n      '</html>'\n      ]\n    T?.eq counts, {\n      once_before_first:  1\n      first:        source.length + 1\n      last:         source.length + 3 + 1\n      once_after_last:   1 }\n  #.........................................................................................................\n  done?()\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"modifier last\" ] = ( T, done ) ->\n  # T?.halt_on_error()\n  { Moonriver } = require '../../../apps/moonriver'\n  { $ }         = Moonriver\n  first         = Symbol 'first'\n  last          = Symbol 'last'\n  collector     = []\n  #.......................................................................................................\n  pipeline      = [\n    [ 'first', 'second', 'third', ]\n    #.....................................................................................................\n    $ { last, }, finalize = ( d, send ) ->\n      if d is last\n        collector.push collector.length\n        return send 'fourth'\n      send d\n      return null\n    #.....................................................................................................\n    ( d ) -> collector.push d\n    #.....................................................................................................\n    ]\n  #.........................................................................................................\n  mr      = new Moonriver pipeline\n  segment = mr.pipeline[ 1 ]\n  T?.eq segment.modifications.do_last,  true\n  T?.eq segment.modifications.last,     last\n  #.........................................................................................................\n  error = null\n  try mr.drive() catch error\n    T?.ok /cannot send values after pipeline has terminated/.test error.message\n  T?.ok error?\n  #.........................................................................................................\n  echo rpr d for d in collector\n  T?.eq collector, [ 'first', 'second', 'third', 3, ]\n  #.........................................................................................................\n  done?()\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"modifier once_after_last\" ] = ( T, done ) ->\n  # T?.halt_on_error()\n  { Moonriver } = require '../../../apps/moonriver'\n  { $ }         = Moonriver\n  once_after_last    = Symbol 'once_after_last'\n  collector     = []\n  #.......................................................................................................\n  pipeline      = [\n    [ 'first', 'second', 'third', ]\n    #.....................................................................................................\n    $ { once_after_last, }, finalize = ( d ) ->\n      if d is once_after_last\n        collector.push collector.length\n      return null\n    #.....................................................................................................\n    ( d ) -> collector.push d\n    #.....................................................................................................\n    ]\n  #.........................................................................................................\n  mr      = new Moonriver pipeline\n  segment = mr.pipeline[ 1 ]\n  T?.eq segment.is_sender,                    false\n  T?.eq segment.is_listener,                  false\n  T?.eq segment.modifications.do_once_after,  true\n  T?.eq segment.modifications.once_after_last,     once_after_last\n  #.........................................................................................................\n  mr.drive()\n  T?.eq collector, [ 'first', 'second', 'third', 3, ]\n  #.........................................................................................................\n  done?()\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"exit symbol\" ] = ( T, done ) ->\n  # T?.halt_on_error()\n  { Moonriver } = require '../../../apps/moonriver'\n  { $ }         = Moonriver\n  collector     = []\n  #.......................................................................................................\n  pipeline      = [\n    [ 'first', 'second', 'third', 'fourth', 'fifth', ]\n    #.....................................................................................................\n    look_for_third = ( d, send ) ->\n      send if d is 'third' then Symbol.for 'exit' else d\n    #.....................................................................................................\n    collect = ( d, send ) ->\n      collector.push d\n    #.....................................................................................................\n    ]\n  mr = new Moonriver pipeline\n  mr.drive()\n  echo rpr d for d in collector\n  T?.eq collector, [ 'first', 'second', ]\n  #.........................................................................................................\n  done?()\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"called even when pipeline empty: once_before_first, once_after_last\" ] = ( T, done ) ->\n  # T?.halt_on_error()\n  { Moonriver } = require '../../../apps/moonriver'\n  { $ }         = Moonriver\n  collector     = []\n  once_before_first   = Symbol.for 'once_before_first'\n  once_after_last    = Symbol.for 'once_after_last'\n  counts        =\n    once_before_first:  0\n    once_after_last:   0\n  #.......................................................................................................\n  pipeline      = [\n    []\n    #.....................................................................................................\n    $ { once_before_first, }, on_once_before = ( d ) ->\n      counts.once_before_first++\n    #.....................................................................................................\n    show_1 = ( d, send ) -> urge '^498-1^', rpr d; send d\n    #.....................................................................................................\n    $ { once_after_last, }, on_once_after = ( d ) ->\n      counts.once_after_last++\n    #.....................................................................................................\n    collect = ( d, send ) ->\n      collector.push d\n      send d\n    #.....................................................................................................\n    show_2 = ( d, send ) -> urge '^498-2^', rpr d; send d\n    #.....................................................................................................\n    ]\n  mr = new Moonriver pipeline\n  mr.drive()\n  T?.eq counts, { once_before_first: 1, once_after_last: 1 }\n  T?.eq collector, []\n  #.........................................................................................................\n  done?()\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"transforms with once_after_last must not be senders\" ] = ( T, done ) ->\n  # T?.halt_on_error()\n  { Moonriver } = require '../../../apps/moonriver'\n  { $ }         = Moonriver\n  once_after_last    = Symbol.for 'once_after_last'\n  #.......................................................................................................\n  pipeline      = [\n    $ { once_after_last, }, on_once_after = ( d, send ) ->\n    ]\n  #.........................................................................................................\n  error = null\n  try mr = new Moonriver pipeline catch error\n    # throw error\n    T?.ok /transforms with modifier once_after_last cannot be senders/.test error.message\n  T?.ok error?\n  #.........................................................................................................\n  done?()\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"using send() in a once_before_first transform\" ] = ( T, done ) ->\n  # T?.halt_on_error()\n  { Moonriver } = require '../../../apps/moonriver'\n  { $ }         = Moonriver\n  once_before_first   = [ 42, 43, 44, ]\n  collector     = []\n  #.......................................................................................................\n  pipeline      = [\n    $ { once_before_first, }, on_once_before = ( d, send ) ->\n      debug '^4532^', d\n      send e for e in d\n    show    = ( d ) -> urge '^4948^', d\n    collect = ( d ) -> collector.push d\n    ]\n  mr = new Moonriver pipeline\n  mr.drive()\n  T?.eq collector, [ 42, 43, 44, ]\n  #.........................................................................................................\n  done?()\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"appending data before closing\" ] = ( T, done ) ->\n  # T?.halt_on_error()\n  { Moonriver } = require '../../../apps/moonriver'\n  { $ }         = Moonriver\n  before_last   = Symbol 'before_last'\n  collector     = []\n  #.......................................................................................................\n  pipeline      = [\n    [ -1, ]\n    show    = ( d ) -> urge '^4948-1^', d\n    $ { before_last, }, on_once_before = ( d, send ) ->\n      debug '^4532^', d\n      return send d unless d is before_last\n      send e for e in [ 'a', 'b', 'c', ]\n    show    = ( d ) -> urge '^4948-2^', d\n    collect = ( d ) -> collector.push d\n    ]\n  mr = new Moonriver pipeline\n  mr.drive()\n  help '^894^', collector\n  #.........................................................................................................\n  done?()\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@[ \"once_before_first, once_after_last transformers transparent to data\" ] = ( T, done ) ->\n  # T?.halt_on_error()\n  { Moonriver } = require '../../../apps/moonriver'\n  { $ }         = Moonriver\n  collectors    =\n    c1: []\n    c2: []\n    c3: []\n    c4: []\n    c5: []\n  #.......................................................................................................\n  pipeline      = [\n    [ 'a', 'b', 'c', ]\n    collect = ( d ) ->                                                          collectors.c1.push d\n    $ { once_before_first:  'bfr', }, on_once_before  = ( d ) -> debug '^453-1^', d;  collectors.c2.push d\n    collect = ( d ) ->                                                          collectors.c3.push d\n    $ { once_after_last:   'aft', }, on_once_after   = ( d ) -> debug '^453-2^', d;  collectors.c4.push d\n    collect = ( d ) ->                                                          collectors.c5.push d\n    show    = ( d ) -> urge '^4948^', d\n    ]\n  mr = new Moonriver pipeline\n  mr.drive()\n  help '^894^', collectors.c1\n  help '^894^', collectors.c2\n  help '^894^', collectors.c3\n  help '^894^', collectors.c4\n  help '^894^', collectors.c5\n  T?.eq collectors.c1, [ 'a', 'b', 'c', ]\n  T?.eq collectors.c2, [ 'bfr', ]\n  T?.eq collectors.c3, [ 'a', 'b', 'c', ]\n  T?.eq collectors.c4, [ 'aft', ]\n  T?.eq collectors.c5, [ 'a', 'b', 'c', ]\n  #.........................................................................................................\n  done?()\n  return null\n\n\n\n############################################################################################################\nif require.main is module then do =>\n  # test @\n  # @[ \"send.call_count\" ]()\n  # @[ \"appending data before closing\" ]()\n  # test @[ \"appending data before closing\" ]\n  # test @[ \"using send() in a once_before_first transform\" ]\n  # @[ \"once_before_first, once_after_last transformers transparent to data\" ]()\n  # test @[ \"once_before_first, once_after_last transformers transparent to data\" ]\n  @[ \"modifiers\" ]()\n  # test @[ \"modifiers\" ]\n  # @[ \"resettable state shared across transforms\" ]()\n  # test @[ \"resettable state shared across transforms\" ]\n  # @[ \"modifier once_after_last\" ]()\n  # test @[ \"modifier once_after_last\" ]\n  # @[ \"modifier last\" ]()\n  # test @[ \"modifier last\" ]\n  # test @[ \"modifier last\" ]\n  # @[ \"called even when pipeline empty: once_before_first, once_after_last\" ]()\n  # test @[ \"called even when pipeline empty: once_before_first, once_after_last\" ]\n  # test @[ \"transforms with once_after_last must not be senders\" ]\n  # test @[ \"exit symbol\" ]\n  # @[ \"can access pipeline from within transform, get user area\" ]()\n  # test @[ \"can access pipeline from within transform, get user area\" ]\n\n\n"
  ]
}
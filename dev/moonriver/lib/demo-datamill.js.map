{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/demo-datamill.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nGUY                       = require '../../../apps/guy'\n{ alert\n  debug\n  help\n  info\n  plain\n  praise\n  urge\n  warn\n  whisper }               = GUY.trm.get_loggers 'MOONRIVER/NG'\n{ rpr\n  inspect\n  echo\n  log     }               = GUY.trm\ntypes                     = new ( require '../../../apps/intertype' ).Intertype()\n{ isa\n  type_of }               = types\nbr                        = -> echo '—————————————————————————————————————————————'\nH                         = require '../../../lib/helpers'\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\ndemo_datamill = ->\n  br()\n  { Pipeline, \\\n    transforms: T,\n    $,              } = require '../../../apps/moonriver'\n  { DBay }            = require '../../../apps/dbay'\n  { SQL  }            = DBay\n  db                  = new DBay()\n  #.........................................................................................................\n  db SQL\"\"\"create table numbers (\n    n   integer not null primary key,\n    sqr integer );\"\"\"\n  insert_number = db.prepare_insert { into: 'numbers', on_conflict: { update: true, }, }\n  # db.sqlt1.unsafeMode true\n  #.........................................................................................................\n  db ->\n    for n in [ 0 .. 10 ]\n      db insert_number, { n, sqr: null, }\n  #.........................................................................................................\n  p = new Pipeline { protocol: true, }\n  p.push ( d ) -> d.sqr = d.n ** 2\n  p.push ( d ) -> urge '^35^', d\n  iterator = p.walk()\n  db.with_unsafe_mode ->\n    # mode = 'deferred' # 'deferred', 'immediate', 'exclusive'\n    # mode = 'immediate' # 'deferred', 'immediate', 'exclusive'\n    # mode = 'exclusive' # 'deferred', 'immediate', 'exclusive'\n    # db.with_transaction { mode, }, ->\n    db.pragma SQL\"journal_mode = wal;\"\n    db.with_transaction ->\n      for d from db SQL\"select * from numbers order by n;\"\n        debug '^35^', d\n        p.send d\n        { value: e, done, } = iterator.next()\n        db insert_number, e\n        break if done\n  #.........................................................................................................\n  H.tabulate \"numbers\", db SQL\"\"\"select * from numbers order by n;\"\"\"\n  #.........................................................................................................\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\ndemo_configurable_concurrent_writes = ->\n  { DBay }            = require '../../../apps/dbay'\n  { SQL  }            = DBay\n  #.........................................................................................................\n  my_path = '/tmp/helo.db'\n  db      = new DBay { path: my_path, }\n  #.........................................................................................................\n  show = ( db ) -> H.tabulate \"numbers\", db SQL\"\"\"select * from numbers order by n;\"\"\"\n  #.........................................................................................................\n  prepare = ->\n    if ( db.all_rows SQL\"select name from sqlite_schema where name = 'numbers';\" ).length is 0\n      db SQL\"\"\"create table numbers (\n        n   integer not null primary key,\n        sqr integer );\"\"\"\n    #.......................................................................................................\n    insert_number = db.prepare_insert { into: 'numbers', on_conflict: { update: true, }, }\n    db insert_number, { n, sqr: null, } for n in [ 0 .. 10 ]\n  #.........................................................................................................\n  do ->\n    prepare()\n    show db\n    reader          = db.prepare SQL\"select * from numbers order by n;\"\n    insert_numbers  = null\n    #.......................................................................................................\n    writer = ( db, d ) ->\n      insert_numbers ?= db.prepare_insert { into: 'numbers', on_conflict: { update: true, }, }\n      d.sqr = d.n ** 2\n      db insert_numbers, d\n      return null\n    db = db.with_concurrent { mode: 'shadow', reader, writer, }\n    show db\n  #.........................................................................................................\n  do ->\n    prepare()\n    show db\n    reader          = db.prepare SQL\"select * from numbers order by n;\"\n    insert_numbers  = null\n    #.......................................................................................................\n    writer = ( db, d ) ->\n      insert_numbers ?= db.prepare_insert { into: 'numbers', on_conflict: { update: true, }, }\n      d.sqr = d.n ** 2\n      db insert_numbers, d\n      return null\n    db = db.with_concurrent { mode: 'reader', reader, writer, }\n    show db\n  #.........................................................................................................\n  return null\n\n\n############################################################################################################\nif module is require.main then do =>\n  # await demo_datamill()\n  demo_configurable_concurrent_writes()\n\n\n"
  ]
}
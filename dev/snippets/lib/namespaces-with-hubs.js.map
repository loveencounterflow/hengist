{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/namespaces-with-hubs.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n\n\n'use strict'\n\n\n#===========================================================================================================\nGUY                       = require 'guy'\n{ alert\n  debug\n  help\n  info\n  plain\n  praise\n  urge\n  warn\n  whisper }               = GUY.trm.get_loggers 'intertalk'\n{ rpr\n  inspect\n  echo\n  log     }               = GUY.trm\n# WG                        = require '../../../apps/webguy'\n# hub_s                     = Symbol.for 'hub'\n\n\n###\n\n**Note**: I first had in mind to use an ingenious / tricky / treacherous construction that would allow the\n'secondary' to reference methods on the host / primary using `this` / `@`; this would have allowed both the\nprimary and the secondary to use a unified notation like `@f`, `@$.f` to reference `f` on the primary and on\nthe secondary. However this also would be surprising because now `this` means not the secondary, but the\nprimary instance in methods of the secondary instance which is too surprising to sound right.\n\nInstead, we're using composition, albeit with a backlink.\n\n###\n\n\n\n\n#===========================================================================================================\nclass Subsidiary_helpers\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ->\n    @subsidiaries = new WeakSet()\n    @hosts        = new WeakMap()\n\n  #---------------------------------------------------------------------------------------------------------\n  walk_subsidiaries: ( host ) ->\n    ### TAINT this loop should be changed so we catch all relevant objects, including from inherited classes ###\n    yield { subsidiary_key, subsidiary, } \\\n      for subsidiary_key, subsidiary of host \\\n        when @is_subsidiary subsidiary\n\n  #---------------------------------------------------------------------------------------------------------\n  create: ( subsidiary ) ->\n    if @subsidiaries.has subsidiary\n      throw new Error \"object already in use as subsidiary\"\n    @subsidiaries.add subsidiary\n    return subsidiary\n\n  #---------------------------------------------------------------------------------------------------------\n  ### TAINT safeguard against non-object values ###\n  is_subsidiary: ( x ) -> @subsidiaries.has x\n\n  #---------------------------------------------------------------------------------------------------------\n  tie_host_and_subsidiary: ( cfg ) ->\n    ### TAINT use types, validate ###\n    template  = { host: null, subsidiary: null, subsidiary_key: '$', host_key: '_', }\n    cfg       = { template..., cfg..., }\n    debug '^340-1^', cfg\n    ### TAINT shouldn't be necessary if done explicitly? ###\n    unless @subsidiaries.has cfg.subsidiary\n      throw new Error \"object isn't a subsidiary\"\n    if @hosts.has cfg.subsidiary\n      throw new Error \"subsidiary already has a host\"\n    ### host->subsidiary is a standard containment/compository relationship and is expressed directly;\n    subsidiary-> host is a backlink that would create a circular reference which we avoid by using a\n    `WeakMap` instance, `@hosts`: ###\n    Object.defineProperty cfg.host,       cfg.subsidiary_key, value:  cfg.subsidiary\n    Object.defineProperty cfg.subsidiary, cfg.host_key,       get:    => @get_host cfg.subsidiary\n    @hosts.set cfg.subsidiary, cfg.host\n    return cfg.subsidiary\n\n  #---------------------------------------------------------------------------------------------------------\n  get_host: ( subsidiary ) ->\n    return R if ( R = @hosts.get subsidiary )?\n    throw new Error \"no host registered for object\"\n\n#===========================================================================================================\nSUBSIDIARY = new Subsidiary_helpers\n\n#===========================================================================================================\nclass Host\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ->\n    for { subsidiary_key, subsidiary, } from SUBSIDIARY.walk_subsidiaries @\n      SUBSIDIARY.tie_host_and_subsidiary { host: @, subsidiary, host_key: '_', subsidiary_key, }\n      debug '^233-1^', subsidiary_key, ( SUBSIDIARY.is_subsidiary subsidiary ), ( subsidiary._ is @ )\n      debug '^233-1^', @[ subsidiary_key ]\n    #   continue unless subsidiary_key.startsWith '$'\n    #   debug '^233-2^', subsidiary_key, subsidiary, subsidiary?.prototype\n    # @$ = new Secondary @\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  show: ->\n    help '^650-1^', @\n    help '^650-2^', @$a, @$a.show\n    help '^650-2^', @$b, @$b.show\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  $a: SUBSIDIARY.create\n    show: ->\n      warn '^650-1^', \"$a.show\"\n      @_.show()\n      return null\n\n  #---------------------------------------------------------------------------------------------------------\n  $b: SUBSIDIARY.create new class B\n    show: ->\n      warn '^650-1^', \"$b.show\"\n      @_.show()\n      return null\n\n  #---------------------------------------------------------------------------------------------------------\n  $not_a_subsidiary: {}\n\n\n#===========================================================================================================\nif module is require.main then await do =>\n  h = new Host()\n  h.show()\n  h.$a.show()\n  h.$b.show()\n\n"
  ]
}
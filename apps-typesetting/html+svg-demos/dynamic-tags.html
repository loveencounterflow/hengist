<!doctype html>

<title>Dynamic Tags</title>
<script src='data:text/javascript;base64,cmVxdWlyZT0oZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz0iZnVuY3Rpb24iPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlICciK2krIiciKTt0aHJvdyBhLmNvZGU9Ik1PRFVMRV9OT1RfRk9VTkQiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT0iZnVuY3Rpb24iPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkoezE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewoKdmFyIHR5cGUgPSByZXF1aXJlKCcuL2prcm9zby10eXBlJykKCi8vIChhbnksIGFueSwgW2FycmF5XSkgLT4gYm9vbGVhbgpmdW5jdGlvbiBlcXVhbChhLCBiLCBtZW1vcyl7CiAgLy8gQWxsIGlkZW50aWNhbCB2YWx1ZXMgYXJlIGVxdWl2YWxlbnQKICBpZiAoYSA9PT0gYikgcmV0dXJuIHRydWUKICB2YXIgZm5BID0gdHlwZXNbdHlwZShhKV0KICB2YXIgZm5CID0gdHlwZXNbdHlwZShiKV0KICByZXR1cm4gZm5BICYmIGZuQSA9PT0gZm5CCiAgICA/IGZuQShhLCBiLCBtZW1vcykKICAgIDogZmFsc2UKfQoKdmFyIHR5cGVzID0ge30KCi8vIChOdW1iZXIpIC0+IGJvb2xlYW4KdHlwZXMubnVtYmVyID0gZnVuY3Rpb24oYSwgYil7CiAgcmV0dXJuIGEgIT09IGEgJiYgYiAhPT0gYi8qTmFuIGNoZWNrKi8KfQoKLy8gKGZ1bmN0aW9uLCBmdW5jdGlvbiwgYXJyYXkpIC0+IGJvb2xlYW4KdHlwZXNbJ2Z1bmN0aW9uJ10gPSBmdW5jdGlvbihhLCBiLCBtZW1vcyl7CiAgcmV0dXJuIGEudG9TdHJpbmcoKSA9PT0gYi50b1N0cmluZygpCiAgICAvLyBGdW5jdGlvbnMgY2FuIGFjdCBhcyBvYmplY3RzCiAgICAmJiB0eXBlcy5vYmplY3QoYSwgYiwgbWVtb3MpCiAgICAmJiBlcXVhbChhLnByb3RvdHlwZSwgYi5wcm90b3R5cGUpCn0KCi8vIChkYXRlLCBkYXRlKSAtPiBib29sZWFuCnR5cGVzLmRhdGUgPSBmdW5jdGlvbihhLCBiKXsKICByZXR1cm4gK2EgPT09ICtiCn0KCi8vIChyZWdleHAsIHJlZ2V4cCkgLT4gYm9vbGVhbgp0eXBlcy5yZWdleHAgPSBmdW5jdGlvbihhLCBiKXsKICByZXR1cm4gYS50b1N0cmluZygpID09PSBiLnRvU3RyaW5nKCkKfQoKLy8gKERPTUVsZW1lbnQsIERPTUVsZW1lbnQpIC0+IGJvb2xlYW4KdHlwZXMuZWxlbWVudCA9IGZ1bmN0aW9uKGEsIGIpewogIHJldHVybiBhLm91dGVySFRNTCA9PT0gYi5vdXRlckhUTUwKfQoKLy8gKHRleHRub2RlLCB0ZXh0bm9kZSkgLT4gYm9vbGVhbgp0eXBlcy50ZXh0bm9kZSA9IGZ1bmN0aW9uKGEsIGIpewogIHJldHVybiBhLnRleHRDb250ZW50ID09PSBiLnRleHRDb250ZW50Cn0KCi8vIGRlY29yYXRlIGZuIHRvIHByZXZlbnQgaXQgcmUtY2hlY2tpbmcgb2JqZWN0cwovLyAoZnVuY3Rpb24pIC0+IGZ1bmN0aW9uCmZ1bmN0aW9uIG1lbW9HYXVyZChmbil7CiAgcmV0dXJuIGZ1bmN0aW9uKGEsIGIsIG1lbW9zKXsKICAgIGlmICghbWVtb3MpIHJldHVybiBmbihhLCBiLCBbXSkKICAgIHZhciBpID0gbWVtb3MubGVuZ3RoLCBtZW1vCiAgICB3aGlsZSAobWVtbyA9IG1lbW9zWy0taV0pIHsKICAgICAgaWYgKG1lbW9bMF0gPT09IGEgJiYgbWVtb1sxXSA9PT0gYikgcmV0dXJuIHRydWUKICAgIH0KICAgIHJldHVybiBmbihhLCBiLCBtZW1vcykKICB9Cn0KCnR5cGVzWydhcmd1bWVudHMnXSA9CnR5cGVzWydiaXQtYXJyYXknXSA9CnR5cGVzLmFycmF5ID0gbWVtb0dhdXJkKGFycmF5RXF1YWwpCgovLyAoYXJyYXksIGFycmF5LCBhcnJheSkgLT4gYm9vbGVhbgpmdW5jdGlvbiBhcnJheUVxdWFsKGEsIGIsIG1lbW9zKXsKICB2YXIgaSA9IGEubGVuZ3RoCiAgaWYgKGkgIT09IGIubGVuZ3RoKSByZXR1cm4gZmFsc2UKICBtZW1vcy5wdXNoKFthLCBiXSkKICB3aGlsZSAoaS0tKSB7CiAgICBpZiAoIWVxdWFsKGFbaV0sIGJbaV0sIG1lbW9zKSkgcmV0dXJuIGZhbHNlCiAgfQogIHJldHVybiB0cnVlCn0KCnR5cGVzLm9iamVjdCA9IG1lbW9HYXVyZChvYmplY3RFcXVhbCkKCi8vIChvYmplY3QsIG9iamVjdCwgYXJyYXkpIC0+IGJvb2xlYW4KZnVuY3Rpb24gb2JqZWN0RXF1YWwoYSwgYiwgbWVtb3MpIHsKICBpZiAodHlwZW9mIGEuZXF1YWwgPT0gJ2Z1bmN0aW9uJykgewogICAgbWVtb3MucHVzaChbYSwgYl0pCiAgICByZXR1cm4gYS5lcXVhbChiLCBtZW1vcykKICB9CiAgdmFyIGthID0gZ2V0RW51bWVyYWJsZVByb3BlcnRpZXMoYSkKICB2YXIga2IgPSBnZXRFbnVtZXJhYmxlUHJvcGVydGllcyhiKQogIHZhciBpID0ga2EubGVuZ3RoCgogIC8vIHNhbWUgbnVtYmVyIG9mIHByb3BlcnRpZXMKICBpZiAoaSAhPT0ga2IubGVuZ3RoKSByZXR1cm4gZmFsc2UKCiAgLy8gYWx0aG91Z2ggbm90IG5lY2Vzc2FyaWx5IHRoZSBzYW1lIG9yZGVyCiAga2Euc29ydCgpCiAga2Iuc29ydCgpCgogIC8vIGNoZWFwIGtleSB0ZXN0CiAgd2hpbGUgKGktLSkgaWYgKGthW2ldICE9PSBrYltpXSkgcmV0dXJuIGZhbHNlCgogIC8vIHJlbWVtYmVyCiAgbWVtb3MucHVzaChbYSwgYl0pCgogIC8vIGl0ZXJhdGUgYWdhaW4gdGhpcyB0aW1lIGRvaW5nIGEgdGhvcm91Z2ggY2hlY2sKICBpID0ga2EubGVuZ3RoCiAgd2hpbGUgKGktLSkgewogICAgdmFyIGtleSA9IGthW2ldCiAgICBpZiAoIWVxdWFsKGFba2V5XSwgYltrZXldLCBtZW1vcykpIHJldHVybiBmYWxzZQogIH0KCiAgcmV0dXJuIHRydWUKfQoKLy8gKG9iamVjdCkgLT4gYXJyYXkKZnVuY3Rpb24gZ2V0RW51bWVyYWJsZVByb3BlcnRpZXMgKG9iamVjdCkgewogIHZhciByZXN1bHQgPSBbXQogIGZvciAodmFyIGsgaW4gb2JqZWN0KSBpZiAoayAhPT0gJ2NvbnN0cnVjdG9yJykgewogICAgcmVzdWx0LnB1c2goaykKICB9CiAgcmV0dXJuIHJlc3VsdAp9Cgptb2R1bGUuZXhwb3J0cyA9IGVxdWFsCgoKfSx7Ii4vamtyb3NvLXR5cGUiOjJ9XSwyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKCnZhciB0b1N0cmluZyA9IHt9LnRvU3RyaW5nCnZhciBEb21Ob2RlID0gdHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJwogID8gd2luZG93Lk5vZGUKICA6IEZ1bmN0aW9uIC8vIGNvdWxkIGJlIGFueSBmdW5jdGlvbgoKLyoqCiAqIFJldHVybiB0aGUgdHlwZSBvZiB2YWwuCiAqCiAqIEBwYXJhbSB7TWl4ZWR9IHZhbAogKiBAcmV0dXJuIHtTdHJpbmd9CiAqIEBhcGkgcHVibGljCiAqLwoKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzID0gZnVuY3Rpb24gdHlwZSh4KXsKICB2YXIgdHlwZSA9IHR5cGVvZiB4CiAgaWYgKHR5cGUgIT0gJ29iamVjdCcpIHJldHVybiB0eXBlCiAgdHlwZSA9IHR5cGVzW3RvU3RyaW5nLmNhbGwoeCldCiAgaWYgKHR5cGUgPT0gJ29iamVjdCcpIHsKICAgIC8vIGluIGNhc2UgdGhleSBoYXZlIGJlZW4gcG9seWZpbGxlZAogICAgaWYgKHggaW5zdGFuY2VvZiBNYXApIHJldHVybiAnbWFwJwogICAgaWYgKHggaW5zdGFuY2VvZiBTZXQpIHJldHVybiAnc2V0JwogICAgcmV0dXJuICdvYmplY3QnCiAgfQogIGlmICh0eXBlKSByZXR1cm4gdHlwZQogIGlmICh4IGluc3RhbmNlb2YgRG9tTm9kZSkgc3dpdGNoICh4Lm5vZGVUeXBlKSB7CiAgICBjYXNlIDE6ICByZXR1cm4gJ2VsZW1lbnQnCiAgICBjYXNlIDM6ICByZXR1cm4gJ3RleHQtbm9kZScKICAgIGNhc2UgOTogIHJldHVybiAnZG9jdW1lbnQnCiAgICBjYXNlIDExOiByZXR1cm4gJ2RvY3VtZW50LWZyYWdtZW50JwogICAgZGVmYXVsdDogcmV0dXJuICdkb20tbm9kZScKICB9Cn0KCnZhciB0eXBlcyA9IGV4cG9ydHMudHlwZXMgPSB7CiAgJ1tvYmplY3QgRnVuY3Rpb25dJzogJ2Z1bmN0aW9uJywKICAnW29iamVjdCBEYXRlXSc6ICdkYXRlJywKICAnW29iamVjdCBSZWdFeHBdJzogJ3JlZ2V4cCcsCiAgJ1tvYmplY3QgQXJndW1lbnRzXSc6ICdhcmd1bWVudHMnLAogICdbb2JqZWN0IEFycmF5XSc6ICdhcnJheScsCiAgJ1tvYmplY3QgU2V0XSc6ICdzZXQnLAogICdbb2JqZWN0IFN0cmluZ10nOiAnc3RyaW5nJywKICAnW29iamVjdCBOdWxsXSc6ICdudWxsJywKICAnW29iamVjdCBVbmRlZmluZWRdJzogJ3VuZGVmaW5lZCcsCiAgJ1tvYmplY3QgTnVtYmVyXSc6ICdudW1iZXInLAogICdbb2JqZWN0IEJvb2xlYW5dJzogJ2Jvb2xlYW4nLAogICdbb2JqZWN0IE9iamVjdF0nOiAnb2JqZWN0JywKICAnW29iamVjdCBNYXBdJzogJ21hcCcsCiAgJ1tvYmplY3QgVGV4dF0nOiAndGV4dC1ub2RlJywKICAnW29iamVjdCBVaW50OEFycmF5XSc6ICdiaXQtYXJyYXknLAogICdbb2JqZWN0IFVpbnQxNkFycmF5XSc6ICdiaXQtYXJyYXknLAogICdbb2JqZWN0IFVpbnQzMkFycmF5XSc6ICdiaXQtYXJyYXknLAogICdbb2JqZWN0IFVpbnQ4Q2xhbXBlZEFycmF5XSc6ICdiaXQtYXJyYXknLAogICdbb2JqZWN0IEVycm9yXSc6ICdlcnJvcicsCiAgJ1tvYmplY3QgRm9ybURhdGFdJzogJ2Zvcm0tZGF0YScsCiAgJ1tvYmplY3QgRmlsZV0nOiAnZmlsZScsCiAgJ1tvYmplY3QgQmxvYl0nOiAnYmxvYicKfQoKCn0se31dLDM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewooZnVuY3Rpb24oKSB7CiAgJ3VzZSBzdHJpY3QnOwogIHZhciBqc190eXBlX29mLCBycHIsIHNhZDsKCiAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogIHRoaXMuc2FkID0gc2FkID0gU3ltYm9sKCdzYWQnKTsKCiAgKHtycHIsIGpzX3R5cGVfb2Z9ID0gcmVxdWlyZSgnLi9oZWxwZXJzJykpOwoKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgdGhpcy5pc19zYWQgPSBmdW5jdGlvbih4KSB7CiAgICByZXR1cm4gKHggPT09IHNhZCkgfHwgKHggaW5zdGFuY2VvZiBFcnJvcikgfHwgKHRoaXMuaXNfc2FkZGVuZWQoeCkpOwogIH07CgogIHRoaXMuaXNfaGFwcHkgPSBmdW5jdGlvbih4KSB7CiAgICByZXR1cm4gIXRoaXMuaXNfc2FkKHgpOwogIH07CgogIHRoaXMuc2FkZGVuID0gZnVuY3Rpb24oeCkgewogICAgcmV0dXJuIHsKICAgICAgW3NhZF06IHRydWUsCiAgICAgIF86IHgKICAgIH07CiAgfTsKCiAgdGhpcy5pc19zYWRkZW5lZCA9IGZ1bmN0aW9uKHgpIHsKICAgIHJldHVybiAoKGpzX3R5cGVfb2YoeCkpID09PSAnb2JqZWN0JykgJiYgKHhbc2FkXSA9PT0gdHJ1ZSk7CiAgfTsKCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIHRoaXMudW5zYWRkZW4gPSBmdW5jdGlvbih4KSB7CiAgICBpZiAodGhpcy5pc19oYXBweSh4KSkgewogICAgICByZXR1cm4geDsKICAgIH0KICAgIHRoaXMudmFsaWRhdGUuc2FkZGVuZWQoeCk7CiAgICByZXR1cm4geC5fOwogIH07CgogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICB0aGlzLmRlY2xhcmVfY2hlY2sgPSBmdW5jdGlvbihuYW1lLCBjaGVja2VyKSB7CiAgICB0aGlzLnZhbGlkYXRlLm5vbmVtcHR5X3RleHQobmFtZSk7CiAgICB0aGlzLnZhbGlkYXRlLmZ1bmN0aW9uKGNoZWNrZXIpOwogICAgaWYgKHRoaXMuc3BlY3NbbmFtZV0gIT0gbnVsbCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYMK1ODAzMiB0eXBlICR7cnByKG5hbWUpfSBhbHJlYWR5IGRlY2xhcmVkYCk7CiAgICB9CiAgICBpZiAodGhpcy5jaGVja3NbbmFtZV0gIT0gbnVsbCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYMK1ODAzMyBjaGVjayAke3JwcihuYW1lKX0gYWxyZWFkeSBkZWNsYXJlZGApOwogICAgfQogICAgdGhpcy5jaGVja3NbbmFtZV0gPSBjaGVja2VyOwogICAgcmV0dXJuIG51bGw7CiAgfTsKCn0pLmNhbGwodGhpcyk7CgoKfSx7Ii4vaGVscGVycyI6Nn1dLDQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewooZnVuY3Rpb24gKEJ1ZmZlcil7KGZ1bmN0aW9uICgpewooZnVuY3Rpb24oKSB7CiAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogIC8vIHsgZXF1YWxzLCB9ICAgICAgICAgICAgICAgPSByZXF1aXJlICdjbmQnCiAgdmFyIENIRUNLUywgYXNzaWduLCBqciwganNfdHlwZV9vZiwganNpZGVudGlmaWVyX3BhdHRlcm4sIHhycHIsCiAgICBtb2R1bG8gPSBmdW5jdGlvbihhLCBiKSB7IHJldHVybiAoK2EgJSAoYiA9ICtiKSArIGIpICUgYjsgfTsKCiAgKHthc3NpZ24sIGpyLCB4cnByLCBqc190eXBlX29mfSA9IHJlcXVpcmUoJy4vaGVscGVycycpKTsKCiAgQ0hFQ0tTID0gcmVxdWlyZSgnLi9jaGVja3MnKTsKCiAgLyogdGh4IHRvCiAgICBodHRwczovL2dpdGh1Yi5jb20vbWF0aGlhc2J5bmVucy9tb3RoZXJlZmYuaW4vYmxvYi9tYXN0ZXIvanMtdmFyaWFibGVzL2VmZi5qcwogICAgaHR0cHM6Ly9tYXRoaWFzYnluZW5zLmJlL25vdGVzL2phdmFzY3JpcHQtaWRlbnRpZmllcnMtZXM2CiAgKi8KICAvLyBqc2lkZW50aWZpZXJfcGF0dGVybiAgICAgID0gL14oPzpbXCRBLVpfYS16XHhBQVx4QjVceEJBXHhDMC1ceEQ2XHhEOC1ceEY2XHhGOC1cdTAyQzFcdTAyQzYtXHUwMkQxXHUwMkUwLVx1MDJFNFx1MDJFQ1x1MDJFRVx1MDM3MC1cdTAzNzRcdTAzNzZcdTAzNzdcdTAzN0EtXHUwMzdEXHUwMzdGXHUwMzg2XHUwMzg4LVx1MDM4QVx1MDM4Q1x1MDM4RS1cdTAzQTFcdTAzQTMtXHUwM0Y1XHUwM0Y3LVx1MDQ4MVx1MDQ4QS1cdTA1MkZcdTA1MzEtXHUwNTU2XHUwNTU5XHUwNTYxLVx1MDU4N1x1MDVEMC1cdTA1RUFcdTA1RjAtXHUwNUYyXHUwNjIwLVx1MDY0QVx1MDY2RVx1MDY2Rlx1MDY3MS1cdTA2RDNcdTA2RDVcdTA2RTVcdTA2RTZcdTA2RUVcdTA2RUZcdTA2RkEtXHUwNkZDXHUwNkZGXHUwNzEwXHUwNzEyLVx1MDcyRlx1MDc0RC1cdTA3QTVcdTA3QjFcdTA3Q0EtXHUwN0VBXHUwN0Y0XHUwN0Y1XHUwN0ZBXHUwODAwLVx1MDgxNVx1MDgxQVx1MDgyNFx1MDgyOFx1MDg0MC1cdTA4NThcdTA4QTAtXHUwOEI0XHUwOTA0LVx1MDkzOVx1MDkzRFx1MDk1MFx1MDk1OC1cdTA5NjFcdTA5NzEtXHUwOTgwXHUwOTg1LVx1MDk4Q1x1MDk4Rlx1MDk5MFx1MDk5My1cdTA5QThcdTA5QUEtXHUwOUIwXHUwOUIyXHUwOUI2LVx1MDlCOVx1MDlCRFx1MDlDRVx1MDlEQ1x1MDlERFx1MDlERi1cdTA5RTFcdTA5RjBcdTA5RjFcdTBBMDUtXHUwQTBBXHUwQTBGXHUwQTEwXHUwQTEzLVx1MEEyOFx1MEEyQS1cdTBBMzBcdTBBMzJcdTBBMzNcdTBBMzVcdTBBMzZcdTBBMzhcdTBBMzlcdTBBNTktXHUwQTVDXHUwQTVFXHUwQTcyLVx1MEE3NFx1MEE4NS1cdTBBOERcdTBBOEYtXHUwQTkxXHUwQTkzLVx1MEFBOFx1MEFBQS1cdTBBQjBcdTBBQjJcdTBBQjNcdTBBQjUtXHUwQUI5XHUwQUJEXHUwQUQwXHUwQUUwXHUwQUUxXHUwQUY5XHUwQjA1LVx1MEIwQ1x1MEIwRlx1MEIxMFx1MEIxMy1cdTBCMjhcdTBCMkEtXHUwQjMwXHUwQjMyXHUwQjMzXHUwQjM1LVx1MEIzOVx1MEIzRFx1MEI1Q1x1MEI1RFx1MEI1Ri1cdTBCNjFcdTBCNzFcdTBCODNcdTBCODUtXHUwQjhBXHUwQjhFLVx1MEI5MFx1MEI5Mi1cdTBCOTVcdTBCOTlcdTBCOUFcdTBCOUNcdTBCOUVcdTBCOUZcdTBCQTNcdTBCQTRcdTBCQTgtXHUwQkFBXHUwQkFFLVx1MEJCOVx1MEJEMFx1MEMwNS1cdTBDMENcdTBDMEUtXHUwQzEwXHUwQzEyLVx1MEMyOFx1MEMyQS1cdTBDMzlcdTBDM0RcdTBDNTgtXHUwQzVBXHUwQzYwXHUwQzYxXHUwQzg1LVx1MEM4Q1x1MEM4RS1cdTBDOTBcdTBDOTItXHUwQ0E4XHUwQ0FBLVx1MENCM1x1MENCNS1cdTBDQjlcdTBDQkRcdTBDREVcdTBDRTBcdTBDRTFcdTBDRjFcdTBDRjJcdTBEMDUtXHUwRDBDXHUwRDBFLVx1MEQxMFx1MEQxMi1cdTBEM0FcdTBEM0RcdTBENEVcdTBENUYtXHUwRDYxXHUwRDdBLVx1MEQ3Rlx1MEQ4NS1cdTBEOTZcdTBEOUEtXHUwREIxXHUwREIzLVx1MERCQlx1MERCRFx1MERDMC1cdTBEQzZcdTBFMDEtXHUwRTMwXHUwRTMyXHUwRTMzXHUwRTQwLVx1MEU0Nlx1MEU4MVx1MEU4Mlx1MEU4NFx1MEU4N1x1MEU4OFx1MEU4QVx1MEU4RFx1MEU5NC1cdTBFOTdcdTBFOTktXHUwRTlGXHUwRUExLVx1MEVBM1x1MEVBNVx1MEVBN1x1MEVBQVx1MEVBQlx1MEVBRC1cdTBFQjBcdTBFQjJcdTBFQjNcdTBFQkRcdTBFQzAtXHUwRUM0XHUwRUM2XHUwRURDLVx1MEVERlx1MEYwMFx1MEY0MC1cdTBGNDdcdTBGNDktXHUwRjZDXHUwRjg4LVx1MEY4Q1x1MTAwMC1cdTEwMkFcdTEwM0ZcdTEwNTAtXHUxMDU1XHUxMDVBLVx1MTA1RFx1MTA2MVx1MTA2NVx1MTA2Nlx1MTA2RS1cdTEwNzBcdTEwNzUtXHUxMDgxXHUxMDhFXHUxMEEwLVx1MTBDNVx1MTBDN1x1MTBDRFx1MTBEMC1cdTEwRkFcdTEwRkMtXHUxMjQ4XHUxMjRBLVx1MTI0RFx1MTI1MC1cdTEyNTZcdTEyNThcdTEyNUEtXHUxMjVEXHUxMjYwLVx1MTI4OFx1MTI4QS1cdTEyOERcdTEyOTAtXHUxMkIwXHUxMkIyLVx1MTJCNVx1MTJCOC1cdTEyQkVcdTEyQzBcdTEyQzItXHUxMkM1XHUxMkM4LVx1MTJENlx1MTJEOC1cdTEzMTBcdTEzMTItXHUxMzE1XHUxMzE4LVx1MTM1QVx1MTM4MC1cdTEzOEZcdTEzQTAtXHUxM0Y1XHUxM0Y4LVx1MTNGRFx1MTQwMS1cdTE2NkNcdTE2NkYtXHUxNjdGXHUxNjgxLVx1MTY5QVx1MTZBMC1cdTE2RUFcdTE2RUUtXHUxNkY4XHUxNzAwLVx1MTcwQ1x1MTcwRS1cdTE3MTFcdTE3MjAtXHUxNzMxXHUxNzQwLVx1MTc1MVx1MTc2MC1cdTE3NkNcdTE3NkUtXHUxNzcwXHUxNzgwLVx1MTdCM1x1MTdEN1x1MTdEQ1x1MTgyMC1cdTE4NzdcdTE4ODAtXHUxOEE4XHUxOEFBXHUxOEIwLVx1MThGNVx1MTkwMC1cdTE5MUVcdTE5NTAtXHUxOTZEXHUxOTcwLVx1MTk3NFx1MTk4MC1cdTE5QUJcdTE5QjAtXHUxOUM5XHUxQTAwLVx1MUExNlx1MUEyMC1cdTFBNTRcdTFBQTdcdTFCMDUtXHUxQjMzXHUxQjQ1LVx1MUI0Qlx1MUI4My1cdTFCQTBcdTFCQUVcdTFCQUZcdTFCQkEtXHUxQkU1XHUxQzAwLVx1MUMyM1x1MUM0RC1cdTFDNEZcdTFDNUEtXHUxQzdEXHUxQ0U5LVx1MUNFQ1x1MUNFRS1cdTFDRjFcdTFDRjVcdTFDRjZcdTFEMDAtXHUxREJGXHUxRTAwLVx1MUYxNVx1MUYxOC1cdTFGMURcdTFGMjAtXHUxRjQ1XHUxRjQ4LVx1MUY0RFx1MUY1MC1cdTFGNTdcdTFGNTlcdTFGNUJcdTFGNURcdTFGNUYtXHUxRjdEXHUxRjgwLVx1MUZCNFx1MUZCNi1cdTFGQkNcdTFGQkVcdTFGQzItXHUxRkM0XHUxRkM2LVx1MUZDQ1x1MUZEMC1cdTFGRDNcdTFGRDYtXHUxRkRCXHUxRkUwLVx1MUZFQ1x1MUZGMi1cdTFGRjRcdTFGRjYtXHUxRkZDXHUyMDcxXHUyMDdGXHUyMDkwLVx1MjA5Q1x1MjEwMlx1MjEwN1x1MjEwQS1cdTIxMTNcdTIxMTVcdTIxMTgtXHUyMTFEXHUyMTI0XHUyMTI2XHUyMTI4XHUyMTJBLVx1MjEzOVx1MjEzQy1cdTIxM0ZcdTIxNDUtXHUyMTQ5XHUyMTRFXHUyMTYwLVx1MjE4OFx1MkMwMC1cdTJDMkVcdTJDMzAtXHUyQzVFXHUyQzYwLVx1MkNFNFx1MkNFQi1cdTJDRUVcdTJDRjJcdTJDRjNcdTJEMDAtXHUyRDI1XHUyRDI3XHUyRDJEXHUyRDMwLVx1MkQ2N1x1MkQ2Rlx1MkQ4MC1cdTJEOTZcdTJEQTAtXHUyREE2XHUyREE4LVx1MkRBRVx1MkRCMC1cdTJEQjZcdTJEQjgtXHUyREJFXHUyREMwLVx1MkRDNlx1MkRDOC1cdTJEQ0VcdTJERDAtXHUyREQ2XHUyREQ4LVx1MkRERVx1MzAwNS1cdTMwMDdcdTMwMjEtXHUzMDI5XHUzMDMxLVx1MzAzNVx1MzAzOC1cdTMwM0NcdTMwNDEtXHUzMDk2XHUzMDlCLVx1MzA5Rlx1MzBBMS1cdTMwRkFcdTMwRkMtXHUzMEZGXHUzMTA1LVx1MzEyRFx1MzEzMS1cdTMxOEVcdTMxQTAtXHUzMUJBXHUzMUYwLVx1MzFGRlx1MzQwMC1cdTREQjVcdTRFMDAtXHU5RkQ1XHVBMDAwLVx1QTQ4Q1x1QTREMC1cdUE0RkRcdUE1MDAtXHVBNjBDXHVBNjEwLVx1QTYxRlx1QTYyQVx1QTYyQlx1QTY0MC1cdUE2NkVcdUE2N0YtXHVBNjlEXHVBNkEwLVx1QTZFRlx1QTcxNy1cdUE3MUZcdUE3MjItXHVBNzg4XHVBNzhCLVx1QTdBRFx1QTdCMC1cdUE3QjdcdUE3RjctXHVBODAxXHVBODAzLVx1QTgwNVx1QTgwNy1cdUE4MEFcdUE4MEMtXHVBODIyXHVBODQwLVx1QTg3M1x1QTg4Mi1cdUE4QjNcdUE4RjItXHVBOEY3XHVBOEZCXHVBOEZEXHVBOTBBLVx1QTkyNVx1QTkzMC1cdUE5NDZcdUE5NjAtXHVBOTdDXHVBOTg0LVx1QTlCMlx1QTlDRlx1QTlFMC1cdUE5RTRcdUE5RTYtXHVBOUVGXHVBOUZBLVx1QTlGRVx1QUEwMC1cdUFBMjhcdUFBNDAtXHVBQTQyXHVBQTQ0LVx1QUE0Qlx1QUE2MC1cdUFBNzZcdUFBN0FcdUFBN0UtXHVBQUFGXHVBQUIxXHVBQUI1XHVBQUI2XHVBQUI5LVx1QUFCRFx1QUFDMFx1QUFDMlx1QUFEQi1cdUFBRERcdUFBRTAtXHVBQUVBXHVBQUYyLVx1QUFGNFx1QUIwMS1cdUFCMDZcdUFCMDktXHVBQjBFXHVBQjExLVx1QUIxNlx1QUIyMC1cdUFCMjZcdUFCMjgtXHVBQjJFXHVBQjMwLVx1QUI1QVx1QUI1Qy1cdUFCNjVcdUFCNzAtXHVBQkUyXHVBQzAwLVx1RDdBM1x1RDdCMC1cdUQ3QzZcdUQ3Q0ItXHVEN0ZCXHVGOTAwLVx1RkE2RFx1RkE3MC1cdUZBRDlcdUZCMDAtXHVGQjA2XHVGQjEzLVx1RkIxN1x1RkIxRFx1RkIxRi1cdUZCMjhcdUZCMkEtXHVGQjM2XHVGQjM4LVx1RkIzQ1x1RkIzRVx1RkI0MFx1RkI0MVx1RkI0M1x1RkI0NFx1RkI0Ni1cdUZCQjFcdUZCRDMtXHVGRDNEXHVGRDUwLVx1RkQ4Rlx1RkQ5Mi1cdUZEQzdcdUZERjAtXHVGREZCXHVGRTcwLVx1RkU3NFx1RkU3Ni1cdUZFRkNcdUZGMjEtXHVGRjNBXHVGRjQxLVx1RkY1QVx1RkY2Ni1cdUZGQkVcdUZGQzItXHVGRkM3XHVGRkNBLVx1RkZDRlx1RkZEMi1cdUZGRDdcdUZGREEtXHVGRkRDXXxcdUQ4MDBbXHVEQzAwLVx1REMwQlx1REMwRC1cdURDMjZcdURDMjgtXHVEQzNBXHVEQzNDXHVEQzNEXHVEQzNGLVx1REM0RFx1REM1MC1cdURDNURcdURDODAtXHVEQ0ZBXHVERDQwLVx1REQ3NFx1REU4MC1cdURFOUNcdURFQTAtXHVERUQwXHVERjAwLVx1REYxRlx1REYzMC1cdURGNEFcdURGNTAtXHVERjc1XHVERjgwLVx1REY5RFx1REZBMC1cdURGQzNcdURGQzgtXHVERkNGXHVERkQxLVx1REZENV18XHVEODAxW1x1REMwMC1cdURDOURcdUREMDAtXHVERDI3XHVERDMwLVx1REQ2M1x1REUwMC1cdURGMzZcdURGNDAtXHVERjU1XHVERjYwLVx1REY2N118XHVEODAyW1x1REMwMC1cdURDMDVcdURDMDhcdURDMEEtXHVEQzM1XHVEQzM3XHVEQzM4XHVEQzNDXHVEQzNGLVx1REM1NVx1REM2MC1cdURDNzZcdURDODAtXHVEQzlFXHVEQ0UwLVx1RENGMlx1RENGNFx1RENGNVx1REQwMC1cdUREMTVcdUREMjAtXHVERDM5XHVERDgwLVx1RERCN1x1RERCRVx1RERCRlx1REUwMFx1REUxMC1cdURFMTNcdURFMTUtXHVERTE3XHVERTE5LVx1REUzM1x1REU2MC1cdURFN0NcdURFODAtXHVERTlDXHVERUMwLVx1REVDN1x1REVDOS1cdURFRTRcdURGMDAtXHVERjM1XHVERjQwLVx1REY1NVx1REY2MC1cdURGNzJcdURGODAtXHVERjkxXXxcdUQ4MDNbXHVEQzAwLVx1REM0OFx1REM4MC1cdURDQjJcdURDQzAtXHVEQ0YyXXxcdUQ4MDRbXHVEQzAzLVx1REMzN1x1REM4My1cdURDQUZcdURDRDAtXHVEQ0U4XHVERDAzLVx1REQyNlx1REQ1MC1cdURENzJcdURENzZcdUREODMtXHVEREIyXHVEREMxLVx1RERDNFx1REREQVx1REREQ1x1REUwMC1cdURFMTFcdURFMTMtXHVERTJCXHVERTgwLVx1REU4Nlx1REU4OFx1REU4QS1cdURFOERcdURFOEYtXHVERTlEXHVERTlGLVx1REVBOFx1REVCMC1cdURFREVcdURGMDUtXHVERjBDXHVERjBGXHVERjEwXHVERjEzLVx1REYyOFx1REYyQS1cdURGMzBcdURGMzJcdURGMzNcdURGMzUtXHVERjM5XHVERjNEXHVERjUwXHVERjVELVx1REY2MV18XHVEODA1W1x1REM4MC1cdURDQUZcdURDQzRcdURDQzVcdURDQzdcdUREODAtXHVEREFFXHVEREQ4LVx1REREQlx1REUwMC1cdURFMkZcdURFNDRcdURFODAtXHVERUFBXHVERjAwLVx1REYxOV18XHVEODA2W1x1RENBMC1cdURDREZcdURDRkZcdURFQzAtXHVERUY4XXxcdUQ4MDhbXHVEQzAwLVx1REY5OV18XHVEODA5W1x1REMwMC1cdURDNkVcdURDODAtXHVERDQzXXxbXHVEODBDXHVEODQwLVx1RDg2OFx1RDg2QS1cdUQ4NkNcdUQ4NkYtXHVEODcyXVtcdURDMDAtXHVERkZGXXxcdUQ4MERbXHVEQzAwLVx1REMyRV18XHVEODExW1x1REMwMC1cdURFNDZdfFx1RDgxQVtcdURDMDAtXHVERTM4XHVERTQwLVx1REU1RVx1REVEMC1cdURFRURcdURGMDAtXHVERjJGXHVERjQwLVx1REY0M1x1REY2My1cdURGNzdcdURGN0QtXHVERjhGXXxcdUQ4MUJbXHVERjAwLVx1REY0NFx1REY1MFx1REY5My1cdURGOUZdfFx1RDgyQ1tcdURDMDBcdURDMDFdfFx1RDgyRltcdURDMDAtXHVEQzZBXHVEQzcwLVx1REM3Q1x1REM4MC1cdURDODhcdURDOTAtXHVEQzk5XXxcdUQ4MzVbXHVEQzAwLVx1REM1NFx1REM1Ni1cdURDOUNcdURDOUVcdURDOUZcdURDQTJcdURDQTVcdURDQTZcdURDQTktXHVEQ0FDXHVEQ0FFLVx1RENCOVx1RENCQlx1RENCRC1cdURDQzNcdURDQzUtXHVERDA1XHVERDA3LVx1REQwQVx1REQwRC1cdUREMTRcdUREMTYtXHVERDFDXHVERDFFLVx1REQzOVx1REQzQi1cdUREM0VcdURENDAtXHVERDQ0XHVERDQ2XHVERDRBLVx1REQ1MFx1REQ1Mi1cdURFQTVcdURFQTgtXHVERUMwXHVERUMyLVx1REVEQVx1REVEQy1cdURFRkFcdURFRkMtXHVERjE0XHVERjE2LVx1REYzNFx1REYzNi1cdURGNEVcdURGNTAtXHVERjZFXHVERjcwLVx1REY4OFx1REY4QS1cdURGQThcdURGQUEtXHVERkMyXHVERkM0LVx1REZDQl18XHVEODNBW1x1REMwMC1cdURDQzRdfFx1RDgzQltcdURFMDAtXHVERTAzXHVERTA1LVx1REUxRlx1REUyMVx1REUyMlx1REUyNFx1REUyN1x1REUyOS1cdURFMzJcdURFMzQtXHVERTM3XHVERTM5XHVERTNCXHVERTQyXHVERTQ3XHVERTQ5XHVERTRCXHVERTRELVx1REU0Rlx1REU1MVx1REU1Mlx1REU1NFx1REU1N1x1REU1OVx1REU1Qlx1REU1RFx1REU1Rlx1REU2MVx1REU2Mlx1REU2NFx1REU2Ny1cdURFNkFcdURFNkMtXHVERTcyXHVERTc0LVx1REU3N1x1REU3OS1cdURFN0NcdURFN0VcdURFODAtXHVERTg5XHVERThCLVx1REU5Qlx1REVBMS1cdURFQTNcdURFQTUtXHVERUE5XHVERUFCLVx1REVCQl18XHVEODY5W1x1REMwMC1cdURFRDZcdURGMDAtXHVERkZGXXxcdUQ4NkRbXHVEQzAwLVx1REYzNFx1REY0MC1cdURGRkZdfFx1RDg2RVtcdURDMDAtXHVEQzFEXHVEQzIwLVx1REZGRl18XHVEODczW1x1REMwMC1cdURFQTFdfFx1RDg3RVtcdURDMDAtXHVERTFEXSkoPzpbXCQwLTlBLVpfYS16XHhBQVx4QjVceEI3XHhCQVx4QzAtXHhENlx4RDgtXHhGNlx4RjgtXHUwMkMxXHUwMkM2LVx1MDJEMVx1MDJFMC1cdTAyRTRcdTAyRUNcdTAyRUVcdTAzMDAtXHUwMzc0XHUwMzc2XHUwMzc3XHUwMzdBLVx1MDM3RFx1MDM3Rlx1MDM4Ni1cdTAzOEFcdTAzOENcdTAzOEUtXHUwM0ExXHUwM0EzLVx1MDNGNVx1MDNGNy1cdTA0ODFcdTA0ODMtXHUwNDg3XHUwNDhBLVx1MDUyRlx1MDUzMS1cdTA1NTZcdTA1NTlcdTA1NjEtXHUwNTg3XHUwNTkxLVx1MDVCRFx1MDVCRlx1MDVDMVx1MDVDMlx1MDVDNFx1MDVDNVx1MDVDN1x1MDVEMC1cdTA1RUFcdTA1RjAtXHUwNUYyXHUwNjEwLVx1MDYxQVx1MDYyMC1cdTA2NjlcdTA2NkUtXHUwNkQzXHUwNkQ1LVx1MDZEQ1x1MDZERi1cdTA2RThcdTA2RUEtXHUwNkZDXHUwNkZGXHUwNzEwLVx1MDc0QVx1MDc0RC1cdTA3QjFcdTA3QzAtXHUwN0Y1XHUwN0ZBXHUwODAwLVx1MDgyRFx1MDg0MC1cdTA4NUJcdTA4QTAtXHUwOEI0XHUwOEUzLVx1MDk2M1x1MDk2Ni1cdTA5NkZcdTA5NzEtXHUwOTgzXHUwOTg1LVx1MDk4Q1x1MDk4Rlx1MDk5MFx1MDk5My1cdTA5QThcdTA5QUEtXHUwOUIwXHUwOUIyXHUwOUI2LVx1MDlCOVx1MDlCQy1cdTA5QzRcdTA5QzdcdTA5QzhcdTA5Q0ItXHUwOUNFXHUwOUQ3XHUwOURDXHUwOUREXHUwOURGLVx1MDlFM1x1MDlFNi1cdTA5RjFcdTBBMDEtXHUwQTAzXHUwQTA1LVx1MEEwQVx1MEEwRlx1MEExMFx1MEExMy1cdTBBMjhcdTBBMkEtXHUwQTMwXHUwQTMyXHUwQTMzXHUwQTM1XHUwQTM2XHUwQTM4XHUwQTM5XHUwQTNDXHUwQTNFLVx1MEE0Mlx1MEE0N1x1MEE0OFx1MEE0Qi1cdTBBNERcdTBBNTFcdTBBNTktXHUwQTVDXHUwQTVFXHUwQTY2LVx1MEE3NVx1MEE4MS1cdTBBODNcdTBBODUtXHUwQThEXHUwQThGLVx1MEE5MVx1MEE5My1cdTBBQThcdTBBQUEtXHUwQUIwXHUwQUIyXHUwQUIzXHUwQUI1LVx1MEFCOVx1MEFCQy1cdTBBQzVcdTBBQzctXHUwQUM5XHUwQUNCLVx1MEFDRFx1MEFEMFx1MEFFMC1cdTBBRTNcdTBBRTYtXHUwQUVGXHUwQUY5XHUwQjAxLVx1MEIwM1x1MEIwNS1cdTBCMENcdTBCMEZcdTBCMTBcdTBCMTMtXHUwQjI4XHUwQjJBLVx1MEIzMFx1MEIzMlx1MEIzM1x1MEIzNS1cdTBCMzlcdTBCM0MtXHUwQjQ0XHUwQjQ3XHUwQjQ4XHUwQjRCLVx1MEI0RFx1MEI1Nlx1MEI1N1x1MEI1Q1x1MEI1RFx1MEI1Ri1cdTBCNjNcdTBCNjYtXHUwQjZGXHUwQjcxXHUwQjgyXHUwQjgzXHUwQjg1LVx1MEI4QVx1MEI4RS1cdTBCOTBcdTBCOTItXHUwQjk1XHUwQjk5XHUwQjlBXHUwQjlDXHUwQjlFXHUwQjlGXHUwQkEzXHUwQkE0XHUwQkE4LVx1MEJBQVx1MEJBRS1cdTBCQjlcdTBCQkUtXHUwQkMyXHUwQkM2LVx1MEJDOFx1MEJDQS1cdTBCQ0RcdTBCRDBcdTBCRDdcdTBCRTYtXHUwQkVGXHUwQzAwLVx1MEMwM1x1MEMwNS1cdTBDMENcdTBDMEUtXHUwQzEwXHUwQzEyLVx1MEMyOFx1MEMyQS1cdTBDMzlcdTBDM0QtXHUwQzQ0XHUwQzQ2LVx1MEM0OFx1MEM0QS1cdTBDNERcdTBDNTVcdTBDNTZcdTBDNTgtXHUwQzVBXHUwQzYwLVx1MEM2M1x1MEM2Ni1cdTBDNkZcdTBDODEtXHUwQzgzXHUwQzg1LVx1MEM4Q1x1MEM4RS1cdTBDOTBcdTBDOTItXHUwQ0E4XHUwQ0FBLVx1MENCM1x1MENCNS1cdTBDQjlcdTBDQkMtXHUwQ0M0XHUwQ0M2LVx1MENDOFx1MENDQS1cdTBDQ0RcdTBDRDVcdTBDRDZcdTBDREVcdTBDRTAtXHUwQ0UzXHUwQ0U2LVx1MENFRlx1MENGMVx1MENGMlx1MEQwMS1cdTBEMDNcdTBEMDUtXHUwRDBDXHUwRDBFLVx1MEQxMFx1MEQxMi1cdTBEM0FcdTBEM0QtXHUwRDQ0XHUwRDQ2LVx1MEQ0OFx1MEQ0QS1cdTBENEVcdTBENTdcdTBENUYtXHUwRDYzXHUwRDY2LVx1MEQ2Rlx1MEQ3QS1cdTBEN0ZcdTBEODJcdTBEODNcdTBEODUtXHUwRDk2XHUwRDlBLVx1MERCMVx1MERCMy1cdTBEQkJcdTBEQkRcdTBEQzAtXHUwREM2XHUwRENBXHUwRENGLVx1MERENFx1MERENlx1MEREOC1cdTBEREZcdTBERTYtXHUwREVGXHUwREYyXHUwREYzXHUwRTAxLVx1MEUzQVx1MEU0MC1cdTBFNEVcdTBFNTAtXHUwRTU5XHUwRTgxXHUwRTgyXHUwRTg0XHUwRTg3XHUwRTg4XHUwRThBXHUwRThEXHUwRTk0LVx1MEU5N1x1MEU5OS1cdTBFOUZcdTBFQTEtXHUwRUEzXHUwRUE1XHUwRUE3XHUwRUFBXHUwRUFCXHUwRUFELVx1MEVCOVx1MEVCQi1cdTBFQkRcdTBFQzAtXHUwRUM0XHUwRUM2XHUwRUM4LVx1MEVDRFx1MEVEMC1cdTBFRDlcdTBFREMtXHUwRURGXHUwRjAwXHUwRjE4XHUwRjE5XHUwRjIwLVx1MEYyOVx1MEYzNVx1MEYzN1x1MEYzOVx1MEYzRS1cdTBGNDdcdTBGNDktXHUwRjZDXHUwRjcxLVx1MEY4NFx1MEY4Ni1cdTBGOTdcdTBGOTktXHUwRkJDXHUwRkM2XHUxMDAwLVx1MTA0OVx1MTA1MC1cdTEwOURcdTEwQTAtXHUxMEM1XHUxMEM3XHUxMENEXHUxMEQwLVx1MTBGQVx1MTBGQy1cdTEyNDhcdTEyNEEtXHUxMjREXHUxMjUwLVx1MTI1Nlx1MTI1OFx1MTI1QS1cdTEyNURcdTEyNjAtXHUxMjg4XHUxMjhBLVx1MTI4RFx1MTI5MC1cdTEyQjBcdTEyQjItXHUxMkI1XHUxMkI4LVx1MTJCRVx1MTJDMFx1MTJDMi1cdTEyQzVcdTEyQzgtXHUxMkQ2XHUxMkQ4LVx1MTMxMFx1MTMxMi1cdTEzMTVcdTEzMTgtXHUxMzVBXHUxMzVELVx1MTM1Rlx1MTM2OS1cdTEzNzFcdTEzODAtXHUxMzhGXHUxM0EwLVx1MTNGNVx1MTNGOC1cdTEzRkRcdTE0MDEtXHUxNjZDXHUxNjZGLVx1MTY3Rlx1MTY4MS1cdTE2OUFcdTE2QTAtXHUxNkVBXHUxNkVFLVx1MTZGOFx1MTcwMC1cdTE3MENcdTE3MEUtXHUxNzE0XHUxNzIwLVx1MTczNFx1MTc0MC1cdTE3NTNcdTE3NjAtXHUxNzZDXHUxNzZFLVx1MTc3MFx1MTc3Mlx1MTc3M1x1MTc4MC1cdTE3RDNcdTE3RDdcdTE3RENcdTE3RERcdTE3RTAtXHUxN0U5XHUxODBCLVx1MTgwRFx1MTgxMC1cdTE4MTlcdTE4MjAtXHUxODc3XHUxODgwLVx1MThBQVx1MThCMC1cdTE4RjVcdTE5MDAtXHUxOTFFXHUxOTIwLVx1MTkyQlx1MTkzMC1cdTE5M0JcdTE5NDYtXHUxOTZEXHUxOTcwLVx1MTk3NFx1MTk4MC1cdTE5QUJcdTE5QjAtXHUxOUM5XHUxOUQwLVx1MTlEQVx1MUEwMC1cdTFBMUJcdTFBMjAtXHUxQTVFXHUxQTYwLVx1MUE3Q1x1MUE3Ri1cdTFBODlcdTFBOTAtXHUxQTk5XHUxQUE3XHUxQUIwLVx1MUFCRFx1MUIwMC1cdTFCNEJcdTFCNTAtXHUxQjU5XHUxQjZCLVx1MUI3M1x1MUI4MC1cdTFCRjNcdTFDMDAtXHUxQzM3XHUxQzQwLVx1MUM0OVx1MUM0RC1cdTFDN0RcdTFDRDAtXHUxQ0QyXHUxQ0Q0LVx1MUNGNlx1MUNGOFx1MUNGOVx1MUQwMC1cdTFERjVcdTFERkMtXHUxRjE1XHUxRjE4LVx1MUYxRFx1MUYyMC1cdTFGNDVcdTFGNDgtXHUxRjREXHUxRjUwLVx1MUY1N1x1MUY1OVx1MUY1Qlx1MUY1RFx1MUY1Ri1cdTFGN0RcdTFGODAtXHUxRkI0XHUxRkI2LVx1MUZCQ1x1MUZCRVx1MUZDMi1cdTFGQzRcdTFGQzYtXHUxRkNDXHUxRkQwLVx1MUZEM1x1MUZENi1cdTFGREJcdTFGRTAtXHUxRkVDXHUxRkYyLVx1MUZGNFx1MUZGNi1cdTFGRkNcdTIwMENcdTIwMERcdTIwM0ZcdTIwNDBcdTIwNTRcdTIwNzFcdTIwN0ZcdTIwOTAtXHUyMDlDXHUyMEQwLVx1MjBEQ1x1MjBFMVx1MjBFNS1cdTIwRjBcdTIxMDJcdTIxMDdcdTIxMEEtXHUyMTEzXHUyMTE1XHUyMTE4LVx1MjExRFx1MjEyNFx1MjEyNlx1MjEyOFx1MjEyQS1cdTIxMzlcdTIxM0MtXHUyMTNGXHUyMTQ1LVx1MjE0OVx1MjE0RVx1MjE2MC1cdTIxODhcdTJDMDAtXHUyQzJFXHUyQzMwLVx1MkM1RVx1MkM2MC1cdTJDRTRcdTJDRUItXHUyQ0YzXHUyRDAwLVx1MkQyNVx1MkQyN1x1MkQyRFx1MkQzMC1cdTJENjdcdTJENkZcdTJEN0YtXHUyRDk2XHUyREEwLVx1MkRBNlx1MkRBOC1cdTJEQUVcdTJEQjAtXHUyREI2XHUyREI4LVx1MkRCRVx1MkRDMC1cdTJEQzZcdTJEQzgtXHUyRENFXHUyREQwLVx1MkRENlx1MkREOC1cdTJEREVcdTJERTAtXHUyREZGXHUzMDA1LVx1MzAwN1x1MzAyMS1cdTMwMkZcdTMwMzEtXHUzMDM1XHUzMDM4LVx1MzAzQ1x1MzA0MS1cdTMwOTZcdTMwOTktXHUzMDlGXHUzMEExLVx1MzBGQVx1MzBGQy1cdTMwRkZcdTMxMDUtXHUzMTJEXHUzMTMxLVx1MzE4RVx1MzFBMC1cdTMxQkFcdTMxRjAtXHUzMUZGXHUzNDAwLVx1NERCNVx1NEUwMC1cdTlGRDVcdUEwMDAtXHVBNDhDXHVBNEQwLVx1QTRGRFx1QTUwMC1cdUE2MENcdUE2MTAtXHVBNjJCXHVBNjQwLVx1QTY2Rlx1QTY3NC1cdUE2N0RcdUE2N0YtXHVBNkYxXHVBNzE3LVx1QTcxRlx1QTcyMi1cdUE3ODhcdUE3OEItXHVBN0FEXHVBN0IwLVx1QTdCN1x1QTdGNy1cdUE4MjdcdUE4NDAtXHVBODczXHVBODgwLVx1QThDNFx1QThEMC1cdUE4RDlcdUE4RTAtXHVBOEY3XHVBOEZCXHVBOEZEXHVBOTAwLVx1QTkyRFx1QTkzMC1cdUE5NTNcdUE5NjAtXHVBOTdDXHVBOTgwLVx1QTlDMFx1QTlDRi1cdUE5RDlcdUE5RTAtXHVBOUZFXHVBQTAwLVx1QUEzNlx1QUE0MC1cdUFBNERcdUFBNTAtXHVBQTU5XHVBQTYwLVx1QUE3Nlx1QUE3QS1cdUFBQzJcdUFBREItXHVBQUREXHVBQUUwLVx1QUFFRlx1QUFGMi1cdUFBRjZcdUFCMDEtXHVBQjA2XHVBQjA5LVx1QUIwRVx1QUIxMS1cdUFCMTZcdUFCMjAtXHVBQjI2XHVBQjI4LVx1QUIyRVx1QUIzMC1cdUFCNUFcdUFCNUMtXHVBQjY1XHVBQjcwLVx1QUJFQVx1QUJFQ1x1QUJFRFx1QUJGMC1cdUFCRjlcdUFDMDAtXHVEN0EzXHVEN0IwLVx1RDdDNlx1RDdDQi1cdUQ3RkJcdUY5MDAtXHVGQTZEXHVGQTcwLVx1RkFEOVx1RkIwMC1cdUZCMDZcdUZCMTMtXHVGQjE3XHVGQjFELVx1RkIyOFx1RkIyQS1cdUZCMzZcdUZCMzgtXHVGQjNDXHVGQjNFXHVGQjQwXHVGQjQxXHVGQjQzXHVGQjQ0XHVGQjQ2LVx1RkJCMVx1RkJEMy1cdUZEM0RcdUZENTAtXHVGRDhGXHVGRDkyLVx1RkRDN1x1RkRGMC1cdUZERkJcdUZFMDAtXHVGRTBGXHVGRTIwLVx1RkUyRlx1RkUzM1x1RkUzNFx1RkU0RC1cdUZFNEZcdUZFNzAtXHVGRTc0XHVGRTc2LVx1RkVGQ1x1RkYxMC1cdUZGMTlcdUZGMjEtXHVGRjNBXHVGRjNGXHVGRjQxLVx1RkY1QVx1RkY2Ni1cdUZGQkVcdUZGQzItXHVGRkM3XHVGRkNBLVx1RkZDRlx1RkZEMi1cdUZGRDdcdUZGREEtXHVGRkRDXXxcdUQ4MDBbXHVEQzAwLVx1REMwQlx1REMwRC1cdURDMjZcdURDMjgtXHVEQzNBXHVEQzNDXHVEQzNEXHVEQzNGLVx1REM0RFx1REM1MC1cdURDNURcdURDODAtXHVEQ0ZBXHVERDQwLVx1REQ3NFx1RERGRFx1REU4MC1cdURFOUNcdURFQTAtXHVERUQwXHVERUUwXHVERjAwLVx1REYxRlx1REYzMC1cdURGNEFcdURGNTAtXHVERjdBXHVERjgwLVx1REY5RFx1REZBMC1cdURGQzNcdURGQzgtXHVERkNGXHVERkQxLVx1REZENV18XHVEODAxW1x1REMwMC1cdURDOURcdURDQTAtXHVEQ0E5XHVERDAwLVx1REQyN1x1REQzMC1cdURENjNcdURFMDAtXHVERjM2XHVERjQwLVx1REY1NVx1REY2MC1cdURGNjddfFx1RDgwMltcdURDMDAtXHVEQzA1XHVEQzA4XHVEQzBBLVx1REMzNVx1REMzN1x1REMzOFx1REMzQ1x1REMzRi1cdURDNTVcdURDNjAtXHVEQzc2XHVEQzgwLVx1REM5RVx1RENFMC1cdURDRjJcdURDRjRcdURDRjVcdUREMDAtXHVERDE1XHVERDIwLVx1REQzOVx1REQ4MC1cdUREQjdcdUREQkVcdUREQkZcdURFMDAtXHVERTAzXHVERTA1XHVERTA2XHVERTBDLVx1REUxM1x1REUxNS1cdURFMTdcdURFMTktXHVERTMzXHVERTM4LVx1REUzQVx1REUzRlx1REU2MC1cdURFN0NcdURFODAtXHVERTlDXHVERUMwLVx1REVDN1x1REVDOS1cdURFRTZcdURGMDAtXHVERjM1XHVERjQwLVx1REY1NVx1REY2MC1cdURGNzJcdURGODAtXHVERjkxXXxcdUQ4MDNbXHVEQzAwLVx1REM0OFx1REM4MC1cdURDQjJcdURDQzAtXHVEQ0YyXXxcdUQ4MDRbXHVEQzAwLVx1REM0Nlx1REM2Ni1cdURDNkZcdURDN0YtXHVEQ0JBXHVEQ0QwLVx1RENFOFx1RENGMC1cdURDRjlcdUREMDAtXHVERDM0XHVERDM2LVx1REQzRlx1REQ1MC1cdURENzNcdURENzZcdUREODAtXHVEREM0XHVERENBLVx1RERDQ1x1REREMC1cdUREREFcdURERENcdURFMDAtXHVERTExXHVERTEzLVx1REUzN1x1REU4MC1cdURFODZcdURFODhcdURFOEEtXHVERThEXHVERThGLVx1REU5RFx1REU5Ri1cdURFQThcdURFQjAtXHVERUVBXHVERUYwLVx1REVGOVx1REYwMC1cdURGMDNcdURGMDUtXHVERjBDXHVERjBGXHVERjEwXHVERjEzLVx1REYyOFx1REYyQS1cdURGMzBcdURGMzJcdURGMzNcdURGMzUtXHVERjM5XHVERjNDLVx1REY0NFx1REY0N1x1REY0OFx1REY0Qi1cdURGNERcdURGNTBcdURGNTdcdURGNUQtXHVERjYzXHVERjY2LVx1REY2Q1x1REY3MC1cdURGNzRdfFx1RDgwNVtcdURDODAtXHVEQ0M1XHVEQ0M3XHVEQ0QwLVx1RENEOVx1REQ4MC1cdUREQjVcdUREQjgtXHVEREMwXHVEREQ4LVx1RERERFx1REUwMC1cdURFNDBcdURFNDRcdURFNTAtXHVERTU5XHVERTgwLVx1REVCN1x1REVDMC1cdURFQzlcdURGMDAtXHVERjE5XHVERjFELVx1REYyQlx1REYzMC1cdURGMzldfFx1RDgwNltcdURDQTAtXHVEQ0U5XHVEQ0ZGXHVERUMwLVx1REVGOF18XHVEODA4W1x1REMwMC1cdURGOTldfFx1RDgwOVtcdURDMDAtXHVEQzZFXHVEQzgwLVx1REQ0M118W1x1RDgwQ1x1RDg0MC1cdUQ4NjhcdUQ4NkEtXHVEODZDXHVEODZGLVx1RDg3Ml1bXHVEQzAwLVx1REZGRl18XHVEODBEW1x1REMwMC1cdURDMkVdfFx1RDgxMVtcdURDMDAtXHVERTQ2XXxcdUQ4MUFbXHVEQzAwLVx1REUzOFx1REU0MC1cdURFNUVcdURFNjAtXHVERTY5XHVERUQwLVx1REVFRFx1REVGMC1cdURFRjRcdURGMDAtXHVERjM2XHVERjQwLVx1REY0M1x1REY1MC1cdURGNTlcdURGNjMtXHVERjc3XHVERjdELVx1REY4Rl18XHVEODFCW1x1REYwMC1cdURGNDRcdURGNTAtXHVERjdFXHVERjhGLVx1REY5Rl18XHVEODJDW1x1REMwMFx1REMwMV18XHVEODJGW1x1REMwMC1cdURDNkFcdURDNzAtXHVEQzdDXHVEQzgwLVx1REM4OFx1REM5MC1cdURDOTlcdURDOURcdURDOUVdfFx1RDgzNFtcdURENjUtXHVERDY5XHVERDZELVx1REQ3Mlx1REQ3Qi1cdUREODJcdUREODUtXHVERDhCXHVEREFBLVx1RERBRFx1REU0Mi1cdURFNDRdfFx1RDgzNVtcdURDMDAtXHVEQzU0XHVEQzU2LVx1REM5Q1x1REM5RVx1REM5Rlx1RENBMlx1RENBNVx1RENBNlx1RENBOS1cdURDQUNcdURDQUUtXHVEQ0I5XHVEQ0JCXHVEQ0JELVx1RENDM1x1RENDNS1cdUREMDVcdUREMDctXHVERDBBXHVERDBELVx1REQxNFx1REQxNi1cdUREMUNcdUREMUUtXHVERDM5XHVERDNCLVx1REQzRVx1REQ0MC1cdURENDRcdURENDZcdURENEEtXHVERDUwXHVERDUyLVx1REVBNVx1REVBOC1cdURFQzBcdURFQzItXHVERURBXHVERURDLVx1REVGQVx1REVGQy1cdURGMTRcdURGMTYtXHVERjM0XHVERjM2LVx1REY0RVx1REY1MC1cdURGNkVcdURGNzAtXHVERjg4XHVERjhBLVx1REZBOFx1REZBQS1cdURGQzJcdURGQzQtXHVERkNCXHVERkNFLVx1REZGRl18XHVEODM2W1x1REUwMC1cdURFMzZcdURFM0ItXHVERTZDXHVERTc1XHVERTg0XHVERTlCLVx1REU5Rlx1REVBMS1cdURFQUZdfFx1RDgzQVtcdURDMDAtXHVEQ0M0XHVEQ0QwLVx1RENENl18XHVEODNCW1x1REUwMC1cdURFMDNcdURFMDUtXHVERTFGXHVERTIxXHVERTIyXHVERTI0XHVERTI3XHVERTI5LVx1REUzMlx1REUzNC1cdURFMzdcdURFMzlcdURFM0JcdURFNDJcdURFNDdcdURFNDlcdURFNEJcdURFNEQtXHVERTRGXHVERTUxXHVERTUyXHVERTU0XHVERTU3XHVERTU5XHVERTVCXHVERTVEXHVERTVGXHVERTYxXHVERTYyXHVERTY0XHVERTY3LVx1REU2QVx1REU2Qy1cdURFNzJcdURFNzQtXHVERTc3XHVERTc5LVx1REU3Q1x1REU3RVx1REU4MC1cdURFODlcdURFOEItXHVERTlCXHVERUExLVx1REVBM1x1REVBNS1cdURFQTlcdURFQUItXHVERUJCXXxcdUQ4NjlbXHVEQzAwLVx1REVENlx1REYwMC1cdURGRkZdfFx1RDg2RFtcdURDMDAtXHVERjM0XHVERjQwLVx1REZGRl18XHVEODZFW1x1REMwMC1cdURDMURcdURDMjAtXHVERkZGXXxcdUQ4NzNbXHVEQzAwLVx1REVBMV18XHVEODdFW1x1REMwMC1cdURFMURdfFx1REI0MFtcdUREMDAtXHVEREVGXSkqJC8KICBqc2lkZW50aWZpZXJfcGF0dGVybiA9IC9eKD86WyRfXXxccHtJRF9TdGFydH0pKD86WyRfXHV7MjAwY31cdXsyMDBkfV18XHB7SURfQ29udGludWV9KSokL3U7CgogIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAvLyBUWVBFIERFQ0xBUkFUSU9OUwogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICB0aGlzLmRlY2xhcmVfdHlwZXMgPSBmdW5jdGlvbigpIHsKICAgIC8qIE5PVEUgdG8gYmUgY2FsbGVkIGFzIGAoIHJlcXVpcmUgJy4vZGVjbGFyYXRpb25zJyApLmRlY2xhcmVfdHlwZXMuYXBwbHkgaW5zdGFuY2VgICovCiAgICB0aGlzLmRlY2xhcmUoJ251bGwnLCAoeCkgPT4gewogICAgICByZXR1cm4geCA9PT0gbnVsbDsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCd1bmRlZmluZWQnLCAoeCkgPT4gewogICAgICByZXR1cm4geCA9PT0gdm9pZCAwOwogICAgfSk7CiAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgdGhpcy5kZWNsYXJlKCdzYWQnLCAoeCkgPT4gewogICAgICByZXR1cm4gQ0hFQ0tTLmlzX3NhZCh4KTsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdoYXBweScsICh4KSA9PiB7CiAgICAgIHJldHVybiBDSEVDS1MuaXNfaGFwcHkoeCk7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnc2FkZGVuZWQnLCAoeCkgPT4gewogICAgICByZXR1cm4gQ0hFQ0tTLmlzX3NhZGRlbmVkKHgpOwogICAgfSk7CiAgICB0aGlzLmRlY2xhcmUoJ3N5bWJvbCcsICh4KSA9PiB7CiAgICAgIHJldHVybiB0eXBlb2YgeCA9PT0gJ3N5bWJvbCc7CiAgICB9KTsKICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICB0aGlzLmRlY2xhcmUoJ2Jvb2xlYW4nLCB7CiAgICAgIHRlc3RzOiB7CiAgICAgICAgInggaXMgdHJ1ZSBvciBmYWxzZSI6ICh4KSA9PiB7CiAgICAgICAgICByZXR1cm4gKHggPT09IHRydWUpIHx8ICh4ID09PSBmYWxzZSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBjYXN0czogewogICAgICAgIGZsb2F0OiAoeCkgPT4gewogICAgICAgICAgaWYgKHgpIHsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgIHRoaXMuZGVjbGFyZSgnbmFuJywgKHgpID0+IHsKICAgICAgcmV0dXJuIE51bWJlci5pc05hTih4KTsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdmaW5pdGUnLCAoeCkgPT4gewogICAgICByZXR1cm4gTnVtYmVyLmlzRmluaXRlKHgpOwogICAgfSk7CiAgICB0aGlzLi8qIFRBSU5UIG1ha2Ugc3VyZSBubyBub24tbnVtYmVycyBzbGlwIHRocm91Z2ggKi9kZWNsYXJlKCdpbnRlZ2VyJywgKHgpID0+IHsKICAgICAgcmV0dXJuIE51bWJlci5pc0ludGVnZXIoeCk7CiAgICB9KTsKICAgIHRoaXMuLyogVEFJTlQgbWFrZSBzdXJlIG5vIG5vbi1udW1iZXJzIHNsaXAgdGhyb3VnaCAqL2RlY2xhcmUoJ3NhZmVpbnRlZ2VyJywgKHgpID0+IHsKICAgICAgcmV0dXJuIE51bWJlci5pc1NhZmVJbnRlZ2VyKHgpOwogICAgfSk7CiAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgLyogRlRUQiB3ZSBhcmUgcmV0YWluaW5nIGBudW1iZXJgIGFzIGEgbGVzcy1wcmVmZXJyZWQgc3lub255bSBmb3IgYGZsb2F0YDsgaW4gdGhlIGZ1dHVyZSwgYG51bWJlcmAgbWF5CiAgICAgYmUgcmVtb3ZlZCBiZWNhdXNlIGl0IGNvbmZsaWN0cyB3aXRoIEpTIHVzYWdlICh3aGVyZSBpdCBpbmNsdWRlcyBgTmFOYCBhbmQgYCsvLUluZmluaXR5YCkgYW5kLCBtb3Jlb3ZlciwKICAgICBpcyBub3QgdHJ1dGhmdWwgKGJlY2F1c2UgaXQgaXMgYSBwb29yIHJlcHJlc2VudGF0aW9uIG9mIHdoYXQgdGhlIG1vZGVybiB1bmRlcnN0YW5kaW5nIG9mICdudW1iZXInIGluIHRoZQogICAgIG1hdGhlbWF0aWNhbCBzZW5zZSB3b3VsZCBpbXBseSkuICovCiAgICAvKiBOT1RFIHJlbW92ZWQgaW4gdjg6IGBAc3BlY3MubnVtYmVyID0gQHNwZWNzLmZsb2F0YCAqLwogICAgdGhpcy4vKiBUQUlOVCBtYWtlIHN1cmUgbm8gbm9uLW51bWJlcnMgc2xpcCB0aHJvdWdoICovZGVjbGFyZSgnbnVtYmVyJywgKHgpID0+IHsKICAgICAgcmV0dXJuIGZhbHNlOyAvLyB0aHJvdyBuZXcgRXJyb3IgIl5pbnRlcnR5cGVAODQ3NDReIHR5cGUgJ251bWJlcicgaXMgZGVwcmVjYXRlZCIKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdmbG9hdCcsIHsKICAgICAgdGVzdHM6ICh4KSA9PiB7CiAgICAgICAgcmV0dXJuIE51bWJlci5pc0Zpbml0ZSh4KTsKICAgICAgfSwKICAgICAgY2FzdHM6IHsKICAgICAgICBib29sZWFuOiAoeCkgPT4gewogICAgICAgICAgaWYgKHggPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpbnRlZ2VyOiAoeCkgPT4gewogICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoeCk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICB0aGlzLmRlY2xhcmUoJ2Zyb3plbicsICh4KSA9PiB7CiAgICAgIHJldHVybiBPYmplY3QuaXNGcm96ZW4oeCk7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnc2VhbGVkJywgKHgpID0+IHsKICAgICAgcmV0dXJuIE9iamVjdC5pc1NlYWxlZCh4KTsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdleHRlbnNpYmxlJywgKHgpID0+IHsKICAgICAgcmV0dXJuIE9iamVjdC5pc0V4dGVuc2libGUoeCk7CiAgICB9KTsKICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICB0aGlzLmRlY2xhcmUoJ251bWVyaWMnLCAoeCkgPT4gewogICAgICByZXR1cm4gKGpzX3R5cGVfb2YoeCkpID09PSAnbnVtYmVyJzsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdmdW5jdGlvbicsICh4KSA9PiB7CiAgICAgIHJldHVybiAoanNfdHlwZV9vZih4KSkgPT09ICdmdW5jdGlvbic7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnYXN5bmNmdW5jdGlvbicsICh4KSA9PiB7CiAgICAgIHJldHVybiAoanNfdHlwZV9vZih4KSkgPT09ICdhc3luY2Z1bmN0aW9uJzsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdnZW5lcmF0b3JmdW5jdGlvbicsICh4KSA9PiB7CiAgICAgIHJldHVybiAoanNfdHlwZV9vZih4KSkgPT09ICdnZW5lcmF0b3JmdW5jdGlvbic7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnYXN5bmNnZW5lcmF0b3JmdW5jdGlvbicsICh4KSA9PiB7CiAgICAgIHJldHVybiAoanNfdHlwZV9vZih4KSkgPT09ICdhc3luY2dlbmVyYXRvcmZ1bmN0aW9uJzsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdhc3luY2dlbmVyYXRvcicsICh4KSA9PiB7CiAgICAgIHJldHVybiAoanNfdHlwZV9vZih4KSkgPT09ICdhc3luY2dlbmVyYXRvcic7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnZ2VuZXJhdG9yJywgKHgpID0+IHsKICAgICAgcmV0dXJuIChqc190eXBlX29mKHgpKSA9PT0gJ2dlbmVyYXRvcic7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnZGF0ZScsICh4KSA9PiB7CiAgICAgIHJldHVybiAoanNfdHlwZV9vZih4KSkgPT09ICdkYXRlJzsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdsaXN0aXRlcmF0b3InLCAoeCkgPT4gewogICAgICByZXR1cm4gKGpzX3R5cGVfb2YoeCkpID09PSAnYXJyYXlpdGVyYXRvcic7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgndGV4dGl0ZXJhdG9yJywgKHgpID0+IHsKICAgICAgcmV0dXJuIChqc190eXBlX29mKHgpKSA9PT0gJ3N0cmluZ2l0ZXJhdG9yJzsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdzZXRpdGVyYXRvcicsICh4KSA9PiB7CiAgICAgIHJldHVybiAoanNfdHlwZV9vZih4KSkgPT09ICdzZXRpdGVyYXRvcic7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnbWFwaXRlcmF0b3InLCAoeCkgPT4gewogICAgICByZXR1cm4gKGpzX3R5cGVfb2YoeCkpID09PSAnbWFwaXRlcmF0b3InOwogICAgfSk7CiAgICB0aGlzLmRlY2xhcmUoJ2NhbGxhYmxlJywgKHgpID0+IHsKICAgICAgdmFyIHJlZjsKICAgICAgcmV0dXJuIChyZWYgPSB0aGlzLnR5cGVfb2YoeCkpID09PSAnZnVuY3Rpb24nIHx8IHJlZiA9PT0gJ2FzeW5jZnVuY3Rpb24nIHx8IHJlZiA9PT0gJ2dlbmVyYXRvcmZ1bmN0aW9uJzsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdwcm9taXNlJywgKHgpID0+IHsKICAgICAgcmV0dXJuICh0aGlzLmlzYS5uYXRpdmVwcm9taXNlKHgpKSB8fCAodGhpcy5pc2EudGhlbmFibGUoeCkpOwogICAgfSk7CiAgICB0aGlzLmRlY2xhcmUoJ25hdGl2ZXByb21pc2UnLCAoeCkgPT4gewogICAgICByZXR1cm4geCBpbnN0YW5jZW9mIFByb21pc2U7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgndGhlbmFibGUnLCAoeCkgPT4gewogICAgICByZXR1cm4gKHRoaXMudHlwZV9vZih4ICE9IG51bGwgPyB4LnRoZW4gOiB2b2lkIDApKSA9PT0gJ2Z1bmN0aW9uJzsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdpbW1lZGlhdGUnLCBmdW5jdGlvbih4KSB7CiAgICAgIHJldHVybiAhdGhpcy5pc2EucHJvbWlzZSh4KTsKICAgIH0pOwogICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgIHRoaXMuZGVjbGFyZSgndHJ1dGh5JywgKHgpID0+IHsKICAgICAgcmV0dXJuICEheDsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdmYWxzeScsICh4KSA9PiB7CiAgICAgIHJldHVybiAheDsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCd0cnVlJywgKHgpID0+IHsKICAgICAgcmV0dXJuIHggPT09IHRydWU7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnZmFsc2UnLCAoeCkgPT4gewogICAgICByZXR1cm4geCA9PT0gZmFsc2U7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgndW5zZXQnLCAoeCkgPT4gewogICAgICByZXR1cm4geCA9PSBudWxsOwogICAgfSk7CiAgICB0aGlzLmRlY2xhcmUoJ25vdHVuc2V0JywgKHgpID0+IHsKICAgICAgcmV0dXJuIHggIT0gbnVsbDsKICAgIH0pOwogICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgIHRoaXMuZGVjbGFyZSgnZXZlbicsICh4KSA9PiB7CiAgICAgIHJldHVybiAodGhpcy5pc2Euc2FmZWludGVnZXIoeCkpICYmIChtb2R1bG8oeCwgMikpID09PSAwOwogICAgfSk7CiAgICB0aGlzLmRlY2xhcmUoJ29kZCcsICh4KSA9PiB7CiAgICAgIHJldHVybiAodGhpcy5pc2Euc2FmZWludGVnZXIoeCkpICYmIChtb2R1bG8oeCwgMikpID09PSAxOwogICAgfSk7CiAgICB0aGlzLmRlY2xhcmUoJ2NhcmRpbmFsJywgZnVuY3Rpb24oeCkgewogICAgICByZXR1cm4gKHRoaXMuaXNhLnNhZmVpbnRlZ2VyKHgpKSAmJiAodGhpcy5pc2Eubm9ubmVnYXRpdmUoeCkpOwogICAgfSk7CiAgICB0aGlzLmRlY2xhcmUoJ25vbm5lZ2F0aXZlJywgKHgpID0+IHsKICAgICAgcmV0dXJuICh0aGlzLmlzYS5pbmZsb2F0KHgpKSAmJiAoeCA+PSAwKTsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdwb3NpdGl2ZScsICh4KSA9PiB7CiAgICAgIHJldHVybiAodGhpcy5pc2EuaW5mbG9hdCh4KSkgJiYgKHggPiAwKTsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdwb3NpdGl2ZV9mbG9hdCcsICh4KSA9PiB7CiAgICAgIHJldHVybiAodGhpcy5pc2EuZmxvYXQoeCkpICYmICh4ID4gMCk7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgncG9zaXRpdmVfaW50ZWdlcicsICh4KSA9PiB7CiAgICAgIHJldHVybiAodGhpcy5pc2EuaW50ZWdlcih4KSkgJiYgKHggPiAwKTsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCduZWdhdGl2ZV9pbnRlZ2VyJywgKHgpID0+IHsKICAgICAgcmV0dXJuICh0aGlzLmlzYS5pbnRlZ2VyKHgpKSAmJiAoeCA8IDApOwogICAgfSk7CiAgICB0aGlzLmRlY2xhcmUoJ3plcm8nLCAoeCkgPT4gewogICAgICByZXR1cm4geCA9PT0gMDsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdpbmZpbml0eScsICh4KSA9PiB7CiAgICAgIHJldHVybiAoeCA9PT0gKzJlMzA4KSB8fCAoeCA9PT0gLTJlMzA4KTsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdpbmZsb2F0JywgKHgpID0+IHsKICAgICAgcmV0dXJuICh0aGlzLmlzYS5mbG9hdCh4KSkgfHwgKHggPT09IDJlMzA4KSB8fCAoeCA9PT0gLTJlMzA4KTsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdub25wb3NpdGl2ZScsICh4KSA9PiB7CiAgICAgIHJldHVybiAodGhpcy5pc2EuaW5mbG9hdCh4KSkgJiYgKHggPD0gMCk7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnbmVnYXRpdmUnLCAoeCkgPT4gewogICAgICByZXR1cm4gKHRoaXMuaXNhLmluZmxvYXQoeCkpICYmICh4IDwgMCk7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnbmVnYXRpdmVfZmxvYXQnLCAoeCkgPT4gewogICAgICByZXR1cm4gKHRoaXMuaXNhLmZsb2F0KHgpKSAmJiAoeCA8IDApOwogICAgfSk7CiAgICB0aGlzLmRlY2xhcmUoJ3Byb3Blcl9mcmFjdGlvbicsICh4KSA9PiB7CiAgICAgIHJldHVybiAodGhpcy5pc2EuZmxvYXQoeCkpICYmICgoMCA8PSB4ICYmIHggPD0gMSkpOwogICAgfSk7CiAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgdGhpcy5kZWNsYXJlKCdlbXB0eScsIGZ1bmN0aW9uKHgpIHsKICAgICAgcmV0dXJuICh0aGlzLmhhc19zaXplKHgpKSAmJiAodGhpcy5zaXplX29mKHgpKSA9PT0gMDsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdzaW5ndWxhcicsIGZ1bmN0aW9uKHgpIHsKICAgICAgcmV0dXJuICh0aGlzLmhhc19zaXplKHgpKSAmJiAodGhpcy5zaXplX29mKHgpKSA9PT0gMTsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdub25lbXB0eScsIGZ1bmN0aW9uKHgpIHsKICAgICAgcmV0dXJuICh0aGlzLmhhc19zaXplKHgpKSAmJiAodGhpcy5zaXplX29mKHgpKSA+IDA7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgncGx1cmFsJywgZnVuY3Rpb24oeCkgewogICAgICByZXR1cm4gKHRoaXMuaGFzX3NpemUoeCkpICYmICh0aGlzLnNpemVfb2YoeCkpID4gMTsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdibGFua190ZXh0JywgZnVuY3Rpb24oeCkgewogICAgICByZXR1cm4gKHRoaXMuaXNhLnRleHQoeCkpICYmICgoeC5tYXRjaCgvXlxzKiQvdXMpKSAhPSBudWxsKTsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdub25ibGFua190ZXh0JywgZnVuY3Rpb24oeCkgewogICAgICByZXR1cm4gKHRoaXMuaXNhLnRleHQoeCkpICYmICgoeC5tYXRjaCgvXlxzKiQvdXMpKSA9PSBudWxsKTsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdjaHInLCBmdW5jdGlvbih4KSB7CiAgICAgIHJldHVybiAodGhpcy5pc2EudGV4dCh4KSkgJiYgKCh4Lm1hdGNoKC9eLiQvdXMpKSAhPSBudWxsKTsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdub25lbXB0eV90ZXh0JywgZnVuY3Rpb24oeCkgewogICAgICByZXR1cm4gKHRoaXMuaXNhLnRleHQoeCkpICYmICh0aGlzLmlzYS5ub25lbXB0eSh4KSk7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnbm9uZW1wdHlfbGlzdCcsIGZ1bmN0aW9uKHgpIHsKICAgICAgcmV0dXJuICh0aGlzLmlzYS5saXN0KHgpKSAmJiAodGhpcy5pc2Eubm9uZW1wdHkoeCkpOwogICAgfSk7CiAgICB0aGlzLmRlY2xhcmUoJ25vbmVtcHR5X29iamVjdCcsIGZ1bmN0aW9uKHgpIHsKICAgICAgcmV0dXJuICh0aGlzLmlzYS5vYmplY3QoeCkpICYmICh0aGlzLmlzYS5ub25lbXB0eSh4KSk7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnbm9uZW1wdHlfc2V0JywgZnVuY3Rpb24oeCkgewogICAgICByZXR1cm4gKHRoaXMuaXNhLnNldCh4KSkgJiYgKHRoaXMuaXNhLm5vbmVtcHR5KHgpKTsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdub25lbXB0eV9tYXAnLCBmdW5jdGlvbih4KSB7CiAgICAgIHJldHVybiAodGhpcy5pc2EubWFwKHgpKSAmJiAodGhpcy5pc2Eubm9uZW1wdHkoeCkpOwogICAgfSk7CiAgICB0aGlzLmRlY2xhcmUoJ2VtcHR5X3RleHQnLCBmdW5jdGlvbih4KSB7CiAgICAgIHJldHVybiAodGhpcy5pc2EudGV4dCh4KSkgJiYgKHRoaXMuaXNhLmVtcHR5KHgpKTsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdlbXB0eV9saXN0JywgZnVuY3Rpb24oeCkgewogICAgICByZXR1cm4gKHRoaXMuaXNhLmxpc3QoeCkpICYmICh0aGlzLmlzYS5lbXB0eSh4KSk7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnZW1wdHlfb2JqZWN0JywgZnVuY3Rpb24oeCkgewogICAgICByZXR1cm4gKHRoaXMuaXNhLm9iamVjdCh4KSkgJiYgKHRoaXMuaXNhLmVtcHR5KHgpKTsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdlbXB0eV9zZXQnLCBmdW5jdGlvbih4KSB7CiAgICAgIHJldHVybiAodGhpcy5pc2Euc2V0KHgpKSAmJiAodGhpcy5pc2EuZW1wdHkoeCkpOwogICAgfSk7CiAgICB0aGlzLmRlY2xhcmUoJ2VtcHR5X21hcCcsIGZ1bmN0aW9uKHgpIHsKICAgICAgcmV0dXJuICh0aGlzLmlzYS5tYXAoeCkpICYmICh0aGlzLmlzYS5lbXB0eSh4KSk7CiAgICB9KTsKICAgIC8vIGlzX2dpdmVuICAgICAgICAgICAgICAgICAgPSAoIHggKSAtPiBub3QgWyBudWxsLCB1bmRlZmluZWQsIE5hTiwgJycsIF0uaW5jbHVkZXMgeAogICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgIHRoaXMuZGVjbGFyZSgnYnVmZmVyJywgewogICAgICBzaXplOiAnbGVuZ3RoJwogICAgfSwgKHgpID0+IHsKICAgICAgcmV0dXJuIEJ1ZmZlci5pc0J1ZmZlcih4KTsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdhcnJheWJ1ZmZlcicsIHsKICAgICAgc2l6ZTogJ2xlbmd0aCcKICAgIH0sICh4KSA9PiB7CiAgICAgIHJldHVybiAoanNfdHlwZV9vZih4KSkgPT09ICdhcnJheWJ1ZmZlcic7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnaW50OGFycmF5JywgewogICAgICBzaXplOiAnbGVuZ3RoJwogICAgfSwgKHgpID0+IHsKICAgICAgcmV0dXJuIChqc190eXBlX29mKHgpKSA9PT0gJ2ludDhhcnJheSc7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgndWludDhhcnJheScsIHsKICAgICAgc2l6ZTogJ2xlbmd0aCcKICAgIH0sICh4KSA9PiB7CiAgICAgIHJldHVybiAoanNfdHlwZV9vZih4KSkgPT09ICd1aW50OGFycmF5JzsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCd1aW50OGNsYW1wZWRhcnJheScsIHsKICAgICAgc2l6ZTogJ2xlbmd0aCcKICAgIH0sICh4KSA9PiB7CiAgICAgIHJldHVybiAoanNfdHlwZV9vZih4KSkgPT09ICd1aW50OGNsYW1wZWRhcnJheSc7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnaW50MTZhcnJheScsIHsKICAgICAgc2l6ZTogJ2xlbmd0aCcKICAgIH0sICh4KSA9PiB7CiAgICAgIHJldHVybiAoanNfdHlwZV9vZih4KSkgPT09ICdpbnQxNmFycmF5JzsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCd1aW50MTZhcnJheScsIHsKICAgICAgc2l6ZTogJ2xlbmd0aCcKICAgIH0sICh4KSA9PiB7CiAgICAgIHJldHVybiAoanNfdHlwZV9vZih4KSkgPT09ICd1aW50MTZhcnJheSc7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnaW50MzJhcnJheScsIHsKICAgICAgc2l6ZTogJ2xlbmd0aCcKICAgIH0sICh4KSA9PiB7CiAgICAgIHJldHVybiAoanNfdHlwZV9vZih4KSkgPT09ICdpbnQzMmFycmF5JzsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCd1aW50MzJhcnJheScsIHsKICAgICAgc2l6ZTogJ2xlbmd0aCcKICAgIH0sICh4KSA9PiB7CiAgICAgIHJldHVybiAoanNfdHlwZV9vZih4KSkgPT09ICd1aW50MzJhcnJheSc7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnZmxvYXQzMmFycmF5JywgewogICAgICBzaXplOiAnbGVuZ3RoJwogICAgfSwgKHgpID0+IHsKICAgICAgcmV0dXJuIChqc190eXBlX29mKHgpKSA9PT0gJ2Zsb2F0MzJhcnJheSc7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnZmxvYXQ2NGFycmF5JywgewogICAgICBzaXplOiAnbGVuZ3RoJwogICAgfSwgKHgpID0+IHsKICAgICAgcmV0dXJuIChqc190eXBlX29mKHgpKSA9PT0gJ2Zsb2F0NjRhcnJheSc7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnbGlzdCcsIHsKICAgICAgc2l6ZTogJ2xlbmd0aCcKICAgIH0sICh4KSA9PiB7CiAgICAgIHJldHVybiAoanNfdHlwZV9vZih4KSkgPT09ICdhcnJheSc7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnc2V0JywgewogICAgICBzaXplOiAnc2l6ZScKICAgIH0sIGZ1bmN0aW9uKHgpIHsKICAgICAgcmV0dXJuIChqc190eXBlX29mKHgpKSA9PT0gJ3NldCc7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnbWFwJywgewogICAgICBzaXplOiAnc2l6ZScKICAgIH0sIGZ1bmN0aW9uKHgpIHsKICAgICAgcmV0dXJuIChqc190eXBlX29mKHgpKSA9PT0gJ21hcCc7CiAgICB9KTsKICAgIHRoaXMuZGVjbGFyZSgnd2Vha21hcCcsIGZ1bmN0aW9uKHgpIHsKICAgICAgcmV0dXJuIChqc190eXBlX29mKHgpKSA9PT0gJ3dlYWttYXAnOwogICAgfSk7CiAgICB0aGlzLmRlY2xhcmUoJ3dlYWtzZXQnLCBmdW5jdGlvbih4KSB7CiAgICAgIHJldHVybiAoanNfdHlwZV9vZih4KSkgPT09ICd3ZWFrc2V0JzsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdlcnJvcicsIGZ1bmN0aW9uKHgpIHsKICAgICAgcmV0dXJuIChqc190eXBlX29mKHgpKSA9PT0gJ2Vycm9yJzsKICAgIH0pOwogICAgdGhpcy5kZWNsYXJlKCdyZWdleCcsIGZ1bmN0aW9uKHgpIHsKICAgICAgcmV0dXJuIChqc190eXBlX29mKHgpKSA9PT0gJ3JlZ2V4cCc7CiAgICB9KTsKICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICB0aGlzLmRlY2xhcmUoJ29iamVjdCcsIHsKICAgICAgdGVzdHM6ICh4KSA9PiB7CiAgICAgICAgcmV0dXJuIChqc190eXBlX29mKHgpKSA9PT0gJ29iamVjdCc7CiAgICAgIH0sCiAgICAgIHNpemU6ICh4KSA9PiB7CiAgICAgICAgcmV0dXJuIChPYmplY3Qua2V5cyh4KSkubGVuZ3RoOwogICAgICB9CiAgICB9KTsKICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICB0aGlzLmRlY2xhcmUoJ2dsb2JhbCcsIHsKICAgICAgdGVzdHM6ICh4KSA9PiB7CiAgICAgICAgcmV0dXJuIChqc190eXBlX29mKHgpKSA9PT0gJ2dsb2JhbCc7CiAgICAgIH0sCiAgICAgIHNpemU6ICh4KSA9PiB7CiAgICAgICAgcmV0dXJuIChPYmplY3Qua2V5cyh4KSkubGVuZ3RoOwogICAgICB9CiAgICB9KTsKICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICB0aGlzLmRlY2xhcmUoJ3RleHQnLCB7CiAgICAgIHRlc3RzOiAoeCkgPT4gewogICAgICAgIHJldHVybiAoanNfdHlwZV9vZih4KSkgPT09ICdzdHJpbmcnOwogICAgICB9LAogICAgICBzaXplOiBmdW5jdGlvbih4LCBzZWxlY3RvciA9ICdjb2RldW5pdHMnKSB7CiAgICAgICAgdmFyIHJlZjsKICAgICAgICBzd2l0Y2ggKHNlbGVjdG9yKSB7CiAgICAgICAgICBjYXNlICdjb2RlcG9pbnRzJzoKICAgICAgICAgICAgcmV0dXJuIChBcnJheS5mcm9tKHgpKS5sZW5ndGg7CiAgICAgICAgICBjYXNlICdjb2RldW5pdHMnOgogICAgICAgICAgICByZXR1cm4geC5sZW5ndGg7CiAgICAgICAgICBjYXNlICdieXRlcyc6CiAgICAgICAgICAgIHJldHVybiBCdWZmZXIuYnl0ZUxlbmd0aCh4LCAocmVmID0gdHlwZW9mIHNldHRpbmdzICE9PSAidW5kZWZpbmVkIiAmJiBzZXR0aW5ncyAhPT0gbnVsbCA/IHNldHRpbmdzWydlbmNvZGluZyddIDogdm9pZCAwKSAhPSBudWxsID8gcmVmIDogJ3V0Zi04Jyk7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYHVua25vd24gY291bnRpbmcgc2VsZWN0b3IgJHtycHIoc2VsZWN0b3IpfWApOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgdGhpcy5kZWNsYXJlKCdsaXN0X29mJywgewogICAgICB0ZXN0czogewogICAgICAgICJ4IGlzIGEgbGlzdCI6ICh0eXBlLCB4LCAuLi54UCkgPT4gewogICAgICAgICAgcmV0dXJuIHRoaXMuaXNhLmxpc3QoeCk7CiAgICAgICAgfSwKICAgICAgICAvKiBUQUlOVCBzaG91bGQgY2hlY2sgZm9yIGBAaXNhLnR5cGUgdHlwZWAgKi8KICAgICAgICAidHlwZSBpcyBub25lbXB0eV90ZXh0IjogKHR5cGUsIHgsIC4uLnhQKSA9PiB7CiAgICAgICAgICByZXR1cm4gdGhpcy5pc2Eubm9uZW1wdHlfdGV4dCh0eXBlKTsKICAgICAgICB9LAogICAgICAgICJhbGwgZWxlbWVudHMgcGFzcyB0ZXN0IjogKHR5cGUsIHgsIC4uLnhQKSA9PiB7CiAgICAgICAgICByZXR1cm4geC5ldmVyeSgoeHgpID0+IHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNhKHR5cGUsIHh4LCAuLi54UCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgIHRoaXMuZGVjbGFyZSgnb2JqZWN0X29mJywgewogICAgICB0ZXN0czogewogICAgICAgICJ4IGlzIGEgb2JqZWN0IjogKHR5cGUsIHgsIC4uLnhQKSA9PiB7CiAgICAgICAgICByZXR1cm4gdGhpcy5pc2Eub2JqZWN0KHgpOwogICAgICAgIH0sCiAgICAgICAgLyogVEFJTlQgc2hvdWxkIGNoZWNrIGZvciBgQGlzYS50eXBlIHR5cGVgICovCiAgICAgICAgInR5cGUgaXMgbm9uZW1wdHlfdGV4dCI6ICh0eXBlLCB4LCAuLi54UCkgPT4gewogICAgICAgICAgcmV0dXJuIHRoaXMuaXNhLm5vbmVtcHR5X3RleHQodHlwZSk7CiAgICAgICAgfSwKICAgICAgICAiYWxsIGVsZW1lbnRzIHBhc3MgdGVzdCI6ICh0eXBlLCB4LCAuLi54UCkgPT4gewogICAgICAgICAgdmFyIF8sIHh4OwogICAgICAgICAgZm9yIChfIGluIHgpIHsKICAgICAgICAgICAgeHggPSB4W19dOwogICAgICAgICAgICBpZiAoIXRoaXMuaXNhKHR5cGUsIHh4LCAuLi54UCkpIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgdGhpcy5kZWNsYXJlKCdqc2lkZW50aWZpZXInLCB7CiAgICAgIHRlc3RzOiAoeCkgPT4gewogICAgICAgIHJldHVybiAodGhpcy5pc2EudGV4dCh4KSkgJiYganNpZGVudGlmaWVyX3BhdHRlcm4udGVzdCh4KTsKICAgICAgfQogICAgfSk7CiAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgdGhpcy5kZWNsYXJlKCdpbnQydGV4dCcsIHsKICAgICAgdGVzdHM6ICh4KSA9PiB7CiAgICAgICAgcmV0dXJuICh0aGlzLmlzYS50ZXh0KHgpKSAmJiAoKHgubWF0Y2goL15bMDFdKyQvKSkgIT0gbnVsbCk7CiAgICAgIH0sCiAgICAgIGNhc3RzOiB7CiAgICAgICAgZmxvYXQ6ICh4KSA9PiB7CiAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoeCwgMik7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICB0aGlzLmRlY2xhcmUoJ2ludDEwdGV4dCcsIHsKICAgICAgdGVzdHM6ICh4KSA9PiB7CiAgICAgICAgcmV0dXJuICh0aGlzLmlzYS50ZXh0KHgpKSAmJiAoKHgubWF0Y2goL15bMC05XSskLykpICE9IG51bGwpOwogICAgICB9LAogICAgICBjYXN0czogewogICAgICAgIGZsb2F0OiAoeCkgPT4gewogICAgICAgICAgcmV0dXJuIHBhcnNlSW50KHgsIDEwKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgIHRoaXMuZGVjbGFyZSgnaW50MTZ0ZXh0JywgewogICAgICB0ZXN0czogKHgpID0+IHsKICAgICAgICByZXR1cm4gKHRoaXMuaXNhLnRleHQoeCkpICYmICgoeC5tYXRjaCgvXlswLTlhLWZBLUZdKyQvKSkgIT0gbnVsbCk7CiAgICAgIH0sCiAgICAgIGNhc3RzOiB7CiAgICAgICAgZmxvYXQ6ICh4KSA9PiB7CiAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoeCwgMTYpOwogICAgICAgIH0sCiAgICAgICAgaW50MnRleHQ6ICh4KSA9PiB7CiAgICAgICAgICByZXR1cm4gKHBhcnNlSW50KHgsIDE2KSkudG9TdHJpbmcoMik7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICB0aGlzLi8qIFRBSU5UIGNvdWxkIHVzZSBgY2FzdCgpYCBBUEkgKi9kZWNsYXJlKCdpbnQzMicsIGZ1bmN0aW9uKHgpIHsKICAgICAgcmV0dXJuICh0aGlzLmlzYS5pbnRlZ2VyKHgpKSAmJiAoKC0yMTQ3NDgzNjQ4IDw9IHggJiYgeCA8PSAyMTQ3NDgzNjQ3KSk7CiAgICB9KTsKICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICB0aGlzLmRlY2xhcmUoJ3ZucicsIGZ1bmN0aW9uKHgpIHsKICAgICAgLyogQSB2ZWN0b3JpYWwgbnVtYmVyIChWTlIpIGlzIGEgbm9uLWVtcHR5IGFycmF5IG9mIG51bWJlcnMsIGluY2x1ZGluZyBpbmZpbml0eS4gKi8KICAgICAgcmV0dXJuICh0aGlzLmlzYV9saXN0X29mLmluZmxvYXQoeCkpICYmICh4Lmxlbmd0aCA+IDApOwogICAgfSk7CiAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgcmV0dXJuIHRoaXMuZGVjbGFyZSgnZnNfc3RhdHMnLCB7CiAgICAgIHRlc3RzOiB7CiAgICAgICAgJ3ggaXMgYW4gb2JqZWN0JzogZnVuY3Rpb24oeCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuaXNhLm9iamVjdCh4KTsKICAgICAgICB9LAogICAgICAgICd4LnNpemUgaXMgYSBjYXJkaW5hbCc6IGZ1bmN0aW9uKHgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmlzYS5jYXJkaW5hbCh4LnNpemUpOwogICAgICAgIH0sCiAgICAgICAgJ3guYXRpbWVNcyBpcyBhIGZsb2F0JzogZnVuY3Rpb24oeCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuaXNhLmZsb2F0KHguYXRpbWVNcyk7CiAgICAgICAgfSwKICAgICAgICAneC5hdGltZSBpcyBhIGRhdGUnOiBmdW5jdGlvbih4KSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5pc2EuZGF0ZSh4LmF0aW1lKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH07CgogIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAvLyBUWVBFIERFQ0xBUkFUSU9OUwogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICB0aGlzLmRlY2xhcmVfY2hlY2tzID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgRlMsIFBBVEg7CiAgICBQQVRIID0gcmVxdWlyZSgncGF0aCcpOwogICAgRlMgPSByZXF1aXJlKCdmcycpOwogICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgIC8qIE5PVEU6IHdpbGwgdGhyb3cgZXJyb3IgdW5sZXNzIHBhdGggZXhpc3RzLCBlcnJvciBpcyBpbXBsaWNpdGx5IGNhdWdodCwgcmVwcmVzZW50cyBzYWQgcGF0aCAqLwogICAgdGhpcy5kZWNsYXJlX2NoZWNrKCdmc29fZXhpc3RzJywgZnVuY3Rpb24ocGF0aCwgc3RhdHMgPSBudWxsKSB7CiAgICAgIHJldHVybiBGUy5zdGF0U3luYyhwYXRoKTsKICAgIH0pOwogICAgLy8gdHJ5ICggc3RhdHMgPyBGUy5zdGF0U3luYyBwYXRoICkgY2F0Y2ggZXJyb3IgdGhlbiBlcnJvcgogICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgIHRoaXMuZGVjbGFyZV9jaGVjaygnaXNfZmlsZScsIGZ1bmN0aW9uKHBhdGgsIHN0YXRzID0gbnVsbCkgewogICAgICB2YXIgYmFkOwogICAgICBpZiAodGhpcy5pc19zYWQoKGJhZCA9IHN0YXRzID0gdGhpcy5jaGVjay5mc29fZXhpc3RzKHBhdGgsIHN0YXRzKSkpKSB7CiAgICAgICAgcmV0dXJuIGJhZDsKICAgICAgfQogICAgICBpZiAoc3RhdHMuaXNGaWxlKCkpIHsKICAgICAgICByZXR1cm4gc3RhdHM7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuc2FkZGVuKGBub3QgYSBmaWxlOiAke3BhdGh9YCk7CiAgICB9KTsKICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICByZXR1cm4gdGhpcy5kZWNsYXJlX2NoZWNrKCdpc19qc29uX2ZpbGUnLCBmdW5jdGlvbihwYXRoKSB7CiAgICAgIHZhciBlcnJvcjsKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShGUy5yZWFkRmlsZVN5bmMocGF0aCkpOwogICAgICB9IGNhdGNoIChlcnJvcjEpIHsKICAgICAgICBlcnJvciA9IGVycm9yMTsKICAgICAgICByZXR1cm4gZXJyb3I7CiAgICAgIH0KICAgIH0pOwogIH07CgogIC8vICMuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KLy8gQGRlY2xhcmVfY2hlY2sgJ2VxdWFscycsICggYSwgUC4uLiApIC0+Ci8vICAgZm9yIGIgaW4gUAovLyAgICAgcmV0dXJuIENIRUNLUy5zYWQgdW5sZXNzIGVxdWFscyBhLCBiCi8vICAgcmV0dXJuIHRydWUKLyogbm90IHN1cHBvcnRlZCB1bnRpbCB3ZSBmaWd1cmUgb3V0IGhvdyB0byBkbyBpdCBpbiBzdHJpY3QgbW9kZTogKi8KLy8gQGRlY2xhcmUgJ2FyZ3VtZW50cycsICAgICAgICAgICAgICAgICAgICAgKCB4ICkgLT4gKCBqc190eXBlX29mIHggKSBpcyAnYXJndW1lbnRzJwoKICAvLyBBcnJheS5pc0FycmF5Ci8vIEFycmF5QnVmZmVyLmlzVmlldwovLyBBdG9taWNzLmlzTG9ja0ZyZWUKLy8gQnVmZmVyLmlzQnVmZmVyCi8vIEJ1ZmZlci5pc0VuY29kaW5nCi8vIGNvbnN0cnVjdG9yLmlzCi8vIGNvbnN0cnVjdG9yLmlzRXh0ZW5zaWJsZQovLyBjb25zdHJ1Y3Rvci5pc0Zyb3plbgovLyBjb25zdHJ1Y3Rvci5pc1NlYWxlZAovLyBOdW1iZXIuaXNGaW5pdGUKLy8gTnVtYmVyLmlzSW50ZWdlcgovLyBOdW1iZXIuaXNOYU4KLy8gTnVtYmVyLmlzU2FmZUludGVnZXIKLy8gT2JqZWN0LmlzCi8vIE9iamVjdC5pc0V4dGVuc2libGUKLy8gT2JqZWN0LmlzRnJvemVuCi8vIE9iamVjdC5pc1NlYWxlZAovLyBSZWZsZWN0LmlzRXh0ZW5zaWJsZQovLyByb290LmlzRmluaXRlCi8vIHJvb3QuaXNOYU4KLy8gU3ltYm9sLmlzQ29uY2F0U3ByZWFkYWJsZQoKfSkuY2FsbCh0aGlzKTsKCgp9KS5jYWxsKHRoaXMpfSkuY2FsbCh0aGlzLHJlcXVpcmUoImJ1ZmZlciIpLkJ1ZmZlcikKfSx7Ii4vY2hlY2tzIjozLCIuL2hlbHBlcnMiOjYsImJ1ZmZlciI6MTksImZzIjoxNSwicGF0aCI6Mzd9XSw1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKKGZ1bmN0aW9uIChCdWZmZXIpeyhmdW5jdGlvbiAoKXsKKGZ1bmN0aW9uKCkgewogICd1c2Ugc3RyaWN0JzsKICB2YXIgYXNzaWduLCBjb25zdHJ1Y3Rvcl9vZl9nZW5lcmF0b3JzLCBjb3B5X2lmX29yaWdpbmFsLCBpc2FfY29weSwganIsIGpzX3R5cGVfb2YsIHJwciwgeHJwciwKICAgIGluZGV4T2YgPSBbXS5pbmRleE9mOwoKICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgKHthc3NpZ24sIGpyLCBycHIsIHhycHIsIGpzX3R5cGVfb2Z9ID0gcmVxdWlyZSgnLi9oZWxwZXJzJykpOwoKICBpc2FfY29weSA9IFN5bWJvbCgnaXNhX2NvcHknKTsKCiAgY29uc3RydWN0b3Jfb2ZfZ2VuZXJhdG9ycyA9ICgoZnVuY3Rpb24qKCkgewogICAgcmV0dXJuICh5aWVsZCA0Mik7CiAgfSkoKSkuY29uc3RydWN0b3I7CgogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAvKiBUQUlOVCBtYWtlIGNhdGFsb2cgb2YgYWxsICdkZWVwIEpTJyBuYW1lcyB0aGF0IG11c3QgbmV2ZXIgYmUgdXNlZCBhcyB0eXBlcywgYi9jIGUuZyBhIHR5cGUgJ2JpbmQnCiAgd291bGQgc2hhZG93IG5hdGl2ZSBgZi5iaW5kKClgICovCiAgdGhpcy5pbGxlZ2FsX3R5cGVzID0gWydiaW5kJywgJ3RvU3RyaW5nJywgJ3ZhbHVlT2YnXTsKCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIGNvcHlfaWZfb3JpZ2luYWwgPSBmdW5jdGlvbih4KSB7CiAgICB2YXIgUjsKICAgIGlmICh4W2lzYV9jb3B5XSkgewogICAgICByZXR1cm4geDsKICAgIH0KICAgIFIgPSBhc3NpZ24oe30sIHgpOwogICAgUltpc2FfY29weV0gPSB0cnVlOwogICAgcmV0dXJuIFI7CiAgfTsKCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIHRoaXMuX3NhdGlzZmllc19hbGxfYXNwZWN0cyA9IGZ1bmN0aW9uKHR5cGUsIC4uLnhQKSB7CiAgICBpZiAoKHRoaXMuX2dldF91bnNhdGlzZmllZF9hc3BlY3QodHlwZSwgLi4ueFApKSA9PSBudWxsKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH07CgogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICB0aGlzLl9nZXRfdW5zYXRpc2ZpZWRfYXNwZWN0ID0gZnVuY3Rpb24odHlwZSwgLi4ueFApIHsKICAgIHZhciBhc3BlY3QsIGZhY3R1YWxfdHlwZSwgcmVmLCBzcGVjLCB0ZXN0OwogICAgLyogQ2hlY2sgd2l0aCBgdHlwZV9vZigpYCBpZiB0eXBlIG5vdCBpbiBzcGVjOiAqLwogICAgaWYgKChzcGVjID0gdGhpcy5zcGVjc1t0eXBlXSkgPT0gbnVsbCkgewogICAgICBpZiAoKGZhY3R1YWxfdHlwZSA9IHRoaXMudHlwZV9vZiguLi54UCkpID09PSB0eXBlKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgcmV0dXJuIGAke3Jwcih0eXBlKX0gaXMgYSBrbm93biB0eXBlYDsKICAgIH0KICAgIHJlZiA9IHNwZWMudGVzdHM7CiAgICAvKiBDaGVjayBhbGwgY29uc3RyYWludHMgaW4gc3BlYzogKi8KICAgIGZvciAoYXNwZWN0IGluIHJlZikgewogICAgICB0ZXN0ID0gcmVmW2FzcGVjdF07CiAgICAgIGlmICghdGVzdC5hcHBseSh0aGlzLCB4UCkpIHsKICAgICAgICByZXR1cm4gYXNwZWN0OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9OwoKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgdGhpcy50eXBlX29mID0gZnVuY3Rpb24oeCkgewogICAgdmFyIFIsIGMsIHRhZ25hbWU7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYF43NzQ2XiBleHBlY3RlZCAxIGFyZ3VtZW50LCBnb3QgJHthcml0eX1gKTsKICAgIH0KICAgIGlmICh4ID09PSBudWxsKSB7CiAgICAgIHJldHVybiAnbnVsbCc7CiAgICB9CiAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgIHJldHVybiAndW5kZWZpbmVkJzsKICAgIH0KICAgIGlmICgoeCA9PT0gMmUzMDgpIHx8ICh4ID09PSAtMmUzMDgpKSB7CiAgICAgIHJldHVybiAnaW5maW5pdHknOwogICAgfQogICAgaWYgKCh4ID09PSB0cnVlKSB8fCAoeCA9PT0gZmFsc2UpKSB7CiAgICAgIHJldHVybiAnYm9vbGVhbic7CiAgICB9CiAgICBpZiAoTnVtYmVyLmlzTmFOKHgpKSB7CiAgICAgIHJldHVybiAnbmFuJzsKICAgIH0KICAgIGlmIChCdWZmZXIuaXNCdWZmZXIoeCkpIHsKICAgICAgcmV0dXJuICdidWZmZXInOwogICAgfQogICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgIGlmICgodGFnbmFtZSA9IHhbU3ltYm9sLnRvU3RyaW5nVGFnXSkgIT0gbnVsbCkgewogICAgICBpZiAodGFnbmFtZSA9PT0gJ0FycmF5IEl0ZXJhdG9yJykgewogICAgICAgIHJldHVybiAnYXJyYXlpdGVyYXRvcic7CiAgICAgIH0KICAgICAgaWYgKHRhZ25hbWUgPT09ICdTdHJpbmcgSXRlcmF0b3InKSB7CiAgICAgICAgcmV0dXJuICdzdHJpbmdpdGVyYXRvcic7CiAgICAgIH0KICAgICAgaWYgKHRhZ25hbWUgPT09ICdNYXAgSXRlcmF0b3InKSB7CiAgICAgICAgcmV0dXJuICdtYXBpdGVyYXRvcic7CiAgICAgIH0KICAgICAgaWYgKHRhZ25hbWUgPT09ICdTZXQgSXRlcmF0b3InKSB7CiAgICAgICAgcmV0dXJuICdzZXRpdGVyYXRvcic7CiAgICAgIH0KICAgICAgcmV0dXJuIHRhZ25hbWUudG9Mb3dlckNhc2UoKTsKICAgIH0KICAgIGlmICgoYyA9IHguY29uc3RydWN0b3IpID09PSB2b2lkIDApIHsKICAgICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgICAgLyogRG9tZW5pYyBEZW5pY29sYSBEZXZpY2UsIHNlZSBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMzA1NjA1ODEgKi8KICAgICAgcmV0dXJuICdudWxsb2JqZWN0JzsKICAgIH0KICAgIGlmICgodHlwZW9mIGMpICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgIHJldHVybiAnb2JqZWN0JzsKICAgIH0KICAgIGlmICgoUiA9IGMubmFtZS50b0xvd2VyQ2FzZSgpKSA9PT0gJycpIHsKICAgICAgaWYgKHguY29uc3RydWN0b3IgPT09IGNvbnN0cnVjdG9yX29mX2dlbmVyYXRvcnMpIHsKICAgICAgICByZXR1cm4gJ2dlbmVyYXRvcic7CiAgICAgIH0KICAgICAgLyogTk9URTogdGhyb3cgZXJyb3Igc2luY2UgdGhpcyBzaG91bGQgbmV2ZXIgaGFwcGVuICovCiAgICAgIHJldHVybiAoKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh4KSkuc2xpY2UoOCwgLTEpKS50b0xvd2VyQ2FzZSgpOwogICAgfQogICAgaWYgKCh0eXBlb2YgeCA9PT0gJ29iamVjdCcpICYmIChSID09PSAnYm9vbGVhbicgfHwgUiA9PT0gJ251bWJlcicgfHwgUiA9PT0gJ3N0cmluZycpKSB7Ci8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCi8qIE1hcmsgTWlsbGVyIERldmljZSAqLyAgICAgIHJldHVybiAnd3JhcHBlcic7CiAgICB9CiAgICBpZiAoUiA9PT0gJ251bWJlcicpIHsKICAgICAgcmV0dXJuICdmbG9hdCc7CiAgICB9CiAgICBpZiAoUiA9PT0gJ3JlZ2V4cCcpIHsKICAgICAgcmV0dXJuICdyZWdleCc7CiAgICB9CiAgICBpZiAoUiA9PT0gJ3N0cmluZycpIHsKICAgICAgcmV0dXJuICd0ZXh0JzsKICAgIH0KICAgIGlmIChSID09PSAnYXJyYXknKSB7CiAgICAgIHJldHVybiAnbGlzdCc7CiAgICB9CiAgICBpZiAoUiA9PT0gJ2Z1bmN0aW9uJyAmJiB4LnRvU3RyaW5nKCkuc3RhcnRzV2l0aCgnY2xhc3MgJykpIHsKICAgICAgLyogdGh4IHRvIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8yOTA5NDIwOSAqLwogICAgICAvKiBUQUlOVCBtYXkgcHJvZHVjZSBhbiBhcmJpdHJhcmlseSBsb25nIHRocm93YXdheSBzdHJpbmcgKi8KICAgICAgcmV0dXJuICdjbGFzcyc7CiAgICB9CiAgICByZXR1cm4gUjsKICB9OwoKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgdGhpcy50eXBlc19vZiA9IGZ1bmN0aW9uKC4uLnhQKSB7CiAgICB2YXIgUiwgYXNwZWN0LCBvaywgcmVmLCByZWYxLCBzcGVjLCB0ZXN0LCB0eXBlOwogICAgUiA9IFtdOwogICAgcmVmID0gdGhpcy5zcGVjczsKICAgIGZvciAodHlwZSBpbiByZWYpIHsKICAgICAgc3BlYyA9IHJlZlt0eXBlXTsKICAgICAgb2sgPSB0cnVlOwogICAgICByZWYxID0gc3BlYy50ZXN0czsKICAgICAgZm9yIChhc3BlY3QgaW4gcmVmMSkgewogICAgICAgIHRlc3QgPSByZWYxW2FzcGVjdF07CiAgICAgICAgaWYgKCF0ZXN0LmFwcGx5KHRoaXMsIHhQKSkgewogICAgICAgICAgb2sgPSBmYWxzZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAob2spIHsKICAgICAgICBSLnB1c2godHlwZSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBSOwogIH07CgogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICB0aGlzLmRlY2xhcmUgPSBmdW5jdGlvbiguLi5QKS8qIHR5cGUsIHNwZWM/LCB0ZXN0PyAqLyB7CiAgICB2YXIgYXJpdHk7CiAgICBzd2l0Y2ggKGFyaXR5ID0gUC5sZW5ndGgpIHsKICAgICAgY2FzZSAxOgogICAgICAgIHJldHVybiB0aGlzLl9kZWNsYXJlXzEoLi4uUCk7CiAgICAgIGNhc2UgMjoKICAgICAgICByZXR1cm4gdGhpcy5fZGVjbGFyZV8yKC4uLlApOwogICAgICBjYXNlIDM6CiAgICAgICAgcmV0dXJuIHRoaXMuX2RlY2xhcmVfMyguLi5QKTsKICAgIH0KICAgIHRocm93IG5ldyBFcnJvcihgwrU2NzQ2IGV4cGVjdGVkIGJldHdlZW4gMSBhbmQgMyBhcmd1bWVudHMsIGdvdCAke2FyaXR5fWApOwogIH07CgogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICB0aGlzLl9kZWNsYXJlXzEgPSBmdW5jdGlvbihzcGVjKSB7CiAgICB2YXIgVDsKICAgIGlmICgoVCA9IGpzX3R5cGVfb2Yoc3BlYykpICE9PSAnb2JqZWN0JykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYMK1Njg2OSBleHBlY3RlZCBhbiBvYmplY3QgZm9yIHNwZWMsIGdvdCBhICR7VH1gKTsKICAgIH0KICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICBpZiAoKFQgPSBqc190eXBlX29mKHNwZWMudHlwZSkpICE9PSAnc3RyaW5nJykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYMK1Njk5MiBleHBlY3RlZCBhIHRleHQgZm9yIHNwZWMudHlwZSwgZ290IGEgJHtUfWApOwogICAgfQogICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgIHN3aXRjaCAoKFQgPSBqc190eXBlX29mKHNwZWMudGVzdHMpKSkgewogICAgICBjYXNlICdmdW5jdGlvbic6CiAgICAgICAgc3BlYy50ZXN0cyA9IHsKICAgICAgICAgIG1haW46IHNwZWMudGVzdHMKICAgICAgICB9OwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdvYmplY3QnOgogICAgICAgIG51bGw7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGDCtTcxMTUgZXhwZWN0ZWQgYW4gb2JqZWN0IGZvciBzcGVjLnRlc3RzLCBnb3QgYSAke1R9YCk7CiAgICB9CiAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgcmV0dXJuIHRoaXMuX2RlY2xhcmUoc3BlYyk7CiAgfTsKCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIHRoaXMuX2RlY2xhcmVfMiA9IGZ1bmN0aW9uKHR5cGUsIHNwZWNfb3JfdGVzdCkgewogICAgdmFyIFQsIHNwZWM7CiAgICBzd2l0Y2ggKFQgPSBqc190eXBlX29mKHNwZWNfb3JfdGVzdCkpIHsKICAgICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICAgIGNhc2UgJ2Z1bmN0aW9uJzoKICAgICAgICByZXR1cm4gdGhpcy5fZGVjbGFyZV8xKHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICB0ZXN0czogewogICAgICAgICAgICBtYWluOiBzcGVjX29yX3Rlc3QKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICAgIGNhc2UgJ2FzeW5jZnVuY3Rpb24nOgogICAgICAgIHRocm93ICLCtTcyMzggYXN5bmNocm9ub3VzIGZ1bmN0aW9ucyBub3QgeWV0IHN1cHBvcnRlZCI7CiAgICB9CiAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgaWYgKFQgIT09ICdvYmplY3QnKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgwrU3MzYxIGV4cGVjdGVkIGFuIG9iamVjdCwgZ290IGEgJHtUfSBmb3Igc3BlY2ApOwogICAgfQogICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgIGlmICgoc3BlY19vcl90ZXN0LnR5cGUgIT0gbnVsbCkgJiYgKCFzcGVjX29yX3Rlc3QudHlwZSA9PT0gdHlwZSkpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGDCtTc0ODQgdHlwZSBkZWNsYXJhdGlvbnMgJHtycHIodHlwZSl9IGFuZCAke3JwcihzcGVjX29yX3Rlc3QudHlwZSl9IGRvIG5vdCBtYXRjaGApOwogICAgfQogICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgIHNwZWMgPSBjb3B5X2lmX29yaWdpbmFsKHNwZWNfb3JfdGVzdCk7CiAgICBzcGVjLnR5cGUgPSB0eXBlOwogICAgcmV0dXJuIHRoaXMuX2RlY2xhcmVfMShzcGVjKTsKICB9OwoKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgdGhpcy5fZGVjbGFyZV8zID0gZnVuY3Rpb24odHlwZSwgc3BlYywgdGVzdCkgewogICAgdmFyIFQ7CiAgICBpZiAoKFQgPSBqc190eXBlX29mKHNwZWMpKSAhPT0gJ29iamVjdCcpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGDCtTc2MDcgZXhwZWN0ZWQgYW4gb2JqZWN0LCBnb3QgYSAke1R9IGZvciBzcGVjYCk7CiAgICB9CiAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgaWYgKChUID0ganNfdHlwZV9vZih0ZXN0KSkgIT09ICdmdW5jdGlvbicpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGDCtTc3MzAgZXhwZWN0ZWQgYSBmdW5jdGlvbiBmb3IgdGVzdCwgZ290IGEgJHtUfWApOwogICAgfQogICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgIGlmIChzcGVjLnRlc3RzICE9IG51bGwpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCLCtTc4NTMgc3BlYyBjYW5ub3QgaGF2ZSB0ZXN0cyB3aGVuIHRlc3RzIGFyZSBwYXNzZWQgYXMgYXJndW1lbnQiKTsKICAgIH0KICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICBzcGVjID0gY29weV9pZl9vcmlnaW5hbChzcGVjKTsKICAgIHNwZWMudGVzdHMgPSB7CiAgICAgIG1haW46IHRlc3QKICAgIH07CiAgICByZXR1cm4gdGhpcy5fZGVjbGFyZV8yKHR5cGUsIHNwZWMpOwogIH07CgogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICB0aGlzLl9kZWNsYXJlID0gZnVuY3Rpb24oc3BlYykgewogICAgdmFyIHR5cGU7CiAgICBzcGVjID0gY29weV9pZl9vcmlnaW5hbChzcGVjKTsKICAgIGRlbGV0ZSBzcGVjW2lzYV9jb3B5XTsKICAgICh7dHlwZX0gPSBzcGVjKTsKICAgIHNwZWMudHlwZSA9IHR5cGU7CiAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgaWYgKGluZGV4T2YuY2FsbCh0aGlzLmlsbGVnYWxfdHlwZXMsIHR5cGUpID49IDApIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGDCtTc5NzYgJHtycHIodHlwZSl9IGlzIG5vdCBhIGxlZ2FsIHR5cGUgbmFtZWApOwogICAgfQogICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgIGlmICh0aGlzLnNwZWNzW3R5cGVdICE9IG51bGwpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGDCtTgwOTkgdHlwZSAke3Jwcih0eXBlKX0gYWxyZWFkeSBkZWNsYXJlZGApOwogICAgfQogICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgIHRoaXMuc3BlY3NbdHlwZV0gPSBzcGVjOwogICAgdGhpcy5pc2FbdHlwZV0gPSAoLi4uUCkgPT4gewogICAgICByZXR1cm4gdGhpcy5pc2EodHlwZSwgLi4uUCk7CiAgICB9OwogICAgLy8gQHZhbGlkYXRlWyB0eXBlIF0gICAgPSAoIFAuLi4gKSA9PiBAdmFsaWRhdGUgdHlwZSwgUC4uLgogICAgc3BlYy5zaXplID0gdGhpcy5fc2l6ZW9mX21ldGhvZF9mcm9tX3NwZWModHlwZSwgc3BlYyk7CiAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgcmV0dXJuIG51bGw7CiAgfTsKCn0pLmNhbGwodGhpcyk7CgoKfSkuY2FsbCh0aGlzKX0pLmNhbGwodGhpcyx7ImlzQnVmZmVyIjpyZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi91c3IvbG9jYWwvbGliL25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9pcy1idWZmZXIvaW5kZXguanMiKX0pCn0seyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi91c3IvbG9jYWwvbGliL25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9pcy1idWZmZXIvaW5kZXguanMiOjM0LCIuL2hlbHBlcnMiOjZ9XSw2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKKGZ1bmN0aW9uKCkgewogICd1c2Ugc3RyaWN0JzsKICB2YXIgaW5zcGVjdCwgcnByLAogICAgaW5kZXhPZiA9IFtdLmluZGV4T2Y7CgogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAoe2luc3BlY3R9ID0gcmVxdWlyZSgndXRpbCcpKTsKCiAgdGhpcy5hc3NpZ24gPSBPYmplY3QuYXNzaWduOwoKICAvLyBAanIgICAgICAgICAgID0gSlNPTi5zdHJpbmdpZnkKICB0aGlzLnJwciA9IHJwciA9IChyZXF1aXJlKCcuLi9sb3VwZS5qcycpKS5pbnNwZWN0OwoKICB0aGlzLnhycHIgPSBmdW5jdGlvbih4KSB7CiAgICByZXR1cm4gKHJwcih4KSkuc2xpY2UoMCwgMTAyNSk7CiAgfTsKCiAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogIC8vIFRZUEVfT0YgRkxBVk9SUwogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICB0aGlzLmRvbWVuaWNfZGVuaWNvbGFfZGV2aWNlID0gZnVuY3Rpb24oeCkgewogICAgdmFyIHJlZiwgcmVmMTsKICAgIHJldHVybiAocmVmID0geCAhPSBudWxsID8gKHJlZjEgPSB4LmNvbnN0cnVjdG9yKSAhPSBudWxsID8gcmVmMS5uYW1lIDogdm9pZCAwIDogdm9pZCAwKSAhPSBudWxsID8gcmVmIDogJy4vLic7CiAgfTsKCiAgdGhpcy5tYXJrX21pbGxlcl9kZXZpY2UgPSBmdW5jdGlvbih4KSB7CiAgICByZXR1cm4gKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh4KSkuc2xpY2UoOCwgLTEpOwogIH07CgogIC8vIEBtYXJrX21pbGxlcl9kZXZpY2UgICAgICAgPSAoIHggKSAtPiAoICggT2JqZWN0Ojp0b1N0cmluZy5jYWxsIHggKS5zbGljZSA4LCAtMSApLnRvTG93ZXJDYXNlKCkucmVwbGFjZSAvXHMrL2csICcnCiAgdGhpcy5qc190eXBlX29mID0gZnVuY3Rpb24oeCkgewogICAgcmV0dXJuICgoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHgpKS5zbGljZSg4LCAtMSkpLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXHMrL2csICcnKTsKICB9OwoKICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICB0aGlzLmdldF9ycHJzX29mX3RwcnMgPSBmdW5jdGlvbih0cHJzKSB7CiAgICAvKiBgdHByczogdGVzdCBwYXJhbWV0ZXJzLCBpLmUuIGFkZGl0aW9uYWwgYXJndW1lbnRzIHRvIHR5cGUgdGVzdGVyLCBhcyBpbiBgbXVsdGlwbGVfb2YgeCwgNGAgKi8KICAgIHZhciBycHJfb2ZfdHBycywgc3Jwcl9vZl90cHJzOwogICAgcnByX29mX3RwcnMgPSAoZnVuY3Rpb24oKSB7CiAgICAgIHN3aXRjaCAodHBycy5sZW5ndGgpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgcmV0dXJuIGAke3Jwcih0cHJzWzBdKX1gOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gYCR7cnByKHRwcnMpfWA7CiAgICAgIH0KICAgIH0pKCk7CiAgICBzcnByX29mX3RwcnMgPSAoZnVuY3Rpb24oKSB7CiAgICAgIHN3aXRjaCAocnByX29mX3RwcnMubGVuZ3RoKSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgcmV0dXJuICcnOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gJyAnICsgcnByX29mX3RwcnM7CiAgICAgIH0KICAgIH0pKCk7CiAgICByZXR1cm4ge3Jwcl9vZl90cHJzLCBzcnByX29mX3RwcnN9OwogIH07CgogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICB0aGlzLmludGVyc2VjdGlvbl9vZiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHZhciB4OwogICAgYSA9IFsuLi5hXS5zb3J0KCk7CiAgICBiID0gWy4uLmJdLnNvcnQoKTsKICAgIHJldHVybiAoKGZ1bmN0aW9uKCkgewogICAgICB2YXIgaSwgbGVuLCByZXN1bHRzOwogICAgICByZXN1bHRzID0gW107CiAgICAgIGZvciAoaSA9IDAsIGxlbiA9IGEubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICB4ID0gYVtpXTsKICAgICAgICBpZiAoaW5kZXhPZi5jYWxsKGIsIHgpID49IDApIHsKICAgICAgICAgIHJlc3VsdHMucHVzaCh4KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICB9KSgpKS5zb3J0KCk7CiAgfTsKCn0pLmNhbGwodGhpcyk7CgoKfSx7Ii4uL2xvdXBlLmpzIjo5LCJ1dGlsIjo0MX1dLDc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewooZnVuY3Rpb24oKSB7CiAgJ3VzZSBzdHJpY3QnOwogIHZhciBNdWx0aW1peCwgYXNzaWduLCBjYXN0LCBjaGVjaywgZGVjbGFyYXRpb25zLCBnZXRfcnByc19vZl90cHJzLCBpc2EsIGlzYV9saXN0X29mLCBpc2Ffb2JqZWN0X29mLCBpc2Ffb3B0aW9uYWwsIGprX2VxdWFscywganIsIGpzX3R5cGVfb2YsIHJwciwgc2FkLCB2YWxpZGF0ZSwgdmFsaWRhdGVfbGlzdF9vZiwgdmFsaWRhdGVfb2JqZWN0X29mLCB2YWxpZGF0ZV9vcHRpb25hbCwgeHJwcjsKCiAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogIE11bHRpbWl4ID0gcmVxdWlyZSgnbXVsdGltaXgnKTsKCiAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICh7YXNzaWduLCBqciwgcnByLCB4cnByLCBnZXRfcnByc19vZl90cHJzLCBqc190eXBlX29mfSA9IHJlcXVpcmUoJy4vaGVscGVycycpKTsKCiAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogIGRlY2xhcmF0aW9ucyA9IHJlcXVpcmUoJy4vZGVjbGFyYXRpb25zJyk7CgogIHNhZCA9IChyZXF1aXJlKCcuL2NoZWNrcycpKS5zYWQ7CgogIGprX2VxdWFscyA9IHJlcXVpcmUoJy4uL2RlcHMvamtyb3NvLWVxdWFscycpOwoKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgaXNhID0gZnVuY3Rpb24odHlwZSwgLi4ueFApIHsKICAgIHJldHVybiB0aGlzLl9zYXRpc2ZpZXNfYWxsX2FzcGVjdHModHlwZSwgLi4ueFApOwogIH07CgogIGlzYV9saXN0X29mID0gZnVuY3Rpb24odHlwZSwgLi4ueFApIHsKICAgIHJldHVybiB0aGlzLmlzYS5saXN0X29mKHR5cGUsIC4uLnhQKTsKICB9OwoKICBpc2Ffb2JqZWN0X29mID0gZnVuY3Rpb24odHlwZSwgLi4ueFApIHsKICAgIHJldHVybiB0aGlzLmlzYS5vYmplY3Rfb2YodHlwZSwgLi4ueFApOwogIH07CgogIHZhbGlkYXRlX2xpc3Rfb2YgPSBmdW5jdGlvbih0eXBlLCAuLi54UCkgewogICAgcmV0dXJuIHRoaXMudmFsaWRhdGUubGlzdF9vZih0eXBlLCAuLi54UCk7CiAgfTsKCiAgdmFsaWRhdGVfb2JqZWN0X29mID0gZnVuY3Rpb24odHlwZSwgLi4ueFApIHsKICAgIHJldHVybiB0aGlzLnZhbGlkYXRlLm9iamVjdF9vZih0eXBlLCAuLi54UCk7CiAgfTsKCiAgaXNhX29wdGlvbmFsID0gZnVuY3Rpb24odHlwZSwgLi4ueFApIHsKICAgIHJldHVybiAoeFBbMF0gPT0gbnVsbCkgfHwgdGhpcy5fc2F0aXNmaWVzX2FsbF9hc3BlY3RzKHR5cGUsIC4uLnhQKTsKICB9OwoKICB2YWxpZGF0ZV9vcHRpb25hbCA9IGZ1bmN0aW9uKHR5cGUsIC4uLnhQKSB7CiAgICByZXR1cm4gKHhQWzBdID09IG51bGwpIHx8IHRoaXMudmFsaWRhdGUodHlwZSwgLi4ueFApOwogIH07CgogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICBjYXN0ID0gZnVuY3Rpb24odHlwZV9hLCB0eXBlX2IsIHgsIC4uLnhQKSB7CiAgICB2YXIgY2FzdHMsIGNvbnZlcnRlcjsKICAgIHRoaXMudmFsaWRhdGUodHlwZV9hLCB4LCAuLi54UCk7CiAgICBpZiAodHlwZV9hID09PSB0eXBlX2IpIHsKICAgICAgcmV0dXJuIHg7CiAgICB9CiAgICBpZiAodGhpcy5pc2EodHlwZV9iLCB4LCAuLi54UCkpIHsKICAgICAgcmV0dXJuIHg7CiAgICB9CiAgICBpZiAoKGNhc3RzID0gdGhpcy5zcGVjc1t0eXBlX2FdLmNhc3RzKSAhPSBudWxsKSB7CiAgICAgIGlmICgoY29udmVydGVyID0gY2FzdHNbdHlwZV9iXSkgIT0gbnVsbCkgewogICAgICAgIHJldHVybiBjb252ZXJ0ZXIuY2FsbCh0aGlzLCB4LCAuLi54UCk7CiAgICAgIH0KICAgIH0KICAgIGlmICh0eXBlX2IgPT09ICd0ZXh0Jy8qIFRBSU5UIHVzZSBiZXR0ZXIgbWV0aG9kIGxpa2UgdXRpbC5pbnNwZWN0ICovKSB7CiAgICAgIHJldHVybiBgJHt4fWA7CiAgICB9CiAgICB0aHJvdyBuZXcgRXJyb3IoYF5pbnRlcnR5cGUvY2FzdEAxMjM0XiB1bmFibGUgdG8gY2FzdCBhICR7dHlwZV9hfSBhcyAke3R5cGVfYn1gKTsKICB9OwoKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgY2hlY2sgPSBmdW5jdGlvbih0eXBlLCB4LCAuLi54UCkgewogICAgdmFyIGVycm9yOwogICAgaWYgKHRoaXMuc3BlY3NbdHlwZV0gIT0gbnVsbCkgewogICAgICBpZiAodGhpcy5pc2EodHlwZSwgeCwgLi4ueFApKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHNhZDsKICAgICAgfQogICAgfQogICAgaWYgKChjaGVjayA9IHRoaXMuY2hlY2tzW3R5cGVdKSA9PSBudWxsKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgXmludGVydHlwZS9jaGVja0AxMzQ1XiB1bmtub3duIHR5cGUgb3IgY2hlY2sgJHtycHIodHlwZSl9YCk7CiAgICB9CiAgICB0cnkgewogICAgICByZXR1cm4gY2hlY2suY2FsbCh0aGlzLCB4LCAuLi54UCk7CiAgICB9IGNhdGNoIChlcnJvcjEpIHsKICAgICAgZXJyb3IgPSBlcnJvcjE7CiAgICAgIHJldHVybiBlcnJvcjsKICAgIH0KICB9OwoKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgdmFsaWRhdGUgPSBmdW5jdGlvbih0eXBlLCAuLi54UCkgewogICAgdmFyIFAsIGFzcGVjdCwgbWVzc2FnZSwgcnByX29mX3RwcnMsIHNycHJfb2ZfdHBycywgeDsKICAgIGlmICgoYXNwZWN0ID0gdGhpcy5fZ2V0X3Vuc2F0aXNmaWVkX2FzcGVjdCh0eXBlLCAuLi54UCkpID09IG51bGwpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBbeCwgLi4uUF0gPSB4UDsKICAgICh7cnByX29mX3RwcnMsIHNycHJfb2ZfdHByc30gPSBnZXRfcnByc19vZl90cHJzKFApKTsKICAgIG1lc3NhZ2UgPSBhc3BlY3QgPT09ICdtYWluJyA/IGBeaW50ZXJ0eXBlL3ZhbGlkYXRlQDE0NTZeIG5vdCBhIHZhbGlkICR7dHlwZX06ICR7eHJwcih4KX0ke3NycHJfb2ZfdHByc31gIDogYF5pbnRlcnR5cGUvdmFsaWRhdGVAMTU2N14gbm90IGEgdmFsaWQgJHt0eXBlfSAodmlvbGF0ZXMgJHtycHIoYXNwZWN0KX0pOiAke3hycHIoeCl9JHtzcnByX29mX3RwcnN9YDsKICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsKICB9OwoKICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgdGhpcy5JbnRlcnR5cGUgPSAoZnVuY3Rpb24oKSB7CiAgICBjbGFzcyBJbnRlcnR5cGUgZXh0ZW5kcyBNdWx0aW1peCB7CiAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIGNvbnN0cnVjdG9yKHRhcmdldCA9IG51bGwpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgICAgIC8qIFRBSU5UIGJ1ZyBpbiBNdWx0aU1peCwgc2hvdWxkIGJlIHBvc3NpYmxlIHRvIGRlY2xhcmUgbWV0aG9kcyBpbiBjbGFzcywgbm90IHRoZSBjb25zdHJ1Y3RvciwKICAgICAgICAgICBhbmQgc3RpbGwgZ2V0IGEgYm91bmQgdmVyc2lvbiB3aXRoIGBleHBvcnQoKWA7IGRlY2xhcmluZyB0aGVtIGhlcmUgRlRUQiAqLwogICAgICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgICAgIHRoaXMuc2FkID0gc2FkOwogICAgICAgIHRoaXMuc3BlY3MgPSB7fTsKICAgICAgICB0aGlzLmNoZWNrcyA9IHt9OwogICAgICAgIHRoaXMuaXNhID0gTXVsdGltaXguZ2V0X2tleW1ldGhvZF9wcm94eSh0aGlzLCBpc2EpOwogICAgICAgIHRoaXMuaXNhX29wdGlvbmFsID0gTXVsdGltaXguZ2V0X2tleW1ldGhvZF9wcm94eSh0aGlzLCBpc2Ffb3B0aW9uYWwpOwogICAgICAgIHRoaXMuaXNhX2xpc3Rfb2YgPSBNdWx0aW1peC5nZXRfa2V5bWV0aG9kX3Byb3h5KHRoaXMsIGlzYV9saXN0X29mKTsKICAgICAgICB0aGlzLmlzYV9vYmplY3Rfb2YgPSBNdWx0aW1peC5nZXRfa2V5bWV0aG9kX3Byb3h5KHRoaXMsIGlzYV9vYmplY3Rfb2YpOwogICAgICAgIHRoaXMuY2FzdCA9IE11bHRpbWl4LmdldF9rZXltZXRob2RfcHJveHkodGhpcywgY2FzdCk7CiAgICAgICAgdGhpcy52YWxpZGF0ZSA9IE11bHRpbWl4LmdldF9rZXltZXRob2RfcHJveHkodGhpcywgdmFsaWRhdGUpOwogICAgICAgIHRoaXMudmFsaWRhdGVfb3B0aW9uYWwgPSBNdWx0aW1peC5nZXRfa2V5bWV0aG9kX3Byb3h5KHRoaXMsIHZhbGlkYXRlX29wdGlvbmFsKTsKICAgICAgICB0aGlzLnZhbGlkYXRlX2xpc3Rfb2YgPSBNdWx0aW1peC5nZXRfa2V5bWV0aG9kX3Byb3h5KHRoaXMsIHZhbGlkYXRlX2xpc3Rfb2YpOwogICAgICAgIHRoaXMudmFsaWRhdGVfb2JqZWN0X29mID0gTXVsdGltaXguZ2V0X2tleW1ldGhvZF9wcm94eSh0aGlzLCB2YWxpZGF0ZV9vYmplY3Rfb2YpOwogICAgICAgIHRoaXMuY2hlY2sgPSBNdWx0aW1peC5nZXRfa2V5bWV0aG9kX3Byb3h5KHRoaXMsIGNoZWNrKTsKICAgICAgICB0aGlzLm5vd2FpdCA9IGZ1bmN0aW9uKHgpIHsKICAgICAgICAgIHRoaXMudmFsaWRhdGUuaW1tZWRpYXRlKHgpOwogICAgICAgICAgcmV0dXJuIHg7CiAgICAgICAgfTsKICAgICAgICBkZWNsYXJhdGlvbnMuZGVjbGFyZV90eXBlcy5hcHBseSh0aGlzKTsKICAgICAgICBkZWNsYXJhdGlvbnMuZGVjbGFyZV9jaGVja3MuYXBwbHkodGhpcyk7CiAgICAgICAgaWYgKHRhcmdldCAhPSBudWxsKSB7CiAgICAgICAgICB0aGlzLmV4cG9ydCh0YXJnZXQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgZXF1YWxzKGEsIC4uLlApIHsKICAgICAgICB2YXIgYXJpdHksIGIsIGksIGxlbiwgdHlwZV9vZl9hOwogICAgICAgIGlmICgoYXJpdHkgPSBhcmd1bWVudHMubGVuZ3RoKSA8IDIpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgXmludGVydHlwZS9lcXVhbHNAMzQ4OV4gZXhwZWN0ZWQgYXQgbGVhc3QgMiBhcmd1bWVudHMsIGdvdCAke2FyaXR5fWApOwogICAgICAgIH0KICAgICAgICB0eXBlX29mX2EgPSB0aGlzLnR5cGVfb2YoYSk7CiAgICAgICAgZm9yIChpID0gMCwgbGVuID0gUC5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgYiA9IFBbaV07CiAgICAgICAgICBpZiAodHlwZV9vZl9hICE9PSB0aGlzLnR5cGVfb2YoYikpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFqa19lcXVhbHMoYSwgYikpIHsKICAgICAgICAgICAgLyogVEFJTlQgdGhpcyBjYWxsIGludm9sdmVzIGl0cyBvd24gdHlwZWNoZWNraW5nIGNvZGUgYW5kIHRodXMgbWF5IG15c3RlcmlvdXNseSBmYWlsICovCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICB9OwoKICAgIC8vIEBleHRlbmQgICBvYmplY3Rfd2l0aF9jbGFzc19wcm9wZXJ0aWVzCiAgICBJbnRlcnR5cGUuaW5jbHVkZShyZXF1aXJlKCcuL3NpemluZycpKTsKCiAgICBJbnRlcnR5cGUuaW5jbHVkZShyZXF1aXJlKCcuL2RlY2xhcmluZycpKTsKCiAgICBJbnRlcnR5cGUuaW5jbHVkZShyZXF1aXJlKCcuL2NoZWNrcycpKTsKCiAgICByZXR1cm4gSW50ZXJ0eXBlOwoKICB9KS5jYWxsKHRoaXMpOwoKfSkuY2FsbCh0aGlzKTsKCgp9LHsiLi4vZGVwcy9qa3Jvc28tZXF1YWxzIjoxLCIuL2NoZWNrcyI6MywiLi9kZWNsYXJhdGlvbnMiOjQsIi4vZGVjbGFyaW5nIjo1LCIuL2hlbHBlcnMiOjYsIi4vc2l6aW5nIjo4LCJtdWx0aW1peCI6MTR9XSw4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKKGZ1bmN0aW9uKCkgewogICd1c2Ugc3RyaWN0JzsKICB2YXIgYXNzaWduLCBqciwganNfdHlwZV9vZiwgeHJwcjsKCiAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICh7YXNzaWduLCBqciwgeHJwciwganNfdHlwZV9vZn0gPSByZXF1aXJlKCcuL2hlbHBlcnMnKSk7CgogIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAvLyBPQkpFQ1QgU0laRVMKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgdGhpcy5fc2l6ZW9mX21ldGhvZF9mcm9tX3NwZWMgPSBmdW5jdGlvbih0eXBlLCBzcGVjKSB7CiAgICByZXR1cm4gKChzKSA9PiB7CiAgICAgIHZhciBUOwogICAgICBpZiAocyA9PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgc3dpdGNoIChUID0ganNfdHlwZV9vZihzKSkgewogICAgICAgIGNhc2UgJ3N0cmluZyc6CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oeCkgewogICAgICAgICAgICByZXR1cm4geFtzXTsKICAgICAgICAgIH07CiAgICAgICAgY2FzZSAnZnVuY3Rpb24nOgogICAgICAgICAgcmV0dXJuIHMvKiBUQUlOVCBkaXNhbGxvd3MgYXN5bmMgZnVudGlvbnMgKi87CiAgICAgICAgY2FzZSAnbnVtYmVyJzoKICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHMvKiBUQUlOVCBhbGxvd3MgTmFOLCBJbmZpbml0eSAqLzsKICAgICAgICAgIH07CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IEVycm9yKGDCtTMwOTg4IGV4cGVjdGVkIG51bGwsIGEgdGV4dCBvciBhIGZ1bmN0aW9uIGZvciBzaXplIG9mICR7dHlwZX0sIGdvdCBhICR7VH1gKTsKICAgIH0pKHNwZWMuc2l6ZSk7CiAgfTsKCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIHRoaXMuc2l6ZV9vZiA9IGZ1bmN0aW9uKHgsIC4uLlApIHsKICAgIC8qIFRoZSBgc2l6ZV9vZigpYCBtZXRob2QgdXNlcyBhIHBlci10eXBlIGNvbmZpZ3VyYWJsZSBtZXRob2RvbG9neSB0byByZXR1cm4gdGhlIHNpemUgb2YgYSBnaXZlbiB2YWx1ZTsKICAgICBzdWNoIG1ldGhvZG9sb2d5IG1heSBwZXJtaXQgb3IgbmVjZXNzaXRhdGUgcGFzc2luZyBhZGRpdGlvbmFsIGFyZ3VtZW50cyAoc3VjaCBhcyBgc2l6ZV9vZiB0ZXh0YCwgd2hpY2gKICAgICBjb21lcyBpbiBzZXZlcmFsIGZsYXZvcnMgZGVwZW5kaW5nIG9uIHdoZXRoZXIgYnl0ZXMgb3IgY29kZXBvaW50cyBhcmUgdG8gYmUgY291bnRlZCkuIEFzIHN1Y2gsIGl0IGlzIGEKICAgICBtb2RlbCBmb3IgaG93IHRvIGltcGxlbWVudCBHby1saWtlIG1ldGhvZCBkaXNwYXRjaGluZy4gKi8KICAgIHZhciBnZXR0ZXIsIHJlZiwgdHlwZTsKICAgIHR5cGUgPSB0aGlzLnR5cGVfb2YoeCk7CiAgICBpZiAoISh0aGlzLmlzYS5mdW5jdGlvbigoZ2V0dGVyID0gKHJlZiA9IHRoaXMuc3BlY3NbdHlwZV0pICE9IG51bGwgPyByZWYuc2l6ZSA6IHZvaWQgMCkpKSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYMK1ODg3OTMgdW5hYmxlIHRvIGdldCBzaXplIG9mIGEgJHt0eXBlfWApOwogICAgfQogICAgcmV0dXJuIGdldHRlcih4LCAuLi5QKTsKICB9OwoKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgLyogVEFJTlQgZmF1bHR5IGltcGxlbWVudGF0aW9uOgogICAqIGRvZXMgbm90IHVzZSBzaXplX29mIGJ1dCBsZW5ndGgKICAgKiBkb2VzIG5vdCBhY2NlcHQgYWRkaXRpb25hbCBhcmd1bWVudHMgYXMgbmVlZGVkIGZvciB0ZXh0cwogICAqIHJpc2tzIHRvIGJyZWFrIGNvZGVwb2ludHMgYXBhcnQKICAgICovCiAgdGhpcy5maXJzdF9vZiA9IGZ1bmN0aW9uKGNvbGxlY3Rpb24pIHsKICAgIHJldHVybiBjb2xsZWN0aW9uWzBdOwogIH07CgogIHRoaXMubGFzdF9vZiA9IGZ1bmN0aW9uKGNvbGxlY3Rpb24pIHsKICAgIHJldHVybiBjb2xsZWN0aW9uW2NvbGxlY3Rpb24ubGVuZ3RoIC0gMV07CiAgfTsKCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIHRoaXMuYXJpdHlfb2YgPSBmdW5jdGlvbih4KSB7CiAgICB2YXIgdHlwZTsKICAgIGlmICgodHlwZSA9IHRoaXMuc3VwZXJ0eXBlX29mKHgpKSAhPT0gJ2NhbGxhYmxlJykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYMK1ODg3MzMgZXhwZWN0ZWQgYSBjYWxsYWJsZSwgZ290IGEgJHt0eXBlfWApOwogICAgfQogICAgcmV0dXJuIHgubGVuZ3RoOwogIH07CgogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICB0aGlzLmhhc19zaXplID0gZnVuY3Rpb24oeCkgewogICAgdmFyIHJlZjsKICAgIHJldHVybiB0aGlzLmlzYS5mdW5jdGlvbigocmVmID0gdGhpcy5zcGVjc1t0aGlzLnR5cGVfb2YoeCldKSAhPSBudWxsID8gcmVmLnNpemUgOiB2b2lkIDApOwogIH07Cgp9KS5jYWxsKHRoaXMpOwoKCn0seyIuL2hlbHBlcnMiOjZ9XSw5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKKGZ1bmN0aW9uIChwcm9jZXNzLGdsb2JhbCxCdWZmZXIpeyhmdW5jdGlvbiAoKXsKKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHsKCXR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyA/IGZhY3RvcnkoZXhwb3J0cykgOgoJdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKFsnZXhwb3J0cyddLCBmYWN0b3J5KSA6CgkoZ2xvYmFsID0gZ2xvYmFsIHx8IHNlbGYsIGZhY3RvcnkoZ2xvYmFsLmxvdXBlID0ge30pKTsKfSh0aGlzLCAoZnVuY3Rpb24gKGV4cG9ydHMpIHsgJ3VzZSBzdHJpY3QnOwoKCXZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9OwoKCWZ1bmN0aW9uIGNyZWF0ZUNvbW1vbmpzTW9kdWxlKGZuLCBtb2R1bGUpIHsKCQlyZXR1cm4gbW9kdWxlID0geyBleHBvcnRzOiB7fSB9LCBmbihtb2R1bGUsIG1vZHVsZS5leHBvcnRzKSwgbW9kdWxlLmV4cG9ydHM7Cgl9CgoJdmFyIHR5cGVEZXRlY3QgPSBjcmVhdGVDb21tb25qc01vZHVsZShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkoZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkgewoJCSBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKSA7Cgl9KGNvbW1vbmpzR2xvYmFsLCAoZnVuY3Rpb24gKCkgewoJLyogIQoJICogdHlwZS1kZXRlY3QKCSAqIENvcHlyaWdodChjKSAyMDEzIGpha2UgbHVlciA8amFrZUBhbG9naWNhbHBhcmFkb3guY29tPgoJICogTUlUIExpY2Vuc2VkCgkgKi8KCXZhciBwcm9taXNlRXhpc3RzID0gdHlwZW9mIFByb21pc2UgPT09ICdmdW5jdGlvbic7CgoJLyogZXNsaW50LWRpc2FibGUgbm8tdW5kZWYgKi8KCXZhciBnbG9iYWxPYmplY3QgPSB0eXBlb2Ygc2VsZiA9PT0gJ29iamVjdCcgPyBzZWxmIDogY29tbW9uanNHbG9iYWw7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgaWQtYmxhY2tsaXN0CgoJdmFyIHN5bWJvbEV4aXN0cyA9IHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnOwoJdmFyIG1hcEV4aXN0cyA9IHR5cGVvZiBNYXAgIT09ICd1bmRlZmluZWQnOwoJdmFyIHNldEV4aXN0cyA9IHR5cGVvZiBTZXQgIT09ICd1bmRlZmluZWQnOwoJdmFyIHdlYWtNYXBFeGlzdHMgPSB0eXBlb2YgV2Vha01hcCAhPT0gJ3VuZGVmaW5lZCc7Cgl2YXIgd2Vha1NldEV4aXN0cyA9IHR5cGVvZiBXZWFrU2V0ICE9PSAndW5kZWZpbmVkJzsKCXZhciBkYXRhVmlld0V4aXN0cyA9IHR5cGVvZiBEYXRhVmlldyAhPT0gJ3VuZGVmaW5lZCc7Cgl2YXIgc3ltYm9sSXRlcmF0b3JFeGlzdHMgPSBzeW1ib2xFeGlzdHMgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciAhPT0gJ3VuZGVmaW5lZCc7Cgl2YXIgc3ltYm9sVG9TdHJpbmdUYWdFeGlzdHMgPSBzeW1ib2xFeGlzdHMgJiYgdHlwZW9mIFN5bWJvbC50b1N0cmluZ1RhZyAhPT0gJ3VuZGVmaW5lZCc7Cgl2YXIgc2V0RW50cmllc0V4aXN0cyA9IHNldEV4aXN0cyAmJiB0eXBlb2YgU2V0LnByb3RvdHlwZS5lbnRyaWVzID09PSAnZnVuY3Rpb24nOwoJdmFyIG1hcEVudHJpZXNFeGlzdHMgPSBtYXBFeGlzdHMgJiYgdHlwZW9mIE1hcC5wcm90b3R5cGUuZW50cmllcyA9PT0gJ2Z1bmN0aW9uJzsKCXZhciBzZXRJdGVyYXRvclByb3RvdHlwZSA9IHNldEVudHJpZXNFeGlzdHMgJiYgT2JqZWN0LmdldFByb3RvdHlwZU9mKG5ldyBTZXQoKS5lbnRyaWVzKCkpOwoJdmFyIG1hcEl0ZXJhdG9yUHJvdG90eXBlID0gbWFwRW50cmllc0V4aXN0cyAmJiBPYmplY3QuZ2V0UHJvdG90eXBlT2YobmV3IE1hcCgpLmVudHJpZXMoKSk7Cgl2YXIgYXJyYXlJdGVyYXRvckV4aXN0cyA9IHN5bWJvbEl0ZXJhdG9yRXhpc3RzICYmIHR5cGVvZiBBcnJheS5wcm90b3R5cGVbU3ltYm9sLml0ZXJhdG9yXSA9PT0gJ2Z1bmN0aW9uJzsKCXZhciBhcnJheUl0ZXJhdG9yUHJvdG90eXBlID0gYXJyYXlJdGVyYXRvckV4aXN0cyAmJiBPYmplY3QuZ2V0UHJvdG90eXBlT2YoW11bU3ltYm9sLml0ZXJhdG9yXSgpKTsKCXZhciBzdHJpbmdJdGVyYXRvckV4aXN0cyA9IHN5bWJvbEl0ZXJhdG9yRXhpc3RzICYmIHR5cGVvZiBTdHJpbmcucHJvdG90eXBlW1N5bWJvbC5pdGVyYXRvcl0gPT09ICdmdW5jdGlvbic7Cgl2YXIgc3RyaW5nSXRlcmF0b3JQcm90b3R5cGUgPSBzdHJpbmdJdGVyYXRvckV4aXN0cyAmJiBPYmplY3QuZ2V0UHJvdG90eXBlT2YoJydbU3ltYm9sLml0ZXJhdG9yXSgpKTsKCXZhciB0b1N0cmluZ0xlZnRTbGljZUxlbmd0aCA9IDg7Cgl2YXIgdG9TdHJpbmdSaWdodFNsaWNlTGVuZ3RoID0gLTE7CgkvKioKCSAqICMjIyB0eXBlT2YgKG9iaikKCSAqCgkgKiBVc2VzIGBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nYCB0byBkZXRlcm1pbmUgdGhlIHR5cGUgb2YgYW4gb2JqZWN0LAoJICogbm9ybWFsaXNpbmcgYmVoYXZpb3VyIGFjcm9zcyBlbmdpbmUgdmVyc2lvbnMgJiB3ZWxsIG9wdGltaXNlZC4KCSAqCgkgKiBAcGFyYW0ge01peGVkfSBvYmplY3QKCSAqIEByZXR1cm4ge1N0cmluZ30gb2JqZWN0IHR5cGUKCSAqIEBhcGkgcHVibGljCgkgKi8KCWZ1bmN0aW9uIHR5cGVEZXRlY3Qob2JqKSB7CgkgIC8qICEgU3BlZWQgb3B0aW1pc2F0aW9uCgkgICAqIFByZToKCSAgICogICBzdHJpbmcgbGl0ZXJhbCAgICAgeCAzLDAzOSwwMzUgb3BzL3NlYyDCsTEuNjIlICg3OCBydW5zIHNhbXBsZWQpCgkgICAqICAgYm9vbGVhbiBsaXRlcmFsICAgIHggMSw0MjQsMTM4IG9wcy9zZWMgwrE0LjU0JSAoNzUgcnVucyBzYW1wbGVkKQoJICAgKiAgIG51bWJlciBsaXRlcmFsICAgICB4IDEsNjUzLDE1MyBvcHMvc2VjIMKxMS45MSUgKDgyIHJ1bnMgc2FtcGxlZCkKCSAgICogICB1bmRlZmluZWQgICAgICAgICAgeCA5LDk3OCw2NjAgb3BzL3NlYyDCsTEuOTIlICg3NSBydW5zIHNhbXBsZWQpCgkgICAqICAgZnVuY3Rpb24gICAgICAgICAgIHggMiw1NTYsNzY5IG9wcy9zZWMgwrExLjczJSAoNzcgcnVucyBzYW1wbGVkKQoJICAgKiBQb3N0OgoJICAgKiAgIHN0cmluZyBsaXRlcmFsICAgICB4IDM4LDU2NCw3OTYgb3BzL3NlYyDCsTEuMTUlICg3OSBydW5zIHNhbXBsZWQpCgkgICAqICAgYm9vbGVhbiBsaXRlcmFsICAgIHggMzEsMTQ4LDk0MCBvcHMvc2VjIMKxMS4xMCUgKDc5IHJ1bnMgc2FtcGxlZCkKCSAgICogICBudW1iZXIgbGl0ZXJhbCAgICAgeCAzMiw2NzksMzMwIG9wcy9zZWMgwrExLjkwJSAoNzggcnVucyBzYW1wbGVkKQoJICAgKiAgIHVuZGVmaW5lZCAgICAgICAgICB4IDMyLDM2MywzNjggb3BzL3NlYyDCsTEuMDclICg4MiBydW5zIHNhbXBsZWQpCgkgICAqICAgZnVuY3Rpb24gICAgICAgICAgIHggMzEsMjk2LDg3MCBvcHMvc2VjIMKxMC45NiUgKDgzIHJ1bnMgc2FtcGxlZCkKCSAgICovCgkgIHZhciB0eXBlb2ZPYmogPSB0eXBlb2Ygb2JqOwoJICBpZiAodHlwZW9mT2JqICE9PSAnb2JqZWN0JykgewoJICAgIHJldHVybiB0eXBlb2ZPYmo7CgkgIH0KCgkgIC8qICEgU3BlZWQgb3B0aW1pc2F0aW9uCgkgICAqIFByZToKCSAgICogICBudWxsICAgICAgICAgICAgICAgeCAyOCw2NDUsNzY1IG9wcy9zZWMgwrExLjE3JSAoODIgcnVucyBzYW1wbGVkKQoJICAgKiBQb3N0OgoJICAgKiAgIG51bGwgICAgICAgICAgICAgICB4IDM2LDQyOCw5NjIgb3BzL3NlYyDCsTEuMzclICg4NCBydW5zIHNhbXBsZWQpCgkgICAqLwoJICBpZiAob2JqID09PSBudWxsKSB7CgkgICAgcmV0dXJuICdudWxsJzsKCSAgfQoKCSAgLyogISBTcGVjIENvbmZvcm1hbmNlCgkgICAqIFRlc3Q6IGBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwod2luZG93KWBgCgkgICAqICAtIE5vZGUgPT09ICJbb2JqZWN0IGdsb2JhbF0iCgkgICAqICAtIENocm9tZSA9PT0gIltvYmplY3QgZ2xvYmFsXSIKCSAgICogIC0gRmlyZWZveCA9PT0gIltvYmplY3QgV2luZG93XSIKCSAgICogIC0gUGhhbnRvbUpTID09PSAiW29iamVjdCBXaW5kb3ddIgoJICAgKiAgLSBTYWZhcmkgPT09ICJbb2JqZWN0IFdpbmRvd10iCgkgICAqICAtIElFIDExID09PSAiW29iamVjdCBXaW5kb3ddIgoJICAgKiAgLSBJRSBFZGdlID09PSAiW29iamVjdCBXaW5kb3ddIgoJICAgKiBUZXN0OiBgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHRoaXMpYGAKCSAgICogIC0gQ2hyb21lIFdvcmtlciA9PT0gIltvYmplY3QgZ2xvYmFsXSIKCSAgICogIC0gRmlyZWZveCBXb3JrZXIgPT09ICJbb2JqZWN0IERlZGljYXRlZFdvcmtlckdsb2JhbFNjb3BlXSIKCSAgICogIC0gU2FmYXJpIFdvcmtlciA9PT0gIltvYmplY3QgRGVkaWNhdGVkV29ya2VyR2xvYmFsU2NvcGVdIgoJICAgKiAgLSBJRSAxMSBXb3JrZXIgPT09ICJbb2JqZWN0IFdvcmtlckdsb2JhbFNjb3BlXSIKCSAgICogIC0gSUUgRWRnZSBXb3JrZXIgPT09ICJbb2JqZWN0IFdvcmtlckdsb2JhbFNjb3BlXSIKCSAgICovCgkgIGlmIChvYmogPT09IGdsb2JhbE9iamVjdCkgewoJICAgIHJldHVybiAnZ2xvYmFsJzsKCSAgfQoKCSAgLyogISBTcGVlZCBvcHRpbWlzYXRpb24KCSAgICogUHJlOgoJICAgKiAgIGFycmF5IGxpdGVyYWwgICAgICB4IDIsODg4LDM1MiBvcHMvc2VjIMKxMC42NyUgKDgyIHJ1bnMgc2FtcGxlZCkKCSAgICogUG9zdDoKCSAgICogICBhcnJheSBsaXRlcmFsICAgICAgeCAyMiw0NzksNjUwIG9wcy9zZWMgwrEwLjk2JSAoODEgcnVucyBzYW1wbGVkKQoJICAgKi8KCSAgaWYgKAoJICAgIEFycmF5LmlzQXJyYXkob2JqKSAmJgoJICAgIChzeW1ib2xUb1N0cmluZ1RhZ0V4aXN0cyA9PT0gZmFsc2UgfHwgIShTeW1ib2wudG9TdHJpbmdUYWcgaW4gb2JqKSkKCSAgKSB7CgkgICAgcmV0dXJuICdBcnJheSc7CgkgIH0KCgkgIC8vIE5vdCBjYWNoaW5nIGV4aXN0ZW5jZSBvZiBgd2luZG93YCBhbmQgcmVsYXRlZCBwcm9wZXJ0aWVzIGR1ZSB0byBwb3RlbnRpYWwKCSAgLy8gZm9yIGB3aW5kb3dgIHRvIGJlIHVuc2V0IGJlZm9yZSB0ZXN0cyBpbiBxdWFzaS1icm93c2VyIGVudmlyb25tZW50cy4KCSAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICdvYmplY3QnICYmIHdpbmRvdyAhPT0gbnVsbCkgewoJICAgIC8qICEgU3BlYyBDb25mb3JtYW5jZQoJICAgICAqIChodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS9icm93c2Vycy5odG1sI2xvY2F0aW9uKQoJICAgICAqIFdoYXRXRyBIVE1MJDcuNy4zIC0gVGhlIGBMb2NhdGlvbmAgaW50ZXJmYWNlCgkgICAgICogVGVzdDogYE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh3aW5kb3cubG9jYXRpb24pYGAKCSAgICAgKiAgLSBJRSA8PTExID09PSAiW29iamVjdCBPYmplY3RdIgoJICAgICAqICAtIElFIEVkZ2UgPD0xMyA9PT0gIltvYmplY3QgT2JqZWN0XSIKCSAgICAgKi8KCSAgICBpZiAodHlwZW9mIHdpbmRvdy5sb2NhdGlvbiA9PT0gJ29iamVjdCcgJiYgb2JqID09PSB3aW5kb3cubG9jYXRpb24pIHsKCSAgICAgIHJldHVybiAnTG9jYXRpb24nOwoJICAgIH0KCgkgICAgLyogISBTcGVjIENvbmZvcm1hbmNlCgkgICAgICogKGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvI2RvY3VtZW50KQoJICAgICAqIFdoYXRXRyBIVE1MJDMuMS4xIC0gVGhlIGBEb2N1bWVudGAgb2JqZWN0CgkgICAgICogTm90ZTogTW9zdCBicm93c2VycyBjdXJyZW50bHkgYWRoZXIgdG8gdGhlIFczQyBET00gTGV2ZWwgMiBzcGVjCgkgICAgICogICAgICAgKGh0dHBzOi8vd3d3LnczLm9yZy9UUi9ET00tTGV2ZWwtMi1IVE1ML2h0bWwuaHRtbCNJRC0yNjgwOTI2OCkKCSAgICAgKiAgICAgICB3aGljaCBzdWdnZXN0cyB0aGF0IGJyb3dzZXJzIHNob3VsZCB1c2UgSFRNTFRhYmxlQ2VsbEVsZW1lbnQgZm9yCgkgICAgICogICAgICAgYm90aCBURCBhbmQgVEggZWxlbWVudHMuIFdoYXRXRyBzZXBhcmF0ZXMgdGhlc2UuCgkgICAgICogICAgICAgV2hhdFdHIEhUTUwgc3RhdGVzOgoJICAgICAqICAgICAgICAgPiBGb3IgaGlzdG9yaWNhbCByZWFzb25zLCBXaW5kb3cgb2JqZWN0cyBtdXN0IGFsc28gaGF2ZSBhCgkgICAgICogICAgICAgICA+IHdyaXRhYmxlLCBjb25maWd1cmFibGUsIG5vbi1lbnVtZXJhYmxlIHByb3BlcnR5IG5hbWVkCgkgICAgICogICAgICAgICA+IEhUTUxEb2N1bWVudCB3aG9zZSB2YWx1ZSBpcyB0aGUgRG9jdW1lbnQgaW50ZXJmYWNlIG9iamVjdC4KCSAgICAgKiBUZXN0OiBgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGRvY3VtZW50KWBgCgkgICAgICogIC0gQ2hyb21lID09PSAiW29iamVjdCBIVE1MRG9jdW1lbnRdIgoJICAgICAqICAtIEZpcmVmb3ggPT09ICJbb2JqZWN0IEhUTUxEb2N1bWVudF0iCgkgICAgICogIC0gU2FmYXJpID09PSAiW29iamVjdCBIVE1MRG9jdW1lbnRdIgoJICAgICAqICAtIElFIDw9MTAgPT09ICJbb2JqZWN0IERvY3VtZW50XSIKCSAgICAgKiAgLSBJRSAxMSA9PT0gIltvYmplY3QgSFRNTERvY3VtZW50XSIKCSAgICAgKiAgLSBJRSBFZGdlIDw9MTMgPT09ICJbb2JqZWN0IEhUTUxEb2N1bWVudF0iCgkgICAgICovCgkgICAgaWYgKHR5cGVvZiB3aW5kb3cuZG9jdW1lbnQgPT09ICdvYmplY3QnICYmIG9iaiA9PT0gd2luZG93LmRvY3VtZW50KSB7CgkgICAgICByZXR1cm4gJ0RvY3VtZW50JzsKCSAgICB9CgoJICAgIGlmICh0eXBlb2Ygd2luZG93Lm5hdmlnYXRvciA9PT0gJ29iamVjdCcpIHsKCSAgICAgIC8qICEgU3BlYyBDb25mb3JtYW5jZQoJICAgICAgICogKGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvbXVsdGlwYWdlL3dlYmFwcGFwaXMuaHRtbCNtaW1ldHlwZWFycmF5KQoJICAgICAgICogV2hhdFdHIEhUTUwkOC42LjEuNSAtIFBsdWdpbnMgLSBJbnRlcmZhY2UgTWltZVR5cGVBcnJheQoJICAgICAgICogVGVzdDogYE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChuYXZpZ2F0b3IubWltZVR5cGVzKWBgCgkgICAgICAgKiAgLSBJRSA8PTEwID09PSAiW29iamVjdCBNU01pbWVUeXBlc0NvbGxlY3Rpb25dIgoJICAgICAgICovCgkgICAgICBpZiAodHlwZW9mIHdpbmRvdy5uYXZpZ2F0b3IubWltZVR5cGVzID09PSAnb2JqZWN0JyAmJgoJICAgICAgICAgIG9iaiA9PT0gd2luZG93Lm5hdmlnYXRvci5taW1lVHlwZXMpIHsKCSAgICAgICAgcmV0dXJuICdNaW1lVHlwZUFycmF5JzsKCSAgICAgIH0KCgkgICAgICAvKiAhIFNwZWMgQ29uZm9ybWFuY2UKCSAgICAgICAqIChodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS93ZWJhcHBhcGlzLmh0bWwjcGx1Z2luYXJyYXkpCgkgICAgICAgKiBXaGF0V0cgSFRNTCQ4LjYuMS41IC0gUGx1Z2lucyAtIEludGVyZmFjZSBQbHVnaW5BcnJheQoJICAgICAgICogVGVzdDogYE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChuYXZpZ2F0b3IucGx1Z2lucylgYAoJICAgICAgICogIC0gSUUgPD0xMCA9PT0gIltvYmplY3QgTVNQbHVnaW5zQ29sbGVjdGlvbl0iCgkgICAgICAgKi8KCSAgICAgIGlmICh0eXBlb2Ygd2luZG93Lm5hdmlnYXRvci5wbHVnaW5zID09PSAnb2JqZWN0JyAmJgoJICAgICAgICAgIG9iaiA9PT0gd2luZG93Lm5hdmlnYXRvci5wbHVnaW5zKSB7CgkgICAgICAgIHJldHVybiAnUGx1Z2luQXJyYXknOwoJICAgICAgfQoJICAgIH0KCgkgICAgaWYgKCh0eXBlb2Ygd2luZG93LkhUTUxFbGVtZW50ID09PSAnZnVuY3Rpb24nIHx8CgkgICAgICAgIHR5cGVvZiB3aW5kb3cuSFRNTEVsZW1lbnQgPT09ICdvYmplY3QnKSAmJgoJICAgICAgICBvYmogaW5zdGFuY2VvZiB3aW5kb3cuSFRNTEVsZW1lbnQpIHsKCSAgICAgIC8qICEgU3BlYyBDb25mb3JtYW5jZQoJICAgICAgKiAoaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2Uvd2ViYXBwYXBpcy5odG1sI3BsdWdpbmFycmF5KQoJICAgICAgKiBXaGF0V0cgSFRNTCQ0LjQuNCAtIFRoZSBgYmxvY2txdW90ZWAgZWxlbWVudCAtIEludGVyZmFjZSBgSFRNTFF1b3RlRWxlbWVudGAKCSAgICAgICogVGVzdDogYE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdibG9ja3F1b3RlJykpYGAKCSAgICAgICogIC0gSUUgPD0xMCA9PT0gIltvYmplY3QgSFRNTEJsb2NrRWxlbWVudF0iCgkgICAgICAqLwoJICAgICAgaWYgKG9iai50YWdOYW1lID09PSAnQkxPQ0tRVU9URScpIHsKCSAgICAgICAgcmV0dXJuICdIVE1MUXVvdGVFbGVtZW50JzsKCSAgICAgIH0KCgkgICAgICAvKiAhIFNwZWMgQ29uZm9ybWFuY2UKCSAgICAgICAqIChodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnLyNodG1sdGFibGVkYXRhY2VsbGVsZW1lbnQpCgkgICAgICAgKiBXaGF0V0cgSFRNTCQ0LjkuOSAtIFRoZSBgdGRgIGVsZW1lbnQgLSBJbnRlcmZhY2UgYEhUTUxUYWJsZURhdGFDZWxsRWxlbWVudGAKCSAgICAgICAqIE5vdGU6IE1vc3QgYnJvd3NlcnMgY3VycmVudGx5IGFkaGVyIHRvIHRoZSBXM0MgRE9NIExldmVsIDIgc3BlYwoJICAgICAgICogICAgICAgKGh0dHBzOi8vd3d3LnczLm9yZy9UUi9ET00tTGV2ZWwtMi1IVE1ML2h0bWwuaHRtbCNJRC04MjkxNTA3NSkKCSAgICAgICAqICAgICAgIHdoaWNoIHN1Z2dlc3RzIHRoYXQgYnJvd3NlcnMgc2hvdWxkIHVzZSBIVE1MVGFibGVDZWxsRWxlbWVudCBmb3IKCSAgICAgICAqICAgICAgIGJvdGggVEQgYW5kIFRIIGVsZW1lbnRzLiBXaGF0V0cgc2VwYXJhdGVzIHRoZXNlLgoJICAgICAgICogVGVzdDogT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJykpCgkgICAgICAgKiAgLSBDaHJvbWUgPT09ICJbb2JqZWN0IEhUTUxUYWJsZUNlbGxFbGVtZW50XSIKCSAgICAgICAqICAtIEZpcmVmb3ggPT09ICJbb2JqZWN0IEhUTUxUYWJsZUNlbGxFbGVtZW50XSIKCSAgICAgICAqICAtIFNhZmFyaSA9PT0gIltvYmplY3QgSFRNTFRhYmxlQ2VsbEVsZW1lbnRdIgoJICAgICAgICovCgkgICAgICBpZiAob2JqLnRhZ05hbWUgPT09ICdURCcpIHsKCSAgICAgICAgcmV0dXJuICdIVE1MVGFibGVEYXRhQ2VsbEVsZW1lbnQnOwoJICAgICAgfQoKCSAgICAgIC8qICEgU3BlYyBDb25mb3JtYW5jZQoJICAgICAgICogKGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvI2h0bWx0YWJsZWhlYWRlcmNlbGxlbGVtZW50KQoJICAgICAgICogV2hhdFdHIEhUTUwkNC45LjkgLSBUaGUgYHRkYCBlbGVtZW50IC0gSW50ZXJmYWNlIGBIVE1MVGFibGVIZWFkZXJDZWxsRWxlbWVudGAKCSAgICAgICAqIE5vdGU6IE1vc3QgYnJvd3NlcnMgY3VycmVudGx5IGFkaGVyIHRvIHRoZSBXM0MgRE9NIExldmVsIDIgc3BlYwoJICAgICAgICogICAgICAgKGh0dHBzOi8vd3d3LnczLm9yZy9UUi9ET00tTGV2ZWwtMi1IVE1ML2h0bWwuaHRtbCNJRC04MjkxNTA3NSkKCSAgICAgICAqICAgICAgIHdoaWNoIHN1Z2dlc3RzIHRoYXQgYnJvd3NlcnMgc2hvdWxkIHVzZSBIVE1MVGFibGVDZWxsRWxlbWVudCBmb3IKCSAgICAgICAqICAgICAgIGJvdGggVEQgYW5kIFRIIGVsZW1lbnRzLiBXaGF0V0cgc2VwYXJhdGVzIHRoZXNlLgoJICAgICAgICogVGVzdDogT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJykpCgkgICAgICAgKiAgLSBDaHJvbWUgPT09ICJbb2JqZWN0IEhUTUxUYWJsZUNlbGxFbGVtZW50XSIKCSAgICAgICAqICAtIEZpcmVmb3ggPT09ICJbb2JqZWN0IEhUTUxUYWJsZUNlbGxFbGVtZW50XSIKCSAgICAgICAqICAtIFNhZmFyaSA9PT0gIltvYmplY3QgSFRNTFRhYmxlQ2VsbEVsZW1lbnRdIgoJICAgICAgICovCgkgICAgICBpZiAob2JqLnRhZ05hbWUgPT09ICdUSCcpIHsKCSAgICAgICAgcmV0dXJuICdIVE1MVGFibGVIZWFkZXJDZWxsRWxlbWVudCc7CgkgICAgICB9CgkgICAgfQoJICB9CgoJICAvKiAhIFNwZWVkIG9wdGltaXNhdGlvbgoJICAqIFByZToKCSAgKiAgIEZsb2F0NjRBcnJheSAgICAgICB4IDYyNSw2NDQgb3BzL3NlYyDCsTEuNTglICg4MCBydW5zIHNhbXBsZWQpCgkgICogICBGbG9hdDMyQXJyYXkgICAgICAgeCAxLDI3OSw4NTIgb3BzL3NlYyDCsTIuOTElICg3NyBydW5zIHNhbXBsZWQpCgkgICogICBVaW50MzJBcnJheSAgICAgICAgeCAxLDE3OCwxODUgb3BzL3NlYyDCsTEuOTUlICg4MyBydW5zIHNhbXBsZWQpCgkgICogICBVaW50MTZBcnJheSAgICAgICAgeCAxLDAwOCwzODAgb3BzL3NlYyDCsTIuMjUlICg4MCBydW5zIHNhbXBsZWQpCgkgICogICBVaW50OEFycmF5ICAgICAgICAgeCAxLDEyOCwwNDAgb3BzL3NlYyDCsTIuMTElICg4MSBydW5zIHNhbXBsZWQpCgkgICogICBJbnQzMkFycmF5ICAgICAgICAgeCAxLDE3MCwxMTkgb3BzL3NlYyDCsTIuODglICg4MCBydW5zIHNhbXBsZWQpCgkgICogICBJbnQxNkFycmF5ICAgICAgICAgeCAxLDE3NiwzNDggb3BzL3NlYyDCsTUuNzklICg4NiBydW5zIHNhbXBsZWQpCgkgICogICBJbnQ4QXJyYXkgICAgICAgICAgeCAxLDA1OCw3MDcgb3BzL3NlYyDCsTQuOTQlICg3NyBydW5zIHNhbXBsZWQpCgkgICogICBVaW50OENsYW1wZWRBcnJheSAgeCAxLDExMCw2MzMgb3BzL3NlYyDCsTQuMjAlICg4MCBydW5zIHNhbXBsZWQpCgkgICogUG9zdDoKCSAgKiAgIEZsb2F0NjRBcnJheSAgICAgICB4IDcsMTA1LDY3MSBvcHMvc2VjIMKxMTMuNDclICg2NCBydW5zIHNhbXBsZWQpCgkgICogICBGbG9hdDMyQXJyYXkgICAgICAgeCA1LDg4Nyw5MTIgb3BzL3NlYyDCsTEuNDYlICg4MiBydW5zIHNhbXBsZWQpCgkgICogICBVaW50MzJBcnJheSAgICAgICAgeCA2LDQ5MSw2NjEgb3BzL3NlYyDCsTEuNzYlICg3OSBydW5zIHNhbXBsZWQpCgkgICogICBVaW50MTZBcnJheSAgICAgICAgeCA2LDU1OSw3OTUgb3BzL3NlYyDCsTEuNjclICg4MiBydW5zIHNhbXBsZWQpCgkgICogICBVaW50OEFycmF5ICAgICAgICAgeCA2LDQ2Myw5NjYgb3BzL3NlYyDCsTEuNDMlICg4NSBydW5zIHNhbXBsZWQpCgkgICogICBJbnQzMkFycmF5ICAgICAgICAgeCA1LDY0MSw4NDEgb3BzL3NlYyDCsTMuNDklICg4MSBydW5zIHNhbXBsZWQpCgkgICogICBJbnQxNkFycmF5ICAgICAgICAgeCA2LDU4Myw1MTEgb3BzL3NlYyDCsTEuOTglICg4MCBydW5zIHNhbXBsZWQpCgkgICogICBJbnQ4QXJyYXkgICAgICAgICAgeCA2LDYwNiwwNzggb3BzL3NlYyDCsTEuNzQlICg4MSBydW5zIHNhbXBsZWQpCgkgICogICBVaW50OENsYW1wZWRBcnJheSAgeCA2LDYwMiwyMjQgb3BzL3NlYyDCsTEuNzclICg4MyBydW5zIHNhbXBsZWQpCgkgICovCgkgIHZhciBzdHJpbmdUYWcgPSAoc3ltYm9sVG9TdHJpbmdUYWdFeGlzdHMgJiYgb2JqW1N5bWJvbC50b1N0cmluZ1RhZ10pOwoJICBpZiAodHlwZW9mIHN0cmluZ1RhZyA9PT0gJ3N0cmluZycpIHsKCSAgICByZXR1cm4gc3RyaW5nVGFnOwoJICB9CgoJICB2YXIgb2JqUHJvdG90eXBlID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iaik7CgkgIC8qICEgU3BlZWQgb3B0aW1pc2F0aW9uCgkgICogUHJlOgoJICAqICAgcmVnZXggbGl0ZXJhbCAgICAgIHggMSw3NzIsMzg1IG9wcy9zZWMgwrExLjg1JSAoNzcgcnVucyBzYW1wbGVkKQoJICAqICAgcmVnZXggY29uc3RydWN0b3IgIHggMiwxNDMsNjM0IG9wcy9zZWMgwrEyLjQ2JSAoNzggcnVucyBzYW1wbGVkKQoJICAqIFBvc3Q6CgkgICogICByZWdleCBsaXRlcmFsICAgICAgeCAzLDkyOCwwMDkgb3BzL3NlYyDCsTAuNjUlICg3OCBydW5zIHNhbXBsZWQpCgkgICogICByZWdleCBjb25zdHJ1Y3RvciAgeCAzLDkzMSwxMDggb3BzL3NlYyDCsTAuNTglICg4NCBydW5zIHNhbXBsZWQpCgkgICovCgkgIGlmIChvYmpQcm90b3R5cGUgPT09IFJlZ0V4cC5wcm90b3R5cGUpIHsKCSAgICByZXR1cm4gJ1JlZ0V4cCc7CgkgIH0KCgkgIC8qICEgU3BlZWQgb3B0aW1pc2F0aW9uCgkgICogUHJlOgoJICAqICAgZGF0ZSAgICAgICAgICAgICAgIHggMiwxMzAsMDc0IG9wcy9zZWMgwrE0LjQyJSAoNjggcnVucyBzYW1wbGVkKQoJICAqIFBvc3Q6CgkgICogICBkYXRlICAgICAgICAgICAgICAgeCAzLDk1Myw3Nzkgb3BzL3NlYyDCsTEuMzUlICg3NyBydW5zIHNhbXBsZWQpCgkgICovCgkgIGlmIChvYmpQcm90b3R5cGUgPT09IERhdGUucHJvdG90eXBlKSB7CgkgICAgcmV0dXJuICdEYXRlJzsKCSAgfQoKCSAgLyogISBTcGVjIENvbmZvcm1hbmNlCgkgICAqIChodHRwOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNi4wL2luZGV4Lmh0bWwjc2VjLXByb21pc2UucHJvdG90eXBlLUBAdG9zdHJpbmd0YWcpCgkgICAqIEVTNiQyNS40LjUuNCAtIFByb21pc2UucHJvdG90eXBlW0BAdG9TdHJpbmdUYWddIHNob3VsZCBiZSAiUHJvbWlzZSI6CgkgICAqIFRlc3Q6IGBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoUHJvbWlzZS5yZXNvbHZlKCkpYGAKCSAgICogIC0gQ2hyb21lIDw9NDcgPT09ICJbb2JqZWN0IE9iamVjdF0iCgkgICAqICAtIEVkZ2UgPD0yMCA9PT0gIltvYmplY3QgT2JqZWN0XSIKCSAgICogIC0gRmlyZWZveCAyOS1MYXRlc3QgPT09ICJbb2JqZWN0IFByb21pc2VdIgoJICAgKiAgLSBTYWZhcmkgNy4xLUxhdGVzdCA9PT0gIltvYmplY3QgUHJvbWlzZV0iCgkgICAqLwoJICBpZiAocHJvbWlzZUV4aXN0cyAmJiBvYmpQcm90b3R5cGUgPT09IFByb21pc2UucHJvdG90eXBlKSB7CgkgICAgcmV0dXJuICdQcm9taXNlJzsKCSAgfQoKCSAgLyogISBTcGVlZCBvcHRpbWlzYXRpb24KCSAgKiBQcmU6CgkgICogICBzZXQgICAgICAgICAgICAgICAgeCAyLDIyMiwxODYgb3BzL3NlYyDCsTEuMzElICg4MiBydW5zIHNhbXBsZWQpCgkgICogUG9zdDoKCSAgKiAgIHNldCAgICAgICAgICAgICAgICB4IDQsNTQ1LDg3OSBvcHMvc2VjIMKxMS4xMyUgKDgzIHJ1bnMgc2FtcGxlZCkKCSAgKi8KCSAgaWYgKHNldEV4aXN0cyAmJiBvYmpQcm90b3R5cGUgPT09IFNldC5wcm90b3R5cGUpIHsKCSAgICByZXR1cm4gJ1NldCc7CgkgIH0KCgkgIC8qICEgU3BlZWQgb3B0aW1pc2F0aW9uCgkgICogUHJlOgoJICAqICAgbWFwICAgICAgICAgICAgICAgIHggMiwzOTYsODQyIG9wcy9zZWMgwrExLjU5JSAoODEgcnVucyBzYW1wbGVkKQoJICAqIFBvc3Q6CgkgICogICBtYXAgICAgICAgICAgICAgICAgeCA0LDE4Myw5NDUgb3BzL3NlYyDCsTYuNTklICg4MiBydW5zIHNhbXBsZWQpCgkgICovCgkgIGlmIChtYXBFeGlzdHMgJiYgb2JqUHJvdG90eXBlID09PSBNYXAucHJvdG90eXBlKSB7CgkgICAgcmV0dXJuICdNYXAnOwoJICB9CgoJICAvKiAhIFNwZWVkIG9wdGltaXNhdGlvbgoJICAqIFByZToKCSAgKiAgIHdlYWtzZXQgICAgICAgICAgICB4IDEsMzIzLDIyMCBvcHMvc2VjIMKxMi4xNyUgKDc2IHJ1bnMgc2FtcGxlZCkKCSAgKiBQb3N0OgoJICAqICAgd2Vha3NldCAgICAgICAgICAgIHggNCwyMzcsNTEwIG9wcy9zZWMgwrEyLjAxJSAoNzcgcnVucyBzYW1wbGVkKQoJICAqLwoJICBpZiAod2Vha1NldEV4aXN0cyAmJiBvYmpQcm90b3R5cGUgPT09IFdlYWtTZXQucHJvdG90eXBlKSB7CgkgICAgcmV0dXJuICdXZWFrU2V0JzsKCSAgfQoKCSAgLyogISBTcGVlZCBvcHRpbWlzYXRpb24KCSAgKiBQcmU6CgkgICogICB3ZWFrbWFwICAgICAgICAgICAgeCAxLDUwMCwyNjAgb3BzL3NlYyDCsTIuMDIlICg3OCBydW5zIHNhbXBsZWQpCgkgICogUG9zdDoKCSAgKiAgIHdlYWttYXAgICAgICAgICAgICB4IDMsODgxLDM4NCBvcHMvc2VjIMKxMS40NSUgKDgyIHJ1bnMgc2FtcGxlZCkKCSAgKi8KCSAgaWYgKHdlYWtNYXBFeGlzdHMgJiYgb2JqUHJvdG90eXBlID09PSBXZWFrTWFwLnByb3RvdHlwZSkgewoJICAgIHJldHVybiAnV2Vha01hcCc7CgkgIH0KCgkgIC8qICEgU3BlYyBDb25mb3JtYW5jZQoJICAgKiAoaHR0cDovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzYuMC9pbmRleC5odG1sI3NlYy1kYXRhdmlldy5wcm90b3R5cGUtQEB0b3N0cmluZ3RhZykKCSAgICogRVM2JDI0LjIuNC4yMSAtIERhdGFWaWV3LnByb3RvdHlwZVtAQHRvU3RyaW5nVGFnXSBzaG91bGQgYmUgIkRhdGFWaWV3IjoKCSAgICogVGVzdDogYE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChuZXcgRGF0YVZpZXcobmV3IEFycmF5QnVmZmVyKDEpKSlgYAoJICAgKiAgLSBFZGdlIDw9MTMgPT09ICJbb2JqZWN0IE9iamVjdF0iCgkgICAqLwoJICBpZiAoZGF0YVZpZXdFeGlzdHMgJiYgb2JqUHJvdG90eXBlID09PSBEYXRhVmlldy5wcm90b3R5cGUpIHsKCSAgICByZXR1cm4gJ0RhdGFWaWV3JzsKCSAgfQoKCSAgLyogISBTcGVjIENvbmZvcm1hbmNlCgkgICAqIChodHRwOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNi4wL2luZGV4Lmh0bWwjc2VjLSVtYXBpdGVyYXRvcnByb3RvdHlwZSUtQEB0b3N0cmluZ3RhZykKCSAgICogRVM2JDIzLjEuNS4yLjIgLSAlTWFwSXRlcmF0b3JQcm90b3R5cGUlW0BAdG9TdHJpbmdUYWddIHNob3VsZCBiZSAiTWFwIEl0ZXJhdG9yIjoKCSAgICogVGVzdDogYE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChuZXcgTWFwKCkuZW50cmllcygpKWBgCgkgICAqICAtIEVkZ2UgPD0xMyA9PT0gIltvYmplY3QgT2JqZWN0XSIKCSAgICovCgkgIGlmIChtYXBFeGlzdHMgJiYgb2JqUHJvdG90eXBlID09PSBtYXBJdGVyYXRvclByb3RvdHlwZSkgewoJICAgIHJldHVybiAnTWFwIEl0ZXJhdG9yJzsKCSAgfQoKCSAgLyogISBTcGVjIENvbmZvcm1hbmNlCgkgICAqIChodHRwOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNi4wL2luZGV4Lmh0bWwjc2VjLSVzZXRpdGVyYXRvcnByb3RvdHlwZSUtQEB0b3N0cmluZ3RhZykKCSAgICogRVM2JDIzLjIuNS4yLjIgLSAlU2V0SXRlcmF0b3JQcm90b3R5cGUlW0BAdG9TdHJpbmdUYWddIHNob3VsZCBiZSAiU2V0IEl0ZXJhdG9yIjoKCSAgICogVGVzdDogYE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChuZXcgU2V0KCkuZW50cmllcygpKWBgCgkgICAqICAtIEVkZ2UgPD0xMyA9PT0gIltvYmplY3QgT2JqZWN0XSIKCSAgICovCgkgIGlmIChzZXRFeGlzdHMgJiYgb2JqUHJvdG90eXBlID09PSBzZXRJdGVyYXRvclByb3RvdHlwZSkgewoJICAgIHJldHVybiAnU2V0IEl0ZXJhdG9yJzsKCSAgfQoKCSAgLyogISBTcGVjIENvbmZvcm1hbmNlCgkgICAqIChodHRwOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNi4wL2luZGV4Lmh0bWwjc2VjLSVhcnJheWl0ZXJhdG9ycHJvdG90eXBlJS1AQHRvc3RyaW5ndGFnKQoJICAgKiBFUzYkMjIuMS41LjIuMiAtICVBcnJheUl0ZXJhdG9yUHJvdG90eXBlJVtAQHRvU3RyaW5nVGFnXSBzaG91bGQgYmUgIkFycmF5IEl0ZXJhdG9yIjoKCSAgICogVGVzdDogYE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChbXVtTeW1ib2wuaXRlcmF0b3JdKCkpYGAKCSAgICogIC0gRWRnZSA8PTEzID09PSAiW29iamVjdCBPYmplY3RdIgoJICAgKi8KCSAgaWYgKGFycmF5SXRlcmF0b3JFeGlzdHMgJiYgb2JqUHJvdG90eXBlID09PSBhcnJheUl0ZXJhdG9yUHJvdG90eXBlKSB7CgkgICAgcmV0dXJuICdBcnJheSBJdGVyYXRvcic7CgkgIH0KCgkgIC8qICEgU3BlYyBDb25mb3JtYW5jZQoJICAgKiAoaHR0cDovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzYuMC9pbmRleC5odG1sI3NlYy0lc3RyaW5naXRlcmF0b3Jwcm90b3R5cGUlLUBAdG9zdHJpbmd0YWcpCgkgICAqIEVTNiQyMS4xLjUuMi4yIC0gJVN0cmluZ0l0ZXJhdG9yUHJvdG90eXBlJVtAQHRvU3RyaW5nVGFnXSBzaG91bGQgYmUgIlN0cmluZyBJdGVyYXRvciI6CgkgICAqIFRlc3Q6IGBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoJydbU3ltYm9sLml0ZXJhdG9yXSgpKWBgCgkgICAqICAtIEVkZ2UgPD0xMyA9PT0gIltvYmplY3QgT2JqZWN0XSIKCSAgICovCgkgIGlmIChzdHJpbmdJdGVyYXRvckV4aXN0cyAmJiBvYmpQcm90b3R5cGUgPT09IHN0cmluZ0l0ZXJhdG9yUHJvdG90eXBlKSB7CgkgICAgcmV0dXJuICdTdHJpbmcgSXRlcmF0b3InOwoJICB9CgoJICAvKiAhIFNwZWVkIG9wdGltaXNhdGlvbgoJICAqIFByZToKCSAgKiAgIG9iamVjdCBmcm9tIG51bGwgICB4IDIsNDI0LDMyMCBvcHMvc2VjIMKxMS42NyUgKDc2IHJ1bnMgc2FtcGxlZCkKCSAgKiBQb3N0OgoJICAqICAgb2JqZWN0IGZyb20gbnVsbCAgIHggNSw4MzgsMDAwIG9wcy9zZWMgwrEwLjk5JSAoODQgcnVucyBzYW1wbGVkKQoJICAqLwoJICBpZiAob2JqUHJvdG90eXBlID09PSBudWxsKSB7CgkgICAgcmV0dXJuICdPYmplY3QnOwoJICB9CgoJICByZXR1cm4gT2JqZWN0CgkgICAgLnByb3RvdHlwZQoJICAgIC50b1N0cmluZwoJICAgIC5jYWxsKG9iaikKCSAgICAuc2xpY2UodG9TdHJpbmdMZWZ0U2xpY2VMZW5ndGgsIHRvU3RyaW5nUmlnaHRTbGljZUxlbmd0aCk7Cgl9CgoJcmV0dXJuIHR5cGVEZXRlY3Q7CgoJfSkpKTsKCX0pOwoKCWZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkgewoJICByZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpOwoJfQoKCWZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHsKCSAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjsKCX0KCglmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7CgkgIGlmICh0eXBlb2YgU3ltYm9sID09PSAidW5kZWZpbmVkIiB8fCAhKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoYXJyKSkpIHJldHVybjsKCSAgdmFyIF9hcnIgPSBbXTsKCSAgdmFyIF9uID0gdHJ1ZTsKCSAgdmFyIF9kID0gZmFsc2U7CgkgIHZhciBfZSA9IHVuZGVmaW5lZDsKCgkgIHRyeSB7CgkgICAgZm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkgewoJICAgICAgX2Fyci5wdXNoKF9zLnZhbHVlKTsKCgkgICAgICBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7CgkgICAgfQoJICB9IGNhdGNoIChlcnIpIHsKCSAgICBfZCA9IHRydWU7CgkgICAgX2UgPSBlcnI7CgkgIH0gZmluYWxseSB7CgkgICAgdHJ5IHsKCSAgICAgIGlmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpOwoJICAgIH0gZmluYWxseSB7CgkgICAgICBpZiAoX2QpIHRocm93IF9lOwoJICAgIH0KCSAgfQoKCSAgcmV0dXJuIF9hcnI7Cgl9CgoJZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikgewoJICBpZiAoIW8pIHJldHVybjsKCSAgaWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7CgkgIHZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTsKCSAgaWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7CgkgIGlmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obik7CgkgIGlmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7Cgl9CgoJZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHsKCSAgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7CgoJICBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIGFycjJbaV0gPSBhcnJbaV07CgoJICByZXR1cm4gYXJyMjsKCX0KCglmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgewoJICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpOwoJfQoKCXZhciBhbnNpQ29sb3JzID0gewoJICBib2xkOiBbJzEnLCAnMjInXSwKCSAgZGltOiBbJzInLCAnMjInXSwKCSAgaXRhbGljOiBbJzMnLCAnMjMnXSwKCSAgdW5kZXJsaW5lOiBbJzQnLCAnMjQnXSwKCSAgLy8gNSAmIDYgYXJlIGJsaW5raW5nCgkgIGludmVyc2U6IFsnNycsICcyNyddLAoJICBoaWRkZW46IFsnOCcsICcyOCddLAoJICBzdHJpa2U6IFsnOScsICcyOSddLAoJICAvLyAxMC0yMCBhcmUgZm9udHMKCSAgLy8gMjEtMjkgYXJlIHJlc2V0cyBmb3IgMS05CgkgIGJsYWNrOiBbJzMwJywgJzM5J10sCgkgIHJlZDogWyczMScsICczOSddLAoJICBncmVlbjogWyczMicsICczOSddLAoJICB5ZWxsb3c6IFsnMzMnLCAnMzknXSwKCSAgYmx1ZTogWyczNCcsICczOSddLAoJICBtYWdlbnRhOiBbJzM1JywgJzM5J10sCgkgIGN5YW46IFsnMzYnLCAnMzknXSwKCSAgd2hpdGU6IFsnMzcnLCAnMzknXSwKCSAgYnJpZ2h0YmxhY2s6IFsnMzA7MScsICczOSddLAoJICBicmlnaHRyZWQ6IFsnMzE7MScsICczOSddLAoJICBicmlnaHRncmVlbjogWyczMjsxJywgJzM5J10sCgkgIGJyaWdodHllbGxvdzogWyczMzsxJywgJzM5J10sCgkgIGJyaWdodGJsdWU6IFsnMzQ7MScsICczOSddLAoJICBicmlnaHRtYWdlbnRhOiBbJzM1OzEnLCAnMzknXSwKCSAgYnJpZ2h0Y3lhbjogWyczNjsxJywgJzM5J10sCgkgIGJyaWdodHdoaXRlOiBbJzM3OzEnLCAnMzknXSwKCSAgZ3JleTogWyc5MCcsICczOSddCgl9OwoJdmFyIHN0eWxlcyA9IHsKCSAgc3BlY2lhbDogJ2N5YW4nLAoJICBudW1iZXI6ICd5ZWxsb3cnLAoJICBib29sZWFuOiAneWVsbG93JywKCSAgdW5kZWZpbmVkOiAnZ3JleScsCgkgIG51bGw6ICdib2xkJywKCSAgc3RyaW5nOiAnZ3JlZW4nLAoJICBzeW1ib2w6ICdncmVlbicsCgkgIGRhdGU6ICdtYWdlbnRhJywKCSAgcmVnZXhwOiAncmVkJwoJfTsKCXZhciB0cnVuY2F0b3IgPSAn4oCmJzsKCglmdW5jdGlvbiBjb2xvcmlzZSh2YWx1ZSwgc3R5bGVUeXBlKSB7CgkgIHZhciBjb2xvciA9IGFuc2lDb2xvcnNbc3R5bGVzW3N0eWxlVHlwZV1dIHx8IGFuc2lDb2xvcnNbc3R5bGVUeXBlXTsKCgkgIGlmICghY29sb3IpIHsKCSAgICByZXR1cm4gU3RyaW5nKHZhbHVlKTsKCSAgfQoKCSAgcmV0dXJuICJceDFCWyIuY29uY2F0KGNvbG9yWzBdLCAibSIpLmNvbmNhdChTdHJpbmcodmFsdWUpLCAiXHgxQlsiKS5jb25jYXQoY29sb3JbMV0sICJtIik7Cgl9CgoJZnVuY3Rpb24gbm9ybWFsaXNlT3B0aW9ucygpIHsKCSAgdmFyIF9yZWYgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9LAoJICAgICAgX3JlZiRzaG93SGlkZGVuID0gX3JlZi5zaG93SGlkZGVuLAoJICAgICAgc2hvd0hpZGRlbiA9IF9yZWYkc2hvd0hpZGRlbiA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmJHNob3dIaWRkZW4sCgkgICAgICBfcmVmJGRlcHRoID0gX3JlZi5kZXB0aCwKCSAgICAgIGRlcHRoID0gX3JlZiRkZXB0aCA9PT0gdm9pZCAwID8gMiA6IF9yZWYkZGVwdGgsCgkgICAgICBfcmVmJGNvbG9ycyA9IF9yZWYuY29sb3JzLAoJICAgICAgY29sb3JzID0gX3JlZiRjb2xvcnMgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZiRjb2xvcnMsCgkgICAgICBfcmVmJGN1c3RvbUluc3BlY3QgPSBfcmVmLmN1c3RvbUluc3BlY3QsCgkgICAgICBjdXN0b21JbnNwZWN0ID0gX3JlZiRjdXN0b21JbnNwZWN0ID09PSB2b2lkIDAgPyB0cnVlIDogX3JlZiRjdXN0b21JbnNwZWN0LAoJICAgICAgX3JlZiRzaG93UHJveHkgPSBfcmVmLnNob3dQcm94eSwKCSAgICAgIHNob3dQcm94eSA9IF9yZWYkc2hvd1Byb3h5ID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWYkc2hvd1Byb3h5LAoJICAgICAgX3JlZiRtYXhBcnJheUxlbmd0aCA9IF9yZWYubWF4QXJyYXlMZW5ndGgsCgkgICAgICBtYXhBcnJheUxlbmd0aCA9IF9yZWYkbWF4QXJyYXlMZW5ndGggPT09IHZvaWQgMCA/IEluZmluaXR5IDogX3JlZiRtYXhBcnJheUxlbmd0aCwKCSAgICAgIF9yZWYkYnJlYWtMZW5ndGggPSBfcmVmLmJyZWFrTGVuZ3RoLAoJICAgICAgYnJlYWtMZW5ndGggPSBfcmVmJGJyZWFrTGVuZ3RoID09PSB2b2lkIDAgPyBJbmZpbml0eSA6IF9yZWYkYnJlYWtMZW5ndGgsCgkgICAgICBfcmVmJHNlZW4gPSBfcmVmLnNlZW4sCgkgICAgICBzZWVuID0gX3JlZiRzZWVuID09PSB2b2lkIDAgPyBbXSA6IF9yZWYkc2VlbiwKCSAgICAgIF9yZWYkdHJ1bmNhdGUgPSBfcmVmLnRydW5jYXRlLAoJICAgICAgdHJ1bmNhdGUgPSBfcmVmJHRydW5jYXRlID09PSB2b2lkIDAgPyBJbmZpbml0eSA6IF9yZWYkdHJ1bmNhdGUsCgkgICAgICBfcmVmJHN0eWxpemUgPSBfcmVmLnN0eWxpemUsCgkgICAgICBzdHlsaXplID0gX3JlZiRzdHlsaXplID09PSB2b2lkIDAgPyBTdHJpbmcgOiBfcmVmJHN0eWxpemU7CgoJICB2YXIgb3B0aW9ucyA9IHsKCSAgICBzaG93SGlkZGVuOiBCb29sZWFuKHNob3dIaWRkZW4pLAoJICAgIGRlcHRoOiBOdW1iZXIoZGVwdGgpLAoJICAgIGNvbG9yczogQm9vbGVhbihjb2xvcnMpLAoJICAgIGN1c3RvbUluc3BlY3Q6IEJvb2xlYW4oY3VzdG9tSW5zcGVjdCksCgkgICAgc2hvd1Byb3h5OiBCb29sZWFuKHNob3dQcm94eSksCgkgICAgbWF4QXJyYXlMZW5ndGg6IE51bWJlcihtYXhBcnJheUxlbmd0aCksCgkgICAgYnJlYWtMZW5ndGg6IE51bWJlcihicmVha0xlbmd0aCksCgkgICAgdHJ1bmNhdGU6IE51bWJlcih0cnVuY2F0ZSksCgkgICAgc2Vlbjogc2VlbiwKCSAgICBzdHlsaXplOiBzdHlsaXplCgkgIH07CgoJICBpZiAob3B0aW9ucy5jb2xvcnMpIHsKCSAgICBvcHRpb25zLnN0eWxpemUgPSBjb2xvcmlzZTsKCSAgfQoKCSAgcmV0dXJuIG9wdGlvbnM7Cgl9CglmdW5jdGlvbiB0cnVuY2F0ZShzdHJpbmcsIGxlbmd0aCkgewoJICB2YXIgdGFpbCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogdHJ1bmNhdG9yOwoJICBzdHJpbmcgPSBTdHJpbmcoc3RyaW5nKTsKCSAgdmFyIHRhaWxMZW5ndGggPSB0YWlsLmxlbmd0aDsKCSAgdmFyIHN0cmluZ0xlbmd0aCA9IHN0cmluZy5sZW5ndGg7CgoJICBpZiAodGFpbExlbmd0aCA+IGxlbmd0aCAmJiBzdHJpbmdMZW5ndGggPiB0YWlsTGVuZ3RoKSB7CgkgICAgcmV0dXJuIHRhaWw7CgkgIH0KCgkgIGlmIChzdHJpbmdMZW5ndGggPiBsZW5ndGggJiYgc3RyaW5nTGVuZ3RoID4gdGFpbExlbmd0aCkgewoJICAgIHJldHVybiAiIi5jb25jYXQoc3RyaW5nLnNsaWNlKDAsIGxlbmd0aCAtIHRhaWxMZW5ndGgpKS5jb25jYXQodGFpbCk7CgkgIH0KCgkgIHJldHVybiBzdHJpbmc7Cgl9IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb21wbGV4aXR5CgoJZnVuY3Rpb24gaW5zcGVjdExpc3QobGlzdCwgb3B0aW9ucywgaW5zcGVjdEl0ZW0pIHsKCSAgdmFyIHNlcGFyYXRvciA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogJywgJzsKCSAgaW5zcGVjdEl0ZW0gPSBpbnNwZWN0SXRlbSB8fCBvcHRpb25zLmluc3BlY3Q7CgkgIHZhciBzaXplID0gbGlzdC5sZW5ndGg7CgkgIGlmIChzaXplID09PSAwKSByZXR1cm4gJyc7CgkgIHZhciBvcmlnaW5hbExlbmd0aCA9IG9wdGlvbnMudHJ1bmNhdGU7CgkgIHZhciBvdXRwdXQgPSAnJzsKCSAgdmFyIHBlZWsgPSAnJzsKCSAgdmFyIHRydW5jYXRlZCA9ICcnOwoKCSAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpICs9IDEpIHsKCSAgICB2YXIgbGFzdCA9IGkgKyAxID09PSBsaXN0Lmxlbmd0aDsKCSAgICB2YXIgc2Vjb25kVG9MYXN0ID0gaSArIDIgPT09IGxpc3QubGVuZ3RoOwoJICAgIHRydW5jYXRlZCA9ICIiLmNvbmNhdCh0cnVuY2F0b3IsICIoIikuY29uY2F0KGxpc3QubGVuZ3RoIC0gaSwgIikiKTsKCSAgICB2YXIgdmFsdWUgPSBsaXN0W2ldOyAvLyBJZiB0aGVyZSBpcyBtb3JlIHRoYW4gb25lIHJlbWFpbmluZyB3ZSBuZWVkIHRvIGFjY291bnQgZm9yIGEgc2VwYXJhdG9yIG9mIGAsIGAKCgkgICAgb3B0aW9ucy50cnVuY2F0ZSA9IG9yaWdpbmFsTGVuZ3RoIC0gb3V0cHV0Lmxlbmd0aCAtIChsYXN0ID8gMCA6IHNlcGFyYXRvci5sZW5ndGgpOwoJICAgIHZhciBzdHJpbmcgPSBwZWVrIHx8IGluc3BlY3RJdGVtKHZhbHVlLCBvcHRpb25zKSArIChsYXN0ID8gJycgOiBzZXBhcmF0b3IpOwoJICAgIHZhciBuZXh0TGVuZ3RoID0gb3V0cHV0Lmxlbmd0aCArIHN0cmluZy5sZW5ndGg7CgkgICAgdmFyIHRydW5jYXRlZExlbmd0aCA9IG5leHRMZW5ndGggKyB0cnVuY2F0ZWQubGVuZ3RoOyAvLyBJZiB0aGlzIGlzIHRoZSBsYXN0IGVsZW1lbnQsIGFuZCBhZGRpbmcgaXQgd291bGQKCSAgICAvLyB0YWtlIHVzIG92ZXIgbGVuZ3RoLCBidXQgYWRkaW5nIHRoZSB0cnVuY2F0b3Igd291bGRuJ3QgLSB0aGVuIGJyZWFrIG5vdwoKCSAgICBpZiAobGFzdCAmJiBuZXh0TGVuZ3RoID4gb3JpZ2luYWxMZW5ndGggJiYgb3V0cHV0Lmxlbmd0aCArIHRydW5jYXRlZC5sZW5ndGggPD0gb3JpZ2luYWxMZW5ndGgpIHsKCSAgICAgIGJyZWFrOwoJICAgIH0gLy8gSWYgdGhpcyBpc24ndCB0aGUgbGFzdCBvciBzZWNvbmQgdG8gbGFzdCBlbGVtZW50IHRvIHNjYW4sCgkgICAgLy8gYnV0IHRoZSBzdHJpbmcgaXMgYWxyZWFkeSBvdmVyIGxlbmd0aCB0aGVuIGJyZWFrIGhlcmUKCgoJICAgIGlmICghbGFzdCAmJiAhc2Vjb25kVG9MYXN0ICYmIHRydW5jYXRlZExlbmd0aCA+IG9yaWdpbmFsTGVuZ3RoKSB7CgkgICAgICBicmVhazsKCSAgICB9IC8vIFBlZWsgYXQgdGhlIG5leHQgc3RyaW5nIHRvIGRldGVybWluZSBpZiB3ZSBzaG91bGQKCSAgICAvLyBicmVhayBlYXJseSBiZWZvcmUgYWRkaW5nIHRoaXMgaXRlbSB0byB0aGUgb3V0cHV0CgoKCSAgICBwZWVrID0gbGFzdCA/ICcnIDogaW5zcGVjdEl0ZW0obGlzdFtpICsgMV0sIG9wdGlvbnMpICsgKHNlY29uZFRvTGFzdCA/ICcnIDogc2VwYXJhdG9yKTsgLy8gSWYgd2UgaGF2ZSBvbmUgZWxlbWVudCBsZWZ0LCBidXQgdGhpcyBlbGVtZW50IGFuZAoJICAgIC8vIHRoZSBuZXh0IHRha2VzIG92ZXIgbGVuZ3RoLCB0aGUgYnJlYWsgZWFybHkKCgkgICAgaWYgKCFsYXN0ICYmIHNlY29uZFRvTGFzdCAmJiB0cnVuY2F0ZWRMZW5ndGggPiBvcmlnaW5hbExlbmd0aCAmJiBuZXh0TGVuZ3RoICsgcGVlay5sZW5ndGggPiBvcmlnaW5hbExlbmd0aCkgewoJICAgICAgYnJlYWs7CgkgICAgfQoKCSAgICBvdXRwdXQgKz0gc3RyaW5nOyAvLyBJZiB0aGUgbmV4dCBlbGVtZW50IHRha2VzIHVzIHRvIGxlbmd0aCAtCgkgICAgLy8gYnV0IHRoZXJlIGFyZSBtb3JlIGFmdGVyIHRoYXQsIHRoZW4gd2Ugc2hvdWxkIHRydW5jYXRlIG5vdwoKCSAgICBpZiAoIWxhc3QgJiYgIXNlY29uZFRvTGFzdCAmJiBuZXh0TGVuZ3RoICsgcGVlay5sZW5ndGggPj0gb3JpZ2luYWxMZW5ndGgpIHsKCSAgICAgIHRydW5jYXRlZCA9ICIiLmNvbmNhdCh0cnVuY2F0b3IsICIoIikuY29uY2F0KGxpc3QubGVuZ3RoIC0gaSAtIDEsICIpIik7CgkgICAgICBicmVhazsKCSAgICB9CgoJICAgIHRydW5jYXRlZCA9ICcnOwoJICB9CgoJICByZXR1cm4gIiIuY29uY2F0KG91dHB1dCkuY29uY2F0KHRydW5jYXRlZCk7Cgl9CglmdW5jdGlvbiBpbnNwZWN0UHJvcGVydHkoX3JlZjIsIG9wdGlvbnMpIHsKCSAgdmFyIF9yZWYzID0gX3NsaWNlZFRvQXJyYXkoX3JlZjIsIDIpLAoJICAgICAga2V5ID0gX3JlZjNbMF0sCgkgICAgICB2YWx1ZSA9IF9yZWYzWzFdOwoKCSAgb3B0aW9ucy50cnVuY2F0ZSAtPSAyOwoKCSAgaWYgKHR5cGVvZiBrZXkgIT09ICdzdHJpbmcnICYmIHR5cGVvZiBrZXkgIT09ICdudW1iZXInKSB7CgkgICAga2V5ID0gIlsiLmNvbmNhdChvcHRpb25zLmluc3BlY3Qoa2V5LCBvcHRpb25zKSwgIl0iKTsKCSAgfQoKCSAgb3B0aW9ucy50cnVuY2F0ZSAtPSBrZXkubGVuZ3RoOwoJICB2YWx1ZSA9IG9wdGlvbnMuaW5zcGVjdCh2YWx1ZSwgb3B0aW9ucyk7CgkgIHJldHVybiAiIi5jb25jYXQoa2V5LCAiOiAiKS5jb25jYXQodmFsdWUpOwoJfQoKCWZ1bmN0aW9uIGluc3BlY3RBcnJheShhcnJheSwgb3B0aW9ucykgewoJICAvLyBPYmplY3Qua2V5cyB3aWxsIGFsd2F5cyBvdXRwdXQgdGhlIEFycmF5IGluZGljZXMgZmlyc3QsIHNvIHdlIGNhbiBzbGljZSBieQoJICAvLyBgYXJyYXkubGVuZ3RoYCB0byBnZXQgbm9uLWluZGV4IHByb3BlcnRpZXMKCSAgdmFyIG5vbkluZGV4UHJvcGVydGllcyA9IE9iamVjdC5rZXlzKGFycmF5KS5zbGljZShhcnJheS5sZW5ndGgpOwoJICBpZiAoIWFycmF5Lmxlbmd0aCAmJiAhbm9uSW5kZXhQcm9wZXJ0aWVzLmxlbmd0aCkgcmV0dXJuICdbXSc7CgkgIG9wdGlvbnMudHJ1bmNhdGUgLT0gNDsKCSAgdmFyIGxpc3RDb250ZW50cyA9IGluc3BlY3RMaXN0KGFycmF5LCBvcHRpb25zKTsKCSAgb3B0aW9ucy50cnVuY2F0ZSAtPSBsaXN0Q29udGVudHMubGVuZ3RoOwoJICB2YXIgcHJvcGVydHlDb250ZW50cyA9ICcnOwoKCSAgaWYgKG5vbkluZGV4UHJvcGVydGllcy5sZW5ndGgpIHsKCSAgICBwcm9wZXJ0eUNvbnRlbnRzID0gaW5zcGVjdExpc3Qobm9uSW5kZXhQcm9wZXJ0aWVzLm1hcChmdW5jdGlvbiAoa2V5KSB7CgkgICAgICByZXR1cm4gW2tleSwgYXJyYXlba2V5XV07CgkgICAgfSksIG9wdGlvbnMsIGluc3BlY3RQcm9wZXJ0eSk7CgkgIH0KCgkgIHJldHVybiAiWyAiLmNvbmNhdChsaXN0Q29udGVudHMpLmNvbmNhdChwcm9wZXJ0eUNvbnRlbnRzID8gIiwgIi5jb25jYXQocHJvcGVydHlDb250ZW50cykgOiAnJywgIiBdIik7Cgl9CgoJLyogIQoJICogQ2hhaSAtIGdldEZ1bmNOYW1lIHV0aWxpdHkKCSAqIENvcHlyaWdodChjKSAyMDEyLTIwMTYgSmFrZSBMdWVyIDxqYWtlQGFsb2dpY2FscGFyYWRveC5jb20+CgkgKiBNSVQgTGljZW5zZWQKCSAqLwoKCS8qKgoJICogIyMjIC5nZXRGdW5jTmFtZShjb25zdHJ1Y3RvckZuKQoJICoKCSAqIFJldHVybnMgdGhlIG5hbWUgb2YgYSBmdW5jdGlvbi4KCSAqIFdoZW4gYSBub24tZnVuY3Rpb24gaW5zdGFuY2UgaXMgcGFzc2VkLCByZXR1cm5zIGBudWxsYC4KCSAqIFRoaXMgYWxzbyBpbmNsdWRlcyBhIHBvbHlmaWxsIGZ1bmN0aW9uIGlmIGBhRnVuYy5uYW1lYCBpcyBub3QgZGVmaW5lZC4KCSAqCgkgKiBAbmFtZSBnZXRGdW5jTmFtZQoJICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuY3QKCSAqIEBuYW1lc3BhY2UgVXRpbHMKCSAqIEBhcGkgcHVibGljCgkgKi8KCgl2YXIgdG9TdHJpbmcgPSBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmc7Cgl2YXIgZnVuY3Rpb25OYW1lTWF0Y2ggPSAvXHMqZnVuY3Rpb24oPzpcc3xccypcL1wqW14oPzoqXC8pXStcKlwvXHMqKSooW15cc1woXC9dKykvOwoJZnVuY3Rpb24gZ2V0RnVuY05hbWUoYUZ1bmMpIHsKCSAgaWYgKHR5cGVvZiBhRnVuYyAhPT0gJ2Z1bmN0aW9uJykgewoJICAgIHJldHVybiBudWxsOwoJICB9CgoJICB2YXIgbmFtZSA9ICcnOwoJICBpZiAodHlwZW9mIEZ1bmN0aW9uLnByb3RvdHlwZS5uYW1lID09PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgYUZ1bmMubmFtZSA9PT0gJ3VuZGVmaW5lZCcpIHsKCSAgICAvLyBIZXJlIHdlIHJ1biBhIHBvbHlmaWxsIGlmIEZ1bmN0aW9uIGRvZXMgbm90IHN1cHBvcnQgdGhlIGBuYW1lYCBwcm9wZXJ0eSBhbmQgaWYgYUZ1bmMubmFtZSBpcyBub3QgZGVmaW5lZAoJICAgIHZhciBtYXRjaCA9IHRvU3RyaW5nLmNhbGwoYUZ1bmMpLm1hdGNoKGZ1bmN0aW9uTmFtZU1hdGNoKTsKCSAgICBpZiAobWF0Y2gpIHsKCSAgICAgIG5hbWUgPSBtYXRjaFsxXTsKCSAgICB9CgkgIH0gZWxzZSB7CgkgICAgLy8gSWYgd2UndmUgZ290IGEgYG5hbWVgIHByb3BlcnR5IHdlIGp1c3QgdXNlIGl0CgkgICAgbmFtZSA9IGFGdW5jLm5hbWU7CgkgIH0KCgkgIHJldHVybiBuYW1lOwoJfQoKCXZhciBnZXRGdW5jTmFtZV8xID0gZ2V0RnVuY05hbWU7CgoJdmFyIHRvU3RyaW5nVGFnID0gdHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnID8gU3ltYm9sLnRvU3RyaW5nVGFnIDogZmFsc2U7CgoJdmFyIGdldEFycmF5TmFtZSA9IGZ1bmN0aW9uIGdldEFycmF5TmFtZShhcnJheSkgewoJICAvLyBXZSBuZWVkIHRvIHNwZWNpYWwgY2FzZSBOb2RlLmpzJyBCdWZmZXJzLCB3aGljaCByZXBvcnQgdG8gYmUgVWludDhBcnJheQoJICBpZiAodHlwZW9mIEJ1ZmZlciA9PT0gJ2Z1bmN0aW9uJyAmJiBhcnJheSBpbnN0YW5jZW9mIEJ1ZmZlcikgewoJICAgIHJldHVybiAnQnVmZmVyJzsKCSAgfQoKCSAgaWYgKHRvU3RyaW5nVGFnICYmIHRvU3RyaW5nVGFnIGluIGFycmF5KSB7CgkgICAgcmV0dXJuIGFycmF5W3RvU3RyaW5nVGFnXTsKCSAgfQoKCSAgcmV0dXJuIGdldEZ1bmNOYW1lXzEoYXJyYXkuY29uc3RydWN0b3IpOwoJfTsKCglmdW5jdGlvbiBpbnNwZWN0VHlwZWRBcnJheShhcnJheSwgb3B0aW9ucykgewoJICB2YXIgbmFtZSA9IGdldEFycmF5TmFtZShhcnJheSk7CgkgIG9wdGlvbnMudHJ1bmNhdGUgLT0gbmFtZS5sZW5ndGggKyA0OyAvLyBPYmplY3Qua2V5cyB3aWxsIGFsd2F5cyBvdXRwdXQgdGhlIEFycmF5IGluZGljZXMgZmlyc3QsIHNvIHdlIGNhbiBzbGljZSBieQoJICAvLyBgYXJyYXkubGVuZ3RoYCB0byBnZXQgbm9uLWluZGV4IHByb3BlcnRpZXMKCgkgIHZhciBub25JbmRleFByb3BlcnRpZXMgPSBPYmplY3Qua2V5cyhhcnJheSkuc2xpY2UoYXJyYXkubGVuZ3RoKTsKCSAgaWYgKCFhcnJheS5sZW5ndGggJiYgIW5vbkluZGV4UHJvcGVydGllcy5sZW5ndGgpIHJldHVybiAiIi5jb25jYXQobmFtZSwgIltdIik7IC8vIEFzIHdlIGtub3cgVHlwZWRBcnJheXMgb25seSBjb250YWluIFVuc2lnbmVkIEludGVnZXJzLCB3ZSBjYW4gc2tpcCBpbnNwZWN0aW5nIGVhY2ggb25lIGFuZCBzaW1wbHkKCSAgLy8gc3R5bGlzZSB0aGUgdG9TdHJpbmcoKSB2YWx1ZSBvZiB0aGVtCgoJICB2YXIgb3V0cHV0ID0gJyc7CgoJICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7CgkgICAgdmFyIHN0cmluZyA9ICIiLmNvbmNhdChvcHRpb25zLnN0eWxpemUodHJ1bmNhdGUoYXJyYXlbaV0sIG9wdGlvbnMudHJ1bmNhdGUpLCAnbnVtYmVyJykpLmNvbmNhdChhcnJheVtpXSA9PT0gYXJyYXkubGVuZ3RoID8gJycgOiAnLCAnKTsKCSAgICBvcHRpb25zLnRydW5jYXRlIC09IHN0cmluZy5sZW5ndGg7CgoJICAgIGlmIChhcnJheVtpXSAhPT0gYXJyYXkubGVuZ3RoICYmIG9wdGlvbnMudHJ1bmNhdGUgPD0gMykgewoJICAgICAgb3V0cHV0ICs9ICIiLmNvbmNhdCh0cnVuY2F0b3IsICIoIikuY29uY2F0KGFycmF5Lmxlbmd0aCAtIGFycmF5W2ldICsgMSwgIikiKTsKCSAgICAgIGJyZWFrOwoJICAgIH0KCgkgICAgb3V0cHV0ICs9IHN0cmluZzsKCSAgfQoKCSAgdmFyIHByb3BlcnR5Q29udGVudHMgPSAnJzsKCgkgIGlmIChub25JbmRleFByb3BlcnRpZXMubGVuZ3RoKSB7CgkgICAgcHJvcGVydHlDb250ZW50cyA9IGluc3BlY3RMaXN0KG5vbkluZGV4UHJvcGVydGllcy5tYXAoZnVuY3Rpb24gKGtleSkgewoJICAgICAgcmV0dXJuIFtrZXksIGFycmF5W2tleV1dOwoJICAgIH0pLCBvcHRpb25zLCBpbnNwZWN0UHJvcGVydHkpOwoJICB9CgoJICByZXR1cm4gIiIuY29uY2F0KG5hbWUsICJbICIpLmNvbmNhdChvdXRwdXQpLmNvbmNhdChwcm9wZXJ0eUNvbnRlbnRzID8gIiwgIi5jb25jYXQocHJvcGVydHlDb250ZW50cykgOiAnJywgIiBdIik7Cgl9CgoJZnVuY3Rpb24gaW5zcGVjdERhdGUoZGF0ZU9iamVjdCwgb3B0aW9ucykgewoJICAvLyBJZiB3ZSBuZWVkIHRvIC0gdHJ1bmNhdGUgdGhlIHRpbWUgcG9ydGlvbiwgYnV0IG5ldmVyIHRoZSBkYXRlCgkgIHZhciBzcGxpdCA9IGRhdGVPYmplY3QudG9KU09OKCkuc3BsaXQoJ1QnKTsKCSAgdmFyIGRhdGUgPSBzcGxpdFswXTsKCSAgcmV0dXJuIG9wdGlvbnMuc3R5bGl6ZSgiIi5jb25jYXQoZGF0ZSwgIlQiKS5jb25jYXQodHJ1bmNhdGUoc3BsaXRbMV0sIG9wdGlvbnMudHJ1bmNhdGUgLSBkYXRlLmxlbmd0aCAtIDEpKSwgJ2RhdGUnKTsKCX0KCgl2YXIgdG9TdHJpbmckMSA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7CgoJdmFyIGdldEZ1bmN0aW9uTmFtZSA9IGZ1bmN0aW9uKGZuKSB7CgkgIGlmICh0b1N0cmluZyQxLmNhbGwoZm4pICE9PSAnW29iamVjdCBGdW5jdGlvbl0nKSByZXR1cm4gbnVsbAoJICBpZiAoZm4ubmFtZSkgcmV0dXJuIGZuLm5hbWUKCSAgdmFyIG5hbWUgPSAvXlxzKmZ1bmN0aW9uXHMqKFteXChdKikvaW0uZXhlYyhmbi50b1N0cmluZygpKVsxXTsKCSAgcmV0dXJuIG5hbWUgfHwgJ2Fub255bW91cycKCX07CgoJZnVuY3Rpb24gaW5zcGVjdEZ1bmN0aW9uKGZ1bmMsIG9wdGlvbnMpIHsKCSAgdmFyIG5hbWUgPSBnZXRGdW5jdGlvbk5hbWUoZnVuYyk7CgoJICBpZiAobmFtZSA9PT0gJ2Fub255bW91cycpIHsKCSAgICByZXR1cm4gb3B0aW9ucy5zdHlsaXplKCdbRnVuY3Rpb25dJywgJ3NwZWNpYWwnKTsKCSAgfQoKCSAgcmV0dXJuIG9wdGlvbnMuc3R5bGl6ZSgiW0Z1bmN0aW9uICIuY29uY2F0KHRydW5jYXRlKG5hbWUsIG9wdGlvbnMudHJ1bmNhdGUgLSAxMSksICJdIiksICdzcGVjaWFsJyk7Cgl9CgoJZnVuY3Rpb24gaW5zcGVjdE1hcEVudHJ5KF9yZWYsIG9wdGlvbnMpIHsKCSAgdmFyIF9yZWYyID0gX3NsaWNlZFRvQXJyYXkoX3JlZiwgMiksCgkgICAgICBrZXkgPSBfcmVmMlswXSwKCSAgICAgIHZhbHVlID0gX3JlZjJbMV07CgoJICBvcHRpb25zLnRydW5jYXRlIC09IDQ7CgkgIGtleSA9IG9wdGlvbnMuaW5zcGVjdChrZXksIG9wdGlvbnMpOwoJICBvcHRpb25zLnRydW5jYXRlIC09IGtleS5sZW5ndGg7CgkgIHZhbHVlID0gb3B0aW9ucy5pbnNwZWN0KHZhbHVlLCBvcHRpb25zKTsKCSAgcmV0dXJuICIiLmNvbmNhdChrZXksICIgPT4gIikuY29uY2F0KHZhbHVlKTsKCX0gLy8gSUUxMSBkb2Vzbid0IHN1cHBvcnQgYG1hcC5lbnRyaWVzKClgCgoKCWZ1bmN0aW9uIG1hcFRvRW50cmllcyhtYXApIHsKCSAgdmFyIGVudHJpZXMgPSBbXTsKCSAgbWFwLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHsKCSAgICBlbnRyaWVzLnB1c2goW2tleSwgdmFsdWVdKTsKCSAgfSk7CgkgIHJldHVybiBlbnRyaWVzOwoJfQoKCWZ1bmN0aW9uIGluc3BlY3RNYXAobWFwLCBvcHRpb25zKSB7CgkgIHZhciBzaXplID0gbWFwLnNpemUgLSAxOwoKCSAgaWYgKHNpemUgPD0gMCkgewoJICAgIHJldHVybiAnTWFwe30nOwoJICB9CgoJICBvcHRpb25zLnRydW5jYXRlIC09IDc7CgkgIHJldHVybiAiTWFweyAiLmNvbmNhdChpbnNwZWN0TGlzdChtYXBUb0VudHJpZXMobWFwKSwgb3B0aW9ucywgaW5zcGVjdE1hcEVudHJ5KSwgIiB9Iik7Cgl9CgoJdmFyIGlzTmFOID0gTnVtYmVyLmlzTmFOIHx8IGZ1bmN0aW9uIChpKSB7CgkgIHJldHVybiBpICE9PSBpOwoJfTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1zZWxmLWNvbXBhcmUKCgoJZnVuY3Rpb24gaW5zcGVjdEJpZ0ludChudW1iZXIsIG9wdGlvbnMpIHsgcmV0dXJuIG51bWJlci50b1N0cmluZygpICsgJ24nOyB9OwoKCWZ1bmN0aW9uIGluc3BlY3ROdW1iZXIobnVtYmVyLCBvcHRpb25zKSB7CgkgIGlmIChpc05hTihudW1iZXIpKSB7CgkgICAgcmV0dXJuIG9wdGlvbnMuc3R5bGl6ZSgnTmFOJywgJ251bWJlcicpOwoJICB9CgoJICBpZiAobnVtYmVyID09PSBJbmZpbml0eSkgewoJICAgIHJldHVybiBvcHRpb25zLnN0eWxpemUoJ0luZmluaXR5JywgJ251bWJlcicpOwoJICB9CgoJICBpZiAobnVtYmVyID09PSAtSW5maW5pdHkpIHsKCSAgICByZXR1cm4gb3B0aW9ucy5zdHlsaXplKCctSW5maW5pdHknLCAnbnVtYmVyJyk7CgkgIH0KCgkgIGlmIChudW1iZXIgPT09IDApIHsKCSAgICByZXR1cm4gb3B0aW9ucy5zdHlsaXplKDEgLyBudW1iZXIgPT09IEluZmluaXR5ID8gJyswJyA6ICctMCcsICdudW1iZXInKTsKCSAgfQoKCSAgcmV0dXJuIG9wdGlvbnMuc3R5bGl6ZSh0cnVuY2F0ZShudW1iZXIsIG9wdGlvbnMudHJ1bmNhdGUpLCAnbnVtYmVyJyk7Cgl9CgoJZnVuY3Rpb24gaW5zcGVjdFJlZ0V4cCh2YWx1ZSwgb3B0aW9ucykgewoJICB2YXIgZmxhZ3MgPSB2YWx1ZS50b1N0cmluZygpLnNwbGl0KCcvJylbMl07CgkgIHZhciBzb3VyY2VMZW5ndGggPSBvcHRpb25zLnRydW5jYXRlIC0gKDIgKyBmbGFncy5sZW5ndGgpOwoJICB2YXIgc291cmNlID0gdmFsdWUuc291cmNlOwoJICByZXR1cm4gb3B0aW9ucy5zdHlsaXplKCIvIi5jb25jYXQodHJ1bmNhdGUoc291cmNlLCBzb3VyY2VMZW5ndGgpLCAiLyIpLmNvbmNhdChmbGFncyksICdyZWdleHAnKTsKCX0KCglmdW5jdGlvbiBhcnJheUZyb21TZXQoc2V0KSB7CgkgIHZhciB2YWx1ZXMgPSBbXTsKCSAgc2V0LmZvckVhY2goZnVuY3Rpb24gKHZhbHVlKSB7CgkgICAgdmFsdWVzLnB1c2godmFsdWUpOwoJICB9KTsKCSAgcmV0dXJuIHZhbHVlczsKCX0KCglmdW5jdGlvbiBpbnNwZWN0U2V0KHNldCwgb3B0aW9ucykgewoJICBpZiAoc2V0LnNpemUgPT09IDApIHJldHVybiAnU2V0e30nOwoJICBvcHRpb25zLnRydW5jYXRlIC09IDc7CgkgIHJldHVybiAiU2V0eyAiLmNvbmNhdChpbnNwZWN0TGlzdChhcnJheUZyb21TZXQoc2V0KSwgb3B0aW9ucyksICIgfSIpOwoJfQoKCXZhciBzdHJpbmdFc2NhcGVDaGFycyA9IG5ldyBSZWdFeHAoIlsnXFx1MDAwMC1cXHUwMDFmXFx1MDA3Zi1cXHUwMDlmXFx1MDBhZFxcdTA2MDAtXFx1MDYwNFxcdTA3MGZcXHUxN2I0XFx1MTdiNSIgKyAiXFx1MjAwYy1cXHUyMDBmXFx1MjAyOC1cXHUyMDJmXFx1MjA2MC1cXHUyMDZmXFx1ZmVmZlxcdWZmZjAtXFx1ZmZmZl0iLCAnZycpOwoJdmFyIGVzY2FwZUNoYXJhY3RlcnMgPSB7CgkgICdcYic6ICdcXGInLAoJICAnXHQnOiAnXFx0JywKCSAgJ1xuJzogJ1xcbicsCgkgICdcZic6ICdcXGYnLAoJICAnXHInOiAnXFxyJywKCSAgIiciOiAiXFwnIiwKCSAgJ1xcJzogJ1xcXFwnCgl9OwoJdmFyIGhleCA9IDE2OwoJdmFyIHVuaWNvZGVMZW5ndGggPSA0OwoKCWZ1bmN0aW9uIGVzY2FwZShjaGFyKSB7CgkgIHJldHVybiBlc2NhcGVDaGFyYWN0ZXJzW2NoYXJdIHx8ICJcXHUiLmNvbmNhdCgiMDAwMCIuY29uY2F0KGNoYXIuY2hhckNvZGVBdCgwKS50b1N0cmluZyhoZXgpKS5zbGljZSgtdW5pY29kZUxlbmd0aCkpOwoJfQoKCWZ1bmN0aW9uIGluc3BlY3RTdHJpbmcoc3RyaW5nLCBvcHRpb25zKSB7CgkgIGlmIChzdHJpbmdFc2NhcGVDaGFycy50ZXN0KHN0cmluZykpIHsKCSAgICBzdHJpbmcgPSBzdHJpbmcucmVwbGFjZShzdHJpbmdFc2NhcGVDaGFycywgZXNjYXBlKTsKCSAgfQoKCSAgcmV0dXJuIG9wdGlvbnMuc3R5bGl6ZSgiJyIuY29uY2F0KHRydW5jYXRlKHN0cmluZywgb3B0aW9ucy50cnVuY2F0ZSAtIDIpLCAiJyIpLCAnc3RyaW5nJyk7Cgl9CgoJZnVuY3Rpb24gaW5zcGVjdFN5bWJvbCh2YWx1ZSkgewoJICBpZiAoJ2Rlc2NyaXB0aW9uJyBpbiBTeW1ib2wucHJvdG90eXBlKSB7CgkgICAgcmV0dXJuICJTeW1ib2woIi5jb25jYXQodmFsdWUuZGVzY3JpcHRpb24sICIpIik7CgkgIH0KCgkgIHJldHVybiB2YWx1ZS50b1N0cmluZygpOwoJfQoKCXZhciBnZXRQcm9taXNlVmFsdWUgPSBmdW5jdGlvbiBnZXRQcm9taXNlVmFsdWUoKSB7CgkgIHJldHVybiAnUHJvbWlzZXvigKZ9JzsKCX07CgoJdHJ5IHsKCSAgdmFyIF9wcm9jZXNzJGJpbmRpbmcgPSBwcm9jZXNzLmJpbmRpbmcoJ3V0aWwnKSwKCSAgICAgIGdldFByb21pc2VEZXRhaWxzID0gX3Byb2Nlc3MkYmluZGluZy5nZXRQcm9taXNlRGV0YWlscywKCSAgICAgIGtQZW5kaW5nID0gX3Byb2Nlc3MkYmluZGluZy5rUGVuZGluZywKCSAgICAgIGtSZWplY3RlZCA9IF9wcm9jZXNzJGJpbmRpbmcua1JlamVjdGVkOwoKCSAgZ2V0UHJvbWlzZVZhbHVlID0gZnVuY3Rpb24gZ2V0UHJvbWlzZVZhbHVlKHZhbHVlLCBvcHRpb25zKSB7CgkgICAgdmFyIF9nZXRQcm9taXNlRGV0YWlscyA9IGdldFByb21pc2VEZXRhaWxzKHZhbHVlKSwKCSAgICAgICAgX2dldFByb21pc2VEZXRhaWxzMiA9IF9zbGljZWRUb0FycmF5KF9nZXRQcm9taXNlRGV0YWlscywgMiksCgkgICAgICAgIHN0YXRlID0gX2dldFByb21pc2VEZXRhaWxzMlswXSwKCSAgICAgICAgaW5uZXJWYWx1ZSA9IF9nZXRQcm9taXNlRGV0YWlsczJbMV07CgoJICAgIGlmIChzdGF0ZSA9PT0ga1BlbmRpbmcpIHsKCSAgICAgIHJldHVybiAnUHJvbWlzZXs8cGVuZGluZz59JzsKCSAgICB9CgoJICAgIHJldHVybiAiUHJvbWlzZSIuY29uY2F0KHN0YXRlID09PSBrUmVqZWN0ZWQgPyAnIScgOiAnJywgInsiKS5jb25jYXQob3B0aW9ucy5pbnNwZWN0KGlubmVyVmFsdWUsIG9wdGlvbnMpLCAifSIpOwoJICB9OwoJfSBjYXRjaCAobm90Tm9kZSkgewoJICAvKiBpZ25vcmUgKi8KCX0KCgl2YXIgaW5zcGVjdFByb21pc2UgPSBnZXRQcm9taXNlVmFsdWU7CgoJZnVuY3Rpb24gaW5zcGVjdE9iamVjdChvYmplY3QsIG9wdGlvbnMpIHsKCSAgdmFyIHByb3BlcnRpZXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhvYmplY3QpOwoJICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCkgOiBbXTsKCgkgIGlmIChwcm9wZXJ0aWVzLmxlbmd0aCA9PT0gMCAmJiBzeW1ib2xzLmxlbmd0aCA9PT0gMCkgewoJICAgIHJldHVybiAne30nOwoJICB9CgoJICBvcHRpb25zLnRydW5jYXRlIC09IDQ7CgkgIHZhciBwcm9wZXJ0eUNvbnRlbnRzID0gaW5zcGVjdExpc3QocHJvcGVydGllcy5tYXAoZnVuY3Rpb24gKGtleSkgewoJICAgIHJldHVybiBba2V5LCBvYmplY3Rba2V5XV07CgkgIH0pLCBvcHRpb25zLCBpbnNwZWN0UHJvcGVydHkpOwoJICB2YXIgc3ltYm9sQ29udGVudHMgPSBpbnNwZWN0TGlzdChzeW1ib2xzLm1hcChmdW5jdGlvbiAoa2V5KSB7CgkgICAgcmV0dXJuIFtrZXksIG9iamVjdFtrZXldXTsKCSAgfSksIG9wdGlvbnMsIGluc3BlY3RQcm9wZXJ0eSk7CgkgIHZhciBzZXAgPSAnJzsKCgkgIGlmIChwcm9wZXJ0eUNvbnRlbnRzICYmIHN5bWJvbENvbnRlbnRzKSB7CgkgICAgc2VwID0gJywgJzsKCSAgfQoKCSAgcmV0dXJuICJ7ICIuY29uY2F0KHByb3BlcnR5Q29udGVudHMpLmNvbmNhdChzZXApLmNvbmNhdChzeW1ib2xDb250ZW50cywgIiB9Iik7Cgl9CgoJdmFyIHRvU3RyaW5nVGFnJDEgPSB0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcgPyBTeW1ib2wudG9TdHJpbmdUYWcgOiBmYWxzZTsKCWZ1bmN0aW9uIGluc3BlY3RDbGFzcyh2YWx1ZSwgb3B0aW9ucykgewoJICB2YXIgbmFtZSA9ICcnOwoKCSAgaWYgKHRvU3RyaW5nVGFnJDEgJiYgdG9TdHJpbmdUYWckMSBpbiB2YWx1ZSkgewoJICAgIG5hbWUgPSB2YWx1ZVt0b1N0cmluZ1RhZyQxXTsKCSAgfQoKCSAgbmFtZSA9IG5hbWUgfHwgZ2V0RnVuY05hbWVfMSh2YWx1ZS5jb25zdHJ1Y3Rvcik7IC8vIEJhYmVsIHRyYW5zZm9ybXMgYW5vbnltb3VzIGNsYXNzZXMgdG8gdGhlIG5hbWUgYF9jbGFzc2AKCgkgIGlmICghbmFtZSB8fCBuYW1lID09PSAnX2NsYXNzJykgewoJICAgIG5hbWUgPSAnPEFub255bW91cyBDbGFzcz4nOwoJICB9CgoJICBvcHRpb25zLnRydW5jYXRlIC09IG5hbWUubGVuZ3RoOwoJICByZXR1cm4gIiIuY29uY2F0KG5hbWUpLmNvbmNhdChpbnNwZWN0T2JqZWN0KHZhbHVlLCBvcHRpb25zKSk7Cgl9CgoJZnVuY3Rpb24gaW5zcGVjdEFyZ3VtZW50cyhhcmdzLCBvcHRpb25zKSB7CgkgIGlmIChhcmdzLmxlbmd0aCA9PT0gMCkgcmV0dXJuICdBcmd1bWVudHNbXSc7CgkgIG9wdGlvbnMudHJ1bmNhdGUgLT0gMTM7CgkgIHJldHVybiAiQXJndW1lbnRzWyAiLmNvbmNhdChpbnNwZWN0TGlzdChhcmdzLCBvcHRpb25zKSwgIiBdIik7Cgl9CgoJdmFyIGVycm9yS2V5cyA9IFsnc3RhY2snLCAnbGluZScsICdjb2x1bW4nLCAnbmFtZScsICdtZXNzYWdlJywgJ2ZpbGVOYW1lJywgJ2xpbmVOdW1iZXInLCAnY29sdW1uTnVtYmVyJywgJ251bWJlcicsICdkZXNjcmlwdGlvbiddOwoJZnVuY3Rpb24gaW5zcGVjdE9iamVjdCQxKGVycm9yLCBvcHRpb25zKSB7CgkgIHZhciBwcm9wZXJ0aWVzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoZXJyb3IpLmZpbHRlcihmdW5jdGlvbiAoa2V5KSB7CgkgICAgcmV0dXJuIGVycm9yS2V5cy5pbmRleE9mKGtleSkgPT09IC0xOwoJICB9KTsKCSAgdmFyIG5hbWUgPSBlcnJvci5uYW1lOwoJICBvcHRpb25zLnRydW5jYXRlIC09IG5hbWUubGVuZ3RoOwoJICB2YXIgbWVzc2FnZSA9ICcnOwoKCSAgaWYgKHR5cGVvZiBlcnJvci5tZXNzYWdlID09PSAnc3RyaW5nJykgewoJICAgIG1lc3NhZ2UgPSB0cnVuY2F0ZShlcnJvci5tZXNzYWdlLCBvcHRpb25zLnRydW5jYXRlKTsKCSAgfSBlbHNlIHsKCSAgICBwcm9wZXJ0aWVzLnVuc2hpZnQoJ21lc3NhZ2UnKTsKCSAgfQoKCSAgbWVzc2FnZSA9IG1lc3NhZ2UgPyAiOiAiLmNvbmNhdChtZXNzYWdlKSA6ICcnOwoJICBvcHRpb25zLnRydW5jYXRlIC09IG1lc3NhZ2UubGVuZ3RoICsgNTsKCSAgdmFyIHByb3BlcnR5Q29udGVudHMgPSBpbnNwZWN0TGlzdChwcm9wZXJ0aWVzLm1hcChmdW5jdGlvbiAoa2V5KSB7CgkgICAgcmV0dXJuIFtrZXksIGVycm9yW2tleV1dOwoJICB9KSwgb3B0aW9ucywgaW5zcGVjdFByb3BlcnR5KTsKCSAgcmV0dXJuICIiLmNvbmNhdChuYW1lKS5jb25jYXQobWVzc2FnZSkuY29uY2F0KHByb3BlcnR5Q29udGVudHMgPyAiIHsgIi5jb25jYXQocHJvcGVydHlDb250ZW50cywgIiB9IikgOiAnJyk7Cgl9CgoJZnVuY3Rpb24gaW5zcGVjdEF0dHJpYnV0ZShfcmVmLCBvcHRpb25zKSB7CgkgIHZhciBfcmVmMiA9IF9zbGljZWRUb0FycmF5KF9yZWYsIDIpLAoJICAgICAga2V5ID0gX3JlZjJbMF0sCgkgICAgICB2YWx1ZSA9IF9yZWYyWzFdOwoKCSAgb3B0aW9ucy50cnVuY2F0ZSAtPSAzOwoKCSAgaWYgKCF2YWx1ZSkgewoJICAgIHJldHVybiAiIi5jb25jYXQob3B0aW9ucy5zdHlsaXplKGtleSwgJ3llbGxvdycpKTsKCSAgfQoKCSAgcmV0dXJuICIiLmNvbmNhdChvcHRpb25zLnN0eWxpemUoa2V5LCAneWVsbG93JyksICI9IikuY29uY2F0KG9wdGlvbnMuc3R5bGl6ZSgiXCIiLmNvbmNhdCh2YWx1ZSwgIlwiIiksICdzdHJpbmcnKSk7Cgl9CglmdW5jdGlvbiBpbnNwZWN0SFRNTENvbGxlY3Rpb24oY29sbGVjdGlvbiwgb3B0aW9ucykgewoJICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdXNlLWJlZm9yZS1kZWZpbmUKCSAgcmV0dXJuIGluc3BlY3RMaXN0KGNvbGxlY3Rpb24sIG9wdGlvbnMsIGluc3BlY3RIVE1MLCAnXG4nKTsKCX0KCWZ1bmN0aW9uIGluc3BlY3RIVE1MKGVsZW1lbnQsIG9wdGlvbnMpIHsKCSAgdmFyIHByb3BlcnRpZXMgPSBlbGVtZW50LmdldEF0dHJpYnV0ZU5hbWVzKCk7CgkgIHZhciBuYW1lID0gZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7CgkgIHZhciBoZWFkID0gb3B0aW9ucy5zdHlsaXplKCI8Ii5jb25jYXQobmFtZSksICdzcGVjaWFsJyk7CgkgIHZhciBoZWFkQ2xvc2UgPSBvcHRpb25zLnN0eWxpemUoIj4iLCAnc3BlY2lhbCcpOwoJICB2YXIgdGFpbCA9IG9wdGlvbnMuc3R5bGl6ZSgiPC8iLmNvbmNhdChuYW1lLCAiPiIpLCAnc3BlY2lhbCcpOwoJICBvcHRpb25zLnRydW5jYXRlIC09IG5hbWUubGVuZ3RoICogMiArIDU7CgkgIHZhciBwcm9wZXJ0eUNvbnRlbnRzID0gJyc7CgoJICBpZiAocHJvcGVydGllcy5sZW5ndGggPiAwKSB7CgkgICAgcHJvcGVydHlDb250ZW50cyArPSAnICc7CgkgICAgcHJvcGVydHlDb250ZW50cyArPSBpbnNwZWN0TGlzdChwcm9wZXJ0aWVzLm1hcChmdW5jdGlvbiAoa2V5KSB7CgkgICAgICByZXR1cm4gW2tleSwgZWxlbWVudC5nZXRBdHRyaWJ1dGUoa2V5KV07CgkgICAgfSksIG9wdGlvbnMsIGluc3BlY3RBdHRyaWJ1dGUsICcgJyk7CgkgIH0KCgkgIG9wdGlvbnMudHJ1bmNhdGUgLT0gcHJvcGVydHlDb250ZW50cy5sZW5ndGg7CgkgIHZhciB0cnVuY2F0ZSA9IG9wdGlvbnMudHJ1bmNhdGU7CgkgIHZhciBjaGlsZHJlbiA9IGluc3BlY3RIVE1MQ29sbGVjdGlvbihlbGVtZW50LmNoaWxkcmVuLCBvcHRpb25zKTsKCgkgIGlmIChjaGlsZHJlbiAmJiBjaGlsZHJlbi5sZW5ndGggPiB0cnVuY2F0ZSkgewoJICAgIGNoaWxkcmVuID0gIiIuY29uY2F0KHRydW5jYXRvciwgIigiKS5jb25jYXQoZWxlbWVudC5jaGlsZHJlbi5sZW5ndGgsICIpIik7CgkgIH0KCgkgIHJldHVybiAiIi5jb25jYXQoaGVhZCkuY29uY2F0KHByb3BlcnR5Q29udGVudHMpLmNvbmNhdChoZWFkQ2xvc2UpLmNvbmNhdChjaGlsZHJlbikuY29uY2F0KHRhaWwpOwoJfQoKCS8qICEKCSAqIGxvdXBlCgkgKiBDb3B5cmlnaHQoYykgMjAxMyBKYWtlIEx1ZXIgPGpha2VAYWxvZ2ljYWxwYXJhZG94LmNvbT4KCSAqIE1JVCBMaWNlbnNlZAoJICovCgl2YXIgc3ltYm9sc1N1cHBvcnRlZCA9IHR5cGVvZiBTeW1ib2wgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIFN5bWJvbC5mb3IgPT09ICdmdW5jdGlvbic7Cgl2YXIgY2hhaUluc3BlY3QgPSBzeW1ib2xzU3VwcG9ydGVkID8gU3ltYm9sLmZvcignY2hhaS9pbnNwZWN0JykgOiAnQEBjaGFpL2luc3BlY3QnOwoJdmFyIG5vZGVJbnNwZWN0ID0gZmFsc2U7CgoJdHJ5IHsKCSAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGdsb2JhbC1yZXF1aXJlCgkgIG5vZGVJbnNwZWN0ID0gcmVxdWlyZSgndXRpbCcpLmluc3BlY3QuY3VzdG9tOwoJfSBjYXRjaCAobm9Ob2RlSW5zcGVjdCkgewoJICBub2RlSW5zcGVjdCA9IGZhbHNlOwoJfQoKCXZhciBjb25zdHJ1Y3Rvck1hcCA9IG5ldyBXZWFrTWFwKCk7Cgl2YXIgc3RyaW5nVGFnTWFwID0ge307Cgl2YXIgYmFzZVR5cGVzTWFwID0gewoJICB1bmRlZmluZWQ6IGZ1bmN0aW9uIHVuZGVmaW5lZCQxKHZhbHVlLCBvcHRpb25zKSB7CgkgICAgcmV0dXJuIG9wdGlvbnMuc3R5bGl6ZSgndW5kZWZpbmVkJywgJ3VuZGVmaW5lZCcpOwoJICB9LAoJICBudWxsOiBmdW5jdGlvbiBfbnVsbCh2YWx1ZSwgb3B0aW9ucykgewoJICAgIHJldHVybiBvcHRpb25zLnN0eWxpemUobnVsbCwgJ251bGwnKTsKCSAgfSwKCSAgYm9vbGVhbjogZnVuY3Rpb24gYm9vbGVhbih2YWx1ZSwgb3B0aW9ucykgewoJICAgIHJldHVybiBvcHRpb25zLnN0eWxpemUodmFsdWUsICdib29sZWFuJyk7CgkgIH0sCgkgIEJvb2xlYW46IGZ1bmN0aW9uIEJvb2xlYW4odmFsdWUsIG9wdGlvbnMpIHsKCSAgICByZXR1cm4gb3B0aW9ucy5zdHlsaXplKHZhbHVlLCAnYm9vbGVhbicpOwoJICB9LAoJICBudW1iZXI6IGluc3BlY3ROdW1iZXIsCgkgIE51bWJlcjogaW5zcGVjdE51bWJlciwKCSAgQmlnSW50OiBpbnNwZWN0QmlnSW50LAoJICBiaWdpbnQ6IGluc3BlY3RCaWdJbnQsCgkgIHN0cmluZzogaW5zcGVjdFN0cmluZywKCSAgU3RyaW5nOiBpbnNwZWN0U3RyaW5nLAoJICBmdW5jdGlvbjogaW5zcGVjdEZ1bmN0aW9uLAoJICBGdW5jdGlvbjogaW5zcGVjdEZ1bmN0aW9uLAoJICBzeW1ib2w6IGluc3BlY3RTeW1ib2wsCgkgIC8vIEEgU3ltYm9sIHBvbHlmaWxsIHdpbGwgcmV0dXJuIGBTeW1ib2xgIG5vdCBgc3ltYm9sYCBmcm9tIHR5cGVkZXRlY3QKCSAgU3ltYm9sOiBpbnNwZWN0U3ltYm9sLAoJICBBcnJheTogaW5zcGVjdEFycmF5LAoJICBEYXRlOiBpbnNwZWN0RGF0ZSwKCSAgTWFwOiBpbnNwZWN0TWFwLAoJICBTZXQ6IGluc3BlY3RTZXQsCgkgIFJlZ0V4cDogaW5zcGVjdFJlZ0V4cCwKCSAgUHJvbWlzZTogaW5zcGVjdFByb21pc2UsCgkgIC8vIFdlYWtTZXQsIFdlYWtNYXAgYXJlIHRvdGFsbHkgb3BhcXVlIHRvIHVzCgkgIFdlYWtTZXQ6IGZ1bmN0aW9uIFdlYWtTZXQodmFsdWUsIG9wdGlvbnMpIHsKCSAgICByZXR1cm4gb3B0aW9ucy5zdHlsaXplKCdXZWFrU2V0e+KApn0nLCAnc3BlY2lhbCcpOwoJICB9LAoJICBXZWFrTWFwOiBmdW5jdGlvbiBXZWFrTWFwKHZhbHVlLCBvcHRpb25zKSB7CgkgICAgcmV0dXJuIG9wdGlvbnMuc3R5bGl6ZSgnV2Vha01hcHvigKZ9JywgJ3NwZWNpYWwnKTsKCSAgfSwKCSAgQXJndW1lbnRzOiBpbnNwZWN0QXJndW1lbnRzLAoJICBJbnQ4QXJyYXk6IGluc3BlY3RUeXBlZEFycmF5LAoJICBVaW50OEFycmF5OiBpbnNwZWN0VHlwZWRBcnJheSwKCSAgVWludDhDbGFtcGVkQXJyYXk6IGluc3BlY3RUeXBlZEFycmF5LAoJICBJbnQxNkFycmF5OiBpbnNwZWN0VHlwZWRBcnJheSwKCSAgVWludDE2QXJyYXk6IGluc3BlY3RUeXBlZEFycmF5LAoJICBJbnQzMkFycmF5OiBpbnNwZWN0VHlwZWRBcnJheSwKCSAgVWludDMyQXJyYXk6IGluc3BlY3RUeXBlZEFycmF5LAoJICBGbG9hdDMyQXJyYXk6IGluc3BlY3RUeXBlZEFycmF5LAoJICBGbG9hdDY0QXJyYXk6IGluc3BlY3RUeXBlZEFycmF5LAoJICBHZW5lcmF0b3I6IGZ1bmN0aW9uIEdlbmVyYXRvcigpIHsKCSAgICByZXR1cm4gJyc7CgkgIH0sCgkgIERhdGFWaWV3OiBmdW5jdGlvbiBEYXRhVmlldygpIHsKCSAgICByZXR1cm4gJyc7CgkgIH0sCgkgIEFycmF5QnVmZmVyOiBmdW5jdGlvbiBBcnJheUJ1ZmZlcigpIHsKCSAgICByZXR1cm4gJyc7CgkgIH0sCgkgIEVycm9yOiBpbnNwZWN0T2JqZWN0JDEsCgkgIEhUTUxDb2xsZWN0aW9uOiBpbnNwZWN0SFRNTENvbGxlY3Rpb24sCgkgIE5vZGVMaXN0OiBpbnNwZWN0SFRNTENvbGxlY3Rpb24KCX07IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb21wbGV4aXR5CgoJdmFyIGluc3BlY3RDdXN0b20gPSBmdW5jdGlvbiBpbnNwZWN0Q3VzdG9tKHZhbHVlLCBvcHRpb25zLCB0eXBlKSB7CgkgIGlmIChjaGFpSW5zcGVjdCBpbiB2YWx1ZSAmJiB0eXBlb2YgdmFsdWVbY2hhaUluc3BlY3RdID09PSAnZnVuY3Rpb24nKSB7CgkgICAgcmV0dXJuIHZhbHVlW2NoYWlJbnNwZWN0XShvcHRpb25zKTsKCSAgfQoKCSAgaWYgKG5vZGVJbnNwZWN0ICYmIG5vZGVJbnNwZWN0IGluIHZhbHVlICYmIHR5cGVvZiB2YWx1ZVtub2RlSW5zcGVjdF0gPT09ICdmdW5jdGlvbicpIHsKCSAgICByZXR1cm4gdmFsdWVbbm9kZUluc3BlY3RdKG9wdGlvbnMuZGVwdGgsIG9wdGlvbnMpOwoJICB9CgoJICBpZiAoJ2luc3BlY3QnIGluIHZhbHVlICYmIHR5cGVvZiB2YWx1ZS5pbnNwZWN0ID09PSAnZnVuY3Rpb24nKSB7CgkgICAgcmV0dXJuIHZhbHVlLmluc3BlY3Qob3B0aW9ucy5kZXB0aCwgb3B0aW9ucyk7CgkgIH0KCgkgIGlmICgnY29uc3RydWN0b3InIGluIHZhbHVlICYmIGNvbnN0cnVjdG9yTWFwLmhhcyh2YWx1ZS5jb25zdHJ1Y3RvcikpIHsKCSAgICByZXR1cm4gY29uc3RydWN0b3JNYXAuZ2V0KHZhbHVlLmNvbnN0cnVjdG9yKSh2YWx1ZSwgb3B0aW9ucyk7CgkgIH0KCgkgIGlmIChzdHJpbmdUYWdNYXBbdHlwZV0pIHsKCSAgICByZXR1cm4gc3RyaW5nVGFnTWFwW3R5cGVdKHZhbHVlLCBvcHRpb25zKTsKCSAgfQoKCSAgcmV0dXJuICcnOwoJfTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbXBsZXhpdHkKCgoJZnVuY3Rpb24gaW5zcGVjdCh2YWx1ZSwgb3B0aW9ucykgewoJICBvcHRpb25zID0gbm9ybWFsaXNlT3B0aW9ucyhvcHRpb25zKTsKCSAgb3B0aW9ucy5pbnNwZWN0ID0gaW5zcGVjdDsKCSAgdmFyIF9vcHRpb25zID0gb3B0aW9ucywKCSAgICAgIGN1c3RvbUluc3BlY3QgPSBfb3B0aW9ucy5jdXN0b21JbnNwZWN0OwoJICB2YXIgdHlwZSA9IHR5cGVEZXRlY3QodmFsdWUpOyAvLyBJZiBpdCBpcyBhIGJhc2UgdmFsdWUgdGhhdCB3ZSBhbHJlYWR5IHN1cHBvcnQsIHRoZW4gdXNlIExvdXBlJ3MgaW5zcGVjdG9yCgoJICBpZiAoYmFzZVR5cGVzTWFwW3R5cGVdKSB7CgkgICAgcmV0dXJuIGJhc2VUeXBlc01hcFt0eXBlXSh2YWx1ZSwgb3B0aW9ucyk7CgkgIH0KCgkgIHZhciBwcm90byA9IHZhbHVlID8gT2JqZWN0LmdldFByb3RvdHlwZU9mKHZhbHVlKSA6IGZhbHNlOyAvLyBJZiBpdCdzIGEgcGxhaW4gT2JqZWN0IHRoZW4gdXNlIExvdXBlJ3MgaW5zcGVjdG9yCgoJICBpZiAocHJvdG8gPT09IE9iamVjdC5wcm90b3R5cGUgfHwgcHJvdG8gPT09IG51bGwpIHsKCSAgICByZXR1cm4gaW5zcGVjdE9iamVjdCh2YWx1ZSwgb3B0aW9ucyk7CgkgIH0gLy8gU3BlY2lmaWNhbGx5IGFjY291bnQgZm9yIEhUTUxFbGVtZW50cwoJICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW5kZWYKCgoJICBpZiAodmFsdWUgJiYgdHlwZW9mIEhUTUxFbGVtZW50ID09PSAnZnVuY3Rpb24nICYmIHZhbHVlIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHsKCSAgICByZXR1cm4gaW5zcGVjdEhUTUwodmFsdWUsIG9wdGlvbnMpOwoJICB9IC8vIElmIGBvcHRpb25zLmN1c3RvbUluc3BlY3RgIGlzIHNldCB0byB0cnVlIHRoZW4gdHJ5IHRvIHVzZSB0aGUgY3VzdG9tIGluc3BlY3RvcgoKCgkgIGlmIChjdXN0b21JbnNwZWN0ICYmIHZhbHVlKSB7CgkgICAgdmFyIG91dHB1dCA9IGluc3BlY3RDdXN0b20odmFsdWUsIG9wdGlvbnMsIHR5cGUpOwoJICAgIGlmIChvdXRwdXQpIHJldHVybiBvdXRwdXQ7CgkgIH0gLy8gSWYgaXQgaXMgYSBjbGFzcywgaW5zcGVjdCBpdCBsaWtlIGFuIG9iamVjdCBidXQgYWRkIHRoZSBjb25zdHJ1Y3RvciBuYW1lCgoKCSAgaWYgKCdjb25zdHJ1Y3RvcicgaW4gdmFsdWUgJiYgdmFsdWUuY29uc3RydWN0b3IgIT09IE9iamVjdCkgewoJICAgIHJldHVybiBpbnNwZWN0Q2xhc3ModmFsdWUsIG9wdGlvbnMpOwoJICB9IC8vIFdlIGhhdmUgcnVuIG91dCBvZiBvcHRpb25zISBKdXN0IHN0cmluZ2lmeSB0aGUgdmFsdWUKCgoJICByZXR1cm4gb3B0aW9ucy5zdHlsaXplKFN0cmluZyh2YWx1ZSksIHR5cGUpOwoJfQoJZnVuY3Rpb24gcmVnaXN0ZXJDb25zdHJ1Y3Rvcihjb25zdHJ1Y3RvciwgaW5zcGVjdG9yKSB7CgkgIGlmIChjb25zdHJ1Y3Rvck1hcC5oYXMoY29uc3RydWN0b3IpKSB7CgkgICAgcmV0dXJuIGZhbHNlOwoJICB9CgoJICBjb25zdHJ1Y3Rvck1hcC5hZGQoY29uc3RydWN0b3IsIGluc3BlY3Rvcik7CgkgIHJldHVybiB0cnVlOwoJfQoJZnVuY3Rpb24gcmVnaXN0ZXJTdHJpbmdUYWcoc3RyaW5nVGFnLCBpbnNwZWN0b3IpIHsKCSAgaWYgKHN0cmluZ1RhZyBpbiBzdHJpbmdUYWdNYXApIHsKCSAgICByZXR1cm4gZmFsc2U7CgkgIH0KCgkgIHN0cmluZ1RhZ01hcFtzdHJpbmdUYWddID0gaW5zcGVjdG9yOwoJICByZXR1cm4gdHJ1ZTsKCX0KCXZhciBjdXN0b20gPSBjaGFpSW5zcGVjdDsKCglleHBvcnRzLmN1c3RvbSA9IGN1c3RvbTsKCWV4cG9ydHMuZGVmYXVsdCA9IGluc3BlY3Q7CglleHBvcnRzLmluc3BlY3QgPSBpbnNwZWN0OwoJZXhwb3J0cy5yZWdpc3RlckNvbnN0cnVjdG9yID0gcmVnaXN0ZXJDb25zdHJ1Y3RvcjsKCWV4cG9ydHMucmVnaXN0ZXJTdHJpbmdUYWcgPSByZWdpc3RlclN0cmluZ1RhZzsKCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pOwoKfSkpKTsKCn0pLmNhbGwodGhpcyl9KS5jYWxsKHRoaXMscmVxdWlyZSgnX3Byb2Nlc3MnKSx0eXBlb2YgZ2xvYmFsICE9PSAidW5kZWZpbmVkIiA/IGdsb2JhbCA6IHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIiA/IHdpbmRvdyA6IHt9LHJlcXVpcmUoImJ1ZmZlciIpLkJ1ZmZlcikKfSx7Il9wcm9jZXNzIjozOCwiYnVmZmVyIjoxOSwidXRpbCI6NDF9XSwxMDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CihmdW5jdGlvbigpIHsKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAndXNlIHN0cmljdCc7CiAgdmFyIGRlYnVnLCBkZWZhdWx0cywgZnJlZXplLCBpc2EsIGxvZywgcmVmLCB0eXBlcywgdmFsaWRhdGUsIHZhbGlkYXRlX29wdGlvbmFsLCDCtSwKICAgIGJvdW5kTWV0aG9kQ2hlY2sgPSBmdW5jdGlvbihpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IEVycm9yKCdCb3VuZCBpbnN0YW5jZSBtZXRob2QgYWNjZXNzZWQgYmVmb3JlIGJpbmRpbmcnKTsgfSB9OwoKICDCtSA9IHJlcXVpcmUoJy4vbWFpbicpOwoKICBsb2cgPSBjb25zb2xlLmxvZzsKCiAgZGVidWcgPSBjb25zb2xlLmRlYnVnOwoKICBmcmVlemUgPSBPYmplY3QuZnJlZXplOwoKICAoe3R5cGVzLCBpc2EsIHZhbGlkYXRlLCB2YWxpZGF0ZV9vcHRpb25hbH0gPSByZXF1aXJlKCcuL3R5cGVzJykpOwoKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgZGVmYXVsdHMgPSB7CiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgbGF0Y2g6IHsKICAgICAgZHQ6IDM1MCAvLyB0aW1lIGluIG1pbGxpc2Vjb25kcyBiZXR3ZWVuIGZpcnN0IGFuZCBsYXN0IGtleSBldmVudCB0byB0cmlnZ2VyIGxhdGNoaW5nCiAgICB9LAogICAgCiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAga2JsaWtlX2V2ZW50bmFtZXM6IFsKICAgICAgLy8gIyMjIFRBSU5UIG5vdCBhbGwgb2YgdGhlc2UgZXZlbnRzIGFyZSBuZWVkZWQKICAgICAgJ2NsaWNrJywKICAgICAgLy8gJ2RibGNsaWNrJywgIyBpbXBsaWVkIC8gcHJlY2VkZWQgYnkgYGNsaWNrYCBldmVudAogICAgICAvLyAnZHJhZycsICdkcmFnZW5kJywgJ2RyYWdlbnRlcicsICdkcmFnbGVhdmUnLCAnZHJhZ292ZXInLCAnZHJhZ3N0YXJ0JywKICAgICAgLy8gJ21vdXNlZG93bicsICdtb3VzZWVudGVyJywgJ21vdXNlbGVhdmUnLCAnbW91c2Vtb3ZlJywgJ21vdXNlb3V0JywgJ21vdXNlb3ZlcicsICdtb3VzZXVwJywKICAgICAgLy8gJ3BvaW50ZXJjYW5jZWwnLAogICAgICAnd2hlZWwnLAogICAgICAncG9pbnRlcm1vdmUnLAogICAgICAncG9pbnRlcm91dCcsCiAgICAgICdwb2ludGVyb3ZlcicKICAgIF0sCiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gJ3BvaW50ZXJkb3duJywKICAgIC8vICdwb2ludGVyZW50ZXInLAogICAgLy8gJ3BvaW50ZXJsZWF2ZScsCiAgICAvLyAncG9pbnRlcnVwJywKICAgIC8vIC0tLS0tLS0tLS0tLS0gVGllciBBOiB1YmlxdWl0b3VzLCB1bmVxdWl2b2NhbAogICAgbW9kaWZpZXJfbmFtZXM6IFsnQWx0JywgJ0FsdEdyYXBoJywgJ0NvbnRyb2wnLCAnTWV0YScsICdTaGlmdCcsICdDYXBzTG9jayddCiAgfTsKCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgLy8gLS0tLS0tLS0tLS0tLSBUaWVyIEI6IHN0YXR1cyBkb3VidGZ1bAogIC8vICdIeXBlcicsCiAgLy8gJ09TJywKICAvLyAnU3VwZXInLAogIC8vICdTeW1ib2wnLAogIC8vIC0tLS0tLS0tLS0tLS0gVGllciBDOiByYXJlLCBub3QgbmVlZGVkLCBvciBub3Qgc2Vuc2VkIGJ5IEpTCiAgLy8gJ0ZuJywKICAvLyAnRm5Mb2NrJywKICAvLyAnTnVtTG9jaycsCiAgLy8gJ1Njcm9sbExvY2snLAogIC8vICdTeW1ib2xMb2NrJywKICB0aGlzLl9LYiA9IChmdW5jdGlvbigpIHsKICAgIGNsYXNzIF9LYiB7CiAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIGNvbnN0cnVjdG9yKGNmZykgewogICAgICAgIHZhciBpLCBsZW4sIG1vZGlmaWVyX25hbWUsIHJlZjsKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIC8qIEdldCB0aGUgbGFzdCBrbm93biBrZXlib2FyZCBtb2RpZmllciBzdGF0ZS4gTk9URSBtYXkgYmUgZXh0ZW5kZWQgd2l0aCBgZXZlbnRgIGFyZ3VtZW50IElURi4gKi8KICAgICAgICAvLyDCtS5ET00uZ2V0X2tiX21vZGlmaWVyX3N0YXRlID0gKCkgPT4gcmV0dXJuIHsgLi4ucHJ2LCB9CgogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgdGhpcy5nZXRfY2hhbmdlZF9rYl9tb2RpZmllcl9zdGF0ZSA9IHRoaXMuZ2V0X2NoYW5nZWRfa2JfbW9kaWZpZXJfc3RhdGUuYmluZCh0aGlzKTsKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgLy8gZ2V0X2tiX21vZGlmaWVyX3N0YXRlID0gKCBldmVudCwgdmFsdWUgKSA9PgogICAgICAgIC8vICAgQF9wcnZfbW9kaWZpZXJzID0ge30KICAgICAgICAvLyAgIGZvciAoIG1vZGlmaWVyX25hbWUgb2YgQGNmZy5tb2RpZmllcl9uYW1lcyApIHsKICAgICAgICAvLyAgICAgQF9wcnZfbW9kaWZpZXJzWyBtb2RpZmllcl9uYW1lIF0gPSBudWxsCiAgICAgICAgLy8gICBmcmVlemUoIEBfcHJ2X21vZGlmaWVycyApCgogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgdGhpcy5fc2V0X2NhcHNsb2NrX3N0YXRlID0gdGhpcy5fc2V0X2NhcHNsb2NrX3N0YXRlLmJpbmQodGhpcyk7CiAgICAgICAgdGhpcy5jZmcgPSB7Li4uZGVmYXVsdHMsIC4uLmNmZ307CiAgICAgICAgcmVmID0gdGhpcy5jZmcubW9kaWZpZXJfbmFtZXM7CiAgICAgICAgZm9yIChpID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICBtb2RpZmllcl9uYW1lID0gcmVmW2ldOwogICAgICAgICAgdGhpcy5fcHJ2X21vZGlmaWVyc1ttb2RpZmllcl9uYW1lXSA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGZyZWV6ZSh0aGlzLl9wcnZfbW9kaWZpZXJzKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgZ2V0X2NoYW5nZWRfa2JfbW9kaWZpZXJfc3RhdGUoKSB7CiAgICAgICAgdmFyIGFueV9oYXNfY2hhbmdlZCwgY2hhbmdlZF9tb2RpZmllcnMsIGNydF9tb2RpZmllcnMsIGksIGxlbiwgbW9kaWZpZXJfbmFtZSwgcmVmLCBzdGF0ZSwgdGhpc19oYXNfY2hhbmdlZDsKICAgICAgICAvKiBSZXR1cm4ga2V5Ym9hcmQgbW9kaWZpZXIgc3RhdGUgaWYgaXQgaGFzIGNoYW5nZWQgc2luY2UgdGhlIGxhc3QgY2FsbCwgb3IgYG51bGxgIGlmIGl0IGhhc24ndCBjaGFuZ2VkLiAqLwogICAgICAgIC8vIGxvZyggJ14zMzk4OF4nLCB7IGV2ZW50LCB9ICkKICAgICAgICBjcnRfbW9kaWZpZXJzID0gewogICAgICAgICAgX3R5cGU6IGV2ZW50LnR5cGUKICAgICAgICB9OwogICAgICAgIGNoYW5nZWRfbW9kaWZpZXJzID0gewogICAgICAgICAgX3R5cGU6IGV2ZW50LnR5cGUKICAgICAgICB9OwogICAgICAgIGFueV9oYXNfY2hhbmdlZCA9IGZhbHNlOwogICAgICAgIHJlZiA9IHRoaXMuY2ZnLm1vZGlmaWVyX25hbWVzOwogICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IHJlZi5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgbW9kaWZpZXJfbmFtZSA9IHJlZltpXTsKICAgICAgICAgIHN0YXRlID0gZXZlbnQuZ2V0TW9kaWZpZXJTdGF0ZShtb2RpZmllcl9uYW1lKTsKICAgICAgICAgIHRoaXNfaGFzX2NoYW5nZWQgPSB0aGlzLl9wcnZfbW9kaWZpZXJzW21vZGlmaWVyX25hbWVdICE9PSBzdGF0ZTsKICAgICAgICAgIGFueV9oYXNfY2hhbmdlZCA9IGFueV9oYXNfY2hhbmdlZCB8fCB0aGlzX2hhc19jaGFuZ2VkOwogICAgICAgICAgY3J0X21vZGlmaWVyc1ttb2RpZmllcl9uYW1lXSA9IHN0YXRlOwogICAgICAgICAgaWYgKHRoaXNfaGFzX2NoYW5nZWQpIHsKICAgICAgICAgICAgY2hhbmdlZF9tb2RpZmllcnNbbW9kaWZpZXJfbmFtZV0gPSBzdGF0ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGFueV9oYXNfY2hhbmdlZCkgewogICAgICAgICAgdGhpcy5fcHJ2X21vZGlmaWVycyA9IGZyZWV6ZShjcnRfbW9kaWZpZXJzKTsKICAgICAgICAgIHJldHVybiBjaGFuZ2VkX21vZGlmaWVyczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIF9zZXRfY2Fwc2xvY2tfc3RhdGUoY2Fwc2xvY2tfYWN0aXZlKSB7CiAgICAgICAgaWYgKGNhcHNsb2NrX2FjdGl2ZSA9PT0gdGhpcy5fY2Fwc2xvY2tfYWN0aXZlKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgdGhpcy5fY2Fwc2xvY2tfYWN0aXZlID0gY2Fwc2xvY2tfYWN0aXZlOwogICAgICAgIMK1LkRPTS5lbWl0X2N1c3RvbV9ldmVudCgnwrVfa2JfY2Fwc2xvY2tfY2hhbmdlZCcsIHsKICAgICAgICAgIGRldGFpbDogewogICAgICAgICAgICBDYXBzTG9jazogY2Fwc2xvY2tfYWN0aXZlCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICB9OwoKICAgIF9LYi5wcm90b3R5cGUuX3Bydl9tb2RpZmllcnMgPSB7fTsKCiAgICBfS2IucHJvdG90eXBlLl9jYXBzbG9ja19hY3RpdmUgPSBmYWxzZTsKCiAgICByZXR1cm4gX0tiOwoKICB9KS5jYWxsKHRoaXMpOwoKICAvLyAjLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgLy8gb25fcHVzaDogKCBrZXluYW1lcywgaGFuZGxlciApID0+CiAgLy8ga2V5bmFtZXMgID0gWyBrZXluYW1lcywgXSB1bmxlc3MgaXNhLmxpc3Qga2V5bmFtZXMKICAvLyB0eXBlcyAgICAgPSBbIHR5cGVzLCAgICBdIHVubGVzcyBpc2EubGlzdCB0eXBlcwogIC8vIHZhbGlkYXRlLmtiX2tleW5hbWVzICBrZXluYW1lcwogIC8vIHZhbGlkYXRlLmtiX3R5cGVzICAgICB0eXBlcwoKICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogIC8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogIC8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICByZWYgPSB0aGlzLktiID0gKGZ1bmN0aW9uKCkgewogICAgY2xhc3MgS2IgZXh0ZW5kcyB0aGlzLl9LYiB7CiAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7CiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICB0aGlzLl9oYW5kbGVyX2Zyb21fd2F0Y2hlciA9IHRoaXMuX2hhbmRsZXJfZnJvbV93YXRjaGVyLmJpbmQodGhpcyk7CiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICB0aGlzLl9saXN0ZW5fdG9fa2V5ID0gdGhpcy5fbGlzdGVuX3RvX2tleS5iaW5kKHRoaXMpOwogICAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAgICAgLy8gTUJNQ0QKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIHRoaXMuX2xpc3Rlbl90b19tb2RpZmllcnMgPSB0aGlzLl9saXN0ZW5fdG9fbW9kaWZpZXJzLmJpbmQodGhpcyk7CiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICB0aGlzLl9lbWl0X21ibWNkX2tleV9ldmVudHMgPSB0aGlzLl9lbWl0X21ibWNkX2tleV9ldmVudHMuYmluZCh0aGlzKTsKICAgICAgfQoKICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgX2dldF9sYXRjaGluZ19rZXluYW1lKCkgewogICAgICAgIHZhciBSLCByZWYxLCByZWYxMCwgcmVmMTEsIHJlZjEyLCByZWYyLCByZWYzLCByZWY0LCByZWY1LCByZWY2LCByZWY3LCByZWY4LCByZWY5OwogICAgICAgIGlmICghKChEYXRlLm5vdygpIC0gKChyZWYxID0gKHJlZjIgPSB0aGlzLl9zaHJlZ1swXSkgIT0gbnVsbCA/IHJlZjIudCA6IHZvaWQgMCkgIT0gbnVsbCA/IHJlZjEgOiAwKSkgPCB0aGlzLmNmZy5sYXRjaC5kdCkpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAoKChyZWYzID0gdGhpcy5fc2hyZWdbMF0pICE9IG51bGwgPyByZWYzLmRpciA6IHZvaWQgMCkgIT09ICdkb3duJykgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIGlmICgoKHJlZjQgPSB0aGlzLl9zaHJlZ1sxXSkgIT0gbnVsbCA/IHJlZjQuZGlyIDogdm9pZCAwKSAhPT0gJ3VwJykgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIGlmICgoKHJlZjUgPSB0aGlzLl9zaHJlZ1syXSkgIT0gbnVsbCA/IHJlZjUuZGlyIDogdm9pZCAwKSAhPT0gJ2Rvd24nKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKCgocmVmNiA9IHRoaXMuX3NocmVnWzNdKSAhPSBudWxsID8gcmVmNi5kaXIgOiB2b2lkIDApICE9PSAndXAnKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKCgoKChyZWY5ID0gdGhpcy5fc2hyZWdbMF0pICE9IG51bGwgPyByZWY5Lm5hbWUgOiB2b2lkIDApICE9PSAocmVmOCA9IChyZWYxMCA9IHRoaXMuX3NocmVnWzFdKSAhPSBudWxsID8gcmVmMTAubmFtZSA6IHZvaWQgMCkgfHwgcmVmOCAhPT0gKHJlZjcgPSAocmVmMTEgPSB0aGlzLl9zaHJlZ1syXSkgIT0gbnVsbCA/IHJlZjExLm5hbWUgOiB2b2lkIDApKSB8fCByZWY3ICE9PSAoKHJlZjEyID0gdGhpcy5fc2hyZWdbM10pICE9IG51bGwgPyByZWYxMi5uYW1lIDogdm9pZCAwKSkpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBSID0gdGhpcy5fc2hyZWdbM10ubmFtZTsKICAgICAgICByZXR1cm4gUjsKICAgICAgfQoKICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgX2luaXRpYWxpemVfbGF0Y2hpbmcoKSB7CiAgICAgICAgdmFyIHB1c2g7CiAgICAgICAgaWYgKHRoaXMuX2xhdGNoaW5nX2luaXRpYWxpemVkKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgdGhpcy5fbGF0Y2hpbmdfaW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgICAgIHB1c2ggPSAoZGlyLCBldmVudCkgPT4gewogICAgICAgICAgdmFyIG5hbWU7CiAgICAgICAgICBuYW1lID0gZXZlbnQua2V5OwogICAgICAgICAgdGhpcy5fc2hyZWcucHVzaCh7CiAgICAgICAgICAgIGRpciwKICAgICAgICAgICAgbmFtZSwKICAgICAgICAgICAgdDogRGF0ZS5ub3coKQogICAgICAgICAgfSk7CiAgICAgICAgICB3aGlsZSAodGhpcy5fc2hyZWcubGVuZ3RoID4gNCkgewogICAgICAgICAgICB0aGlzLl9zaHJlZy5zaGlmdCgpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfTsKICAgICAgICDCtS5ET00ub24oZG9jdW1lbnQsICdrZXlkb3duJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICByZXR1cm4gcHVzaCgnZG93bicsIGV2ZW50KTsKICAgICAgICB9KTsKICAgICAgICDCtS5ET00ub24oZG9jdW1lbnQsICdrZXl1cCcsIChldmVudCkgPT4gewogICAgICAgICAgcmV0dXJuIHB1c2goJ3VwJywgZXZlbnQpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgX2xpc3Rlbl90b19rZXlfcHVzaChrZXluYW1lLCBoYW5kbGVyKSB7CiAgICAgICAgdmFyIGJlaGF2aW9yLCBzdGF0ZTsKICAgICAgICBzdGF0ZSA9IGZhbHNlOwogICAgICAgIGJlaGF2aW9yID0gJ3B1c2gnOwogICAgICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgICAgIMK1LkRPTS5vbihkb2N1bWVudCwgJ2tleWRvd24nLCAoZXZlbnQpID0+IHsKICAgICAgICAgIGlmIChldmVudC5rZXkgIT09IGtleW5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZSA9IHRydWU7CiAgICAgICAgICBoYW5kbGVyKGZyZWV6ZSh7a2V5bmFtZSwgYmVoYXZpb3IsIHN0YXRlLCBldmVudH0pKTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0pOwogICAgICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgICAgIMK1LkRPTS5vbihkb2N1bWVudCwgJ2tleXVwJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICBpZiAoZXZlbnQua2V5ICE9PSBrZXluYW1lKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgc3RhdGUgPSBmYWxzZTsKICAgICAgICAgIGhhbmRsZXIoZnJlZXplKHtrZXluYW1lLCBiZWhhdmlvciwgc3RhdGUsIGV2ZW50fSkpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSk7CiAgICAgICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIF9saXN0ZW5fdG9fa2V5X3RvZ2dsZShrZXluYW1lLCBoYW5kbGVyKSB7CiAgICAgICAgdmFyIGJlaGF2aW9yLCBza2lwX25leHQsIHN0YXRlOwogICAgICAgIHN0YXRlID0gZmFsc2U7CiAgICAgICAgYmVoYXZpb3IgPSAndG9nZ2xlJzsKICAgICAgICBza2lwX25leHQgPSBmYWxzZTsKICAgICAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgICAgICDCtS5ET00ub24oZG9jdW1lbnQsICdrZXlkb3duJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICBpZiAoZXZlbnQua2V5ICE9PSBrZXluYW1lKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YXRlKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgc3RhdGUgPSB0cnVlOwogICAgICAgICAgc2tpcF9uZXh0ID0gdHJ1ZTsKICAgICAgICAgIC8vIGRlYnVnICdeX2xpc3Rlbl90b19rZXlAMjIzXicsICdrZXlkb3duJywgeyBrZXluYW1lLCBiZWhhdmlvciwgZW50cnksIH0KICAgICAgICAgIGhhbmRsZXIoZnJlZXplKHtrZXluYW1lLCBiZWhhdmlvciwgc3RhdGUsIGV2ZW50fSkpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSk7CiAgICAgICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICAgICAgwrUuRE9NLm9uKGRvY3VtZW50LCAna2V5dXAnLCAoZXZlbnQpID0+IHsKICAgICAgICAgIGlmIChldmVudC5rZXkgIT09IGtleW5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIXN0YXRlKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHNraXBfbmV4dCkgewogICAgICAgICAgICBza2lwX25leHQgPSBmYWxzZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0YXRlID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBkZWJ1ZyAnXl9saXN0ZW5fdG9fa2V5QDIyM14nLCAndG9nZ2xlL2tleXVwJywgeyBrZXluYW1lLCBiZWhhdmlvciwgZW50cnksIH0KICAgICAgICAgIGhhbmRsZXIoZnJlZXplKHtrZXluYW1lLCBiZWhhdmlvciwgc3RhdGUsIGV2ZW50fSkpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSk7CiAgICAgICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIF9saXN0ZW5fdG9fa2V5X2xhdGNoKGtleW5hbWUsIGhhbmRsZXIpIHsKICAgICAgICB2YXIgYmVoYXZpb3IsIHN0YXRlOwogICAgICAgIHRoaXMuX2luaXRpYWxpemVfbGF0Y2hpbmcoKTsKICAgICAgICBzdGF0ZSA9IGZhbHNlOwogICAgICAgIGJlaGF2aW9yID0gJ2xhdGNoJzsKICAgICAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgICAgICDCtS5ET00ub24oZG9jdW1lbnQsICdrZXl1cCcsIChldmVudCkgPT4gewogICAgICAgICAgaWYgKGtleW5hbWUgPT09IHRoaXMuX2dldF9sYXRjaGluZ19rZXluYW1lKCkpIHsKICAgICAgICAgICAgc3RhdGUgPSAhc3RhdGU7CiAgICAgICAgICAgIGhhbmRsZXIoZnJlZXplKHtrZXluYW1lLCBiZWhhdmlvciwgc3RhdGUsIGV2ZW50fSkpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSk7CiAgICAgICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIF9saXN0ZW5fdG9fa2V5X3RsYXRjaChrZXluYW1lLCBoYW5kbGVyKSB7CiAgICAgICAgdmFyIGJlaGF2aW9yLCBpc19sYXRjaGVkLCBzdGF0ZTsKICAgICAgICBzdGF0ZSA9IGZhbHNlOwogICAgICAgIGJlaGF2aW9yID0gJ3RsYXRjaCc7CiAgICAgICAgaXNfbGF0Y2hlZCA9IGZhbHNlOwogICAgICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgICAgIHRoaXMuX2xpc3Rlbl90b19rZXkoa2V5bmFtZSwgJ2xhdGNoJywgKGQpID0+IHsKICAgICAgICAgIHJldHVybiBpc19sYXRjaGVkID0gZC5zdGF0ZTsKICAgICAgICB9KTsKICAgICAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgICAgICDCtS5ET00ub24oZG9jdW1lbnQsICdrZXlkb3duJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICBpZiAoZXZlbnQua2V5ICE9PSBrZXluYW1lKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgc3RhdGUgPSAhaXNfbGF0Y2hlZDsKICAgICAgICAgIGhhbmRsZXIoZnJlZXplKHtrZXluYW1lLCBiZWhhdmlvciwgc3RhdGUsIGV2ZW50fSkpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSk7CiAgICAgICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICAgICAgwrUuRE9NLm9uKGRvY3VtZW50LCAna2V5dXAnLCAoZXZlbnQpID0+IHsKICAgICAgICAgIGlmIChldmVudC5rZXkgIT09IGtleW5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZSA9IGlzX2xhdGNoZWQ7CiAgICAgICAgICBoYW5kbGVyKGZyZWV6ZSh7a2V5bmFtZSwgYmVoYXZpb3IsIHN0YXRlLCBldmVudH0pKTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0pOwogICAgICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICBfbGlzdGVuX3RvX2tleV9wdGxhdGNoKGtleW5hbWUsIGhhbmRsZXIpIHsKICAgICAgICB2YXIgYmVoYXZpb3IsIGlzX2xhdGNoZWQsIHN0YXRlOwogICAgICAgIHN0YXRlID0gZmFsc2U7CiAgICAgICAgYmVoYXZpb3IgPSAncHRsYXRjaCc7CiAgICAgICAgaXNfbGF0Y2hlZCA9IGZhbHNlOwogICAgICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgICAgIHRoaXMuX2xpc3Rlbl90b19rZXkoa2V5bmFtZSwgJ2xhdGNoJywgKGQpID0+IHsKICAgICAgICAgIHJldHVybiBpc19sYXRjaGVkID0gZC5zdGF0ZTsKICAgICAgICB9KTsKICAgICAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgICAgICDCtS5ET00ub24oZG9jdW1lbnQsICdrZXlkb3duJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICBpZiAoZXZlbnQua2V5ICE9PSBrZXluYW1lKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGlzX2xhdGNoZWQpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZSA9IHRydWU7CiAgICAgICAgICBoYW5kbGVyKGZyZWV6ZSh7a2V5bmFtZSwgYmVoYXZpb3IsIHN0YXRlLCBldmVudH0pKTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0pOwogICAgICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgICAgIMK1LkRPTS5vbihkb2N1bWVudCwgJ2tleXVwJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICBpZiAoZXZlbnQua2V5ICE9PSBrZXluYW1lKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGlzX2xhdGNoZWQpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZSA9IGZhbHNlOwogICAgICAgICAgaGFuZGxlcihmcmVlemUoe2tleW5hbWUsIGJlaGF2aW9yLCBzdGF0ZSwgZXZlbnR9KSk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9KTsKICAgICAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgX2xpc3Rlbl90b19rZXlfbnRsYXRjaChrZXluYW1lLCBoYW5kbGVyKSB7CiAgICAgICAgdmFyIGJlaGF2aW9yLCBpc19sYXRjaGVkLCBzdGF0ZTsKICAgICAgICBzdGF0ZSA9IGZhbHNlOwogICAgICAgIGJlaGF2aW9yID0gJ250bGF0Y2gnOwogICAgICAgIGlzX2xhdGNoZWQgPSBmYWxzZTsKICAgICAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgICAgICB0aGlzLl9saXN0ZW5fdG9fa2V5KGtleW5hbWUsICdsYXRjaCcsIChkKSA9PiB7CiAgICAgICAgICByZXR1cm4gaXNfbGF0Y2hlZCA9IGQuc3RhdGU7CiAgICAgICAgfSk7CiAgICAgICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICAgICAgwrUuRE9NLm9uKGRvY3VtZW50LCAna2V5ZG93bicsIChldmVudCkgPT4gewogICAgICAgICAgaWYgKGV2ZW50LmtleSAhPT0ga2V5bmFtZSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICghaXNfbGF0Y2hlZCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIHN0YXRlID0gZmFsc2U7CiAgICAgICAgICBoYW5kbGVyKGZyZWV6ZSh7a2V5bmFtZSwgYmVoYXZpb3IsIHN0YXRlLCBldmVudH0pKTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0pOwogICAgICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgICAgIMK1LkRPTS5vbihkb2N1bWVudCwgJ2tleXVwJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICBpZiAoZXZlbnQua2V5ICE9PSBrZXluYW1lKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFpc19sYXRjaGVkKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgc3RhdGUgPSB0cnVlOwogICAgICAgICAgaGFuZGxlcihmcmVlemUoe2tleW5hbWUsIGJlaGF2aW9yLCBzdGF0ZSwgZXZlbnR9KSk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9KTsKICAgICAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgX2hhbmRsZXJfZnJvbV93YXRjaGVyKHdhdGNoZXIpIHsKICAgICAgICBib3VuZE1ldGhvZENoZWNrKHRoaXMsIHJlZik7CiAgICAgICAgLyogVEFJTlQgY291bGQgdXNlIHNpbmdsZSBmdW5jdGlvbiBmb3IgYWxsIGhhbmRsZXJzIHRoYXQgZW1pdCB0aGUgc2FtZSBldmVudCAqLwogICAgICAgIHZhbGlkYXRlLmtiX3dhdGNoZXIod2F0Y2hlcik7CiAgICAgICAgaWYgKGlzYS5mdW5jdGlvbih3YXRjaGVyKSkgewogICAgICAgICAgcmV0dXJuIHdhdGNoZXI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmdW5jdGlvbihkKSB7CiAgICAgICAgICByZXR1cm4gwrUuRE9NLmVtaXRfY3VzdG9tX2V2ZW50KHdhdGNoZXIsIHsKICAgICAgICAgICAgZGV0YWlsOiBkCiAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICB9CgogICAgICBfbGlzdGVuX3RvX2tleShrZXluYW1lLCBiZWhhdmlvciwgd2F0Y2hlcikgewogICAgICAgIHZhciBoYW5kbGVyOwogICAgICAgIGJvdW5kTWV0aG9kQ2hlY2sodGhpcywgcmVmKTsKICAgICAgICBpZiAoa2V5bmFtZSA9PT0gJ1NwYWNlJykgewogICAgICAgICAga2V5bmFtZSA9ICcgJzsKICAgICAgICB9CiAgICAgICAgdmFsaWRhdGUua2Jfa2V5bmFtZShrZXluYW1lKTsKICAgICAgICB2YWxpZGF0ZS5rYl9rZXl0eXBlKGJlaGF2aW9yKTsKICAgICAgICBoYW5kbGVyID0gdGhpcy5faGFuZGxlcl9mcm9tX3dhdGNoZXIod2F0Y2hlcik7CiAgICAgICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCiAgICAgICAgc3dpdGNoIChiZWhhdmlvcikgewogICAgICAgICAgY2FzZSAncHVzaCc6CiAgICAgICAgICAgIHRoaXMuX2xpc3Rlbl90b19rZXlfcHVzaChrZXluYW1lLCBoYW5kbGVyKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICd0b2dnbGUnOgogICAgICAgICAgICB0aGlzLl9saXN0ZW5fdG9fa2V5X3RvZ2dsZShrZXluYW1lLCBoYW5kbGVyKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdsYXRjaCc6CiAgICAgICAgICAgIHRoaXMuX2xpc3Rlbl90b19rZXlfbGF0Y2goa2V5bmFtZSwgaGFuZGxlcik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAndGxhdGNoJzoKICAgICAgICAgICAgdGhpcy5fbGlzdGVuX3RvX2tleV90bGF0Y2goa2V5bmFtZSwgaGFuZGxlcik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnbnRsYXRjaCc6CiAgICAgICAgICAgIHRoaXMuX2xpc3Rlbl90b19rZXlfbnRsYXRjaChrZXluYW1lLCBoYW5kbGVyKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdwdGxhdGNoJzoKICAgICAgICAgICAgdGhpcy5fbGlzdGVuX3RvX2tleV9wdGxhdGNoKGtleW5hbWUsIGhhbmRsZXIpOwogICAgICAgIH0KICAgICAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgICAgICByZXR1cm4gbnVsbC8qIE5PVEUgbWF5IHJldHVybiBhIGByZW1vdmVfbGlzdGVuZXJgIG1ldGhvZCBJVEYgKi87CiAgICAgIH0KCiAgICAgIF9saXN0ZW5fdG9fbW9kaWZpZXJzKHdhdGNoZXIgPSBudWxsKSB7CiAgICAgICAgdmFyIGV2ZW50bmFtZSwgaGFuZGxlX2tibGlrZV9ldmVudCwgaGFuZGxlciwgaSwgbGVuLCByZWYxOwogICAgICAgIGJvdW5kTWV0aG9kQ2hlY2sodGhpcywgcmVmKTsKICAgICAgICBpZiAod2F0Y2hlciAhPSBudWxsKSB7CiAgICAgICAgICBoYW5kbGVyID0gdGhpcy5faGFuZGxlcl9mcm9tX3dhdGNoZXIod2F0Y2hlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGhhbmRsZXIgPSB0aGlzLl9lbWl0X21ibWNkX2tleV9ldmVudHM7CiAgICAgICAgfQogICAgICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgICAgIGhhbmRsZV9rYmxpa2VfZXZlbnQgPSAoZXZlbnQpID0+IHsKICAgICAgICAgIHZhciBtb2RpZmllcl9zdGF0ZTsKICAgICAgICAgIG1vZGlmaWVyX3N0YXRlID0gdGhpcy5nZXRfY2hhbmdlZF9rYl9tb2RpZmllcl9zdGF0ZShldmVudCk7CiAgICAgICAgICBpZiAobW9kaWZpZXJfc3RhdGUgIT09IG51bGwpIHsKICAgICAgICAgICAgaGFuZGxlcihtb2RpZmllcl9zdGF0ZSk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLl9zZXRfY2Fwc2xvY2tfc3RhdGUoZXZlbnQuZ2V0TW9kaWZpZXJTdGF0ZSgnQ2Fwc0xvY2snKSk7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9OwogICAgICAgIHJlZjEgPSB0aGlzLmNmZy5rYmxpa2VfZXZlbnRuYW1lczsKICAgICAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSByZWYxLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICBldmVudG5hbWUgPSByZWYxW2ldOwogICAgICAgICAgwrUuRE9NLm9uKGRvY3VtZW50LCBldmVudG5hbWUsIGhhbmRsZV9rYmxpa2VfZXZlbnQpOwogICAgICAgIH0KICAgICAgICAvLy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgICAgICDCtS5ET00ub24oZG9jdW1lbnQsICdrZXlkb3duJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICAvLyBoYW5kbGVfa2JsaWtlX2V2ZW50IGV2ZW50ICMjIyAhISEhISEhISEhISEhISEhISEhISEhICMjIwogICAgICAgICAgLyogVEFJTlQgbG9naWMgaXMgcXVlc3Rpb25hYmxlICovCiAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAnQ2Fwc0xvY2snKSB7CiAgICAgICAgICAgIHRoaXMuX3NldF9jYXBzbG9ja19zdGF0ZSghdGhpcy5fY2Fwc2xvY2tfYWN0aXZlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuX3NldF9jYXBzbG9ja19zdGF0ZShldmVudC5nZXRNb2RpZmllclN0YXRlKCdDYXBzTG9jaycpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0pOwogICAgICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgICAgIMK1LkRPTS5vbihkb2N1bWVudCwgJ2tleXVwJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAnQ2Fwc0xvY2snKSB7CiAgICAgICAgICAgIC8vIGhhbmRsZV9rYmxpa2VfZXZlbnQgZXZlbnQgIyMjICEhISEhISEhISEhISEhISEhISEhISEgIyMjCiAgICAgICAgICAgIC8qIFRBSU5UIGxvZ2ljIGlzIHF1ZXN0aW9uYWJsZSAqLwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuX3NldF9jYXBzbG9ja19zdGF0ZShldmVudC5nZXRNb2RpZmllclN0YXRlKCdDYXBzTG9jaycpKTsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICBfZW1pdF9tYm1jZF9rZXlfZXZlbnRzKGQpIHsKICAgICAgICB2YXIgZXZlbnRuYW1lLCBrZXksIHN0YXRlOwogICAgICAgIGJvdW5kTWV0aG9kQ2hlY2sodGhpcywgcmVmKTsKLyogQWNjZXB0cyBhbiBvYmplY3Qgd2l0aCBtb2RpZmllciBuYW1lcyBhcyBrZXlzLCBib29sZWFucyBhcyB2YWx1ZXM7IHdpbGwgZW1pdCBga2V5ZG93bmAsIGBrZXl1cGAKICAgZXZlbnRzIGFzIG5lZWRlZC4gKi8KLyogVEFJTlQgb25seSBpdGVyYXRlIG92ZXIgbW9kaWZpZXIgbmFtZXM/ICovCiAgICAgICAgZm9yIChrZXkgaW4gZCkgewogICAgICAgICAgc3RhdGUgPSBkW2tleV07CiAgICAgICAgICBpZiAoa2V5ID09PSAnX3R5cGUnKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgZXZlbnRuYW1lID0gc3RhdGUgPyAna2V5ZG93bicgOiAna2V5dXAnOwogICAgICAgICAgZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChuZXcgS2V5Ym9hcmRFdmVudChldmVudG5hbWUsIHtrZXl9KSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgfTsKCiAgICAvLyAjLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBfZGVmYXVsdHM6IGZyZWV6ZSB7CiAgICAvLyAgIHN0YXRlOiBmcmVlemUgeyBkb3duOiBmYWxzZSwgdXA6IGZhbHNlLCB0b2dnbGU6IGZhbHNlLCBsYXRjaDogZmFsc2UsIHRsYXRjaDogZmFsc2UsIH0KICAgIC8vICAgfQoKICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBLYi5wcm90b3R5cGUuX3NocmVnID0gW107CgogICAgS2IucHJvdG90eXBlLl9sYXRjaGluZ19pbml0aWFsaXplZCA9IGZhbHNlOwoKICAgIHJldHVybiBLYjsKCiAgfSkuY2FsbCh0aGlzKTsKCn0pLmNhbGwodGhpcyk7CgoKfSx7Ii4vbWFpbiI6Im11ZG9tIiwiLi90eXBlcyI6MTF9XSwxMTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CihmdW5jdGlvbigpIHsKICAndXNlIHN0cmljdCc7CiAgdGhpcy50eXBlcyA9IG5ldyAocmVxdWlyZSgnaW50ZXJ0eXBlJykpLkludGVydHlwZSgpOwoKICBPYmplY3QuYXNzaWduKHRoaXMsIHRoaXMudHlwZXMuZXhwb3J0KCkpOwoKICAvLyAjLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAvLyBAZGVjbGFyZSAna2Jfa2V5dHlwZXMnLCB0ZXN0czoKICAvLyAgICJ4IGlzIGEgbGlzdCBvZiBrYl9rZXl0eXBlIjogICAgICggeCApIC0+IEBpc2EubGlzdF9vZiAna2Jfa2V5dHlwZScsIHgKICAvLyAgICJ4IGlzIG5vdCBlbXB0eSI6ICAgICAgICAgICAgICAgICAgICggeCApIC0+IG5vdCBAaXNhLmVtcHR5IHgKCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIHRoaXMuZGVjbGFyZSgna2Jfa2V5dHlwZScsIHsKICAgIHRlc3RzOiB7CiAgICAgICJ4IGlzIG9uZSBvZiAndG9nZ2xlJywgJ2xhdGNoJywgJ3RsYXRjaCcsICdwdGxhdGNoJywgJ250bGF0Y2gnLCAncHVzaCciOiBmdW5jdGlvbih4KSB7CiAgICAgICAgcmV0dXJuIHggPT09ICd0b2dnbGUnIHx8IHggPT09ICdsYXRjaCcgfHwgeCA9PT0gJ3RsYXRjaCcgfHwgeCA9PT0gJ3B0bGF0Y2gnIHx8IHggPT09ICdudGxhdGNoJyB8fCB4ID09PSAncHVzaCc7CiAgICAgIH0KICAgIH0KICB9KTsKCiAgLy8gIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgLy8gQGRlY2xhcmUgJ2tiX2tleW5hbWVzJywgdGVzdHM6CiAgLy8gICAieCBpcyBhIGxpc3Qgb2Yga2Jfa2V5bmFtZSI6ICAoIHggKSAtPiBAaXNhLmxpc3Rfb2YgJ2tiX2tleW5hbWUnLCB4CiAgLy8gICAieCBpcyBub3QgZW1wdHkiOiAgICAgICAgICAgICAgICAgICAoIHggKSAtPiBub3QgQGlzYS5lbXB0eSB4CgogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICB0aGlzLmRlY2xhcmUoJ2tiX2tleW5hbWUnLCB7CiAgICB0ZXN0czogewogICAgICAieCBpcyBhIG5vbmVtcHR5X3RleHQiOiBmdW5jdGlvbih4KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaXNhLm5vbmVtcHR5X3RleHQoeCk7CiAgICAgIH0KICAgIH0KICB9KTsKCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIHRoaXMuZGVjbGFyZSgna2Jfd2F0Y2hlcicsIHsKICAgIHRlc3RzOiB7CiAgICAgICJ4IGlzIGEgZnVuY3Rpb24gb3IgYSBub25lbXB0eV90ZXh0IjogZnVuY3Rpb24oeCkgewogICAgICAgIHJldHVybiAodGhpcy5pc2EuZnVuY3Rpb24oeCkpIHx8ICh0aGlzLmlzYS5ub25lbXB0eV90ZXh0KHgpKTsKICAgICAgfQogICAgfQogIH0pOwoKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgLyogVEFJTlQgcHJvYmFibHkgbm90IGNvcnJlY3QgdG8gb25seSBjaGVjayBmb3IgRWxlbWVudCwgYXQgbGVhc3QgaW4gc29tZSBjYXNlcyBjb3VsZCBiZSBOb2RlIGFzIHdlbGwgKi8KICB0aGlzLmRlY2xhcmUoJ2RlbGVtZW50JywgZnVuY3Rpb24oeCkgewogICAgcmV0dXJuICh4ID09PSBkb2N1bWVudCkgfHwgKHggaW5zdGFuY2VvZiBFbGVtZW50KTsKICB9KTsKCiAgdGhpcy5kZWNsYXJlKCdlbGVtZW50JywgZnVuY3Rpb24oeCkgewogICAgcmV0dXJuIHggaW5zdGFuY2VvZiBFbGVtZW50OwogIH0pOwoKfSkuY2FsbCh0aGlzKTsKCgp9LHsiaW50ZXJ0eXBlIjo3fV0sMTI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewooZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcil7KGZ1bmN0aW9uICgpewooZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkgewoJdHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnID8gZmFjdG9yeShleHBvcnRzKSA6Cgl0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQgPyBkZWZpbmUoWydleHBvcnRzJ10sIGZhY3RvcnkpIDoKCShnbG9iYWwgPSBnbG9iYWwgfHwgc2VsZiwgZmFjdG9yeShnbG9iYWwubG91cGUgPSB7fSkpOwp9KHRoaXMsIChmdW5jdGlvbiAoZXhwb3J0cykgeyAndXNlIHN0cmljdCc7CgoJdmFyIGNvbW1vbmpzR2xvYmFsID0gdHlwZW9mIGdsb2JhbFRoaXMgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsVGhpcyA6IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDogdHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyBnbG9iYWwgOiB0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmIDoge307CgoJZnVuY3Rpb24gY3JlYXRlQ29tbW9uanNNb2R1bGUoZm4sIG1vZHVsZSkgewoJCXJldHVybiBtb2R1bGUgPSB7IGV4cG9ydHM6IHt9IH0sIGZuKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMpLCBtb2R1bGUuZXhwb3J0czsKCX0KCgl2YXIgdHlwZURldGVjdCA9IGNyZWF0ZUNvbW1vbmpzTW9kdWxlKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCShmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7CgkJIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpIDsKCX0oY29tbW9uanNHbG9iYWwsIChmdW5jdGlvbiAoKSB7CgkvKiAhCgkgKiB0eXBlLWRldGVjdAoJICogQ29weXJpZ2h0KGMpIDIwMTMgamFrZSBsdWVyIDxqYWtlQGFsb2dpY2FscGFyYWRveC5jb20+CgkgKiBNSVQgTGljZW5zZWQKCSAqLwoJdmFyIHByb21pc2VFeGlzdHMgPSB0eXBlb2YgUHJvbWlzZSA9PT0gJ2Z1bmN0aW9uJzsKCgkvKiBlc2xpbnQtZGlzYWJsZSBuby11bmRlZiAqLwoJdmFyIGdsb2JhbE9iamVjdCA9IHR5cGVvZiBzZWxmID09PSAnb2JqZWN0JyA/IHNlbGYgOiBjb21tb25qc0dsb2JhbDsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBpZC1ibGFja2xpc3QKCgl2YXIgc3ltYm9sRXhpc3RzID0gdHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCc7Cgl2YXIgbWFwRXhpc3RzID0gdHlwZW9mIE1hcCAhPT0gJ3VuZGVmaW5lZCc7Cgl2YXIgc2V0RXhpc3RzID0gdHlwZW9mIFNldCAhPT0gJ3VuZGVmaW5lZCc7Cgl2YXIgd2Vha01hcEV4aXN0cyA9IHR5cGVvZiBXZWFrTWFwICE9PSAndW5kZWZpbmVkJzsKCXZhciB3ZWFrU2V0RXhpc3RzID0gdHlwZW9mIFdlYWtTZXQgIT09ICd1bmRlZmluZWQnOwoJdmFyIGRhdGFWaWV3RXhpc3RzID0gdHlwZW9mIERhdGFWaWV3ICE9PSAndW5kZWZpbmVkJzsKCXZhciBzeW1ib2xJdGVyYXRvckV4aXN0cyA9IHN5bWJvbEV4aXN0cyAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yICE9PSAndW5kZWZpbmVkJzsKCXZhciBzeW1ib2xUb1N0cmluZ1RhZ0V4aXN0cyA9IHN5bWJvbEV4aXN0cyAmJiB0eXBlb2YgU3ltYm9sLnRvU3RyaW5nVGFnICE9PSAndW5kZWZpbmVkJzsKCXZhciBzZXRFbnRyaWVzRXhpc3RzID0gc2V0RXhpc3RzICYmIHR5cGVvZiBTZXQucHJvdG90eXBlLmVudHJpZXMgPT09ICdmdW5jdGlvbic7Cgl2YXIgbWFwRW50cmllc0V4aXN0cyA9IG1hcEV4aXN0cyAmJiB0eXBlb2YgTWFwLnByb3RvdHlwZS5lbnRyaWVzID09PSAnZnVuY3Rpb24nOwoJdmFyIHNldEl0ZXJhdG9yUHJvdG90eXBlID0gc2V0RW50cmllc0V4aXN0cyAmJiBPYmplY3QuZ2V0UHJvdG90eXBlT2YobmV3IFNldCgpLmVudHJpZXMoKSk7Cgl2YXIgbWFwSXRlcmF0b3JQcm90b3R5cGUgPSBtYXBFbnRyaWVzRXhpc3RzICYmIE9iamVjdC5nZXRQcm90b3R5cGVPZihuZXcgTWFwKCkuZW50cmllcygpKTsKCXZhciBhcnJheUl0ZXJhdG9yRXhpc3RzID0gc3ltYm9sSXRlcmF0b3JFeGlzdHMgJiYgdHlwZW9mIEFycmF5LnByb3RvdHlwZVtTeW1ib2wuaXRlcmF0b3JdID09PSAnZnVuY3Rpb24nOwoJdmFyIGFycmF5SXRlcmF0b3JQcm90b3R5cGUgPSBhcnJheUl0ZXJhdG9yRXhpc3RzICYmIE9iamVjdC5nZXRQcm90b3R5cGVPZihbXVtTeW1ib2wuaXRlcmF0b3JdKCkpOwoJdmFyIHN0cmluZ0l0ZXJhdG9yRXhpc3RzID0gc3ltYm9sSXRlcmF0b3JFeGlzdHMgJiYgdHlwZW9mIFN0cmluZy5wcm90b3R5cGVbU3ltYm9sLml0ZXJhdG9yXSA9PT0gJ2Z1bmN0aW9uJzsKCXZhciBzdHJpbmdJdGVyYXRvclByb3RvdHlwZSA9IHN0cmluZ0l0ZXJhdG9yRXhpc3RzICYmIE9iamVjdC5nZXRQcm90b3R5cGVPZignJ1tTeW1ib2wuaXRlcmF0b3JdKCkpOwoJdmFyIHRvU3RyaW5nTGVmdFNsaWNlTGVuZ3RoID0gODsKCXZhciB0b1N0cmluZ1JpZ2h0U2xpY2VMZW5ndGggPSAtMTsKCS8qKgoJICogIyMjIHR5cGVPZiAob2JqKQoJICoKCSAqIFVzZXMgYE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmdgIHRvIGRldGVybWluZSB0aGUgdHlwZSBvZiBhbiBvYmplY3QsCgkgKiBub3JtYWxpc2luZyBiZWhhdmlvdXIgYWNyb3NzIGVuZ2luZSB2ZXJzaW9ucyAmIHdlbGwgb3B0aW1pc2VkLgoJICoKCSAqIEBwYXJhbSB7TWl4ZWR9IG9iamVjdAoJICogQHJldHVybiB7U3RyaW5nfSBvYmplY3QgdHlwZQoJICogQGFwaSBwdWJsaWMKCSAqLwoJZnVuY3Rpb24gdHlwZURldGVjdChvYmopIHsKCSAgLyogISBTcGVlZCBvcHRpbWlzYXRpb24KCSAgICogUHJlOgoJICAgKiAgIHN0cmluZyBsaXRlcmFsICAgICB4IDMsMDM5LDAzNSBvcHMvc2VjIMKxMS42MiUgKDc4IHJ1bnMgc2FtcGxlZCkKCSAgICogICBib29sZWFuIGxpdGVyYWwgICAgeCAxLDQyNCwxMzggb3BzL3NlYyDCsTQuNTQlICg3NSBydW5zIHNhbXBsZWQpCgkgICAqICAgbnVtYmVyIGxpdGVyYWwgICAgIHggMSw2NTMsMTUzIG9wcy9zZWMgwrExLjkxJSAoODIgcnVucyBzYW1wbGVkKQoJICAgKiAgIHVuZGVmaW5lZCAgICAgICAgICB4IDksOTc4LDY2MCBvcHMvc2VjIMKxMS45MiUgKDc1IHJ1bnMgc2FtcGxlZCkKCSAgICogICBmdW5jdGlvbiAgICAgICAgICAgeCAyLDU1Niw3Njkgb3BzL3NlYyDCsTEuNzMlICg3NyBydW5zIHNhbXBsZWQpCgkgICAqIFBvc3Q6CgkgICAqICAgc3RyaW5nIGxpdGVyYWwgICAgIHggMzgsNTY0LDc5NiBvcHMvc2VjIMKxMS4xNSUgKDc5IHJ1bnMgc2FtcGxlZCkKCSAgICogICBib29sZWFuIGxpdGVyYWwgICAgeCAzMSwxNDgsOTQwIG9wcy9zZWMgwrExLjEwJSAoNzkgcnVucyBzYW1wbGVkKQoJICAgKiAgIG51bWJlciBsaXRlcmFsICAgICB4IDMyLDY3OSwzMzAgb3BzL3NlYyDCsTEuOTAlICg3OCBydW5zIHNhbXBsZWQpCgkgICAqICAgdW5kZWZpbmVkICAgICAgICAgIHggMzIsMzYzLDM2OCBvcHMvc2VjIMKxMS4wNyUgKDgyIHJ1bnMgc2FtcGxlZCkKCSAgICogICBmdW5jdGlvbiAgICAgICAgICAgeCAzMSwyOTYsODcwIG9wcy9zZWMgwrEwLjk2JSAoODMgcnVucyBzYW1wbGVkKQoJICAgKi8KCSAgdmFyIHR5cGVvZk9iaiA9IHR5cGVvZiBvYmo7CgkgIGlmICh0eXBlb2ZPYmogIT09ICdvYmplY3QnKSB7CgkgICAgcmV0dXJuIHR5cGVvZk9iajsKCSAgfQoKCSAgLyogISBTcGVlZCBvcHRpbWlzYXRpb24KCSAgICogUHJlOgoJICAgKiAgIG51bGwgICAgICAgICAgICAgICB4IDI4LDY0NSw3NjUgb3BzL3NlYyDCsTEuMTclICg4MiBydW5zIHNhbXBsZWQpCgkgICAqIFBvc3Q6CgkgICAqICAgbnVsbCAgICAgICAgICAgICAgIHggMzYsNDI4LDk2MiBvcHMvc2VjIMKxMS4zNyUgKDg0IHJ1bnMgc2FtcGxlZCkKCSAgICovCgkgIGlmIChvYmogPT09IG51bGwpIHsKCSAgICByZXR1cm4gJ251bGwnOwoJICB9CgoJICAvKiAhIFNwZWMgQ29uZm9ybWFuY2UKCSAgICogVGVzdDogYE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh3aW5kb3cpYGAKCSAgICogIC0gTm9kZSA9PT0gIltvYmplY3QgZ2xvYmFsXSIKCSAgICogIC0gQ2hyb21lID09PSAiW29iamVjdCBnbG9iYWxdIgoJICAgKiAgLSBGaXJlZm94ID09PSAiW29iamVjdCBXaW5kb3ddIgoJICAgKiAgLSBQaGFudG9tSlMgPT09ICJbb2JqZWN0IFdpbmRvd10iCgkgICAqICAtIFNhZmFyaSA9PT0gIltvYmplY3QgV2luZG93XSIKCSAgICogIC0gSUUgMTEgPT09ICJbb2JqZWN0IFdpbmRvd10iCgkgICAqICAtIElFIEVkZ2UgPT09ICJbb2JqZWN0IFdpbmRvd10iCgkgICAqIFRlc3Q6IGBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodGhpcylgYAoJICAgKiAgLSBDaHJvbWUgV29ya2VyID09PSAiW29iamVjdCBnbG9iYWxdIgoJICAgKiAgLSBGaXJlZm94IFdvcmtlciA9PT0gIltvYmplY3QgRGVkaWNhdGVkV29ya2VyR2xvYmFsU2NvcGVdIgoJICAgKiAgLSBTYWZhcmkgV29ya2VyID09PSAiW29iamVjdCBEZWRpY2F0ZWRXb3JrZXJHbG9iYWxTY29wZV0iCgkgICAqICAtIElFIDExIFdvcmtlciA9PT0gIltvYmplY3QgV29ya2VyR2xvYmFsU2NvcGVdIgoJICAgKiAgLSBJRSBFZGdlIFdvcmtlciA9PT0gIltvYmplY3QgV29ya2VyR2xvYmFsU2NvcGVdIgoJICAgKi8KCSAgaWYgKG9iaiA9PT0gZ2xvYmFsT2JqZWN0KSB7CgkgICAgcmV0dXJuICdnbG9iYWwnOwoJICB9CgoJICAvKiAhIFNwZWVkIG9wdGltaXNhdGlvbgoJICAgKiBQcmU6CgkgICAqICAgYXJyYXkgbGl0ZXJhbCAgICAgIHggMiw4ODgsMzUyIG9wcy9zZWMgwrEwLjY3JSAoODIgcnVucyBzYW1wbGVkKQoJICAgKiBQb3N0OgoJICAgKiAgIGFycmF5IGxpdGVyYWwgICAgICB4IDIyLDQ3OSw2NTAgb3BzL3NlYyDCsTAuOTYlICg4MSBydW5zIHNhbXBsZWQpCgkgICAqLwoJICBpZiAoCgkgICAgQXJyYXkuaXNBcnJheShvYmopICYmCgkgICAgKHN5bWJvbFRvU3RyaW5nVGFnRXhpc3RzID09PSBmYWxzZSB8fCAhKFN5bWJvbC50b1N0cmluZ1RhZyBpbiBvYmopKQoJICApIHsKCSAgICByZXR1cm4gJ0FycmF5JzsKCSAgfQoKCSAgLy8gTm90IGNhY2hpbmcgZXhpc3RlbmNlIG9mIGB3aW5kb3dgIGFuZCByZWxhdGVkIHByb3BlcnRpZXMgZHVlIHRvIHBvdGVudGlhbAoJICAvLyBmb3IgYHdpbmRvd2AgdG8gYmUgdW5zZXQgYmVmb3JlIHRlc3RzIGluIHF1YXNpLWJyb3dzZXIgZW52aXJvbm1lbnRzLgoJICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcgJiYgd2luZG93ICE9PSBudWxsKSB7CgkgICAgLyogISBTcGVjIENvbmZvcm1hbmNlCgkgICAgICogKGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvbXVsdGlwYWdlL2Jyb3dzZXJzLmh0bWwjbG9jYXRpb24pCgkgICAgICogV2hhdFdHIEhUTUwkNy43LjMgLSBUaGUgYExvY2F0aW9uYCBpbnRlcmZhY2UKCSAgICAgKiBUZXN0OiBgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHdpbmRvdy5sb2NhdGlvbilgYAoJICAgICAqICAtIElFIDw9MTEgPT09ICJbb2JqZWN0IE9iamVjdF0iCgkgICAgICogIC0gSUUgRWRnZSA8PTEzID09PSAiW29iamVjdCBPYmplY3RdIgoJICAgICAqLwoJICAgIGlmICh0eXBlb2Ygd2luZG93LmxvY2F0aW9uID09PSAnb2JqZWN0JyAmJiBvYmogPT09IHdpbmRvdy5sb2NhdGlvbikgewoJICAgICAgcmV0dXJuICdMb2NhdGlvbic7CgkgICAgfQoKCSAgICAvKiAhIFNwZWMgQ29uZm9ybWFuY2UKCSAgICAgKiAoaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy8jZG9jdW1lbnQpCgkgICAgICogV2hhdFdHIEhUTUwkMy4xLjEgLSBUaGUgYERvY3VtZW50YCBvYmplY3QKCSAgICAgKiBOb3RlOiBNb3N0IGJyb3dzZXJzIGN1cnJlbnRseSBhZGhlciB0byB0aGUgVzNDIERPTSBMZXZlbCAyIHNwZWMKCSAgICAgKiAgICAgICAoaHR0cHM6Ly93d3cudzMub3JnL1RSL0RPTS1MZXZlbC0yLUhUTUwvaHRtbC5odG1sI0lELTI2ODA5MjY4KQoJICAgICAqICAgICAgIHdoaWNoIHN1Z2dlc3RzIHRoYXQgYnJvd3NlcnMgc2hvdWxkIHVzZSBIVE1MVGFibGVDZWxsRWxlbWVudCBmb3IKCSAgICAgKiAgICAgICBib3RoIFREIGFuZCBUSCBlbGVtZW50cy4gV2hhdFdHIHNlcGFyYXRlcyB0aGVzZS4KCSAgICAgKiAgICAgICBXaGF0V0cgSFRNTCBzdGF0ZXM6CgkgICAgICogICAgICAgICA+IEZvciBoaXN0b3JpY2FsIHJlYXNvbnMsIFdpbmRvdyBvYmplY3RzIG11c3QgYWxzbyBoYXZlIGEKCSAgICAgKiAgICAgICAgID4gd3JpdGFibGUsIGNvbmZpZ3VyYWJsZSwgbm9uLWVudW1lcmFibGUgcHJvcGVydHkgbmFtZWQKCSAgICAgKiAgICAgICAgID4gSFRNTERvY3VtZW50IHdob3NlIHZhbHVlIGlzIHRoZSBEb2N1bWVudCBpbnRlcmZhY2Ugb2JqZWN0LgoJICAgICAqIFRlc3Q6IGBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZG9jdW1lbnQpYGAKCSAgICAgKiAgLSBDaHJvbWUgPT09ICJbb2JqZWN0IEhUTUxEb2N1bWVudF0iCgkgICAgICogIC0gRmlyZWZveCA9PT0gIltvYmplY3QgSFRNTERvY3VtZW50XSIKCSAgICAgKiAgLSBTYWZhcmkgPT09ICJbb2JqZWN0IEhUTUxEb2N1bWVudF0iCgkgICAgICogIC0gSUUgPD0xMCA9PT0gIltvYmplY3QgRG9jdW1lbnRdIgoJICAgICAqICAtIElFIDExID09PSAiW29iamVjdCBIVE1MRG9jdW1lbnRdIgoJICAgICAqICAtIElFIEVkZ2UgPD0xMyA9PT0gIltvYmplY3QgSFRNTERvY3VtZW50XSIKCSAgICAgKi8KCSAgICBpZiAodHlwZW9mIHdpbmRvdy5kb2N1bWVudCA9PT0gJ29iamVjdCcgJiYgb2JqID09PSB3aW5kb3cuZG9jdW1lbnQpIHsKCSAgICAgIHJldHVybiAnRG9jdW1lbnQnOwoJICAgIH0KCgkgICAgaWYgKHR5cGVvZiB3aW5kb3cubmF2aWdhdG9yID09PSAnb2JqZWN0JykgewoJICAgICAgLyogISBTcGVjIENvbmZvcm1hbmNlCgkgICAgICAgKiAoaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2Uvd2ViYXBwYXBpcy5odG1sI21pbWV0eXBlYXJyYXkpCgkgICAgICAgKiBXaGF0V0cgSFRNTCQ4LjYuMS41IC0gUGx1Z2lucyAtIEludGVyZmFjZSBNaW1lVHlwZUFycmF5CgkgICAgICAgKiBUZXN0OiBgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG5hdmlnYXRvci5taW1lVHlwZXMpYGAKCSAgICAgICAqICAtIElFIDw9MTAgPT09ICJbb2JqZWN0IE1TTWltZVR5cGVzQ29sbGVjdGlvbl0iCgkgICAgICAgKi8KCSAgICAgIGlmICh0eXBlb2Ygd2luZG93Lm5hdmlnYXRvci5taW1lVHlwZXMgPT09ICdvYmplY3QnICYmCgkgICAgICAgICAgb2JqID09PSB3aW5kb3cubmF2aWdhdG9yLm1pbWVUeXBlcykgewoJICAgICAgICByZXR1cm4gJ01pbWVUeXBlQXJyYXknOwoJICAgICAgfQoKCSAgICAgIC8qICEgU3BlYyBDb25mb3JtYW5jZQoJICAgICAgICogKGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvbXVsdGlwYWdlL3dlYmFwcGFwaXMuaHRtbCNwbHVnaW5hcnJheSkKCSAgICAgICAqIFdoYXRXRyBIVE1MJDguNi4xLjUgLSBQbHVnaW5zIC0gSW50ZXJmYWNlIFBsdWdpbkFycmF5CgkgICAgICAgKiBUZXN0OiBgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG5hdmlnYXRvci5wbHVnaW5zKWBgCgkgICAgICAgKiAgLSBJRSA8PTEwID09PSAiW29iamVjdCBNU1BsdWdpbnNDb2xsZWN0aW9uXSIKCSAgICAgICAqLwoJICAgICAgaWYgKHR5cGVvZiB3aW5kb3cubmF2aWdhdG9yLnBsdWdpbnMgPT09ICdvYmplY3QnICYmCgkgICAgICAgICAgb2JqID09PSB3aW5kb3cubmF2aWdhdG9yLnBsdWdpbnMpIHsKCSAgICAgICAgcmV0dXJuICdQbHVnaW5BcnJheSc7CgkgICAgICB9CgkgICAgfQoKCSAgICBpZiAoKHR5cGVvZiB3aW5kb3cuSFRNTEVsZW1lbnQgPT09ICdmdW5jdGlvbicgfHwKCSAgICAgICAgdHlwZW9mIHdpbmRvdy5IVE1MRWxlbWVudCA9PT0gJ29iamVjdCcpICYmCgkgICAgICAgIG9iaiBpbnN0YW5jZW9mIHdpbmRvdy5IVE1MRWxlbWVudCkgewoJICAgICAgLyogISBTcGVjIENvbmZvcm1hbmNlCgkgICAgICAqIChodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS93ZWJhcHBhcGlzLmh0bWwjcGx1Z2luYXJyYXkpCgkgICAgICAqIFdoYXRXRyBIVE1MJDQuNC40IC0gVGhlIGBibG9ja3F1b3RlYCBlbGVtZW50IC0gSW50ZXJmYWNlIGBIVE1MUXVvdGVFbGVtZW50YAoJICAgICAgKiBUZXN0OiBgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Jsb2NrcXVvdGUnKSlgYAoJICAgICAgKiAgLSBJRSA8PTEwID09PSAiW29iamVjdCBIVE1MQmxvY2tFbGVtZW50XSIKCSAgICAgICovCgkgICAgICBpZiAob2JqLnRhZ05hbWUgPT09ICdCTE9DS1FVT1RFJykgewoJICAgICAgICByZXR1cm4gJ0hUTUxRdW90ZUVsZW1lbnQnOwoJICAgICAgfQoKCSAgICAgIC8qICEgU3BlYyBDb25mb3JtYW5jZQoJICAgICAgICogKGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvI2h0bWx0YWJsZWRhdGFjZWxsZWxlbWVudCkKCSAgICAgICAqIFdoYXRXRyBIVE1MJDQuOS45IC0gVGhlIGB0ZGAgZWxlbWVudCAtIEludGVyZmFjZSBgSFRNTFRhYmxlRGF0YUNlbGxFbGVtZW50YAoJICAgICAgICogTm90ZTogTW9zdCBicm93c2VycyBjdXJyZW50bHkgYWRoZXIgdG8gdGhlIFczQyBET00gTGV2ZWwgMiBzcGVjCgkgICAgICAgKiAgICAgICAoaHR0cHM6Ly93d3cudzMub3JnL1RSL0RPTS1MZXZlbC0yLUhUTUwvaHRtbC5odG1sI0lELTgyOTE1MDc1KQoJICAgICAgICogICAgICAgd2hpY2ggc3VnZ2VzdHMgdGhhdCBicm93c2VycyBzaG91bGQgdXNlIEhUTUxUYWJsZUNlbGxFbGVtZW50IGZvcgoJICAgICAgICogICAgICAgYm90aCBURCBhbmQgVEggZWxlbWVudHMuIFdoYXRXRyBzZXBhcmF0ZXMgdGhlc2UuCgkgICAgICAgKiBUZXN0OiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKSkKCSAgICAgICAqICAtIENocm9tZSA9PT0gIltvYmplY3QgSFRNTFRhYmxlQ2VsbEVsZW1lbnRdIgoJICAgICAgICogIC0gRmlyZWZveCA9PT0gIltvYmplY3QgSFRNTFRhYmxlQ2VsbEVsZW1lbnRdIgoJICAgICAgICogIC0gU2FmYXJpID09PSAiW29iamVjdCBIVE1MVGFibGVDZWxsRWxlbWVudF0iCgkgICAgICAgKi8KCSAgICAgIGlmIChvYmoudGFnTmFtZSA9PT0gJ1REJykgewoJICAgICAgICByZXR1cm4gJ0hUTUxUYWJsZURhdGFDZWxsRWxlbWVudCc7CgkgICAgICB9CgoJICAgICAgLyogISBTcGVjIENvbmZvcm1hbmNlCgkgICAgICAgKiAoaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy8jaHRtbHRhYmxlaGVhZGVyY2VsbGVsZW1lbnQpCgkgICAgICAgKiBXaGF0V0cgSFRNTCQ0LjkuOSAtIFRoZSBgdGRgIGVsZW1lbnQgLSBJbnRlcmZhY2UgYEhUTUxUYWJsZUhlYWRlckNlbGxFbGVtZW50YAoJICAgICAgICogTm90ZTogTW9zdCBicm93c2VycyBjdXJyZW50bHkgYWRoZXIgdG8gdGhlIFczQyBET00gTGV2ZWwgMiBzcGVjCgkgICAgICAgKiAgICAgICAoaHR0cHM6Ly93d3cudzMub3JnL1RSL0RPTS1MZXZlbC0yLUhUTUwvaHRtbC5odG1sI0lELTgyOTE1MDc1KQoJICAgICAgICogICAgICAgd2hpY2ggc3VnZ2VzdHMgdGhhdCBicm93c2VycyBzaG91bGQgdXNlIEhUTUxUYWJsZUNlbGxFbGVtZW50IGZvcgoJICAgICAgICogICAgICAgYm90aCBURCBhbmQgVEggZWxlbWVudHMuIFdoYXRXRyBzZXBhcmF0ZXMgdGhlc2UuCgkgICAgICAgKiBUZXN0OiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKSkKCSAgICAgICAqICAtIENocm9tZSA9PT0gIltvYmplY3QgSFRNTFRhYmxlQ2VsbEVsZW1lbnRdIgoJICAgICAgICogIC0gRmlyZWZveCA9PT0gIltvYmplY3QgSFRNTFRhYmxlQ2VsbEVsZW1lbnRdIgoJICAgICAgICogIC0gU2FmYXJpID09PSAiW29iamVjdCBIVE1MVGFibGVDZWxsRWxlbWVudF0iCgkgICAgICAgKi8KCSAgICAgIGlmIChvYmoudGFnTmFtZSA9PT0gJ1RIJykgewoJICAgICAgICByZXR1cm4gJ0hUTUxUYWJsZUhlYWRlckNlbGxFbGVtZW50JzsKCSAgICAgIH0KCSAgICB9CgkgIH0KCgkgIC8qICEgU3BlZWQgb3B0aW1pc2F0aW9uCgkgICogUHJlOgoJICAqICAgRmxvYXQ2NEFycmF5ICAgICAgIHggNjI1LDY0NCBvcHMvc2VjIMKxMS41OCUgKDgwIHJ1bnMgc2FtcGxlZCkKCSAgKiAgIEZsb2F0MzJBcnJheSAgICAgICB4IDEsMjc5LDg1MiBvcHMvc2VjIMKxMi45MSUgKDc3IHJ1bnMgc2FtcGxlZCkKCSAgKiAgIFVpbnQzMkFycmF5ICAgICAgICB4IDEsMTc4LDE4NSBvcHMvc2VjIMKxMS45NSUgKDgzIHJ1bnMgc2FtcGxlZCkKCSAgKiAgIFVpbnQxNkFycmF5ICAgICAgICB4IDEsMDA4LDM4MCBvcHMvc2VjIMKxMi4yNSUgKDgwIHJ1bnMgc2FtcGxlZCkKCSAgKiAgIFVpbnQ4QXJyYXkgICAgICAgICB4IDEsMTI4LDA0MCBvcHMvc2VjIMKxMi4xMSUgKDgxIHJ1bnMgc2FtcGxlZCkKCSAgKiAgIEludDMyQXJyYXkgICAgICAgICB4IDEsMTcwLDExOSBvcHMvc2VjIMKxMi44OCUgKDgwIHJ1bnMgc2FtcGxlZCkKCSAgKiAgIEludDE2QXJyYXkgICAgICAgICB4IDEsMTc2LDM0OCBvcHMvc2VjIMKxNS43OSUgKDg2IHJ1bnMgc2FtcGxlZCkKCSAgKiAgIEludDhBcnJheSAgICAgICAgICB4IDEsMDU4LDcwNyBvcHMvc2VjIMKxNC45NCUgKDc3IHJ1bnMgc2FtcGxlZCkKCSAgKiAgIFVpbnQ4Q2xhbXBlZEFycmF5ICB4IDEsMTEwLDYzMyBvcHMvc2VjIMKxNC4yMCUgKDgwIHJ1bnMgc2FtcGxlZCkKCSAgKiBQb3N0OgoJICAqICAgRmxvYXQ2NEFycmF5ICAgICAgIHggNywxMDUsNjcxIG9wcy9zZWMgwrExMy40NyUgKDY0IHJ1bnMgc2FtcGxlZCkKCSAgKiAgIEZsb2F0MzJBcnJheSAgICAgICB4IDUsODg3LDkxMiBvcHMvc2VjIMKxMS40NiUgKDgyIHJ1bnMgc2FtcGxlZCkKCSAgKiAgIFVpbnQzMkFycmF5ICAgICAgICB4IDYsNDkxLDY2MSBvcHMvc2VjIMKxMS43NiUgKDc5IHJ1bnMgc2FtcGxlZCkKCSAgKiAgIFVpbnQxNkFycmF5ICAgICAgICB4IDYsNTU5LDc5NSBvcHMvc2VjIMKxMS42NyUgKDgyIHJ1bnMgc2FtcGxlZCkKCSAgKiAgIFVpbnQ4QXJyYXkgICAgICAgICB4IDYsNDYzLDk2NiBvcHMvc2VjIMKxMS40MyUgKDg1IHJ1bnMgc2FtcGxlZCkKCSAgKiAgIEludDMyQXJyYXkgICAgICAgICB4IDUsNjQxLDg0MSBvcHMvc2VjIMKxMy40OSUgKDgxIHJ1bnMgc2FtcGxlZCkKCSAgKiAgIEludDE2QXJyYXkgICAgICAgICB4IDYsNTgzLDUxMSBvcHMvc2VjIMKxMS45OCUgKDgwIHJ1bnMgc2FtcGxlZCkKCSAgKiAgIEludDhBcnJheSAgICAgICAgICB4IDYsNjA2LDA3OCBvcHMvc2VjIMKxMS43NCUgKDgxIHJ1bnMgc2FtcGxlZCkKCSAgKiAgIFVpbnQ4Q2xhbXBlZEFycmF5ICB4IDYsNjAyLDIyNCBvcHMvc2VjIMKxMS43NyUgKDgzIHJ1bnMgc2FtcGxlZCkKCSAgKi8KCSAgdmFyIHN0cmluZ1RhZyA9IChzeW1ib2xUb1N0cmluZ1RhZ0V4aXN0cyAmJiBvYmpbU3ltYm9sLnRvU3RyaW5nVGFnXSk7CgkgIGlmICh0eXBlb2Ygc3RyaW5nVGFnID09PSAnc3RyaW5nJykgewoJICAgIHJldHVybiBzdHJpbmdUYWc7CgkgIH0KCgkgIHZhciBvYmpQcm90b3R5cGUgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqKTsKCSAgLyogISBTcGVlZCBvcHRpbWlzYXRpb24KCSAgKiBQcmU6CgkgICogICByZWdleCBsaXRlcmFsICAgICAgeCAxLDc3MiwzODUgb3BzL3NlYyDCsTEuODUlICg3NyBydW5zIHNhbXBsZWQpCgkgICogICByZWdleCBjb25zdHJ1Y3RvciAgeCAyLDE0Myw2MzQgb3BzL3NlYyDCsTIuNDYlICg3OCBydW5zIHNhbXBsZWQpCgkgICogUG9zdDoKCSAgKiAgIHJlZ2V4IGxpdGVyYWwgICAgICB4IDMsOTI4LDAwOSBvcHMvc2VjIMKxMC42NSUgKDc4IHJ1bnMgc2FtcGxlZCkKCSAgKiAgIHJlZ2V4IGNvbnN0cnVjdG9yICB4IDMsOTMxLDEwOCBvcHMvc2VjIMKxMC41OCUgKDg0IHJ1bnMgc2FtcGxlZCkKCSAgKi8KCSAgaWYgKG9ialByb3RvdHlwZSA9PT0gUmVnRXhwLnByb3RvdHlwZSkgewoJICAgIHJldHVybiAnUmVnRXhwJzsKCSAgfQoKCSAgLyogISBTcGVlZCBvcHRpbWlzYXRpb24KCSAgKiBQcmU6CgkgICogICBkYXRlICAgICAgICAgICAgICAgeCAyLDEzMCwwNzQgb3BzL3NlYyDCsTQuNDIlICg2OCBydW5zIHNhbXBsZWQpCgkgICogUG9zdDoKCSAgKiAgIGRhdGUgICAgICAgICAgICAgICB4IDMsOTUzLDc3OSBvcHMvc2VjIMKxMS4zNSUgKDc3IHJ1bnMgc2FtcGxlZCkKCSAgKi8KCSAgaWYgKG9ialByb3RvdHlwZSA9PT0gRGF0ZS5wcm90b3R5cGUpIHsKCSAgICByZXR1cm4gJ0RhdGUnOwoJICB9CgoJICAvKiAhIFNwZWMgQ29uZm9ybWFuY2UKCSAgICogKGh0dHA6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi82LjAvaW5kZXguaHRtbCNzZWMtcHJvbWlzZS5wcm90b3R5cGUtQEB0b3N0cmluZ3RhZykKCSAgICogRVM2JDI1LjQuNS40IC0gUHJvbWlzZS5wcm90b3R5cGVbQEB0b1N0cmluZ1RhZ10gc2hvdWxkIGJlICJQcm9taXNlIjoKCSAgICogVGVzdDogYE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChQcm9taXNlLnJlc29sdmUoKSlgYAoJICAgKiAgLSBDaHJvbWUgPD00NyA9PT0gIltvYmplY3QgT2JqZWN0XSIKCSAgICogIC0gRWRnZSA8PTIwID09PSAiW29iamVjdCBPYmplY3RdIgoJICAgKiAgLSBGaXJlZm94IDI5LUxhdGVzdCA9PT0gIltvYmplY3QgUHJvbWlzZV0iCgkgICAqICAtIFNhZmFyaSA3LjEtTGF0ZXN0ID09PSAiW29iamVjdCBQcm9taXNlXSIKCSAgICovCgkgIGlmIChwcm9taXNlRXhpc3RzICYmIG9ialByb3RvdHlwZSA9PT0gUHJvbWlzZS5wcm90b3R5cGUpIHsKCSAgICByZXR1cm4gJ1Byb21pc2UnOwoJICB9CgoJICAvKiAhIFNwZWVkIG9wdGltaXNhdGlvbgoJICAqIFByZToKCSAgKiAgIHNldCAgICAgICAgICAgICAgICB4IDIsMjIyLDE4NiBvcHMvc2VjIMKxMS4zMSUgKDgyIHJ1bnMgc2FtcGxlZCkKCSAgKiBQb3N0OgoJICAqICAgc2V0ICAgICAgICAgICAgICAgIHggNCw1NDUsODc5IG9wcy9zZWMgwrExLjEzJSAoODMgcnVucyBzYW1wbGVkKQoJICAqLwoJICBpZiAoc2V0RXhpc3RzICYmIG9ialByb3RvdHlwZSA9PT0gU2V0LnByb3RvdHlwZSkgewoJICAgIHJldHVybiAnU2V0JzsKCSAgfQoKCSAgLyogISBTcGVlZCBvcHRpbWlzYXRpb24KCSAgKiBQcmU6CgkgICogICBtYXAgICAgICAgICAgICAgICAgeCAyLDM5Niw4NDIgb3BzL3NlYyDCsTEuNTklICg4MSBydW5zIHNhbXBsZWQpCgkgICogUG9zdDoKCSAgKiAgIG1hcCAgICAgICAgICAgICAgICB4IDQsMTgzLDk0NSBvcHMvc2VjIMKxNi41OSUgKDgyIHJ1bnMgc2FtcGxlZCkKCSAgKi8KCSAgaWYgKG1hcEV4aXN0cyAmJiBvYmpQcm90b3R5cGUgPT09IE1hcC5wcm90b3R5cGUpIHsKCSAgICByZXR1cm4gJ01hcCc7CgkgIH0KCgkgIC8qICEgU3BlZWQgb3B0aW1pc2F0aW9uCgkgICogUHJlOgoJICAqICAgd2Vha3NldCAgICAgICAgICAgIHggMSwzMjMsMjIwIG9wcy9zZWMgwrEyLjE3JSAoNzYgcnVucyBzYW1wbGVkKQoJICAqIFBvc3Q6CgkgICogICB3ZWFrc2V0ICAgICAgICAgICAgeCA0LDIzNyw1MTAgb3BzL3NlYyDCsTIuMDElICg3NyBydW5zIHNhbXBsZWQpCgkgICovCgkgIGlmICh3ZWFrU2V0RXhpc3RzICYmIG9ialByb3RvdHlwZSA9PT0gV2Vha1NldC5wcm90b3R5cGUpIHsKCSAgICByZXR1cm4gJ1dlYWtTZXQnOwoJICB9CgoJICAvKiAhIFNwZWVkIG9wdGltaXNhdGlvbgoJICAqIFByZToKCSAgKiAgIHdlYWttYXAgICAgICAgICAgICB4IDEsNTAwLDI2MCBvcHMvc2VjIMKxMi4wMiUgKDc4IHJ1bnMgc2FtcGxlZCkKCSAgKiBQb3N0OgoJICAqICAgd2Vha21hcCAgICAgICAgICAgIHggMyw4ODEsMzg0IG9wcy9zZWMgwrExLjQ1JSAoODIgcnVucyBzYW1wbGVkKQoJICAqLwoJICBpZiAod2Vha01hcEV4aXN0cyAmJiBvYmpQcm90b3R5cGUgPT09IFdlYWtNYXAucHJvdG90eXBlKSB7CgkgICAgcmV0dXJuICdXZWFrTWFwJzsKCSAgfQoKCSAgLyogISBTcGVjIENvbmZvcm1hbmNlCgkgICAqIChodHRwOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNi4wL2luZGV4Lmh0bWwjc2VjLWRhdGF2aWV3LnByb3RvdHlwZS1AQHRvc3RyaW5ndGFnKQoJICAgKiBFUzYkMjQuMi40LjIxIC0gRGF0YVZpZXcucHJvdG90eXBlW0BAdG9TdHJpbmdUYWddIHNob3VsZCBiZSAiRGF0YVZpZXciOgoJICAgKiBUZXN0OiBgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIoMSkpKWBgCgkgICAqICAtIEVkZ2UgPD0xMyA9PT0gIltvYmplY3QgT2JqZWN0XSIKCSAgICovCgkgIGlmIChkYXRhVmlld0V4aXN0cyAmJiBvYmpQcm90b3R5cGUgPT09IERhdGFWaWV3LnByb3RvdHlwZSkgewoJICAgIHJldHVybiAnRGF0YVZpZXcnOwoJICB9CgoJICAvKiAhIFNwZWMgQ29uZm9ybWFuY2UKCSAgICogKGh0dHA6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi82LjAvaW5kZXguaHRtbCNzZWMtJW1hcGl0ZXJhdG9ycHJvdG90eXBlJS1AQHRvc3RyaW5ndGFnKQoJICAgKiBFUzYkMjMuMS41LjIuMiAtICVNYXBJdGVyYXRvclByb3RvdHlwZSVbQEB0b1N0cmluZ1RhZ10gc2hvdWxkIGJlICJNYXAgSXRlcmF0b3IiOgoJICAgKiBUZXN0OiBgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG5ldyBNYXAoKS5lbnRyaWVzKCkpYGAKCSAgICogIC0gRWRnZSA8PTEzID09PSAiW29iamVjdCBPYmplY3RdIgoJICAgKi8KCSAgaWYgKG1hcEV4aXN0cyAmJiBvYmpQcm90b3R5cGUgPT09IG1hcEl0ZXJhdG9yUHJvdG90eXBlKSB7CgkgICAgcmV0dXJuICdNYXAgSXRlcmF0b3InOwoJICB9CgoJICAvKiAhIFNwZWMgQ29uZm9ybWFuY2UKCSAgICogKGh0dHA6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi82LjAvaW5kZXguaHRtbCNzZWMtJXNldGl0ZXJhdG9ycHJvdG90eXBlJS1AQHRvc3RyaW5ndGFnKQoJICAgKiBFUzYkMjMuMi41LjIuMiAtICVTZXRJdGVyYXRvclByb3RvdHlwZSVbQEB0b1N0cmluZ1RhZ10gc2hvdWxkIGJlICJTZXQgSXRlcmF0b3IiOgoJICAgKiBUZXN0OiBgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG5ldyBTZXQoKS5lbnRyaWVzKCkpYGAKCSAgICogIC0gRWRnZSA8PTEzID09PSAiW29iamVjdCBPYmplY3RdIgoJICAgKi8KCSAgaWYgKHNldEV4aXN0cyAmJiBvYmpQcm90b3R5cGUgPT09IHNldEl0ZXJhdG9yUHJvdG90eXBlKSB7CgkgICAgcmV0dXJuICdTZXQgSXRlcmF0b3InOwoJICB9CgoJICAvKiAhIFNwZWMgQ29uZm9ybWFuY2UKCSAgICogKGh0dHA6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi82LjAvaW5kZXguaHRtbCNzZWMtJWFycmF5aXRlcmF0b3Jwcm90b3R5cGUlLUBAdG9zdHJpbmd0YWcpCgkgICAqIEVTNiQyMi4xLjUuMi4yIC0gJUFycmF5SXRlcmF0b3JQcm90b3R5cGUlW0BAdG9TdHJpbmdUYWddIHNob3VsZCBiZSAiQXJyYXkgSXRlcmF0b3IiOgoJICAgKiBUZXN0OiBgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKFtdW1N5bWJvbC5pdGVyYXRvcl0oKSlgYAoJICAgKiAgLSBFZGdlIDw9MTMgPT09ICJbb2JqZWN0IE9iamVjdF0iCgkgICAqLwoJICBpZiAoYXJyYXlJdGVyYXRvckV4aXN0cyAmJiBvYmpQcm90b3R5cGUgPT09IGFycmF5SXRlcmF0b3JQcm90b3R5cGUpIHsKCSAgICByZXR1cm4gJ0FycmF5IEl0ZXJhdG9yJzsKCSAgfQoKCSAgLyogISBTcGVjIENvbmZvcm1hbmNlCgkgICAqIChodHRwOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNi4wL2luZGV4Lmh0bWwjc2VjLSVzdHJpbmdpdGVyYXRvcnByb3RvdHlwZSUtQEB0b3N0cmluZ3RhZykKCSAgICogRVM2JDIxLjEuNS4yLjIgLSAlU3RyaW5nSXRlcmF0b3JQcm90b3R5cGUlW0BAdG9TdHJpbmdUYWddIHNob3VsZCBiZSAiU3RyaW5nIEl0ZXJhdG9yIjoKCSAgICogVGVzdDogYE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCgnJ1tTeW1ib2wuaXRlcmF0b3JdKCkpYGAKCSAgICogIC0gRWRnZSA8PTEzID09PSAiW29iamVjdCBPYmplY3RdIgoJICAgKi8KCSAgaWYgKHN0cmluZ0l0ZXJhdG9yRXhpc3RzICYmIG9ialByb3RvdHlwZSA9PT0gc3RyaW5nSXRlcmF0b3JQcm90b3R5cGUpIHsKCSAgICByZXR1cm4gJ1N0cmluZyBJdGVyYXRvcic7CgkgIH0KCgkgIC8qICEgU3BlZWQgb3B0aW1pc2F0aW9uCgkgICogUHJlOgoJICAqICAgb2JqZWN0IGZyb20gbnVsbCAgIHggMiw0MjQsMzIwIG9wcy9zZWMgwrExLjY3JSAoNzYgcnVucyBzYW1wbGVkKQoJICAqIFBvc3Q6CgkgICogICBvYmplY3QgZnJvbSBudWxsICAgeCA1LDgzOCwwMDAgb3BzL3NlYyDCsTAuOTklICg4NCBydW5zIHNhbXBsZWQpCgkgICovCgkgIGlmIChvYmpQcm90b3R5cGUgPT09IG51bGwpIHsKCSAgICByZXR1cm4gJ09iamVjdCc7CgkgIH0KCgkgIHJldHVybiBPYmplY3QKCSAgICAucHJvdG90eXBlCgkgICAgLnRvU3RyaW5nCgkgICAgLmNhbGwob2JqKQoJICAgIC5zbGljZSh0b1N0cmluZ0xlZnRTbGljZUxlbmd0aCwgdG9TdHJpbmdSaWdodFNsaWNlTGVuZ3RoKTsKCX0KCglyZXR1cm4gdHlwZURldGVjdDsKCgl9KSkpOwoJfSk7CgoJZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7CgkgIHJldHVybiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0KCk7Cgl9CgoJZnVuY3Rpb24gX2FycmF5V2l0aEhvbGVzKGFycikgewoJICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyOwoJfQoKCWZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHsKCSAgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJ1bmRlZmluZWQiIHx8ICEoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChhcnIpKSkgcmV0dXJuOwoJICB2YXIgX2FyciA9IFtdOwoJICB2YXIgX24gPSB0cnVlOwoJICB2YXIgX2QgPSBmYWxzZTsKCSAgdmFyIF9lID0gdW5kZWZpbmVkOwoKCSAgdHJ5IHsKCSAgICBmb3IgKHZhciBfaSA9IGFycltTeW1ib2wuaXRlcmF0b3JdKCksIF9zOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7CgkgICAgICBfYXJyLnB1c2goX3MudmFsdWUpOwoKCSAgICAgIGlmIChpICYmIF9hcnIubGVuZ3RoID09PSBpKSBicmVhazsKCSAgICB9CgkgIH0gY2F0Y2ggKGVycikgewoJICAgIF9kID0gdHJ1ZTsKCSAgICBfZSA9IGVycjsKCSAgfSBmaW5hbGx5IHsKCSAgICB0cnkgewoJICAgICAgaWYgKCFfbiAmJiBfaVsicmV0dXJuIl0gIT0gbnVsbCkgX2lbInJldHVybiJdKCk7CgkgICAgfSBmaW5hbGx5IHsKCSAgICAgIGlmIChfZCkgdGhyb3cgX2U7CgkgICAgfQoJICB9CgoJICByZXR1cm4gX2FycjsKCX0KCglmdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7CgkgIGlmICghbykgcmV0dXJuOwoJICBpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTsKCSAgdmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpOwoJICBpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTsKCSAgaWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShuKTsKCSAgaWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTsKCX0KCglmdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikgewoJICBpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDsKCgkgIGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgYXJyMltpXSA9IGFycltpXTsKCgkgIHJldHVybiBhcnIyOwoJfQoKCWZ1bmN0aW9uIF9ub25JdGVyYWJsZVJlc3QoKSB7CgkgIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7Cgl9CgoJdmFyIGFuc2lDb2xvcnMgPSB7CgkgIGJvbGQ6IFsnMScsICcyMiddLAoJICBkaW06IFsnMicsICcyMiddLAoJICBpdGFsaWM6IFsnMycsICcyMyddLAoJICB1bmRlcmxpbmU6IFsnNCcsICcyNCddLAoJICAvLyA1ICYgNiBhcmUgYmxpbmtpbmcKCSAgaW52ZXJzZTogWyc3JywgJzI3J10sCgkgIGhpZGRlbjogWyc4JywgJzI4J10sCgkgIHN0cmlrZTogWyc5JywgJzI5J10sCgkgIC8vIDEwLTIwIGFyZSBmb250cwoJICAvLyAyMS0yOSBhcmUgcmVzZXRzIGZvciAxLTkKCSAgYmxhY2s6IFsnMzAnLCAnMzknXSwKCSAgcmVkOiBbJzMxJywgJzM5J10sCgkgIGdyZWVuOiBbJzMyJywgJzM5J10sCgkgIHllbGxvdzogWyczMycsICczOSddLAoJICBibHVlOiBbJzM0JywgJzM5J10sCgkgIG1hZ2VudGE6IFsnMzUnLCAnMzknXSwKCSAgY3lhbjogWyczNicsICczOSddLAoJICB3aGl0ZTogWyczNycsICczOSddLAoJICBicmlnaHRibGFjazogWyczMDsxJywgJzM5J10sCgkgIGJyaWdodHJlZDogWyczMTsxJywgJzM5J10sCgkgIGJyaWdodGdyZWVuOiBbJzMyOzEnLCAnMzknXSwKCSAgYnJpZ2h0eWVsbG93OiBbJzMzOzEnLCAnMzknXSwKCSAgYnJpZ2h0Ymx1ZTogWyczNDsxJywgJzM5J10sCgkgIGJyaWdodG1hZ2VudGE6IFsnMzU7MScsICczOSddLAoJICBicmlnaHRjeWFuOiBbJzM2OzEnLCAnMzknXSwKCSAgYnJpZ2h0d2hpdGU6IFsnMzc7MScsICczOSddLAoJICBncmV5OiBbJzkwJywgJzM5J10KCX07Cgl2YXIgc3R5bGVzID0gewoJICBzcGVjaWFsOiAnY3lhbicsCgkgIG51bWJlcjogJ3llbGxvdycsCgkgIGJvb2xlYW46ICd5ZWxsb3cnLAoJICB1bmRlZmluZWQ6ICdncmV5JywKCSAgbnVsbDogJ2JvbGQnLAoJICBzdHJpbmc6ICdncmVlbicsCgkgIHN5bWJvbDogJ2dyZWVuJywKCSAgZGF0ZTogJ21hZ2VudGEnLAoJICByZWdleHA6ICdyZWQnCgl9OwoJdmFyIHRydW5jYXRvciA9ICfigKYnOwoKCWZ1bmN0aW9uIGNvbG9yaXNlKHZhbHVlLCBzdHlsZVR5cGUpIHsKCSAgdmFyIGNvbG9yID0gYW5zaUNvbG9yc1tzdHlsZXNbc3R5bGVUeXBlXV0gfHwgYW5zaUNvbG9yc1tzdHlsZVR5cGVdOwoKCSAgaWYgKCFjb2xvcikgewoJICAgIHJldHVybiBTdHJpbmcodmFsdWUpOwoJICB9CgoJICByZXR1cm4gIlx4MUJbIi5jb25jYXQoY29sb3JbMF0sICJtIikuY29uY2F0KFN0cmluZyh2YWx1ZSksICJceDFCWyIpLmNvbmNhdChjb2xvclsxXSwgIm0iKTsKCX0KCglmdW5jdGlvbiBub3JtYWxpc2VPcHRpb25zKCkgewoJICB2YXIgX3JlZiA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge30sCgkgICAgICBfcmVmJHNob3dIaWRkZW4gPSBfcmVmLnNob3dIaWRkZW4sCgkgICAgICBzaG93SGlkZGVuID0gX3JlZiRzaG93SGlkZGVuID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWYkc2hvd0hpZGRlbiwKCSAgICAgIF9yZWYkZGVwdGggPSBfcmVmLmRlcHRoLAoJICAgICAgZGVwdGggPSBfcmVmJGRlcHRoID09PSB2b2lkIDAgPyAyIDogX3JlZiRkZXB0aCwKCSAgICAgIF9yZWYkY29sb3JzID0gX3JlZi5jb2xvcnMsCgkgICAgICBjb2xvcnMgPSBfcmVmJGNvbG9ycyA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmJGNvbG9ycywKCSAgICAgIF9yZWYkY3VzdG9tSW5zcGVjdCA9IF9yZWYuY3VzdG9tSW5zcGVjdCwKCSAgICAgIGN1c3RvbUluc3BlY3QgPSBfcmVmJGN1c3RvbUluc3BlY3QgPT09IHZvaWQgMCA/IHRydWUgOiBfcmVmJGN1c3RvbUluc3BlY3QsCgkgICAgICBfcmVmJHNob3dQcm94eSA9IF9yZWYuc2hvd1Byb3h5LAoJICAgICAgc2hvd1Byb3h5ID0gX3JlZiRzaG93UHJveHkgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZiRzaG93UHJveHksCgkgICAgICBfcmVmJG1heEFycmF5TGVuZ3RoID0gX3JlZi5tYXhBcnJheUxlbmd0aCwKCSAgICAgIG1heEFycmF5TGVuZ3RoID0gX3JlZiRtYXhBcnJheUxlbmd0aCA9PT0gdm9pZCAwID8gSW5maW5pdHkgOiBfcmVmJG1heEFycmF5TGVuZ3RoLAoJICAgICAgX3JlZiRicmVha0xlbmd0aCA9IF9yZWYuYnJlYWtMZW5ndGgsCgkgICAgICBicmVha0xlbmd0aCA9IF9yZWYkYnJlYWtMZW5ndGggPT09IHZvaWQgMCA/IEluZmluaXR5IDogX3JlZiRicmVha0xlbmd0aCwKCSAgICAgIF9yZWYkc2VlbiA9IF9yZWYuc2VlbiwKCSAgICAgIHNlZW4gPSBfcmVmJHNlZW4gPT09IHZvaWQgMCA/IFtdIDogX3JlZiRzZWVuLAoJICAgICAgX3JlZiR0cnVuY2F0ZSA9IF9yZWYudHJ1bmNhdGUsCgkgICAgICB0cnVuY2F0ZSA9IF9yZWYkdHJ1bmNhdGUgPT09IHZvaWQgMCA/IEluZmluaXR5IDogX3JlZiR0cnVuY2F0ZSwKCSAgICAgIF9yZWYkc3R5bGl6ZSA9IF9yZWYuc3R5bGl6ZSwKCSAgICAgIHN0eWxpemUgPSBfcmVmJHN0eWxpemUgPT09IHZvaWQgMCA/IFN0cmluZyA6IF9yZWYkc3R5bGl6ZTsKCgkgIHZhciBvcHRpb25zID0gewoJICAgIHNob3dIaWRkZW46IEJvb2xlYW4oc2hvd0hpZGRlbiksCgkgICAgZGVwdGg6IE51bWJlcihkZXB0aCksCgkgICAgY29sb3JzOiBCb29sZWFuKGNvbG9ycyksCgkgICAgY3VzdG9tSW5zcGVjdDogQm9vbGVhbihjdXN0b21JbnNwZWN0KSwKCSAgICBzaG93UHJveHk6IEJvb2xlYW4oc2hvd1Byb3h5KSwKCSAgICBtYXhBcnJheUxlbmd0aDogTnVtYmVyKG1heEFycmF5TGVuZ3RoKSwKCSAgICBicmVha0xlbmd0aDogTnVtYmVyKGJyZWFrTGVuZ3RoKSwKCSAgICB0cnVuY2F0ZTogTnVtYmVyKHRydW5jYXRlKSwKCSAgICBzZWVuOiBzZWVuLAoJICAgIHN0eWxpemU6IHN0eWxpemUKCSAgfTsKCgkgIGlmIChvcHRpb25zLmNvbG9ycykgewoJICAgIG9wdGlvbnMuc3R5bGl6ZSA9IGNvbG9yaXNlOwoJICB9CgoJICByZXR1cm4gb3B0aW9uczsKCX0KCWZ1bmN0aW9uIHRydW5jYXRlKHN0cmluZywgbGVuZ3RoKSB7CgkgIHZhciB0YWlsID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiB0cnVuY2F0b3I7CgkgIHN0cmluZyA9IFN0cmluZyhzdHJpbmcpOwoJICB2YXIgdGFpbExlbmd0aCA9IHRhaWwubGVuZ3RoOwoJICB2YXIgc3RyaW5nTGVuZ3RoID0gc3RyaW5nLmxlbmd0aDsKCgkgIGlmICh0YWlsTGVuZ3RoID4gbGVuZ3RoICYmIHN0cmluZ0xlbmd0aCA+IHRhaWxMZW5ndGgpIHsKCSAgICByZXR1cm4gdGFpbDsKCSAgfQoKCSAgaWYgKHN0cmluZ0xlbmd0aCA+IGxlbmd0aCAmJiBzdHJpbmdMZW5ndGggPiB0YWlsTGVuZ3RoKSB7CgkgICAgcmV0dXJuICIiLmNvbmNhdChzdHJpbmcuc2xpY2UoMCwgbGVuZ3RoIC0gdGFpbExlbmd0aCkpLmNvbmNhdCh0YWlsKTsKCSAgfQoKCSAgcmV0dXJuIHN0cmluZzsKCX0gLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbXBsZXhpdHkKCglmdW5jdGlvbiBpbnNwZWN0TGlzdChsaXN0LCBvcHRpb25zLCBpbnNwZWN0SXRlbSkgewoJICB2YXIgc2VwYXJhdG9yID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiAnLCAnOwoJICBpbnNwZWN0SXRlbSA9IGluc3BlY3RJdGVtIHx8IG9wdGlvbnMuaW5zcGVjdDsKCSAgdmFyIHNpemUgPSBsaXN0Lmxlbmd0aDsKCSAgaWYgKHNpemUgPT09IDApIHJldHVybiAnJzsKCSAgdmFyIG9yaWdpbmFsTGVuZ3RoID0gb3B0aW9ucy50cnVuY2F0ZTsKCSAgdmFyIG91dHB1dCA9ICcnOwoJICB2YXIgcGVlayA9ICcnOwoJICB2YXIgdHJ1bmNhdGVkID0gJyc7CgoJICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkgKz0gMSkgewoJICAgIHZhciBsYXN0ID0gaSArIDEgPT09IGxpc3QubGVuZ3RoOwoJICAgIHZhciBzZWNvbmRUb0xhc3QgPSBpICsgMiA9PT0gbGlzdC5sZW5ndGg7CgkgICAgdHJ1bmNhdGVkID0gIiIuY29uY2F0KHRydW5jYXRvciwgIigiKS5jb25jYXQobGlzdC5sZW5ndGggLSBpLCAiKSIpOwoJICAgIHZhciB2YWx1ZSA9IGxpc3RbaV07IC8vIElmIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUgcmVtYWluaW5nIHdlIG5lZWQgdG8gYWNjb3VudCBmb3IgYSBzZXBhcmF0b3Igb2YgYCwgYAoKCSAgICBvcHRpb25zLnRydW5jYXRlID0gb3JpZ2luYWxMZW5ndGggLSBvdXRwdXQubGVuZ3RoIC0gKGxhc3QgPyAwIDogc2VwYXJhdG9yLmxlbmd0aCk7CgkgICAgdmFyIHN0cmluZyA9IHBlZWsgfHwgaW5zcGVjdEl0ZW0odmFsdWUsIG9wdGlvbnMpICsgKGxhc3QgPyAnJyA6IHNlcGFyYXRvcik7CgkgICAgdmFyIG5leHRMZW5ndGggPSBvdXRwdXQubGVuZ3RoICsgc3RyaW5nLmxlbmd0aDsKCSAgICB2YXIgdHJ1bmNhdGVkTGVuZ3RoID0gbmV4dExlbmd0aCArIHRydW5jYXRlZC5sZW5ndGg7IC8vIElmIHRoaXMgaXMgdGhlIGxhc3QgZWxlbWVudCwgYW5kIGFkZGluZyBpdCB3b3VsZAoJICAgIC8vIHRha2UgdXMgb3ZlciBsZW5ndGgsIGJ1dCBhZGRpbmcgdGhlIHRydW5jYXRvciB3b3VsZG4ndCAtIHRoZW4gYnJlYWsgbm93CgoJICAgIGlmIChsYXN0ICYmIG5leHRMZW5ndGggPiBvcmlnaW5hbExlbmd0aCAmJiBvdXRwdXQubGVuZ3RoICsgdHJ1bmNhdGVkLmxlbmd0aCA8PSBvcmlnaW5hbExlbmd0aCkgewoJICAgICAgYnJlYWs7CgkgICAgfSAvLyBJZiB0aGlzIGlzbid0IHRoZSBsYXN0IG9yIHNlY29uZCB0byBsYXN0IGVsZW1lbnQgdG8gc2NhbiwKCSAgICAvLyBidXQgdGhlIHN0cmluZyBpcyBhbHJlYWR5IG92ZXIgbGVuZ3RoIHRoZW4gYnJlYWsgaGVyZQoKCgkgICAgaWYgKCFsYXN0ICYmICFzZWNvbmRUb0xhc3QgJiYgdHJ1bmNhdGVkTGVuZ3RoID4gb3JpZ2luYWxMZW5ndGgpIHsKCSAgICAgIGJyZWFrOwoJICAgIH0gLy8gUGVlayBhdCB0aGUgbmV4dCBzdHJpbmcgdG8gZGV0ZXJtaW5lIGlmIHdlIHNob3VsZAoJICAgIC8vIGJyZWFrIGVhcmx5IGJlZm9yZSBhZGRpbmcgdGhpcyBpdGVtIHRvIHRoZSBvdXRwdXQKCgoJICAgIHBlZWsgPSBsYXN0ID8gJycgOiBpbnNwZWN0SXRlbShsaXN0W2kgKyAxXSwgb3B0aW9ucykgKyAoc2Vjb25kVG9MYXN0ID8gJycgOiBzZXBhcmF0b3IpOyAvLyBJZiB3ZSBoYXZlIG9uZSBlbGVtZW50IGxlZnQsIGJ1dCB0aGlzIGVsZW1lbnQgYW5kCgkgICAgLy8gdGhlIG5leHQgdGFrZXMgb3ZlciBsZW5ndGgsIHRoZSBicmVhayBlYXJseQoKCSAgICBpZiAoIWxhc3QgJiYgc2Vjb25kVG9MYXN0ICYmIHRydW5jYXRlZExlbmd0aCA+IG9yaWdpbmFsTGVuZ3RoICYmIG5leHRMZW5ndGggKyBwZWVrLmxlbmd0aCA+IG9yaWdpbmFsTGVuZ3RoKSB7CgkgICAgICBicmVhazsKCSAgICB9CgoJICAgIG91dHB1dCArPSBzdHJpbmc7IC8vIElmIHRoZSBuZXh0IGVsZW1lbnQgdGFrZXMgdXMgdG8gbGVuZ3RoIC0KCSAgICAvLyBidXQgdGhlcmUgYXJlIG1vcmUgYWZ0ZXIgdGhhdCwgdGhlbiB3ZSBzaG91bGQgdHJ1bmNhdGUgbm93CgoJICAgIGlmICghbGFzdCAmJiAhc2Vjb25kVG9MYXN0ICYmIG5leHRMZW5ndGggKyBwZWVrLmxlbmd0aCA+PSBvcmlnaW5hbExlbmd0aCkgewoJICAgICAgdHJ1bmNhdGVkID0gIiIuY29uY2F0KHRydW5jYXRvciwgIigiKS5jb25jYXQobGlzdC5sZW5ndGggLSBpIC0gMSwgIikiKTsKCSAgICAgIGJyZWFrOwoJICAgIH0KCgkgICAgdHJ1bmNhdGVkID0gJyc7CgkgIH0KCgkgIHJldHVybiAiIi5jb25jYXQob3V0cHV0KS5jb25jYXQodHJ1bmNhdGVkKTsKCX0KCWZ1bmN0aW9uIGluc3BlY3RQcm9wZXJ0eShfcmVmMiwgb3B0aW9ucykgewoJICB2YXIgX3JlZjMgPSBfc2xpY2VkVG9BcnJheShfcmVmMiwgMiksCgkgICAgICBrZXkgPSBfcmVmM1swXSwKCSAgICAgIHZhbHVlID0gX3JlZjNbMV07CgoJICBvcHRpb25zLnRydW5jYXRlIC09IDI7CgoJICBpZiAodHlwZW9mIGtleSAhPT0gJ3N0cmluZycgJiYgdHlwZW9mIGtleSAhPT0gJ251bWJlcicpIHsKCSAgICBrZXkgPSAiWyIuY29uY2F0KG9wdGlvbnMuaW5zcGVjdChrZXksIG9wdGlvbnMpLCAiXSIpOwoJICB9CgoJICBvcHRpb25zLnRydW5jYXRlIC09IGtleS5sZW5ndGg7CgkgIHZhbHVlID0gb3B0aW9ucy5pbnNwZWN0KHZhbHVlLCBvcHRpb25zKTsKCSAgcmV0dXJuICIiLmNvbmNhdChrZXksICI6ICIpLmNvbmNhdCh2YWx1ZSk7Cgl9CgoJZnVuY3Rpb24gaW5zcGVjdEFycmF5KGFycmF5LCBvcHRpb25zKSB7CgkgIC8vIE9iamVjdC5rZXlzIHdpbGwgYWx3YXlzIG91dHB1dCB0aGUgQXJyYXkgaW5kaWNlcyBmaXJzdCwgc28gd2UgY2FuIHNsaWNlIGJ5CgkgIC8vIGBhcnJheS5sZW5ndGhgIHRvIGdldCBub24taW5kZXggcHJvcGVydGllcwoJICB2YXIgbm9uSW5kZXhQcm9wZXJ0aWVzID0gT2JqZWN0LmtleXMoYXJyYXkpLnNsaWNlKGFycmF5Lmxlbmd0aCk7CgkgIGlmICghYXJyYXkubGVuZ3RoICYmICFub25JbmRleFByb3BlcnRpZXMubGVuZ3RoKSByZXR1cm4gJ1tdJzsKCSAgb3B0aW9ucy50cnVuY2F0ZSAtPSA0OwoJICB2YXIgbGlzdENvbnRlbnRzID0gaW5zcGVjdExpc3QoYXJyYXksIG9wdGlvbnMpOwoJICBvcHRpb25zLnRydW5jYXRlIC09IGxpc3RDb250ZW50cy5sZW5ndGg7CgkgIHZhciBwcm9wZXJ0eUNvbnRlbnRzID0gJyc7CgoJICBpZiAobm9uSW5kZXhQcm9wZXJ0aWVzLmxlbmd0aCkgewoJICAgIHByb3BlcnR5Q29udGVudHMgPSBpbnNwZWN0TGlzdChub25JbmRleFByb3BlcnRpZXMubWFwKGZ1bmN0aW9uIChrZXkpIHsKCSAgICAgIHJldHVybiBba2V5LCBhcnJheVtrZXldXTsKCSAgICB9KSwgb3B0aW9ucywgaW5zcGVjdFByb3BlcnR5KTsKCSAgfQoKCSAgcmV0dXJuICJbICIuY29uY2F0KGxpc3RDb250ZW50cykuY29uY2F0KHByb3BlcnR5Q29udGVudHMgPyAiLCAiLmNvbmNhdChwcm9wZXJ0eUNvbnRlbnRzKSA6ICcnLCAiIF0iKTsKCX0KCgkvKiAhCgkgKiBDaGFpIC0gZ2V0RnVuY05hbWUgdXRpbGl0eQoJICogQ29weXJpZ2h0KGMpIDIwMTItMjAxNiBKYWtlIEx1ZXIgPGpha2VAYWxvZ2ljYWxwYXJhZG94LmNvbT4KCSAqIE1JVCBMaWNlbnNlZAoJICovCgoJLyoqCgkgKiAjIyMgLmdldEZ1bmNOYW1lKGNvbnN0cnVjdG9yRm4pCgkgKgoJICogUmV0dXJucyB0aGUgbmFtZSBvZiBhIGZ1bmN0aW9uLgoJICogV2hlbiBhIG5vbi1mdW5jdGlvbiBpbnN0YW5jZSBpcyBwYXNzZWQsIHJldHVybnMgYG51bGxgLgoJICogVGhpcyBhbHNvIGluY2x1ZGVzIGEgcG9seWZpbGwgZnVuY3Rpb24gaWYgYGFGdW5jLm5hbWVgIGlzIG5vdCBkZWZpbmVkLgoJICoKCSAqIEBuYW1lIGdldEZ1bmNOYW1lCgkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jdAoJICogQG5hbWVzcGFjZSBVdGlscwoJICogQGFwaSBwdWJsaWMKCSAqLwoKCXZhciB0b1N0cmluZyA9IEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZzsKCXZhciBmdW5jdGlvbk5hbWVNYXRjaCA9IC9ccypmdW5jdGlvbig/OlxzfFxzKlwvXCpbXig/OipcLyldK1wqXC9ccyopKihbXlxzXChcL10rKS87CglmdW5jdGlvbiBnZXRGdW5jTmFtZShhRnVuYykgewoJICBpZiAodHlwZW9mIGFGdW5jICE9PSAnZnVuY3Rpb24nKSB7CgkgICAgcmV0dXJuIG51bGw7CgkgIH0KCgkgIHZhciBuYW1lID0gJyc7CgkgIGlmICh0eXBlb2YgRnVuY3Rpb24ucHJvdG90eXBlLm5hbWUgPT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBhRnVuYy5uYW1lID09PSAndW5kZWZpbmVkJykgewoJICAgIC8vIEhlcmUgd2UgcnVuIGEgcG9seWZpbGwgaWYgRnVuY3Rpb24gZG9lcyBub3Qgc3VwcG9ydCB0aGUgYG5hbWVgIHByb3BlcnR5IGFuZCBpZiBhRnVuYy5uYW1lIGlzIG5vdCBkZWZpbmVkCgkgICAgdmFyIG1hdGNoID0gdG9TdHJpbmcuY2FsbChhRnVuYykubWF0Y2goZnVuY3Rpb25OYW1lTWF0Y2gpOwoJICAgIGlmIChtYXRjaCkgewoJICAgICAgbmFtZSA9IG1hdGNoWzFdOwoJICAgIH0KCSAgfSBlbHNlIHsKCSAgICAvLyBJZiB3ZSd2ZSBnb3QgYSBgbmFtZWAgcHJvcGVydHkgd2UganVzdCB1c2UgaXQKCSAgICBuYW1lID0gYUZ1bmMubmFtZTsKCSAgfQoKCSAgcmV0dXJuIG5hbWU7Cgl9CgoJdmFyIGdldEZ1bmNOYW1lXzEgPSBnZXRGdW5jTmFtZTsKCgl2YXIgdG9TdHJpbmdUYWcgPSB0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcgPyBTeW1ib2wudG9TdHJpbmdUYWcgOiBmYWxzZTsKCgl2YXIgZ2V0QXJyYXlOYW1lID0gZnVuY3Rpb24gZ2V0QXJyYXlOYW1lKGFycmF5KSB7CgkgIC8vIFdlIG5lZWQgdG8gc3BlY2lhbCBjYXNlIE5vZGUuanMnIEJ1ZmZlcnMsIHdoaWNoIHJlcG9ydCB0byBiZSBVaW50OEFycmF5CgkgIGlmICh0eXBlb2YgQnVmZmVyID09PSAnZnVuY3Rpb24nICYmIGFycmF5IGluc3RhbmNlb2YgQnVmZmVyKSB7CgkgICAgcmV0dXJuICdCdWZmZXInOwoJICB9CgoJICBpZiAodG9TdHJpbmdUYWcgJiYgdG9TdHJpbmdUYWcgaW4gYXJyYXkpIHsKCSAgICByZXR1cm4gYXJyYXlbdG9TdHJpbmdUYWddOwoJICB9CgoJICByZXR1cm4gZ2V0RnVuY05hbWVfMShhcnJheS5jb25zdHJ1Y3Rvcik7Cgl9OwoKCWZ1bmN0aW9uIGluc3BlY3RUeXBlZEFycmF5KGFycmF5LCBvcHRpb25zKSB7CgkgIHZhciBuYW1lID0gZ2V0QXJyYXlOYW1lKGFycmF5KTsKCSAgb3B0aW9ucy50cnVuY2F0ZSAtPSBuYW1lLmxlbmd0aCArIDQ7IC8vIE9iamVjdC5rZXlzIHdpbGwgYWx3YXlzIG91dHB1dCB0aGUgQXJyYXkgaW5kaWNlcyBmaXJzdCwgc28gd2UgY2FuIHNsaWNlIGJ5CgkgIC8vIGBhcnJheS5sZW5ndGhgIHRvIGdldCBub24taW5kZXggcHJvcGVydGllcwoKCSAgdmFyIG5vbkluZGV4UHJvcGVydGllcyA9IE9iamVjdC5rZXlzKGFycmF5KS5zbGljZShhcnJheS5sZW5ndGgpOwoJICBpZiAoIWFycmF5Lmxlbmd0aCAmJiAhbm9uSW5kZXhQcm9wZXJ0aWVzLmxlbmd0aCkgcmV0dXJuICIiLmNvbmNhdChuYW1lLCAiW10iKTsgLy8gQXMgd2Uga25vdyBUeXBlZEFycmF5cyBvbmx5IGNvbnRhaW4gVW5zaWduZWQgSW50ZWdlcnMsIHdlIGNhbiBza2lwIGluc3BlY3RpbmcgZWFjaCBvbmUgYW5kIHNpbXBseQoJICAvLyBzdHlsaXNlIHRoZSB0b1N0cmluZygpIHZhbHVlIG9mIHRoZW0KCgkgIHZhciBvdXRwdXQgPSAnJzsKCgkgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHsKCSAgICB2YXIgc3RyaW5nID0gIiIuY29uY2F0KG9wdGlvbnMuc3R5bGl6ZSh0cnVuY2F0ZShhcnJheVtpXSwgb3B0aW9ucy50cnVuY2F0ZSksICdudW1iZXInKSkuY29uY2F0KGFycmF5W2ldID09PSBhcnJheS5sZW5ndGggPyAnJyA6ICcsICcpOwoJICAgIG9wdGlvbnMudHJ1bmNhdGUgLT0gc3RyaW5nLmxlbmd0aDsKCgkgICAgaWYgKGFycmF5W2ldICE9PSBhcnJheS5sZW5ndGggJiYgb3B0aW9ucy50cnVuY2F0ZSA8PSAzKSB7CgkgICAgICBvdXRwdXQgKz0gIiIuY29uY2F0KHRydW5jYXRvciwgIigiKS5jb25jYXQoYXJyYXkubGVuZ3RoIC0gYXJyYXlbaV0gKyAxLCAiKSIpOwoJICAgICAgYnJlYWs7CgkgICAgfQoKCSAgICBvdXRwdXQgKz0gc3RyaW5nOwoJICB9CgoJICB2YXIgcHJvcGVydHlDb250ZW50cyA9ICcnOwoKCSAgaWYgKG5vbkluZGV4UHJvcGVydGllcy5sZW5ndGgpIHsKCSAgICBwcm9wZXJ0eUNvbnRlbnRzID0gaW5zcGVjdExpc3Qobm9uSW5kZXhQcm9wZXJ0aWVzLm1hcChmdW5jdGlvbiAoa2V5KSB7CgkgICAgICByZXR1cm4gW2tleSwgYXJyYXlba2V5XV07CgkgICAgfSksIG9wdGlvbnMsIGluc3BlY3RQcm9wZXJ0eSk7CgkgIH0KCgkgIHJldHVybiAiIi5jb25jYXQobmFtZSwgIlsgIikuY29uY2F0KG91dHB1dCkuY29uY2F0KHByb3BlcnR5Q29udGVudHMgPyAiLCAiLmNvbmNhdChwcm9wZXJ0eUNvbnRlbnRzKSA6ICcnLCAiIF0iKTsKCX0KCglmdW5jdGlvbiBpbnNwZWN0RGF0ZShkYXRlT2JqZWN0LCBvcHRpb25zKSB7CgkgIC8vIElmIHdlIG5lZWQgdG8gLSB0cnVuY2F0ZSB0aGUgdGltZSBwb3J0aW9uLCBidXQgbmV2ZXIgdGhlIGRhdGUKCSAgdmFyIHNwbGl0ID0gZGF0ZU9iamVjdC50b0pTT04oKS5zcGxpdCgnVCcpOwoJICB2YXIgZGF0ZSA9IHNwbGl0WzBdOwoJICByZXR1cm4gb3B0aW9ucy5zdHlsaXplKCIiLmNvbmNhdChkYXRlLCAiVCIpLmNvbmNhdCh0cnVuY2F0ZShzcGxpdFsxXSwgb3B0aW9ucy50cnVuY2F0ZSAtIGRhdGUubGVuZ3RoIC0gMSkpLCAnZGF0ZScpOwoJfQoKCXZhciB0b1N0cmluZyQxID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsKCgl2YXIgZ2V0RnVuY3Rpb25OYW1lID0gZnVuY3Rpb24oZm4pIHsKCSAgaWYgKHRvU3RyaW5nJDEuY2FsbChmbikgIT09ICdbb2JqZWN0IEZ1bmN0aW9uXScpIHJldHVybiBudWxsCgkgIGlmIChmbi5uYW1lKSByZXR1cm4gZm4ubmFtZQoJICB2YXIgbmFtZSA9IC9eXHMqZnVuY3Rpb25ccyooW15cKF0qKS9pbS5leGVjKGZuLnRvU3RyaW5nKCkpWzFdOwoJICByZXR1cm4gbmFtZSB8fCAnYW5vbnltb3VzJwoJfTsKCglmdW5jdGlvbiBpbnNwZWN0RnVuY3Rpb24oZnVuYywgb3B0aW9ucykgewoJICB2YXIgbmFtZSA9IGdldEZ1bmN0aW9uTmFtZShmdW5jKTsKCgkgIGlmIChuYW1lID09PSAnYW5vbnltb3VzJykgewoJICAgIHJldHVybiBvcHRpb25zLnN0eWxpemUoJ1tGdW5jdGlvbl0nLCAnc3BlY2lhbCcpOwoJICB9CgoJICByZXR1cm4gb3B0aW9ucy5zdHlsaXplKCJbRnVuY3Rpb24gIi5jb25jYXQodHJ1bmNhdGUobmFtZSwgb3B0aW9ucy50cnVuY2F0ZSAtIDExKSwgIl0iKSwgJ3NwZWNpYWwnKTsKCX0KCglmdW5jdGlvbiBpbnNwZWN0TWFwRW50cnkoX3JlZiwgb3B0aW9ucykgewoJICB2YXIgX3JlZjIgPSBfc2xpY2VkVG9BcnJheShfcmVmLCAyKSwKCSAgICAgIGtleSA9IF9yZWYyWzBdLAoJICAgICAgdmFsdWUgPSBfcmVmMlsxXTsKCgkgIG9wdGlvbnMudHJ1bmNhdGUgLT0gNDsKCSAga2V5ID0gb3B0aW9ucy5pbnNwZWN0KGtleSwgb3B0aW9ucyk7CgkgIG9wdGlvbnMudHJ1bmNhdGUgLT0ga2V5Lmxlbmd0aDsKCSAgdmFsdWUgPSBvcHRpb25zLmluc3BlY3QodmFsdWUsIG9wdGlvbnMpOwoJICByZXR1cm4gIiIuY29uY2F0KGtleSwgIiA9PiAiKS5jb25jYXQodmFsdWUpOwoJfSAvLyBJRTExIGRvZXNuJ3Qgc3VwcG9ydCBgbWFwLmVudHJpZXMoKWAKCgoJZnVuY3Rpb24gbWFwVG9FbnRyaWVzKG1hcCkgewoJICB2YXIgZW50cmllcyA9IFtdOwoJICBtYXAuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUsIGtleSkgewoJICAgIGVudHJpZXMucHVzaChba2V5LCB2YWx1ZV0pOwoJICB9KTsKCSAgcmV0dXJuIGVudHJpZXM7Cgl9CgoJZnVuY3Rpb24gaW5zcGVjdE1hcChtYXAsIG9wdGlvbnMpIHsKCSAgdmFyIHNpemUgPSBtYXAuc2l6ZSAtIDE7CgoJICBpZiAoc2l6ZSA8PSAwKSB7CgkgICAgcmV0dXJuICdNYXB7fSc7CgkgIH0KCgkgIG9wdGlvbnMudHJ1bmNhdGUgLT0gNzsKCSAgcmV0dXJuICJNYXB7ICIuY29uY2F0KGluc3BlY3RMaXN0KG1hcFRvRW50cmllcyhtYXApLCBvcHRpb25zLCBpbnNwZWN0TWFwRW50cnkpLCAiIH0iKTsKCX0KCgl2YXIgaXNOYU4gPSBOdW1iZXIuaXNOYU4gfHwgZnVuY3Rpb24gKGkpIHsKCSAgcmV0dXJuIGkgIT09IGk7Cgl9OyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXNlbGYtY29tcGFyZQoKCglmdW5jdGlvbiBpbnNwZWN0TnVtYmVyKG51bWJlciwgb3B0aW9ucykgewoJICBpZiAoaXNOYU4obnVtYmVyKSkgewoJICAgIHJldHVybiBvcHRpb25zLnN0eWxpemUoJ05hTicsICdudW1iZXInKTsKCSAgfQoKCSAgaWYgKG51bWJlciA9PT0gSW5maW5pdHkpIHsKCSAgICByZXR1cm4gb3B0aW9ucy5zdHlsaXplKCdJbmZpbml0eScsICdudW1iZXInKTsKCSAgfQoKCSAgaWYgKG51bWJlciA9PT0gLUluZmluaXR5KSB7CgkgICAgcmV0dXJuIG9wdGlvbnMuc3R5bGl6ZSgnLUluZmluaXR5JywgJ251bWJlcicpOwoJICB9CgoJICBpZiAobnVtYmVyID09PSAwKSB7CgkgICAgcmV0dXJuIG9wdGlvbnMuc3R5bGl6ZSgxIC8gbnVtYmVyID09PSBJbmZpbml0eSA/ICcrMCcgOiAnLTAnLCAnbnVtYmVyJyk7CgkgIH0KCgkgIHJldHVybiBvcHRpb25zLnN0eWxpemUodHJ1bmNhdGUobnVtYmVyLCBvcHRpb25zLnRydW5jYXRlKSwgJ251bWJlcicpOwoJfQoKCWZ1bmN0aW9uIGluc3BlY3RSZWdFeHAodmFsdWUsIG9wdGlvbnMpIHsKCSAgdmFyIGZsYWdzID0gdmFsdWUudG9TdHJpbmcoKS5zcGxpdCgnLycpWzJdOwoJICB2YXIgc291cmNlTGVuZ3RoID0gb3B0aW9ucy50cnVuY2F0ZSAtICgyICsgZmxhZ3MubGVuZ3RoKTsKCSAgdmFyIHNvdXJjZSA9IHZhbHVlLnNvdXJjZTsKCSAgcmV0dXJuIG9wdGlvbnMuc3R5bGl6ZSgiLyIuY29uY2F0KHRydW5jYXRlKHNvdXJjZSwgc291cmNlTGVuZ3RoKSwgIi8iKS5jb25jYXQoZmxhZ3MpLCAncmVnZXhwJyk7Cgl9CgoJZnVuY3Rpb24gYXJyYXlGcm9tU2V0KHNldCkgewoJICB2YXIgdmFsdWVzID0gW107CgkgIHNldC5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkgewoJICAgIHZhbHVlcy5wdXNoKHZhbHVlKTsKCSAgfSk7CgkgIHJldHVybiB2YWx1ZXM7Cgl9CgoJZnVuY3Rpb24gaW5zcGVjdFNldChzZXQsIG9wdGlvbnMpIHsKCSAgaWYgKHNldC5zaXplID09PSAwKSByZXR1cm4gJ1NldHt9JzsKCSAgb3B0aW9ucy50cnVuY2F0ZSAtPSA3OwoJICByZXR1cm4gIlNldHsgIi5jb25jYXQoaW5zcGVjdExpc3QoYXJyYXlGcm9tU2V0KHNldCksIG9wdGlvbnMpLCAiIH0iKTsKCX0KCgl2YXIgc3RyaW5nRXNjYXBlQ2hhcnMgPSBuZXcgUmVnRXhwKCJbJ1xcdTAwMDAtXFx1MDAxZlxcdTAwN2YtXFx1MDA5ZlxcdTAwYWRcXHUwNjAwLVxcdTA2MDRcXHUwNzBmXFx1MTdiNFxcdTE3YjUiICsgIlxcdTIwMGMtXFx1MjAwZlxcdTIwMjgtXFx1MjAyZlxcdTIwNjAtXFx1MjA2ZlxcdWZlZmZcXHVmZmYwLVxcdWZmZmZdIiwgJ2cnKTsKCXZhciBlc2NhcGVDaGFyYWN0ZXJzID0gewoJICAnXGInOiAnXFxiJywKCSAgJ1x0JzogJ1xcdCcsCgkgICdcbic6ICdcXG4nLAoJICAnXGYnOiAnXFxmJywKCSAgJ1xyJzogJ1xccicsCgkgICInIjogIlxcJyIsCgkgICdcXCc6ICdcXFxcJwoJfTsKCXZhciBoZXggPSAxNjsKCXZhciB1bmljb2RlTGVuZ3RoID0gNDsKCglmdW5jdGlvbiBlc2NhcGUoY2hhcikgewoJICByZXR1cm4gZXNjYXBlQ2hhcmFjdGVyc1tjaGFyXSB8fCAiXFx1Ii5jb25jYXQoIjAwMDAiLmNvbmNhdChjaGFyLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoaGV4KSkuc2xpY2UoLXVuaWNvZGVMZW5ndGgpKTsKCX0KCglmdW5jdGlvbiBpbnNwZWN0U3RyaW5nKHN0cmluZywgb3B0aW9ucykgewoJICBpZiAoc3RyaW5nRXNjYXBlQ2hhcnMudGVzdChzdHJpbmcpKSB7CgkgICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2Uoc3RyaW5nRXNjYXBlQ2hhcnMsIGVzY2FwZSk7CgkgIH0KCgkgIHJldHVybiBvcHRpb25zLnN0eWxpemUoIiciLmNvbmNhdCh0cnVuY2F0ZShzdHJpbmcsIG9wdGlvbnMudHJ1bmNhdGUgLSAyKSwgIiciKSwgJ3N0cmluZycpOwoJfQoKCWZ1bmN0aW9uIGluc3BlY3RTeW1ib2wodmFsdWUpIHsKCSAgaWYgKCdkZXNjcmlwdGlvbicgaW4gU3ltYm9sLnByb3RvdHlwZSkgewoJICAgIHJldHVybiAiU3ltYm9sKCIuY29uY2F0KHZhbHVlLmRlc2NyaXB0aW9uLCAiKSIpOwoJICB9CgoJICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKTsKCX0KCgl2YXIgZ2V0UHJvbWlzZVZhbHVlID0gZnVuY3Rpb24gZ2V0UHJvbWlzZVZhbHVlKCkgewoJICByZXR1cm4gJ1Byb21pc2V74oCmfSc7Cgl9OwoKCXRyeSB7CgkgIHZhciBfcHJvY2VzcyRiaW5kaW5nID0gcHJvY2Vzcy5iaW5kaW5nKCd1dGlsJyksCgkgICAgICBnZXRQcm9taXNlRGV0YWlscyA9IF9wcm9jZXNzJGJpbmRpbmcuZ2V0UHJvbWlzZURldGFpbHMsCgkgICAgICBrUGVuZGluZyA9IF9wcm9jZXNzJGJpbmRpbmcua1BlbmRpbmcsCgkgICAgICBrUmVqZWN0ZWQgPSBfcHJvY2VzcyRiaW5kaW5nLmtSZWplY3RlZDsKCgkgIGdldFByb21pc2VWYWx1ZSA9IGZ1bmN0aW9uIGdldFByb21pc2VWYWx1ZSh2YWx1ZSwgb3B0aW9ucykgewoJICAgIHZhciBfZ2V0UHJvbWlzZURldGFpbHMgPSBnZXRQcm9taXNlRGV0YWlscyh2YWx1ZSksCgkgICAgICAgIF9nZXRQcm9taXNlRGV0YWlsczIgPSBfc2xpY2VkVG9BcnJheShfZ2V0UHJvbWlzZURldGFpbHMsIDIpLAoJICAgICAgICBzdGF0ZSA9IF9nZXRQcm9taXNlRGV0YWlsczJbMF0sCgkgICAgICAgIGlubmVyVmFsdWUgPSBfZ2V0UHJvbWlzZURldGFpbHMyWzFdOwoKCSAgICBpZiAoc3RhdGUgPT09IGtQZW5kaW5nKSB7CgkgICAgICByZXR1cm4gJ1Byb21pc2V7PHBlbmRpbmc+fSc7CgkgICAgfQoKCSAgICByZXR1cm4gIlByb21pc2UiLmNvbmNhdChzdGF0ZSA9PT0ga1JlamVjdGVkID8gJyEnIDogJycsICJ7IikuY29uY2F0KG9wdGlvbnMuaW5zcGVjdChpbm5lclZhbHVlLCBvcHRpb25zKSwgIn0iKTsKCSAgfTsKCX0gY2F0Y2ggKG5vdE5vZGUpIHsKCSAgLyogaWdub3JlICovCgl9CgoJdmFyIGluc3BlY3RQcm9taXNlID0gZ2V0UHJvbWlzZVZhbHVlOwoKCWZ1bmN0aW9uIGluc3BlY3RPYmplY3Qob2JqZWN0LCBvcHRpb25zKSB7CgkgIHZhciBwcm9wZXJ0aWVzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMob2JqZWN0KTsKCSAgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzID8gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpIDogW107CgoJICBpZiAocHJvcGVydGllcy5sZW5ndGggPT09IDAgJiYgc3ltYm9scy5sZW5ndGggPT09IDApIHsKCSAgICByZXR1cm4gJ3t9JzsKCSAgfQoKCSAgb3B0aW9ucy50cnVuY2F0ZSAtPSA0OwoJICB2YXIgcHJvcGVydHlDb250ZW50cyA9IGluc3BlY3RMaXN0KHByb3BlcnRpZXMubWFwKGZ1bmN0aW9uIChrZXkpIHsKCSAgICByZXR1cm4gW2tleSwgb2JqZWN0W2tleV1dOwoJICB9KSwgb3B0aW9ucywgaW5zcGVjdFByb3BlcnR5KTsKCSAgdmFyIHN5bWJvbENvbnRlbnRzID0gaW5zcGVjdExpc3Qoc3ltYm9scy5tYXAoZnVuY3Rpb24gKGtleSkgewoJICAgIHJldHVybiBba2V5LCBvYmplY3Rba2V5XV07CgkgIH0pLCBvcHRpb25zLCBpbnNwZWN0UHJvcGVydHkpOwoJICB2YXIgc2VwID0gJyc7CgoJICBpZiAocHJvcGVydHlDb250ZW50cyAmJiBzeW1ib2xDb250ZW50cykgewoJICAgIHNlcCA9ICcsICc7CgkgIH0KCgkgIHJldHVybiAieyAiLmNvbmNhdChwcm9wZXJ0eUNvbnRlbnRzKS5jb25jYXQoc2VwKS5jb25jYXQoc3ltYm9sQ29udGVudHMsICIgfSIpOwoJfQoKCXZhciB0b1N0cmluZ1RhZyQxID0gdHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnID8gU3ltYm9sLnRvU3RyaW5nVGFnIDogZmFsc2U7CglmdW5jdGlvbiBpbnNwZWN0Q2xhc3ModmFsdWUsIG9wdGlvbnMpIHsKCSAgdmFyIG5hbWUgPSAnJzsKCgkgIGlmICh0b1N0cmluZ1RhZyQxICYmIHRvU3RyaW5nVGFnJDEgaW4gdmFsdWUpIHsKCSAgICBuYW1lID0gdmFsdWVbdG9TdHJpbmdUYWckMV07CgkgIH0KCgkgIG5hbWUgPSBuYW1lIHx8IGdldEZ1bmNOYW1lXzEodmFsdWUuY29uc3RydWN0b3IpOyAvLyBCYWJlbCB0cmFuc2Zvcm1zIGFub255bW91cyBjbGFzc2VzIHRvIHRoZSBuYW1lIGBfY2xhc3NgCgoJICBpZiAoIW5hbWUgfHwgbmFtZSA9PT0gJ19jbGFzcycpIHsKCSAgICBuYW1lID0gJzxBbm9ueW1vdXMgQ2xhc3M+JzsKCSAgfQoKCSAgb3B0aW9ucy50cnVuY2F0ZSAtPSBuYW1lLmxlbmd0aDsKCSAgcmV0dXJuICIiLmNvbmNhdChuYW1lKS5jb25jYXQoaW5zcGVjdE9iamVjdCh2YWx1ZSwgb3B0aW9ucykpOwoJfQoKCWZ1bmN0aW9uIGluc3BlY3RBcmd1bWVudHMoYXJncywgb3B0aW9ucykgewoJICBpZiAoYXJncy5sZW5ndGggPT09IDApIHJldHVybiAnQXJndW1lbnRzW10nOwoJICBvcHRpb25zLnRydW5jYXRlIC09IDEzOwoJICByZXR1cm4gIkFyZ3VtZW50c1sgIi5jb25jYXQoaW5zcGVjdExpc3QoYXJncywgb3B0aW9ucyksICIgXSIpOwoJfQoKCXZhciBlcnJvcktleXMgPSBbJ3N0YWNrJywgJ2xpbmUnLCAnY29sdW1uJywgJ25hbWUnLCAnbWVzc2FnZScsICdmaWxlTmFtZScsICdsaW5lTnVtYmVyJywgJ2NvbHVtbk51bWJlcicsICdudW1iZXInLCAnZGVzY3JpcHRpb24nXTsKCWZ1bmN0aW9uIGluc3BlY3RPYmplY3QkMShlcnJvciwgb3B0aW9ucykgewoJICB2YXIgcHJvcGVydGllcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGVycm9yKS5maWx0ZXIoZnVuY3Rpb24gKGtleSkgewoJICAgIHJldHVybiBlcnJvcktleXMuaW5kZXhPZihrZXkpID09PSAtMTsKCSAgfSk7CgkgIHZhciBuYW1lID0gZXJyb3IubmFtZTsKCSAgb3B0aW9ucy50cnVuY2F0ZSAtPSBuYW1lLmxlbmd0aDsKCSAgdmFyIG1lc3NhZ2UgPSAnJzsKCgkgIGlmICh0eXBlb2YgZXJyb3IubWVzc2FnZSA9PT0gJ3N0cmluZycpIHsKCSAgICBtZXNzYWdlID0gdHJ1bmNhdGUoZXJyb3IubWVzc2FnZSwgb3B0aW9ucy50cnVuY2F0ZSk7CgkgIH0gZWxzZSB7CgkgICAgcHJvcGVydGllcy51bnNoaWZ0KCdtZXNzYWdlJyk7CgkgIH0KCgkgIG1lc3NhZ2UgPSBtZXNzYWdlID8gIjogIi5jb25jYXQobWVzc2FnZSkgOiAnJzsKCSAgb3B0aW9ucy50cnVuY2F0ZSAtPSBtZXNzYWdlLmxlbmd0aCArIDU7CgkgIHZhciBwcm9wZXJ0eUNvbnRlbnRzID0gaW5zcGVjdExpc3QocHJvcGVydGllcy5tYXAoZnVuY3Rpb24gKGtleSkgewoJICAgIHJldHVybiBba2V5LCBlcnJvcltrZXldXTsKCSAgfSksIG9wdGlvbnMsIGluc3BlY3RQcm9wZXJ0eSk7CgkgIHJldHVybiAiIi5jb25jYXQobmFtZSkuY29uY2F0KG1lc3NhZ2UpLmNvbmNhdChwcm9wZXJ0eUNvbnRlbnRzID8gIiB7ICIuY29uY2F0KHByb3BlcnR5Q29udGVudHMsICIgfSIpIDogJycpOwoJfQoKCWZ1bmN0aW9uIGluc3BlY3RBdHRyaWJ1dGUoX3JlZiwgb3B0aW9ucykgewoJICB2YXIgX3JlZjIgPSBfc2xpY2VkVG9BcnJheShfcmVmLCAyKSwKCSAgICAgIGtleSA9IF9yZWYyWzBdLAoJICAgICAgdmFsdWUgPSBfcmVmMlsxXTsKCgkgIG9wdGlvbnMudHJ1bmNhdGUgLT0gMzsKCgkgIGlmICghdmFsdWUpIHsKCSAgICByZXR1cm4gIiIuY29uY2F0KG9wdGlvbnMuc3R5bGl6ZShrZXksICd5ZWxsb3cnKSk7CgkgIH0KCgkgIHJldHVybiAiIi5jb25jYXQob3B0aW9ucy5zdHlsaXplKGtleSwgJ3llbGxvdycpLCAiPSIpLmNvbmNhdChvcHRpb25zLnN0eWxpemUoIlwiIi5jb25jYXQodmFsdWUsICJcIiIpLCAnc3RyaW5nJykpOwoJfQoJZnVuY3Rpb24gaW5zcGVjdEhUTUxDb2xsZWN0aW9uKGNvbGxlY3Rpb24sIG9wdGlvbnMpIHsKCSAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVzZS1iZWZvcmUtZGVmaW5lCgkgIHJldHVybiBpbnNwZWN0TGlzdChjb2xsZWN0aW9uLCBvcHRpb25zLCBpbnNwZWN0SFRNTCwgJ1xuJyk7Cgl9CglmdW5jdGlvbiBpbnNwZWN0SFRNTChlbGVtZW50LCBvcHRpb25zKSB7CgkgIHZhciBwcm9wZXJ0aWVzID0gZWxlbWVudC5nZXRBdHRyaWJ1dGVOYW1lcygpOwoJICB2YXIgbmFtZSA9IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpOwoJICB2YXIgaGVhZCA9IG9wdGlvbnMuc3R5bGl6ZSgiPCIuY29uY2F0KG5hbWUpLCAnc3BlY2lhbCcpOwoJICB2YXIgaGVhZENsb3NlID0gb3B0aW9ucy5zdHlsaXplKCI+IiwgJ3NwZWNpYWwnKTsKCSAgdmFyIHRhaWwgPSBvcHRpb25zLnN0eWxpemUoIjwvIi5jb25jYXQobmFtZSwgIj4iKSwgJ3NwZWNpYWwnKTsKCSAgb3B0aW9ucy50cnVuY2F0ZSAtPSBuYW1lLmxlbmd0aCAqIDIgKyA1OwoJICB2YXIgcHJvcGVydHlDb250ZW50cyA9ICcnOwoKCSAgaWYgKHByb3BlcnRpZXMubGVuZ3RoID4gMCkgewoJICAgIHByb3BlcnR5Q29udGVudHMgKz0gJyAnOwoJICAgIHByb3BlcnR5Q29udGVudHMgKz0gaW5zcGVjdExpc3QocHJvcGVydGllcy5tYXAoZnVuY3Rpb24gKGtleSkgewoJICAgICAgcmV0dXJuIFtrZXksIGVsZW1lbnQuZ2V0QXR0cmlidXRlKGtleSldOwoJICAgIH0pLCBvcHRpb25zLCBpbnNwZWN0QXR0cmlidXRlLCAnICcpOwoJICB9CgoJICBvcHRpb25zLnRydW5jYXRlIC09IHByb3BlcnR5Q29udGVudHMubGVuZ3RoOwoJICB2YXIgdHJ1bmNhdGUgPSBvcHRpb25zLnRydW5jYXRlOwoJICB2YXIgY2hpbGRyZW4gPSBpbnNwZWN0SFRNTENvbGxlY3Rpb24oZWxlbWVudC5jaGlsZHJlbiwgb3B0aW9ucyk7CgoJICBpZiAoY2hpbGRyZW4gJiYgY2hpbGRyZW4ubGVuZ3RoID4gdHJ1bmNhdGUpIHsKCSAgICBjaGlsZHJlbiA9ICIiLmNvbmNhdCh0cnVuY2F0b3IsICIoIikuY29uY2F0KGVsZW1lbnQuY2hpbGRyZW4ubGVuZ3RoLCAiKSIpOwoJICB9CgoJICByZXR1cm4gIiIuY29uY2F0KGhlYWQpLmNvbmNhdChwcm9wZXJ0eUNvbnRlbnRzKS5jb25jYXQoaGVhZENsb3NlKS5jb25jYXQoY2hpbGRyZW4pLmNvbmNhdCh0YWlsKTsKCX0KCgkvKiAhCgkgKiBsb3VwZQoJICogQ29weXJpZ2h0KGMpIDIwMTMgSmFrZSBMdWVyIDxqYWtlQGFsb2dpY2FscGFyYWRveC5jb20+CgkgKiBNSVQgTGljZW5zZWQKCSAqLwoJdmFyIHN5bWJvbHNTdXBwb3J0ZWQgPSB0eXBlb2YgU3ltYm9sID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZiBTeW1ib2wuZm9yID09PSAnZnVuY3Rpb24nOwoJdmFyIGNoYWlJbnNwZWN0ID0gc3ltYm9sc1N1cHBvcnRlZCA/IFN5bWJvbC5mb3IoJ2NoYWkvaW5zcGVjdCcpIDogJ0BAY2hhaS9pbnNwZWN0JzsKCXZhciBub2RlSW5zcGVjdCA9IGZhbHNlOwoKCXRyeSB7CgkgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBnbG9iYWwtcmVxdWlyZQoJICBub2RlSW5zcGVjdCA9IHJlcXVpcmUoJ3V0aWwnKS5pbnNwZWN0LmN1c3RvbTsKCX0gY2F0Y2ggKG5vTm9kZUluc3BlY3QpIHsKCSAgbm9kZUluc3BlY3QgPSBmYWxzZTsKCX0KCgl2YXIgY29uc3RydWN0b3JNYXAgPSBuZXcgV2Vha01hcCgpOwoJdmFyIHN0cmluZ1RhZ01hcCA9IHt9OwoJdmFyIGJhc2VUeXBlc01hcCA9IHsKCSAgdW5kZWZpbmVkOiBmdW5jdGlvbiB1bmRlZmluZWQkMSh2YWx1ZSwgb3B0aW9ucykgewoJICAgIHJldHVybiBvcHRpb25zLnN0eWxpemUoJ3VuZGVmaW5lZCcsICd1bmRlZmluZWQnKTsKCSAgfSwKCSAgbnVsbDogZnVuY3Rpb24gX251bGwodmFsdWUsIG9wdGlvbnMpIHsKCSAgICByZXR1cm4gb3B0aW9ucy5zdHlsaXplKG51bGwsICdudWxsJyk7CgkgIH0sCgkgIGJvb2xlYW46IGZ1bmN0aW9uIGJvb2xlYW4odmFsdWUsIG9wdGlvbnMpIHsKCSAgICByZXR1cm4gb3B0aW9ucy5zdHlsaXplKHZhbHVlLCAnYm9vbGVhbicpOwoJICB9LAoJICBCb29sZWFuOiBmdW5jdGlvbiBCb29sZWFuKHZhbHVlLCBvcHRpb25zKSB7CgkgICAgcmV0dXJuIG9wdGlvbnMuc3R5bGl6ZSh2YWx1ZSwgJ2Jvb2xlYW4nKTsKCSAgfSwKCSAgbnVtYmVyOiBpbnNwZWN0TnVtYmVyLAoJICBOdW1iZXI6IGluc3BlY3ROdW1iZXIsCgkgIHN0cmluZzogaW5zcGVjdFN0cmluZywKCSAgU3RyaW5nOiBpbnNwZWN0U3RyaW5nLAoJICBmdW5jdGlvbjogaW5zcGVjdEZ1bmN0aW9uLAoJICBGdW5jdGlvbjogaW5zcGVjdEZ1bmN0aW9uLAoJICBzeW1ib2w6IGluc3BlY3RTeW1ib2wsCgkgIC8vIEEgU3ltYm9sIHBvbHlmaWxsIHdpbGwgcmV0dXJuIGBTeW1ib2xgIG5vdCBgc3ltYm9sYCBmcm9tIHR5cGVkZXRlY3QKCSAgU3ltYm9sOiBpbnNwZWN0U3ltYm9sLAoJICBBcnJheTogaW5zcGVjdEFycmF5LAoJICBEYXRlOiBpbnNwZWN0RGF0ZSwKCSAgTWFwOiBpbnNwZWN0TWFwLAoJICBTZXQ6IGluc3BlY3RTZXQsCgkgIFJlZ0V4cDogaW5zcGVjdFJlZ0V4cCwKCSAgUHJvbWlzZTogaW5zcGVjdFByb21pc2UsCgkgIC8vIFdlYWtTZXQsIFdlYWtNYXAgYXJlIHRvdGFsbHkgb3BhcXVlIHRvIHVzCgkgIFdlYWtTZXQ6IGZ1bmN0aW9uIFdlYWtTZXQodmFsdWUsIG9wdGlvbnMpIHsKCSAgICByZXR1cm4gb3B0aW9ucy5zdHlsaXplKCdXZWFrU2V0e+KApn0nLCAnc3BlY2lhbCcpOwoJICB9LAoJICBXZWFrTWFwOiBmdW5jdGlvbiBXZWFrTWFwKHZhbHVlLCBvcHRpb25zKSB7CgkgICAgcmV0dXJuIG9wdGlvbnMuc3R5bGl6ZSgnV2Vha01hcHvigKZ9JywgJ3NwZWNpYWwnKTsKCSAgfSwKCSAgQXJndW1lbnRzOiBpbnNwZWN0QXJndW1lbnRzLAoJICBJbnQ4QXJyYXk6IGluc3BlY3RUeXBlZEFycmF5LAoJICBVaW50OEFycmF5OiBpbnNwZWN0VHlwZWRBcnJheSwKCSAgVWludDhDbGFtcGVkQXJyYXk6IGluc3BlY3RUeXBlZEFycmF5LAoJICBJbnQxNkFycmF5OiBpbnNwZWN0VHlwZWRBcnJheSwKCSAgVWludDE2QXJyYXk6IGluc3BlY3RUeXBlZEFycmF5LAoJICBJbnQzMkFycmF5OiBpbnNwZWN0VHlwZWRBcnJheSwKCSAgVWludDMyQXJyYXk6IGluc3BlY3RUeXBlZEFycmF5LAoJICBGbG9hdDMyQXJyYXk6IGluc3BlY3RUeXBlZEFycmF5LAoJICBGbG9hdDY0QXJyYXk6IGluc3BlY3RUeXBlZEFycmF5LAoJICBHZW5lcmF0b3I6IGZ1bmN0aW9uIEdlbmVyYXRvcigpIHsKCSAgICByZXR1cm4gJyc7CgkgIH0sCgkgIERhdGFWaWV3OiBmdW5jdGlvbiBEYXRhVmlldygpIHsKCSAgICByZXR1cm4gJyc7CgkgIH0sCgkgIEFycmF5QnVmZmVyOiBmdW5jdGlvbiBBcnJheUJ1ZmZlcigpIHsKCSAgICByZXR1cm4gJyc7CgkgIH0sCgkgIEVycm9yOiBpbnNwZWN0T2JqZWN0JDEsCgkgIEhUTUxDb2xsZWN0aW9uOiBpbnNwZWN0SFRNTENvbGxlY3Rpb24sCgkgIE5vZGVMaXN0OiBpbnNwZWN0SFRNTENvbGxlY3Rpb24KCX07IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb21wbGV4aXR5CgoJdmFyIGluc3BlY3RDdXN0b20gPSBmdW5jdGlvbiBpbnNwZWN0Q3VzdG9tKHZhbHVlLCBvcHRpb25zLCB0eXBlKSB7CgkgIGlmIChjaGFpSW5zcGVjdCBpbiB2YWx1ZSAmJiB0eXBlb2YgdmFsdWVbY2hhaUluc3BlY3RdID09PSAnZnVuY3Rpb24nKSB7CgkgICAgcmV0dXJuIHZhbHVlW2NoYWlJbnNwZWN0XShvcHRpb25zKTsKCSAgfQoKCSAgaWYgKG5vZGVJbnNwZWN0ICYmIG5vZGVJbnNwZWN0IGluIHZhbHVlICYmIHR5cGVvZiB2YWx1ZVtub2RlSW5zcGVjdF0gPT09ICdmdW5jdGlvbicpIHsKCSAgICByZXR1cm4gdmFsdWVbbm9kZUluc3BlY3RdKG9wdGlvbnMuZGVwdGgsIG9wdGlvbnMpOwoJICB9CgoJICBpZiAoJ2luc3BlY3QnIGluIHZhbHVlICYmIHR5cGVvZiB2YWx1ZS5pbnNwZWN0ID09PSAnZnVuY3Rpb24nKSB7CgkgICAgcmV0dXJuIHZhbHVlLmluc3BlY3Qob3B0aW9ucy5kZXB0aCwgb3B0aW9ucyk7CgkgIH0KCgkgIGlmICgnY29uc3RydWN0b3InIGluIHZhbHVlICYmIGNvbnN0cnVjdG9yTWFwLmhhcyh2YWx1ZS5jb25zdHJ1Y3RvcikpIHsKCSAgICByZXR1cm4gY29uc3RydWN0b3JNYXAuZ2V0KHZhbHVlLmNvbnN0cnVjdG9yKSh2YWx1ZSwgb3B0aW9ucyk7CgkgIH0KCgkgIGlmIChzdHJpbmdUYWdNYXBbdHlwZV0pIHsKCSAgICByZXR1cm4gc3RyaW5nVGFnTWFwW3R5cGVdKHZhbHVlLCBvcHRpb25zKTsKCSAgfQoKCSAgcmV0dXJuICcnOwoJfTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbXBsZXhpdHkKCgoJZnVuY3Rpb24gaW5zcGVjdCh2YWx1ZSwgb3B0aW9ucykgewoJICBvcHRpb25zID0gbm9ybWFsaXNlT3B0aW9ucyhvcHRpb25zKTsKCSAgb3B0aW9ucy5pbnNwZWN0ID0gaW5zcGVjdDsKCSAgdmFyIF9vcHRpb25zID0gb3B0aW9ucywKCSAgICAgIGN1c3RvbUluc3BlY3QgPSBfb3B0aW9ucy5jdXN0b21JbnNwZWN0OwoJICB2YXIgdHlwZSA9IHR5cGVEZXRlY3QodmFsdWUpOyAvLyBJZiBpdCBpcyBhIGJhc2UgdmFsdWUgdGhhdCB3ZSBhbHJlYWR5IHN1cHBvcnQsIHRoZW4gdXNlIExvdXBlJ3MgaW5zcGVjdG9yCgoJICBpZiAoYmFzZVR5cGVzTWFwW3R5cGVdKSB7CgkgICAgcmV0dXJuIGJhc2VUeXBlc01hcFt0eXBlXSh2YWx1ZSwgb3B0aW9ucyk7CgkgIH0KCgkgIHZhciBwcm90byA9IHZhbHVlID8gT2JqZWN0LmdldFByb3RvdHlwZU9mKHZhbHVlKSA6IGZhbHNlOyAvLyBJZiBpdCdzIGEgcGxhaW4gT2JqZWN0IHRoZW4gdXNlIExvdXBlJ3MgaW5zcGVjdG9yCgoJICBpZiAocHJvdG8gPT09IE9iamVjdC5wcm90b3R5cGUgfHwgcHJvdG8gPT09IG51bGwpIHsKCSAgICByZXR1cm4gaW5zcGVjdE9iamVjdCh2YWx1ZSwgb3B0aW9ucyk7CgkgIH0gLy8gU3BlY2lmaWNhbGx5IGFjY291bnQgZm9yIEhUTUxFbGVtZW50cwoJICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW5kZWYKCgoJICBpZiAodmFsdWUgJiYgdHlwZW9mIEhUTUxFbGVtZW50ID09PSAnZnVuY3Rpb24nICYmIHZhbHVlIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHsKCSAgICByZXR1cm4gaW5zcGVjdEhUTUwodmFsdWUsIG9wdGlvbnMpOwoJICB9IC8vIElmIGBvcHRpb25zLmN1c3RvbUluc3BlY3RgIGlzIHNldCB0byB0cnVlIHRoZW4gdHJ5IHRvIHVzZSB0aGUgY3VzdG9tIGluc3BlY3RvcgoKCgkgIGlmIChjdXN0b21JbnNwZWN0ICYmIHZhbHVlKSB7CgkgICAgdmFyIG91dHB1dCA9IGluc3BlY3RDdXN0b20odmFsdWUsIG9wdGlvbnMsIHR5cGUpOwoJICAgIGlmIChvdXRwdXQpIHJldHVybiBvdXRwdXQ7CgkgIH0gLy8gSWYgaXQgaXMgYSBjbGFzcywgaW5zcGVjdCBpdCBsaWtlIGFuIG9iamVjdCBidXQgYWRkIHRoZSBjb25zdHJ1Y3RvciBuYW1lCgoKCSAgaWYgKCdjb25zdHJ1Y3RvcicgaW4gdmFsdWUgJiYgdmFsdWUuY29uc3RydWN0b3IgIT09IE9iamVjdCkgewoJICAgIHJldHVybiBpbnNwZWN0Q2xhc3ModmFsdWUsIG9wdGlvbnMpOwoJICB9IC8vIFdlIGhhdmUgcnVuIG91dCBvZiBvcHRpb25zISBKdXN0IHN0cmluZ2lmeSB0aGUgdmFsdWUKCgoJICByZXR1cm4gb3B0aW9ucy5zdHlsaXplKFN0cmluZyh2YWx1ZSksIHR5cGUpOwoJfQoJZnVuY3Rpb24gcmVnaXN0ZXJDb25zdHJ1Y3Rvcihjb25zdHJ1Y3RvciwgaW5zcGVjdG9yKSB7CgkgIGlmIChjb25zdHJ1Y3Rvck1hcC5oYXMoY29uc3RydWN0b3IpKSB7CgkgICAgcmV0dXJuIGZhbHNlOwoJICB9CgoJICBjb25zdHJ1Y3Rvck1hcC5hZGQoY29uc3RydWN0b3IsIGluc3BlY3Rvcik7CgkgIHJldHVybiB0cnVlOwoJfQoJZnVuY3Rpb24gcmVnaXN0ZXJTdHJpbmdUYWcoc3RyaW5nVGFnLCBpbnNwZWN0b3IpIHsKCSAgaWYgKHN0cmluZ1RhZyBpbiBzdHJpbmdUYWdNYXApIHsKCSAgICByZXR1cm4gZmFsc2U7CgkgIH0KCgkgIHN0cmluZ1RhZ01hcFtzdHJpbmdUYWddID0gaW5zcGVjdG9yOwoJICByZXR1cm4gdHJ1ZTsKCX0KCXZhciBjdXN0b20gPSBjaGFpSW5zcGVjdDsKCglleHBvcnRzLmN1c3RvbSA9IGN1c3RvbTsKCWV4cG9ydHMuZGVmYXVsdCA9IGluc3BlY3Q7CglleHBvcnRzLmluc3BlY3QgPSBpbnNwZWN0OwoJZXhwb3J0cy5yZWdpc3RlckNvbnN0cnVjdG9yID0gcmVnaXN0ZXJDb25zdHJ1Y3RvcjsKCWV4cG9ydHMucmVnaXN0ZXJTdHJpbmdUYWcgPSByZWdpc3RlclN0cmluZ1RhZzsKCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pOwoKfSkpKTsKCn0pLmNhbGwodGhpcyl9KS5jYWxsKHRoaXMscmVxdWlyZSgnX3Byb2Nlc3MnKSx0eXBlb2YgZ2xvYmFsICE9PSAidW5kZWZpbmVkIiA/IGdsb2JhbCA6IHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIiA/IHdpbmRvdyA6IHt9LHJlcXVpcmUoImJ1ZmZlciIpLkJ1ZmZlcikKfSx7Il9wcm9jZXNzIjozOCwiYnVmZmVyIjoxOSwidXRpbCI6NDF9XSwxMzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CihmdW5jdGlvbigpIHsKICAndXNlIHN0cmljdCc7CiAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogIC8vIE9CSkVDVCBQUk9QRVJUWSBDQVRBTE9HVUlORwogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICB0aGlzLmtleXNfb2YgPSBmdW5jdGlvbiguLi5QKSB7CiAgICByZXR1cm4gdGhpcy52YWx1ZXNfb2YodGhpcy53YWxrX2tleXNfb2YoLi4uUCkpOwogIH07CgogIHRoaXMuYWxsX2tleXNfb2YgPSBmdW5jdGlvbiguLi5QKSB7CiAgICByZXR1cm4gdGhpcy52YWx1ZXNfb2YodGhpcy53YWxrX2FsbF9rZXlzX29mKC4uLlApKTsKICB9OwoKICB0aGlzLmFsbF9vd25fa2V5c19vZiA9IGZ1bmN0aW9uKHgpIHsKICAgIGlmICh4ICE9IG51bGwpIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHgpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQogIH07CgogIHRoaXMud2Fsa19hbGxfb3duX2tleXNfb2YgPSBmdW5jdGlvbiooeCkgewogICAgdmFyIGksIGssIGxlbiwgcmVmLCByZXN1bHRzOwogICAgcmVmID0gdGhpcy5hbGxfb3duX2tleXNfb2YoeCk7CiAgICByZXN1bHRzID0gW107CiAgICBmb3IgKGkgPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgayA9IHJlZltpXTsKICAgICAgcmVzdWx0cy5wdXNoKCh5aWVsZCBrKSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgdGhpcy53YWxrX2tleXNfb2YgPSBmdW5jdGlvbiooeCwgc2V0dGluZ3MpIHsKICAgIHZhciBkZWZhdWx0cywgaywgcmVzdWx0czsKICAgIGRlZmF1bHRzID0gewogICAgICBza2lwX3VuZGVmaW5lZDogdHJ1ZQogICAgfTsKICAgIHNldHRpbmdzID0gey4uLmRlZmF1bHRzLCAuLi5zZXR0aW5nc307CiAgICByZXN1bHRzID0gW107CiAgICBmb3IgKGsgaW4geCkgewogICAgICBpZiAoKHhba10gPT09IHZvaWQgMCkgJiYgc2V0dGluZ3Muc2tpcF91bmRlZmluZWQpIHsKICAgICAgICAvKiBUQUlOVCBzaG91bGQgdXNlIHByb3BlcnR5IGRlc2NyaXB0b3JzIHRvIGF2b2lkIHBvc3NpYmxlIHNpZGUgZWZmZWN0cyAqLwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHJlc3VsdHMucHVzaCgoeWllbGQgaykpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfTsKCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIHRoaXMud2Fsa19hbGxfa2V5c19vZiA9IGZ1bmN0aW9uKHgsIHNldHRpbmdzKSB7CiAgICB2YXIgZGVmYXVsdHM7CiAgICBkZWZhdWx0cyA9IHsKICAgICAgc2tpcF9vYmplY3Q6IHRydWUsCiAgICAgIHNraXBfdW5kZWZpbmVkOiB0cnVlCiAgICB9OwogICAgc2V0dGluZ3MgPSB7Li4uZGVmYXVsdHMsIC4uLnNldHRpbmdzfTsKICAgIHJldHVybiB0aGlzLl93YWxrX2FsbF9rZXlzX29mKHgsIG5ldyBTZXQoKSwgc2V0dGluZ3MpOwogIH07CgogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICB0aGlzLl93YWxrX2FsbF9rZXlzX29mID0gZnVuY3Rpb24qKHgsIHNlZW4sIHNldHRpbmdzKSB7CiAgICAvKiBUQUlOVCBzaG91bGQgdXNlIHByb3BlcnR5IGRlc2NyaXB0b3JzIHRvIGF2b2lkIHBvc3NpYmxlIHNpZGUgZWZmZWN0cyAqLwogICAgLyogVEFJTlQgdHJ5aW5nIHRvIGFjY2VzcyBgYXJndW1lbnRzYCBjYXVzZXMgZXJyb3IgKi8KICAgIHZhciBlcnJvciwgaywgcHJvdG8sIHJlZiwgdmFsdWU7CiAgICBpZiAoKCFzZXR0aW5ncy5za2lwX29iamVjdCkgJiYgeCA9PT0gT2JqZWN0LnByb3RvdHlwZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICByZWYgPSB0aGlzLndhbGtfYWxsX293bl9rZXlzX29mKHgpOwogICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgIGZvciAoayBvZiByZWYpIHsKICAgICAgaWYgKHNlZW4uaGFzKGspKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgc2Vlbi5hZGQoayk7CiAgICAgIHRyeSB7CiAgICAgICAgdmFsdWUgPSB4W2tdOwogICAgICB9IGNhdGNoIChlcnJvcjEpIHsKICAgICAgICBlcnJvciA9IGVycm9yMTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoKHZhbHVlID09PSB2b2lkIDApICYmIHNldHRpbmdzLnNraXBfdW5kZWZpbmVkKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKHNldHRpbmdzLnN5bWJvbCAhPSBudWxsKSB7CiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoIXZhbHVlW3NldHRpbmdzLnN5bWJvbF0pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB5aWVsZCBrOwogICAgfQogICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgIGlmICgocHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoeCkpICE9IG51bGwpIHsKICAgICAgcmV0dXJuICh5aWVsZCogdGhpcy5fd2Fsa19hbGxfa2V5c19vZihwcm90bywgc2Vlbiwgc2V0dGluZ3MpKTsKICAgIH0KICB9OwoKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgLyogVHVybiBpdGVyYXRvcnMgaW50byBsaXN0cywgY29weSBsaXN0czogKi8KICB0aGlzLnZhbHVlc19vZiA9IGZ1bmN0aW9uKHgpIHsKICAgIHJldHVybiBbLi4ueF07CiAgfTsKCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIHRoaXMuaGFzX2tleXMgPSBmdW5jdGlvbih4LCAuLi5QKSB7CiAgICB2YXIgaSwga2V5LCBsZW4sIHJlZjsKICAgIGlmICh4ID09IG51bGwpIHsKICAgICAgLyogT2JzZXJ2ZSB0aGF0IGBoYXNfa2V5cygpYCBhbHdheXMgY29uc2lkZXJzIGB1bmRlZmluZWRgIGFzICdub3Qgc2V0JyAqLwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9Ci8qIFRBSU5UIG9yIHRocm93IGVycm9yICovICAgIHJlZiA9IFAuZmxhdCgyZTMwOCk7CiAgICBmb3IgKGkgPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAga2V5ID0gcmVmW2ldOwogICAgICBpZiAoeFtrZXldID09PSB2b2lkIDApIHsKICAgICAgICAvKiBUQUlOVCBzaG91bGQgdXNlIHByb3BlcnR5IGRlc2NyaXB0b3JzIHRvIGF2b2lkIHBvc3NpYmxlIHNpZGUgZWZmZWN0cyAqLwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfTsKCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIHRoaXMuaGFzX2tleSA9IGZ1bmN0aW9uKHgsIGtleSkgewogICAgcmV0dXJuIHRoaXMuaGFzX2tleXMoeCwga2V5KTsKICB9OwoKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgdGhpcy5oYXNfb25seV9rZXlzID0gZnVuY3Rpb24oeCwgLi4uUCkgewogICAgdmFyIGtleXMsIHByb2JlczsKICAgIHByb2JlcyA9IChQLmZsYXQoMmUzMDgpKS5zb3J0KCk7CiAgICBrZXlzID0gKHRoaXMudmFsdWVzX29mKHRoaXMua2V5c19vZih4KSkpLnNvcnQoKTsKICAgIHJldHVybiBwcm9iZXMubGVuZ3RoID0ga2V5cy5sZW5ndGggJiYgcHJvYmVzLmV2ZXJ5KGZ1bmN0aW9uKHgsIGlkeCkgewogICAgICByZXR1cm4geCA9PT0ga2V5c1tpZHhdOwogICAgfSk7CiAgfTsKCn0pLmNhbGwodGhpcyk7CgoKfSx7fV0sMTQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewooZnVuY3Rpb24oKSB7CiAgJ3VzZSBzdHJpY3QnOwogIHZhciBNdWx0aW1peCwgbW9kdWxlX2tleXdvcmRzLAogICAgaW5kZXhPZiA9IFtdLmluZGV4T2Y7CgogIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAvLyBNT0RVTEUgTUVUQUNMQVNTIHByb3ZpZGVzIHN0YXRpYyBtZXRob2RzIGBAZXh0ZW5kKClgLCBgQGluY2x1ZGUoKWAKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgLyogVGhlIGxpdHRsZSBkYW5jZSBhcm91bmQgdGhlIG1vZHVsZV9rZXl3b3JkcyB2YXJpYWJsZSBpcyB0byBlbnN1cmUgd2UgaGF2ZSBjYWxsYmFjayBzdXBwb3J0IHdoZW4gbWl4aW5zCiAgZXh0ZW5kIGEgY2xhc3MuIFNlZSBodHRwczovL2FyY3R1cm8uZ2l0aHViLmlvL2xpYnJhcnkvY29mZmVlc2NyaXB0LzAzX2NsYXNzZXMuaHRtbCAqLwogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICBtb2R1bGVfa2V5d29yZHMgPSBbJ2V4dGVuZGVkJywgJ2luY2x1ZGVkJ107CgogIE11bHRpbWl4ID0gKGZ1bmN0aW9uKCkgewogICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgY2xhc3MgTXVsdGltaXggewogICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICBzdGF0aWMgZXh0ZW5kKG9iamVjdCwgc2V0dGluZ3MgPSBudWxsKSB7CiAgICAgICAgdmFyIGtleSwgcmVmLCB2YWx1ZTsKICAgICAgICBzZXR0aW5ncyA9IHsuLi57CiAgICAgICAgICAgIG92ZXJ3cml0ZTogdHJ1ZQogICAgICAgICAgfSwgLi4uKHNldHRpbmdzICE9IG51bGwgPyBzZXR0aW5ncyA6IG51bGwpfTsKICAgICAgICBmb3IgKGtleSBpbiBvYmplY3QpIHsKICAgICAgICAgIHZhbHVlID0gb2JqZWN0W2tleV07CiAgICAgICAgICBpZiAoIShpbmRleE9mLmNhbGwobW9kdWxlX2tleXdvcmRzLCBrZXkpIDwgMCkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoKCFzZXR0aW5ncy5vdmVyd3JpdGUpICYmICgodGhpcy5wcm90b3R5cGVba2V5XSAhPSBudWxsKSB8fCAodGhpc1trZXldICE9IG51bGwpKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYF5tdWx0aW1peC9pbmNsdWRlQDU2ODQgb3ZlcndyaXRlIHNldCB0byBmYWxzZSBidXQgbmFtZSBhbHJlYWR5IHNldDogJHtKU09OLnN0cmluZ2lmeShrZXkpfWApOwogICAgICAgICAgfQogICAgICAgICAgdGhpc1trZXldID0gdmFsdWU7CiAgICAgICAgfQogICAgICAgIGlmICgocmVmID0gb2JqZWN0LmV4dGVuZGVkKSAhPSBudWxsKSB7CiAgICAgICAgICByZWYuYXBwbHkodGhpcyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICBzdGF0aWMgaW5jbHVkZShvYmplY3QsIHNldHRpbmdzID0gbnVsbCkgewogICAgICAgIHZhciBrZXksIHJlZiwgdmFsdWU7CiAgICAgICAgc2V0dGluZ3MgPSB7Li4uewogICAgICAgICAgICBvdmVyd3JpdGU6IHRydWUKICAgICAgICAgIH0sIC4uLihzZXR0aW5ncyAhPSBudWxsID8gc2V0dGluZ3MgOiBudWxsKX07CiAgICAgICAgZm9yIChrZXkgaW4gb2JqZWN0KSB7CiAgICAgICAgICB2YWx1ZSA9IG9iamVjdFtrZXldOwogICAgICAgICAgaWYgKCEoaW5kZXhPZi5jYWxsKG1vZHVsZV9rZXl3b3Jkcywga2V5KSA8IDApKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCghc2V0dGluZ3Mub3ZlcndyaXRlKSAmJiAoKHRoaXMucHJvdG90eXBlW2tleV0gIT0gbnVsbCkgfHwgKHRoaXNba2V5XSAhPSBudWxsKSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBebXVsdGltaXgvaW5jbHVkZUA1NjgzIG92ZXJ3cml0ZSBzZXQgdG8gZmFsc2UgYnV0IG5hbWUgYWxyZWFkeSBzZXQ6ICR7SlNPTi5zdHJpbmdpZnkoa2V5KX1gKTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIEFzc2lnbiBwcm9wZXJ0aWVzIHRvIHRoZSBwcm90b3R5cGUKICAgICAgICAgIHRoaXMucHJvdG90eXBlW2tleV0gPSB2YWx1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKChyZWYgPSBvYmplY3QuaW5jbHVkZWQpICE9IG51bGwpIHsKICAgICAgICAgIHJlZi5hcHBseSh0aGlzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIGV4cG9ydCh0YXJnZXQgPSBudWxsKSB7CiAgICAgICAgLyogUmV0dXJuIGFuIG9iamVjdCB3aXRoIG1ldGhvZHMsIGJvdW5kIHRvIHRoZSBjdXJyZW50IGluc3RhbmNlLiAqLwogICAgICAgIHZhciBSLCBrLCByZWYsIHJlZjEsIHY7CiAgICAgICAgUiA9IHRhcmdldCAhPSBudWxsID8gdGFyZ2V0IDoge307CiAgICAgICAgcmVmID0gKHJlcXVpcmUoJy4vY2F0YWxvZ3VpbmcnKSkud2Fsa19hbGxfa2V5c19vZih0aGlzKTsKICAgICAgICBmb3IgKGsgb2YgcmVmKSB7CiAgICAgICAgICB2ID0gdGhpc1trXTsKICAgICAgICAgIGlmICgodiAhPSBudWxsID8gdi5iaW5kIDogdm9pZCAwKSA9PSBudWxsKSB7CiAgICAgICAgICAgIFJba10gPSB2OwogICAgICAgICAgfSBlbHNlIGlmICgocmVmMSA9IHZbTXVsdGltaXguaXNhX2tleW1ldGhvZF9wcm94eV0pICE9IG51bGwgPyByZWYxIDogZmFsc2UpIHsKICAgICAgICAgICAgUltrXSA9IE11bHRpbWl4LmdldF9rZXltZXRob2RfcHJveHkodGhpcywgdik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBSW2tdID0gdi5iaW5kKHRoaXMpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gUjsKICAgICAgfQoKICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgZ2V0X215X3Byb3RvdHlwZSgpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmdldFByb3RvdHlwZU9mKE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKSk7CiAgICAgIH0KCiAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIG5ldyguLi5QKSB7CiAgICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKC4uLlApOwogICAgICB9CgogICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICAvLyBLRVlNRVRIT0QgRkFDVE9SWQogICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICBzdGF0aWMgZ2V0X2tleW1ldGhvZF9wcm94eShiaW5kX3RhcmdldCwgZikgewogICAgICAgIHZhciBSOwogICAgICAgIFIgPSBuZXcgUHJveHkoZi5iaW5kKGJpbmRfdGFyZ2V0KSwgewogICAgICAgICAgZ2V0OiBmdW5jdGlvbih0YXJnZXQsIGtleSkgewogICAgICAgICAgICBpZiAoa2V5ID09PSAnYmluZCcpIHsgLy8gLi4uIG90aGVyIHByb3BlcnRpZXMgLi4uCiAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldFtrZXldOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgodHlwZW9mIGtleSkgPT09ICdzeW1ib2wnKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldFtrZXldOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiguLi54UCkgewogICAgICAgICAgICAgIHJldHVybiB0YXJnZXQoa2V5LCAuLi54UCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgUltNdWx0aW1peC5pc2Ffa2V5bWV0aG9kX3Byb3h5XSA9IHRydWU7CiAgICAgICAgcmV0dXJuIFI7CiAgICAgIH0KCiAgICB9OwoKICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvLyBAanNfdHlwZV9vZiA9ICggeCApIC0+IHJldHVybiAoICggT2JqZWN0Ojp0b1N0cmluZy5jYWxsIHggKS5zbGljZSA4LCAtMSApLnRvTG93ZXJDYXNlKCkKICAgIE11bHRpbWl4LmlzYV9rZXltZXRob2RfcHJveHkgPSBTeW1ib2woJ3Byb3h5Jyk7CgogICAgcmV0dXJuIE11bHRpbWl4OwoKICB9KS5jYWxsKHRoaXMpOwoKICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgbW9kdWxlLmV4cG9ydHMgPSBNdWx0aW1peDsKCn0pLmNhbGwodGhpcyk7CgoKfSx7Ii4vY2F0YWxvZ3VpbmciOjEzfV0sMTU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewoKfSx7fV0sMTY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewoKLyoqCiAqIEFycmF5I2ZpbHRlci4KICoKICogQHBhcmFtIHtBcnJheX0gYXJyCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuCiAqIEBwYXJhbSB7T2JqZWN0PX0gc2VsZgogKiBAcmV0dXJuIHtBcnJheX0KICogQHRocm93IFR5cGVFcnJvcgogKi8KCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGFyciwgZm4sIHNlbGYpIHsKICBpZiAoYXJyLmZpbHRlcikgcmV0dXJuIGFyci5maWx0ZXIoZm4sIHNlbGYpOwogIGlmICh2b2lkIDAgPT09IGFyciB8fCBudWxsID09PSBhcnIpIHRocm93IG5ldyBUeXBlRXJyb3I7CiAgaWYgKCdmdW5jdGlvbicgIT0gdHlwZW9mIGZuKSB0aHJvdyBuZXcgVHlwZUVycm9yOwogIHZhciByZXQgPSBbXTsKICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykgewogICAgaWYgKCFoYXNPd24uY2FsbChhcnIsIGkpKSBjb250aW51ZTsKICAgIHZhciB2YWwgPSBhcnJbaV07CiAgICBpZiAoZm4uY2FsbChzZWxmLCB2YWwsIGksIGFycikpIHJldC5wdXNoKHZhbCk7CiAgfQogIHJldHVybiByZXQ7Cn07Cgp2YXIgaGFzT3duID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKCn0se31dLDE3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKKGZ1bmN0aW9uIChnbG9iYWwpeyhmdW5jdGlvbiAoKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIGZpbHRlciA9IHJlcXVpcmUoJ2FycmF5LWZpbHRlcicpOwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBhdmFpbGFibGVUeXBlZEFycmF5cygpIHsKCXJldHVybiBmaWx0ZXIoWwoJCSdCaWdJbnQ2NEFycmF5JywKCQknQmlnVWludDY0QXJyYXknLAoJCSdGbG9hdDMyQXJyYXknLAoJCSdGbG9hdDY0QXJyYXknLAoJCSdJbnQxNkFycmF5JywKCQknSW50MzJBcnJheScsCgkJJ0ludDhBcnJheScsCgkJJ1VpbnQxNkFycmF5JywKCQknVWludDMyQXJyYXknLAoJCSdVaW50OEFycmF5JywKCQknVWludDhDbGFtcGVkQXJyYXknCgldLCBmdW5jdGlvbiAodHlwZWRBcnJheSkgewoJCXJldHVybiB0eXBlb2YgZ2xvYmFsW3R5cGVkQXJyYXldID09PSAnZnVuY3Rpb24nOwoJfSk7Cn07Cgp9KS5jYWxsKHRoaXMpfSkuY2FsbCh0aGlzLHR5cGVvZiBnbG9iYWwgIT09ICJ1bmRlZmluZWQiID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiID8gd2luZG93IDoge30pCn0seyJhcnJheS1maWx0ZXIiOjE2fV0sMTg6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCcKCmV4cG9ydHMuYnl0ZUxlbmd0aCA9IGJ5dGVMZW5ndGgKZXhwb3J0cy50b0J5dGVBcnJheSA9IHRvQnl0ZUFycmF5CmV4cG9ydHMuZnJvbUJ5dGVBcnJheSA9IGZyb21CeXRlQXJyYXkKCnZhciBsb29rdXAgPSBbXQp2YXIgcmV2TG9va3VwID0gW10KdmFyIEFyciA9IHR5cGVvZiBVaW50OEFycmF5ICE9PSAndW5kZWZpbmVkJyA/IFVpbnQ4QXJyYXkgOiBBcnJheQoKdmFyIGNvZGUgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLycKZm9yICh2YXIgaSA9IDAsIGxlbiA9IGNvZGUubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICBsb29rdXBbaV0gPSBjb2RlW2ldCiAgcmV2TG9va3VwW2NvZGUuY2hhckNvZGVBdChpKV0gPSBpCn0KCi8vIFN1cHBvcnQgZGVjb2RpbmcgVVJMLXNhZmUgYmFzZTY0IHN0cmluZ3MsIGFzIE5vZGUuanMgZG9lcy4KLy8gU2VlOiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9CYXNlNjQjVVJMX2FwcGxpY2F0aW9ucwpyZXZMb29rdXBbJy0nLmNoYXJDb2RlQXQoMCldID0gNjIKcmV2TG9va3VwWydfJy5jaGFyQ29kZUF0KDApXSA9IDYzCgpmdW5jdGlvbiBnZXRMZW5zIChiNjQpIHsKICB2YXIgbGVuID0gYjY0Lmxlbmd0aAoKICBpZiAobGVuICUgNCA+IDApIHsKICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBzdHJpbmcuIExlbmd0aCBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgNCcpCiAgfQoKICAvLyBUcmltIG9mZiBleHRyYSBieXRlcyBhZnRlciBwbGFjZWhvbGRlciBieXRlcyBhcmUgZm91bmQKICAvLyBTZWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9iZWF0Z2FtbWl0L2Jhc2U2NC1qcy9pc3N1ZXMvNDIKICB2YXIgdmFsaWRMZW4gPSBiNjQuaW5kZXhPZignPScpCiAgaWYgKHZhbGlkTGVuID09PSAtMSkgdmFsaWRMZW4gPSBsZW4KCiAgdmFyIHBsYWNlSG9sZGVyc0xlbiA9IHZhbGlkTGVuID09PSBsZW4KICAgID8gMAogICAgOiA0IC0gKHZhbGlkTGVuICUgNCkKCiAgcmV0dXJuIFt2YWxpZExlbiwgcGxhY2VIb2xkZXJzTGVuXQp9CgovLyBiYXNlNjQgaXMgNC8zICsgdXAgdG8gdHdvIGNoYXJhY3RlcnMgb2YgdGhlIG9yaWdpbmFsIGRhdGEKZnVuY3Rpb24gYnl0ZUxlbmd0aCAoYjY0KSB7CiAgdmFyIGxlbnMgPSBnZXRMZW5zKGI2NCkKICB2YXIgdmFsaWRMZW4gPSBsZW5zWzBdCiAgdmFyIHBsYWNlSG9sZGVyc0xlbiA9IGxlbnNbMV0KICByZXR1cm4gKCh2YWxpZExlbiArIHBsYWNlSG9sZGVyc0xlbikgKiAzIC8gNCkgLSBwbGFjZUhvbGRlcnNMZW4KfQoKZnVuY3Rpb24gX2J5dGVMZW5ndGggKGI2NCwgdmFsaWRMZW4sIHBsYWNlSG9sZGVyc0xlbikgewogIHJldHVybiAoKHZhbGlkTGVuICsgcGxhY2VIb2xkZXJzTGVuKSAqIDMgLyA0KSAtIHBsYWNlSG9sZGVyc0xlbgp9CgpmdW5jdGlvbiB0b0J5dGVBcnJheSAoYjY0KSB7CiAgdmFyIHRtcAogIHZhciBsZW5zID0gZ2V0TGVucyhiNjQpCiAgdmFyIHZhbGlkTGVuID0gbGVuc1swXQogIHZhciBwbGFjZUhvbGRlcnNMZW4gPSBsZW5zWzFdCgogIHZhciBhcnIgPSBuZXcgQXJyKF9ieXRlTGVuZ3RoKGI2NCwgdmFsaWRMZW4sIHBsYWNlSG9sZGVyc0xlbikpCgogIHZhciBjdXJCeXRlID0gMAoKICAvLyBpZiB0aGVyZSBhcmUgcGxhY2Vob2xkZXJzLCBvbmx5IGdldCB1cCB0byB0aGUgbGFzdCBjb21wbGV0ZSA0IGNoYXJzCiAgdmFyIGxlbiA9IHBsYWNlSG9sZGVyc0xlbiA+IDAKICAgID8gdmFsaWRMZW4gLSA0CiAgICA6IHZhbGlkTGVuCgogIHZhciBpCiAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSArPSA0KSB7CiAgICB0bXAgPQogICAgICAocmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkpXSA8PCAxOCkgfAogICAgICAocmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkgKyAxKV0gPDwgMTIpIHwKICAgICAgKHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpICsgMildIDw8IDYpIHwKICAgICAgcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkgKyAzKV0KICAgIGFycltjdXJCeXRlKytdID0gKHRtcCA+PiAxNikgJiAweEZGCiAgICBhcnJbY3VyQnl0ZSsrXSA9ICh0bXAgPj4gOCkgJiAweEZGCiAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCAmIDB4RkYKICB9CgogIGlmIChwbGFjZUhvbGRlcnNMZW4gPT09IDIpIHsKICAgIHRtcCA9CiAgICAgIChyZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaSldIDw8IDIpIHwKICAgICAgKHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpICsgMSldID4+IDQpCiAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCAmIDB4RkYKICB9CgogIGlmIChwbGFjZUhvbGRlcnNMZW4gPT09IDEpIHsKICAgIHRtcCA9CiAgICAgIChyZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaSldIDw8IDEwKSB8CiAgICAgIChyZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaSArIDEpXSA8PCA0KSB8CiAgICAgIChyZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaSArIDIpXSA+PiAyKQogICAgYXJyW2N1ckJ5dGUrK10gPSAodG1wID4+IDgpICYgMHhGRgogICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgJiAweEZGCiAgfQoKICByZXR1cm4gYXJyCn0KCmZ1bmN0aW9uIHRyaXBsZXRUb0Jhc2U2NCAobnVtKSB7CiAgcmV0dXJuIGxvb2t1cFtudW0gPj4gMTggJiAweDNGXSArCiAgICBsb29rdXBbbnVtID4+IDEyICYgMHgzRl0gKwogICAgbG9va3VwW251bSA+PiA2ICYgMHgzRl0gKwogICAgbG9va3VwW251bSAmIDB4M0ZdCn0KCmZ1bmN0aW9uIGVuY29kZUNodW5rICh1aW50OCwgc3RhcnQsIGVuZCkgewogIHZhciB0bXAKICB2YXIgb3V0cHV0ID0gW10KICBmb3IgKHZhciBpID0gc3RhcnQ7IGkgPCBlbmQ7IGkgKz0gMykgewogICAgdG1wID0KICAgICAgKCh1aW50OFtpXSA8PCAxNikgJiAweEZGMDAwMCkgKwogICAgICAoKHVpbnQ4W2kgKyAxXSA8PCA4KSAmIDB4RkYwMCkgKwogICAgICAodWludDhbaSArIDJdICYgMHhGRikKICAgIG91dHB1dC5wdXNoKHRyaXBsZXRUb0Jhc2U2NCh0bXApKQogIH0KICByZXR1cm4gb3V0cHV0LmpvaW4oJycpCn0KCmZ1bmN0aW9uIGZyb21CeXRlQXJyYXkgKHVpbnQ4KSB7CiAgdmFyIHRtcAogIHZhciBsZW4gPSB1aW50OC5sZW5ndGgKICB2YXIgZXh0cmFCeXRlcyA9IGxlbiAlIDMgLy8gaWYgd2UgaGF2ZSAxIGJ5dGUgbGVmdCwgcGFkIDIgYnl0ZXMKICB2YXIgcGFydHMgPSBbXQogIHZhciBtYXhDaHVua0xlbmd0aCA9IDE2MzgzIC8vIG11c3QgYmUgbXVsdGlwbGUgb2YgMwoKICAvLyBnbyB0aHJvdWdoIHRoZSBhcnJheSBldmVyeSB0aHJlZSBieXRlcywgd2UnbGwgZGVhbCB3aXRoIHRyYWlsaW5nIHN0dWZmIGxhdGVyCiAgZm9yICh2YXIgaSA9IDAsIGxlbjIgPSBsZW4gLSBleHRyYUJ5dGVzOyBpIDwgbGVuMjsgaSArPSBtYXhDaHVua0xlbmd0aCkgewogICAgcGFydHMucHVzaChlbmNvZGVDaHVuayh1aW50OCwgaSwgKGkgKyBtYXhDaHVua0xlbmd0aCkgPiBsZW4yID8gbGVuMiA6IChpICsgbWF4Q2h1bmtMZW5ndGgpKSkKICB9CgogIC8vIHBhZCB0aGUgZW5kIHdpdGggemVyb3MsIGJ1dCBtYWtlIHN1cmUgdG8gbm90IGZvcmdldCB0aGUgZXh0cmEgYnl0ZXMKICBpZiAoZXh0cmFCeXRlcyA9PT0gMSkgewogICAgdG1wID0gdWludDhbbGVuIC0gMV0KICAgIHBhcnRzLnB1c2goCiAgICAgIGxvb2t1cFt0bXAgPj4gMl0gKwogICAgICBsb29rdXBbKHRtcCA8PCA0KSAmIDB4M0ZdICsKICAgICAgJz09JwogICAgKQogIH0gZWxzZSBpZiAoZXh0cmFCeXRlcyA9PT0gMikgewogICAgdG1wID0gKHVpbnQ4W2xlbiAtIDJdIDw8IDgpICsgdWludDhbbGVuIC0gMV0KICAgIHBhcnRzLnB1c2goCiAgICAgIGxvb2t1cFt0bXAgPj4gMTBdICsKICAgICAgbG9va3VwWyh0bXAgPj4gNCkgJiAweDNGXSArCiAgICAgIGxvb2t1cFsodG1wIDw8IDIpICYgMHgzRl0gKwogICAgICAnPScKICAgICkKICB9CgogIHJldHVybiBwYXJ0cy5qb2luKCcnKQp9Cgp9LHt9XSwxOTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CihmdW5jdGlvbiAoQnVmZmVyKXsoZnVuY3Rpb24gKCl7Ci8qIQogKiBUaGUgYnVmZmVyIG1vZHVsZSBmcm9tIG5vZGUuanMsIGZvciB0aGUgYnJvd3Nlci4KICoKICogQGF1dGhvciAgIEZlcm9zcyBBYm91a2hhZGlqZWggPGh0dHBzOi8vZmVyb3NzLm9yZz4KICogQGxpY2Vuc2UgIE1JVAogKi8KLyogZXNsaW50LWRpc2FibGUgbm8tcHJvdG8gKi8KCid1c2Ugc3RyaWN0JwoKdmFyIGJhc2U2NCA9IHJlcXVpcmUoJ2Jhc2U2NC1qcycpCnZhciBpZWVlNzU0ID0gcmVxdWlyZSgnaWVlZTc1NCcpCgpleHBvcnRzLkJ1ZmZlciA9IEJ1ZmZlcgpleHBvcnRzLlNsb3dCdWZmZXIgPSBTbG93QnVmZmVyCmV4cG9ydHMuSU5TUEVDVF9NQVhfQllURVMgPSA1MAoKdmFyIEtfTUFYX0xFTkdUSCA9IDB4N2ZmZmZmZmYKZXhwb3J0cy5rTWF4TGVuZ3RoID0gS19NQVhfTEVOR1RICgovKioKICogSWYgYEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUYDoKICogICA9PT0gdHJ1ZSAgICBVc2UgVWludDhBcnJheSBpbXBsZW1lbnRhdGlvbiAoZmFzdGVzdCkKICogICA9PT0gZmFsc2UgICBQcmludCB3YXJuaW5nIGFuZCByZWNvbW1lbmQgdXNpbmcgYGJ1ZmZlcmAgdjQueCB3aGljaCBoYXMgYW4gT2JqZWN0CiAqICAgICAgICAgICAgICAgaW1wbGVtZW50YXRpb24gKG1vc3QgY29tcGF0aWJsZSwgZXZlbiBJRTYpCiAqCiAqIEJyb3dzZXJzIHRoYXQgc3VwcG9ydCB0eXBlZCBhcnJheXMgYXJlIElFIDEwKywgRmlyZWZveCA0KywgQ2hyb21lIDcrLCBTYWZhcmkgNS4xKywKICogT3BlcmEgMTEuNissIGlPUyA0LjIrLgogKgogKiBXZSByZXBvcnQgdGhhdCB0aGUgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IHR5cGVkIGFycmF5cyBpZiB0aGUgYXJlIG5vdCBzdWJjbGFzc2FibGUKICogdXNpbmcgX19wcm90b19fLiBGaXJlZm94IDQtMjkgbGFja3Mgc3VwcG9ydCBmb3IgYWRkaW5nIG5ldyBwcm9wZXJ0aWVzIHRvIGBVaW50OEFycmF5YAogKiAoU2VlOiBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD02OTU0MzgpLiBJRSAxMCBsYWNrcyBzdXBwb3J0CiAqIGZvciBfX3Byb3RvX18gYW5kIGhhcyBhIGJ1Z2d5IHR5cGVkIGFycmF5IGltcGxlbWVudGF0aW9uLgogKi8KQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQgPSB0eXBlZEFycmF5U3VwcG9ydCgpCgppZiAoIUJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUICYmIHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJyAmJgogICAgdHlwZW9mIGNvbnNvbGUuZXJyb3IgPT09ICdmdW5jdGlvbicpIHsKICBjb25zb2xlLmVycm9yKAogICAgJ1RoaXMgYnJvd3NlciBsYWNrcyB0eXBlZCBhcnJheSAoVWludDhBcnJheSkgc3VwcG9ydCB3aGljaCBpcyByZXF1aXJlZCBieSAnICsKICAgICdgYnVmZmVyYCB2NS54LiBVc2UgYGJ1ZmZlcmAgdjQueCBpZiB5b3UgcmVxdWlyZSBvbGQgYnJvd3NlciBzdXBwb3J0LicKICApCn0KCmZ1bmN0aW9uIHR5cGVkQXJyYXlTdXBwb3J0ICgpIHsKICAvLyBDYW4gdHlwZWQgYXJyYXkgaW5zdGFuY2VzIGNhbiBiZSBhdWdtZW50ZWQ/CiAgdHJ5IHsKICAgIHZhciBhcnIgPSBuZXcgVWludDhBcnJheSgxKQogICAgYXJyLl9fcHJvdG9fXyA9IHsgX19wcm90b19fOiBVaW50OEFycmF5LnByb3RvdHlwZSwgZm9vOiBmdW5jdGlvbiAoKSB7IHJldHVybiA0MiB9IH0KICAgIHJldHVybiBhcnIuZm9vKCkgPT09IDQyCiAgfSBjYXRjaCAoZSkgewogICAgcmV0dXJuIGZhbHNlCiAgfQp9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoQnVmZmVyLnByb3RvdHlwZSwgJ3BhcmVudCcsIHsKICBlbnVtZXJhYmxlOiB0cnVlLAogIGdldDogZnVuY3Rpb24gKCkgewogICAgaWYgKCFCdWZmZXIuaXNCdWZmZXIodGhpcykpIHJldHVybiB1bmRlZmluZWQKICAgIHJldHVybiB0aGlzLmJ1ZmZlcgogIH0KfSkKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShCdWZmZXIucHJvdG90eXBlLCAnb2Zmc2V0JywgewogIGVudW1lcmFibGU6IHRydWUsCiAgZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICBpZiAoIUJ1ZmZlci5pc0J1ZmZlcih0aGlzKSkgcmV0dXJuIHVuZGVmaW5lZAogICAgcmV0dXJuIHRoaXMuYnl0ZU9mZnNldAogIH0KfSkKCmZ1bmN0aW9uIGNyZWF0ZUJ1ZmZlciAobGVuZ3RoKSB7CiAgaWYgKGxlbmd0aCA+IEtfTUFYX0xFTkdUSCkgewogICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1RoZSB2YWx1ZSAiJyArIGxlbmd0aCArICciIGlzIGludmFsaWQgZm9yIG9wdGlvbiAic2l6ZSInKQogIH0KICAvLyBSZXR1cm4gYW4gYXVnbWVudGVkIGBVaW50OEFycmF5YCBpbnN0YW5jZQogIHZhciBidWYgPSBuZXcgVWludDhBcnJheShsZW5ndGgpCiAgYnVmLl9fcHJvdG9fXyA9IEJ1ZmZlci5wcm90b3R5cGUKICByZXR1cm4gYnVmCn0KCi8qKgogKiBUaGUgQnVmZmVyIGNvbnN0cnVjdG9yIHJldHVybnMgaW5zdGFuY2VzIG9mIGBVaW50OEFycmF5YCB0aGF0IGhhdmUgdGhlaXIKICogcHJvdG90eXBlIGNoYW5nZWQgdG8gYEJ1ZmZlci5wcm90b3R5cGVgLiBGdXJ0aGVybW9yZSwgYEJ1ZmZlcmAgaXMgYSBzdWJjbGFzcyBvZgogKiBgVWludDhBcnJheWAsIHNvIHRoZSByZXR1cm5lZCBpbnN0YW5jZXMgd2lsbCBoYXZlIGFsbCB0aGUgbm9kZSBgQnVmZmVyYCBtZXRob2RzCiAqIGFuZCB0aGUgYFVpbnQ4QXJyYXlgIG1ldGhvZHMuIFNxdWFyZSBicmFja2V0IG5vdGF0aW9uIHdvcmtzIGFzIGV4cGVjdGVkIC0tIGl0CiAqIHJldHVybnMgYSBzaW5nbGUgb2N0ZXQuCiAqCiAqIFRoZSBgVWludDhBcnJheWAgcHJvdG90eXBlIHJlbWFpbnMgdW5tb2RpZmllZC4KICovCgpmdW5jdGlvbiBCdWZmZXIgKGFyZywgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKSB7CiAgLy8gQ29tbW9uIGNhc2UuCiAgaWYgKHR5cGVvZiBhcmcgPT09ICdudW1iZXInKSB7CiAgICBpZiAodHlwZW9mIGVuY29kaW5nT3JPZmZzZXQgPT09ICdzdHJpbmcnKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoCiAgICAgICAgJ1RoZSAic3RyaW5nIiBhcmd1bWVudCBtdXN0IGJlIG9mIHR5cGUgc3RyaW5nLiBSZWNlaXZlZCB0eXBlIG51bWJlcicKICAgICAgKQogICAgfQogICAgcmV0dXJuIGFsbG9jVW5zYWZlKGFyZykKICB9CiAgcmV0dXJuIGZyb20oYXJnLCBlbmNvZGluZ09yT2Zmc2V0LCBsZW5ndGgpCn0KCi8vIEZpeCBzdWJhcnJheSgpIGluIEVTMjAxNi4gU2VlOiBodHRwczovL2dpdGh1Yi5jb20vZmVyb3NzL2J1ZmZlci9wdWxsLzk3CmlmICh0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wuc3BlY2llcyAhPSBudWxsICYmCiAgICBCdWZmZXJbU3ltYm9sLnNwZWNpZXNdID09PSBCdWZmZXIpIHsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQnVmZmVyLCBTeW1ib2wuc3BlY2llcywgewogICAgdmFsdWU6IG51bGwsCiAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICBlbnVtZXJhYmxlOiBmYWxzZSwKICAgIHdyaXRhYmxlOiBmYWxzZQogIH0pCn0KCkJ1ZmZlci5wb29sU2l6ZSA9IDgxOTIgLy8gbm90IHVzZWQgYnkgdGhpcyBpbXBsZW1lbnRhdGlvbgoKZnVuY3Rpb24gZnJvbSAodmFsdWUsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aCkgewogIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7CiAgICByZXR1cm4gZnJvbVN0cmluZyh2YWx1ZSwgZW5jb2RpbmdPck9mZnNldCkKICB9CgogIGlmIChBcnJheUJ1ZmZlci5pc1ZpZXcodmFsdWUpKSB7CiAgICByZXR1cm4gZnJvbUFycmF5TGlrZSh2YWx1ZSkKICB9CgogIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICB0aHJvdyBUeXBlRXJyb3IoCiAgICAgICdUaGUgZmlyc3QgYXJndW1lbnQgbXVzdCBiZSBvbmUgb2YgdHlwZSBzdHJpbmcsIEJ1ZmZlciwgQXJyYXlCdWZmZXIsIEFycmF5LCAnICsKICAgICAgJ29yIEFycmF5LWxpa2UgT2JqZWN0LiBSZWNlaXZlZCB0eXBlICcgKyAodHlwZW9mIHZhbHVlKQogICAgKQogIH0KCiAgaWYgKGlzSW5zdGFuY2UodmFsdWUsIEFycmF5QnVmZmVyKSB8fAogICAgICAodmFsdWUgJiYgaXNJbnN0YW5jZSh2YWx1ZS5idWZmZXIsIEFycmF5QnVmZmVyKSkpIHsKICAgIHJldHVybiBmcm9tQXJyYXlCdWZmZXIodmFsdWUsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aCkKICB9CgogIGlmICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKAogICAgICAnVGhlICJ2YWx1ZSIgYXJndW1lbnQgbXVzdCBub3QgYmUgb2YgdHlwZSBudW1iZXIuIFJlY2VpdmVkIHR5cGUgbnVtYmVyJwogICAgKQogIH0KCiAgdmFyIHZhbHVlT2YgPSB2YWx1ZS52YWx1ZU9mICYmIHZhbHVlLnZhbHVlT2YoKQogIGlmICh2YWx1ZU9mICE9IG51bGwgJiYgdmFsdWVPZiAhPT0gdmFsdWUpIHsKICAgIHJldHVybiBCdWZmZXIuZnJvbSh2YWx1ZU9mLCBlbmNvZGluZ09yT2Zmc2V0LCBsZW5ndGgpCiAgfQoKICB2YXIgYiA9IGZyb21PYmplY3QodmFsdWUpCiAgaWYgKGIpIHJldHVybiBiCgogIGlmICh0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9QcmltaXRpdmUgIT0gbnVsbCAmJgogICAgICB0eXBlb2YgdmFsdWVbU3ltYm9sLnRvUHJpbWl0aXZlXSA9PT0gJ2Z1bmN0aW9uJykgewogICAgcmV0dXJuIEJ1ZmZlci5mcm9tKAogICAgICB2YWx1ZVtTeW1ib2wudG9QcmltaXRpdmVdKCdzdHJpbmcnKSwgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoCiAgICApCiAgfQoKICB0aHJvdyBuZXcgVHlwZUVycm9yKAogICAgJ1RoZSBmaXJzdCBhcmd1bWVudCBtdXN0IGJlIG9uZSBvZiB0eXBlIHN0cmluZywgQnVmZmVyLCBBcnJheUJ1ZmZlciwgQXJyYXksICcgKwogICAgJ29yIEFycmF5LWxpa2UgT2JqZWN0LiBSZWNlaXZlZCB0eXBlICcgKyAodHlwZW9mIHZhbHVlKQogICkKfQoKLyoqCiAqIEZ1bmN0aW9uYWxseSBlcXVpdmFsZW50IHRvIEJ1ZmZlcihhcmcsIGVuY29kaW5nKSBidXQgdGhyb3dzIGEgVHlwZUVycm9yCiAqIGlmIHZhbHVlIGlzIGEgbnVtYmVyLgogKiBCdWZmZXIuZnJvbShzdHJbLCBlbmNvZGluZ10pCiAqIEJ1ZmZlci5mcm9tKGFycmF5KQogKiBCdWZmZXIuZnJvbShidWZmZXIpCiAqIEJ1ZmZlci5mcm9tKGFycmF5QnVmZmVyWywgYnl0ZU9mZnNldFssIGxlbmd0aF1dKQogKiovCkJ1ZmZlci5mcm9tID0gZnVuY3Rpb24gKHZhbHVlLCBlbmNvZGluZ09yT2Zmc2V0LCBsZW5ndGgpIHsKICByZXR1cm4gZnJvbSh2YWx1ZSwgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKQp9CgovLyBOb3RlOiBDaGFuZ2UgcHJvdG90eXBlICphZnRlciogQnVmZmVyLmZyb20gaXMgZGVmaW5lZCB0byB3b3JrYXJvdW5kIENocm9tZSBidWc6Ci8vIGh0dHBzOi8vZ2l0aHViLmNvbS9mZXJvc3MvYnVmZmVyL3B1bGwvMTQ4CkJ1ZmZlci5wcm90b3R5cGUuX19wcm90b19fID0gVWludDhBcnJheS5wcm90b3R5cGUKQnVmZmVyLl9fcHJvdG9fXyA9IFVpbnQ4QXJyYXkKCmZ1bmN0aW9uIGFzc2VydFNpemUgKHNpemUpIHsKICBpZiAodHlwZW9mIHNpemUgIT09ICdudW1iZXInKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCcic2l6ZSIgYXJndW1lbnQgbXVzdCBiZSBvZiB0eXBlIG51bWJlcicpCiAgfSBlbHNlIGlmIChzaXplIDwgMCkgewogICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1RoZSB2YWx1ZSAiJyArIHNpemUgKyAnIiBpcyBpbnZhbGlkIGZvciBvcHRpb24gInNpemUiJykKICB9Cn0KCmZ1bmN0aW9uIGFsbG9jIChzaXplLCBmaWxsLCBlbmNvZGluZykgewogIGFzc2VydFNpemUoc2l6ZSkKICBpZiAoc2l6ZSA8PSAwKSB7CiAgICByZXR1cm4gY3JlYXRlQnVmZmVyKHNpemUpCiAgfQogIGlmIChmaWxsICE9PSB1bmRlZmluZWQpIHsKICAgIC8vIE9ubHkgcGF5IGF0dGVudGlvbiB0byBlbmNvZGluZyBpZiBpdCdzIGEgc3RyaW5nLiBUaGlzCiAgICAvLyBwcmV2ZW50cyBhY2NpZGVudGFsbHkgc2VuZGluZyBpbiBhIG51bWJlciB0aGF0IHdvdWxkCiAgICAvLyBiZSBpbnRlcnByZXR0ZWQgYXMgYSBzdGFydCBvZmZzZXQuCiAgICByZXR1cm4gdHlwZW9mIGVuY29kaW5nID09PSAnc3RyaW5nJwogICAgICA/IGNyZWF0ZUJ1ZmZlcihzaXplKS5maWxsKGZpbGwsIGVuY29kaW5nKQogICAgICA6IGNyZWF0ZUJ1ZmZlcihzaXplKS5maWxsKGZpbGwpCiAgfQogIHJldHVybiBjcmVhdGVCdWZmZXIoc2l6ZSkKfQoKLyoqCiAqIENyZWF0ZXMgYSBuZXcgZmlsbGVkIEJ1ZmZlciBpbnN0YW5jZS4KICogYWxsb2Moc2l6ZVssIGZpbGxbLCBlbmNvZGluZ11dKQogKiovCkJ1ZmZlci5hbGxvYyA9IGZ1bmN0aW9uIChzaXplLCBmaWxsLCBlbmNvZGluZykgewogIHJldHVybiBhbGxvYyhzaXplLCBmaWxsLCBlbmNvZGluZykKfQoKZnVuY3Rpb24gYWxsb2NVbnNhZmUgKHNpemUpIHsKICBhc3NlcnRTaXplKHNpemUpCiAgcmV0dXJuIGNyZWF0ZUJ1ZmZlcihzaXplIDwgMCA/IDAgOiBjaGVja2VkKHNpemUpIHwgMCkKfQoKLyoqCiAqIEVxdWl2YWxlbnQgdG8gQnVmZmVyKG51bSksIGJ5IGRlZmF1bHQgY3JlYXRlcyBhIG5vbi16ZXJvLWZpbGxlZCBCdWZmZXIgaW5zdGFuY2UuCiAqICovCkJ1ZmZlci5hbGxvY1Vuc2FmZSA9IGZ1bmN0aW9uIChzaXplKSB7CiAgcmV0dXJuIGFsbG9jVW5zYWZlKHNpemUpCn0KLyoqCiAqIEVxdWl2YWxlbnQgdG8gU2xvd0J1ZmZlcihudW0pLCBieSBkZWZhdWx0IGNyZWF0ZXMgYSBub24temVyby1maWxsZWQgQnVmZmVyIGluc3RhbmNlLgogKi8KQnVmZmVyLmFsbG9jVW5zYWZlU2xvdyA9IGZ1bmN0aW9uIChzaXplKSB7CiAgcmV0dXJuIGFsbG9jVW5zYWZlKHNpemUpCn0KCmZ1bmN0aW9uIGZyb21TdHJpbmcgKHN0cmluZywgZW5jb2RpbmcpIHsKICBpZiAodHlwZW9mIGVuY29kaW5nICE9PSAnc3RyaW5nJyB8fCBlbmNvZGluZyA9PT0gJycpIHsKICAgIGVuY29kaW5nID0gJ3V0ZjgnCiAgfQoKICBpZiAoIUJ1ZmZlci5pc0VuY29kaW5nKGVuY29kaW5nKSkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVW5rbm93biBlbmNvZGluZzogJyArIGVuY29kaW5nKQogIH0KCiAgdmFyIGxlbmd0aCA9IGJ5dGVMZW5ndGgoc3RyaW5nLCBlbmNvZGluZykgfCAwCiAgdmFyIGJ1ZiA9IGNyZWF0ZUJ1ZmZlcihsZW5ndGgpCgogIHZhciBhY3R1YWwgPSBidWYud3JpdGUoc3RyaW5nLCBlbmNvZGluZykKCiAgaWYgKGFjdHVhbCAhPT0gbGVuZ3RoKSB7CiAgICAvLyBXcml0aW5nIGEgaGV4IHN0cmluZywgZm9yIGV4YW1wbGUsIHRoYXQgY29udGFpbnMgaW52YWxpZCBjaGFyYWN0ZXJzIHdpbGwKICAgIC8vIGNhdXNlIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0IGludmFsaWQgY2hhcmFjdGVyIHRvIGJlIGlnbm9yZWQuIChlLmcuCiAgICAvLyAnYWJ4eGNkJyB3aWxsIGJlIHRyZWF0ZWQgYXMgJ2FiJykKICAgIGJ1ZiA9IGJ1Zi5zbGljZSgwLCBhY3R1YWwpCiAgfQoKICByZXR1cm4gYnVmCn0KCmZ1bmN0aW9uIGZyb21BcnJheUxpa2UgKGFycmF5KSB7CiAgdmFyIGxlbmd0aCA9IGFycmF5Lmxlbmd0aCA8IDAgPyAwIDogY2hlY2tlZChhcnJheS5sZW5ndGgpIHwgMAogIHZhciBidWYgPSBjcmVhdGVCdWZmZXIobGVuZ3RoKQogIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpICs9IDEpIHsKICAgIGJ1ZltpXSA9IGFycmF5W2ldICYgMjU1CiAgfQogIHJldHVybiBidWYKfQoKZnVuY3Rpb24gZnJvbUFycmF5QnVmZmVyIChhcnJheSwgYnl0ZU9mZnNldCwgbGVuZ3RoKSB7CiAgaWYgKGJ5dGVPZmZzZXQgPCAwIHx8IGFycmF5LmJ5dGVMZW5ndGggPCBieXRlT2Zmc2V0KSB7CiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignIm9mZnNldCIgaXMgb3V0c2lkZSBvZiBidWZmZXIgYm91bmRzJykKICB9CgogIGlmIChhcnJheS5ieXRlTGVuZ3RoIDwgYnl0ZU9mZnNldCArIChsZW5ndGggfHwgMCkpIHsKICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCcibGVuZ3RoIiBpcyBvdXRzaWRlIG9mIGJ1ZmZlciBib3VuZHMnKQogIH0KCiAgdmFyIGJ1ZgogIGlmIChieXRlT2Zmc2V0ID09PSB1bmRlZmluZWQgJiYgbGVuZ3RoID09PSB1bmRlZmluZWQpIHsKICAgIGJ1ZiA9IG5ldyBVaW50OEFycmF5KGFycmF5KQogIH0gZWxzZSBpZiAobGVuZ3RoID09PSB1bmRlZmluZWQpIHsKICAgIGJ1ZiA9IG5ldyBVaW50OEFycmF5KGFycmF5LCBieXRlT2Zmc2V0KQogIH0gZWxzZSB7CiAgICBidWYgPSBuZXcgVWludDhBcnJheShhcnJheSwgYnl0ZU9mZnNldCwgbGVuZ3RoKQogIH0KCiAgLy8gUmV0dXJuIGFuIGF1Z21lbnRlZCBgVWludDhBcnJheWAgaW5zdGFuY2UKICBidWYuX19wcm90b19fID0gQnVmZmVyLnByb3RvdHlwZQogIHJldHVybiBidWYKfQoKZnVuY3Rpb24gZnJvbU9iamVjdCAob2JqKSB7CiAgaWYgKEJ1ZmZlci5pc0J1ZmZlcihvYmopKSB7CiAgICB2YXIgbGVuID0gY2hlY2tlZChvYmoubGVuZ3RoKSB8IDAKICAgIHZhciBidWYgPSBjcmVhdGVCdWZmZXIobGVuKQoKICAgIGlmIChidWYubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBidWYKICAgIH0KCiAgICBvYmouY29weShidWYsIDAsIDAsIGxlbikKICAgIHJldHVybiBidWYKICB9CgogIGlmIChvYmoubGVuZ3RoICE9PSB1bmRlZmluZWQpIHsKICAgIGlmICh0eXBlb2Ygb2JqLmxlbmd0aCAhPT0gJ251bWJlcicgfHwgbnVtYmVySXNOYU4ob2JqLmxlbmd0aCkpIHsKICAgICAgcmV0dXJuIGNyZWF0ZUJ1ZmZlcigwKQogICAgfQogICAgcmV0dXJuIGZyb21BcnJheUxpa2Uob2JqKQogIH0KCiAgaWYgKG9iai50eXBlID09PSAnQnVmZmVyJyAmJiBBcnJheS5pc0FycmF5KG9iai5kYXRhKSkgewogICAgcmV0dXJuIGZyb21BcnJheUxpa2Uob2JqLmRhdGEpCiAgfQp9CgpmdW5jdGlvbiBjaGVja2VkIChsZW5ndGgpIHsKICAvLyBOb3RlOiBjYW5ub3QgdXNlIGBsZW5ndGggPCBLX01BWF9MRU5HVEhgIGhlcmUgYmVjYXVzZSB0aGF0IGZhaWxzIHdoZW4KICAvLyBsZW5ndGggaXMgTmFOICh3aGljaCBpcyBvdGhlcndpc2UgY29lcmNlZCB0byB6ZXJvLikKICBpZiAobGVuZ3RoID49IEtfTUFYX0xFTkdUSCkgewogICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0F0dGVtcHQgdG8gYWxsb2NhdGUgQnVmZmVyIGxhcmdlciB0aGFuIG1heGltdW0gJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAnc2l6ZTogMHgnICsgS19NQVhfTEVOR1RILnRvU3RyaW5nKDE2KSArICcgYnl0ZXMnKQogIH0KICByZXR1cm4gbGVuZ3RoIHwgMAp9CgpmdW5jdGlvbiBTbG93QnVmZmVyIChsZW5ndGgpIHsKICBpZiAoK2xlbmd0aCAhPSBsZW5ndGgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBlcWVxZXEKICAgIGxlbmd0aCA9IDAKICB9CiAgcmV0dXJuIEJ1ZmZlci5hbGxvYygrbGVuZ3RoKQp9CgpCdWZmZXIuaXNCdWZmZXIgPSBmdW5jdGlvbiBpc0J1ZmZlciAoYikgewogIHJldHVybiBiICE9IG51bGwgJiYgYi5faXNCdWZmZXIgPT09IHRydWUgJiYKICAgIGIgIT09IEJ1ZmZlci5wcm90b3R5cGUgLy8gc28gQnVmZmVyLmlzQnVmZmVyKEJ1ZmZlci5wcm90b3R5cGUpIHdpbGwgYmUgZmFsc2UKfQoKQnVmZmVyLmNvbXBhcmUgPSBmdW5jdGlvbiBjb21wYXJlIChhLCBiKSB7CiAgaWYgKGlzSW5zdGFuY2UoYSwgVWludDhBcnJheSkpIGEgPSBCdWZmZXIuZnJvbShhLCBhLm9mZnNldCwgYS5ieXRlTGVuZ3RoKQogIGlmIChpc0luc3RhbmNlKGIsIFVpbnQ4QXJyYXkpKSBiID0gQnVmZmVyLmZyb20oYiwgYi5vZmZzZXQsIGIuYnl0ZUxlbmd0aCkKICBpZiAoIUJ1ZmZlci5pc0J1ZmZlcihhKSB8fCAhQnVmZmVyLmlzQnVmZmVyKGIpKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKAogICAgICAnVGhlICJidWYxIiwgImJ1ZjIiIGFyZ3VtZW50cyBtdXN0IGJlIG9uZSBvZiB0eXBlIEJ1ZmZlciBvciBVaW50OEFycmF5JwogICAgKQogIH0KCiAgaWYgKGEgPT09IGIpIHJldHVybiAwCgogIHZhciB4ID0gYS5sZW5ndGgKICB2YXIgeSA9IGIubGVuZ3RoCgogIGZvciAodmFyIGkgPSAwLCBsZW4gPSBNYXRoLm1pbih4LCB5KTsgaSA8IGxlbjsgKytpKSB7CiAgICBpZiAoYVtpXSAhPT0gYltpXSkgewogICAgICB4ID0gYVtpXQogICAgICB5ID0gYltpXQogICAgICBicmVhawogICAgfQogIH0KCiAgaWYgKHggPCB5KSByZXR1cm4gLTEKICBpZiAoeSA8IHgpIHJldHVybiAxCiAgcmV0dXJuIDAKfQoKQnVmZmVyLmlzRW5jb2RpbmcgPSBmdW5jdGlvbiBpc0VuY29kaW5nIChlbmNvZGluZykgewogIHN3aXRjaCAoU3RyaW5nKGVuY29kaW5nKS50b0xvd2VyQ2FzZSgpKSB7CiAgICBjYXNlICdoZXgnOgogICAgY2FzZSAndXRmOCc6CiAgICBjYXNlICd1dGYtOCc6CiAgICBjYXNlICdhc2NpaSc6CiAgICBjYXNlICdsYXRpbjEnOgogICAgY2FzZSAnYmluYXJ5JzoKICAgIGNhc2UgJ2Jhc2U2NCc6CiAgICBjYXNlICd1Y3MyJzoKICAgIGNhc2UgJ3Vjcy0yJzoKICAgIGNhc2UgJ3V0ZjE2bGUnOgogICAgY2FzZSAndXRmLTE2bGUnOgogICAgICByZXR1cm4gdHJ1ZQogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIGZhbHNlCiAgfQp9CgpCdWZmZXIuY29uY2F0ID0gZnVuY3Rpb24gY29uY2F0IChsaXN0LCBsZW5ndGgpIHsKICBpZiAoIUFycmF5LmlzQXJyYXkobGlzdCkpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJyJsaXN0IiBhcmd1bWVudCBtdXN0IGJlIGFuIEFycmF5IG9mIEJ1ZmZlcnMnKQogIH0KCiAgaWYgKGxpc3QubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gQnVmZmVyLmFsbG9jKDApCiAgfQoKICB2YXIgaQogIGlmIChsZW5ndGggPT09IHVuZGVmaW5lZCkgewogICAgbGVuZ3RoID0gMAogICAgZm9yIChpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyArK2kpIHsKICAgICAgbGVuZ3RoICs9IGxpc3RbaV0ubGVuZ3RoCiAgICB9CiAgfQoKICB2YXIgYnVmZmVyID0gQnVmZmVyLmFsbG9jVW5zYWZlKGxlbmd0aCkKICB2YXIgcG9zID0gMAogIGZvciAoaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgKytpKSB7CiAgICB2YXIgYnVmID0gbGlzdFtpXQogICAgaWYgKGlzSW5zdGFuY2UoYnVmLCBVaW50OEFycmF5KSkgewogICAgICBidWYgPSBCdWZmZXIuZnJvbShidWYpCiAgICB9CiAgICBpZiAoIUJ1ZmZlci5pc0J1ZmZlcihidWYpKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJyJsaXN0IiBhcmd1bWVudCBtdXN0IGJlIGFuIEFycmF5IG9mIEJ1ZmZlcnMnKQogICAgfQogICAgYnVmLmNvcHkoYnVmZmVyLCBwb3MpCiAgICBwb3MgKz0gYnVmLmxlbmd0aAogIH0KICByZXR1cm4gYnVmZmVyCn0KCmZ1bmN0aW9uIGJ5dGVMZW5ndGggKHN0cmluZywgZW5jb2RpbmcpIHsKICBpZiAoQnVmZmVyLmlzQnVmZmVyKHN0cmluZykpIHsKICAgIHJldHVybiBzdHJpbmcubGVuZ3RoCiAgfQogIGlmIChBcnJheUJ1ZmZlci5pc1ZpZXcoc3RyaW5nKSB8fCBpc0luc3RhbmNlKHN0cmluZywgQXJyYXlCdWZmZXIpKSB7CiAgICByZXR1cm4gc3RyaW5nLmJ5dGVMZW5ndGgKICB9CiAgaWYgKHR5cGVvZiBzdHJpbmcgIT09ICdzdHJpbmcnKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKAogICAgICAnVGhlICJzdHJpbmciIGFyZ3VtZW50IG11c3QgYmUgb25lIG9mIHR5cGUgc3RyaW5nLCBCdWZmZXIsIG9yIEFycmF5QnVmZmVyLiAnICsKICAgICAgJ1JlY2VpdmVkIHR5cGUgJyArIHR5cGVvZiBzdHJpbmcKICAgICkKICB9CgogIHZhciBsZW4gPSBzdHJpbmcubGVuZ3RoCiAgdmFyIG11c3RNYXRjaCA9IChhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gPT09IHRydWUpCiAgaWYgKCFtdXN0TWF0Y2ggJiYgbGVuID09PSAwKSByZXR1cm4gMAoKICAvLyBVc2UgYSBmb3IgbG9vcCB0byBhdm9pZCByZWN1cnNpb24KICB2YXIgbG93ZXJlZENhc2UgPSBmYWxzZQogIGZvciAoOzspIHsKICAgIHN3aXRjaCAoZW5jb2RpbmcpIHsKICAgICAgY2FzZSAnYXNjaWknOgogICAgICBjYXNlICdsYXRpbjEnOgogICAgICBjYXNlICdiaW5hcnknOgogICAgICAgIHJldHVybiBsZW4KICAgICAgY2FzZSAndXRmOCc6CiAgICAgIGNhc2UgJ3V0Zi04JzoKICAgICAgICByZXR1cm4gdXRmOFRvQnl0ZXMoc3RyaW5nKS5sZW5ndGgKICAgICAgY2FzZSAndWNzMic6CiAgICAgIGNhc2UgJ3Vjcy0yJzoKICAgICAgY2FzZSAndXRmMTZsZSc6CiAgICAgIGNhc2UgJ3V0Zi0xNmxlJzoKICAgICAgICByZXR1cm4gbGVuICogMgogICAgICBjYXNlICdoZXgnOgogICAgICAgIHJldHVybiBsZW4gPj4+IDEKICAgICAgY2FzZSAnYmFzZTY0JzoKICAgICAgICByZXR1cm4gYmFzZTY0VG9CeXRlcyhzdHJpbmcpLmxlbmd0aAogICAgICBkZWZhdWx0OgogICAgICAgIGlmIChsb3dlcmVkQ2FzZSkgewogICAgICAgICAgcmV0dXJuIG11c3RNYXRjaCA/IC0xIDogdXRmOFRvQnl0ZXMoc3RyaW5nKS5sZW5ndGggLy8gYXNzdW1lIHV0ZjgKICAgICAgICB9CiAgICAgICAgZW5jb2RpbmcgPSAoJycgKyBlbmNvZGluZykudG9Mb3dlckNhc2UoKQogICAgICAgIGxvd2VyZWRDYXNlID0gdHJ1ZQogICAgfQogIH0KfQpCdWZmZXIuYnl0ZUxlbmd0aCA9IGJ5dGVMZW5ndGgKCmZ1bmN0aW9uIHNsb3dUb1N0cmluZyAoZW5jb2RpbmcsIHN0YXJ0LCBlbmQpIHsKICB2YXIgbG93ZXJlZENhc2UgPSBmYWxzZQoKICAvLyBObyBuZWVkIHRvIHZlcmlmeSB0aGF0ICJ0aGlzLmxlbmd0aCA8PSBNQVhfVUlOVDMyIiBzaW5jZSBpdCdzIGEgcmVhZC1vbmx5CiAgLy8gcHJvcGVydHkgb2YgYSB0eXBlZCBhcnJheS4KCiAgLy8gVGhpcyBiZWhhdmVzIG5laXRoZXIgbGlrZSBTdHJpbmcgbm9yIFVpbnQ4QXJyYXkgaW4gdGhhdCB3ZSBzZXQgc3RhcnQvZW5kCiAgLy8gdG8gdGhlaXIgdXBwZXIvbG93ZXIgYm91bmRzIGlmIHRoZSB2YWx1ZSBwYXNzZWQgaXMgb3V0IG9mIHJhbmdlLgogIC8vIHVuZGVmaW5lZCBpcyBoYW5kbGVkIHNwZWNpYWxseSBhcyBwZXIgRUNNQS0yNjIgNnRoIEVkaXRpb24sCiAgLy8gU2VjdGlvbiAxMy4zLjMuNyBSdW50aW1lIFNlbWFudGljczogS2V5ZWRCaW5kaW5nSW5pdGlhbGl6YXRpb24uCiAgaWYgKHN0YXJ0ID09PSB1bmRlZmluZWQgfHwgc3RhcnQgPCAwKSB7CiAgICBzdGFydCA9IDAKICB9CiAgLy8gUmV0dXJuIGVhcmx5IGlmIHN0YXJ0ID4gdGhpcy5sZW5ndGguIERvbmUgaGVyZSB0byBwcmV2ZW50IHBvdGVudGlhbCB1aW50MzIKICAvLyBjb2VyY2lvbiBmYWlsIGJlbG93LgogIGlmIChzdGFydCA+IHRoaXMubGVuZ3RoKSB7CiAgICByZXR1cm4gJycKICB9CgogIGlmIChlbmQgPT09IHVuZGVmaW5lZCB8fCBlbmQgPiB0aGlzLmxlbmd0aCkgewogICAgZW5kID0gdGhpcy5sZW5ndGgKICB9CgogIGlmIChlbmQgPD0gMCkgewogICAgcmV0dXJuICcnCiAgfQoKICAvLyBGb3JjZSBjb2Vyc2lvbiB0byB1aW50MzIuIFRoaXMgd2lsbCBhbHNvIGNvZXJjZSBmYWxzZXkvTmFOIHZhbHVlcyB0byAwLgogIGVuZCA+Pj49IDAKICBzdGFydCA+Pj49IDAKCiAgaWYgKGVuZCA8PSBzdGFydCkgewogICAgcmV0dXJuICcnCiAgfQoKICBpZiAoIWVuY29kaW5nKSBlbmNvZGluZyA9ICd1dGY4JwoKICB3aGlsZSAodHJ1ZSkgewogICAgc3dpdGNoIChlbmNvZGluZykgewogICAgICBjYXNlICdoZXgnOgogICAgICAgIHJldHVybiBoZXhTbGljZSh0aGlzLCBzdGFydCwgZW5kKQoKICAgICAgY2FzZSAndXRmOCc6CiAgICAgIGNhc2UgJ3V0Zi04JzoKICAgICAgICByZXR1cm4gdXRmOFNsaWNlKHRoaXMsIHN0YXJ0LCBlbmQpCgogICAgICBjYXNlICdhc2NpaSc6CiAgICAgICAgcmV0dXJuIGFzY2lpU2xpY2UodGhpcywgc3RhcnQsIGVuZCkKCiAgICAgIGNhc2UgJ2xhdGluMSc6CiAgICAgIGNhc2UgJ2JpbmFyeSc6CiAgICAgICAgcmV0dXJuIGxhdGluMVNsaWNlKHRoaXMsIHN0YXJ0LCBlbmQpCgogICAgICBjYXNlICdiYXNlNjQnOgogICAgICAgIHJldHVybiBiYXNlNjRTbGljZSh0aGlzLCBzdGFydCwgZW5kKQoKICAgICAgY2FzZSAndWNzMic6CiAgICAgIGNhc2UgJ3Vjcy0yJzoKICAgICAgY2FzZSAndXRmMTZsZSc6CiAgICAgIGNhc2UgJ3V0Zi0xNmxlJzoKICAgICAgICByZXR1cm4gdXRmMTZsZVNsaWNlKHRoaXMsIHN0YXJ0LCBlbmQpCgogICAgICBkZWZhdWx0OgogICAgICAgIGlmIChsb3dlcmVkQ2FzZSkgdGhyb3cgbmV3IFR5cGVFcnJvcignVW5rbm93biBlbmNvZGluZzogJyArIGVuY29kaW5nKQogICAgICAgIGVuY29kaW5nID0gKGVuY29kaW5nICsgJycpLnRvTG93ZXJDYXNlKCkKICAgICAgICBsb3dlcmVkQ2FzZSA9IHRydWUKICAgIH0KICB9Cn0KCi8vIFRoaXMgcHJvcGVydHkgaXMgdXNlZCBieSBgQnVmZmVyLmlzQnVmZmVyYCAoYW5kIHRoZSBgaXMtYnVmZmVyYCBucG0gcGFja2FnZSkKLy8gdG8gZGV0ZWN0IGEgQnVmZmVyIGluc3RhbmNlLiBJdCdzIG5vdCBwb3NzaWJsZSB0byB1c2UgYGluc3RhbmNlb2YgQnVmZmVyYAovLyByZWxpYWJseSBpbiBhIGJyb3dzZXJpZnkgY29udGV4dCBiZWNhdXNlIHRoZXJlIGNvdWxkIGJlIG11bHRpcGxlIGRpZmZlcmVudAovLyBjb3BpZXMgb2YgdGhlICdidWZmZXInIHBhY2thZ2UgaW4gdXNlLiBUaGlzIG1ldGhvZCB3b3JrcyBldmVuIGZvciBCdWZmZXIKLy8gaW5zdGFuY2VzIHRoYXQgd2VyZSBjcmVhdGVkIGZyb20gYW5vdGhlciBjb3B5IG9mIHRoZSBgYnVmZmVyYCBwYWNrYWdlLgovLyBTZWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9mZXJvc3MvYnVmZmVyL2lzc3Vlcy8xNTQKQnVmZmVyLnByb3RvdHlwZS5faXNCdWZmZXIgPSB0cnVlCgpmdW5jdGlvbiBzd2FwIChiLCBuLCBtKSB7CiAgdmFyIGkgPSBiW25dCiAgYltuXSA9IGJbbV0KICBiW21dID0gaQp9CgpCdWZmZXIucHJvdG90eXBlLnN3YXAxNiA9IGZ1bmN0aW9uIHN3YXAxNiAoKSB7CiAgdmFyIGxlbiA9IHRoaXMubGVuZ3RoCiAgaWYgKGxlbiAlIDIgIT09IDApIHsKICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdCdWZmZXIgc2l6ZSBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgMTYtYml0cycpCiAgfQogIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpICs9IDIpIHsKICAgIHN3YXAodGhpcywgaSwgaSArIDEpCiAgfQogIHJldHVybiB0aGlzCn0KCkJ1ZmZlci5wcm90b3R5cGUuc3dhcDMyID0gZnVuY3Rpb24gc3dhcDMyICgpIHsKICB2YXIgbGVuID0gdGhpcy5sZW5ndGgKICBpZiAobGVuICUgNCAhPT0gMCkgewogICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0J1ZmZlciBzaXplIG11c3QgYmUgYSBtdWx0aXBsZSBvZiAzMi1iaXRzJykKICB9CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkgKz0gNCkgewogICAgc3dhcCh0aGlzLCBpLCBpICsgMykKICAgIHN3YXAodGhpcywgaSArIDEsIGkgKyAyKQogIH0KICByZXR1cm4gdGhpcwp9CgpCdWZmZXIucHJvdG90eXBlLnN3YXA2NCA9IGZ1bmN0aW9uIHN3YXA2NCAoKSB7CiAgdmFyIGxlbiA9IHRoaXMubGVuZ3RoCiAgaWYgKGxlbiAlIDggIT09IDApIHsKICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdCdWZmZXIgc2l6ZSBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgNjQtYml0cycpCiAgfQogIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpICs9IDgpIHsKICAgIHN3YXAodGhpcywgaSwgaSArIDcpCiAgICBzd2FwKHRoaXMsIGkgKyAxLCBpICsgNikKICAgIHN3YXAodGhpcywgaSArIDIsIGkgKyA1KQogICAgc3dhcCh0aGlzLCBpICsgMywgaSArIDQpCiAgfQogIHJldHVybiB0aGlzCn0KCkJ1ZmZlci5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiB0b1N0cmluZyAoKSB7CiAgdmFyIGxlbmd0aCA9IHRoaXMubGVuZ3RoCiAgaWYgKGxlbmd0aCA9PT0gMCkgcmV0dXJuICcnCiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHJldHVybiB1dGY4U2xpY2UodGhpcywgMCwgbGVuZ3RoKQogIHJldHVybiBzbG93VG9TdHJpbmcuYXBwbHkodGhpcywgYXJndW1lbnRzKQp9CgpCdWZmZXIucHJvdG90eXBlLnRvTG9jYWxlU3RyaW5nID0gQnVmZmVyLnByb3RvdHlwZS50b1N0cmluZwoKQnVmZmVyLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiBlcXVhbHMgKGIpIHsKICBpZiAoIUJ1ZmZlci5pc0J1ZmZlcihiKSkgdGhyb3cgbmV3IFR5cGVFcnJvcignQXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlcicpCiAgaWYgKHRoaXMgPT09IGIpIHJldHVybiB0cnVlCiAgcmV0dXJuIEJ1ZmZlci5jb21wYXJlKHRoaXMsIGIpID09PSAwCn0KCkJ1ZmZlci5wcm90b3R5cGUuaW5zcGVjdCA9IGZ1bmN0aW9uIGluc3BlY3QgKCkgewogIHZhciBzdHIgPSAnJwogIHZhciBtYXggPSBleHBvcnRzLklOU1BFQ1RfTUFYX0JZVEVTCiAgc3RyID0gdGhpcy50b1N0cmluZygnaGV4JywgMCwgbWF4KS5yZXBsYWNlKC8oLnsyfSkvZywgJyQxICcpLnRyaW0oKQogIGlmICh0aGlzLmxlbmd0aCA+IG1heCkgc3RyICs9ICcgLi4uICcKICByZXR1cm4gJzxCdWZmZXIgJyArIHN0ciArICc+Jwp9CgpCdWZmZXIucHJvdG90eXBlLmNvbXBhcmUgPSBmdW5jdGlvbiBjb21wYXJlICh0YXJnZXQsIHN0YXJ0LCBlbmQsIHRoaXNTdGFydCwgdGhpc0VuZCkgewogIGlmIChpc0luc3RhbmNlKHRhcmdldCwgVWludDhBcnJheSkpIHsKICAgIHRhcmdldCA9IEJ1ZmZlci5mcm9tKHRhcmdldCwgdGFyZ2V0Lm9mZnNldCwgdGFyZ2V0LmJ5dGVMZW5ndGgpCiAgfQogIGlmICghQnVmZmVyLmlzQnVmZmVyKHRhcmdldCkpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoCiAgICAgICdUaGUgInRhcmdldCIgYXJndW1lbnQgbXVzdCBiZSBvbmUgb2YgdHlwZSBCdWZmZXIgb3IgVWludDhBcnJheS4gJyArCiAgICAgICdSZWNlaXZlZCB0eXBlICcgKyAodHlwZW9mIHRhcmdldCkKICAgICkKICB9CgogIGlmIChzdGFydCA9PT0gdW5kZWZpbmVkKSB7CiAgICBzdGFydCA9IDAKICB9CiAgaWYgKGVuZCA9PT0gdW5kZWZpbmVkKSB7CiAgICBlbmQgPSB0YXJnZXQgPyB0YXJnZXQubGVuZ3RoIDogMAogIH0KICBpZiAodGhpc1N0YXJ0ID09PSB1bmRlZmluZWQpIHsKICAgIHRoaXNTdGFydCA9IDAKICB9CiAgaWYgKHRoaXNFbmQgPT09IHVuZGVmaW5lZCkgewogICAgdGhpc0VuZCA9IHRoaXMubGVuZ3RoCiAgfQoKICBpZiAoc3RhcnQgPCAwIHx8IGVuZCA+IHRhcmdldC5sZW5ndGggfHwgdGhpc1N0YXJ0IDwgMCB8fCB0aGlzRW5kID4gdGhpcy5sZW5ndGgpIHsKICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdvdXQgb2YgcmFuZ2UgaW5kZXgnKQogIH0KCiAgaWYgKHRoaXNTdGFydCA+PSB0aGlzRW5kICYmIHN0YXJ0ID49IGVuZCkgewogICAgcmV0dXJuIDAKICB9CiAgaWYgKHRoaXNTdGFydCA+PSB0aGlzRW5kKSB7CiAgICByZXR1cm4gLTEKICB9CiAgaWYgKHN0YXJ0ID49IGVuZCkgewogICAgcmV0dXJuIDEKICB9CgogIHN0YXJ0ID4+Pj0gMAogIGVuZCA+Pj49IDAKICB0aGlzU3RhcnQgPj4+PSAwCiAgdGhpc0VuZCA+Pj49IDAKCiAgaWYgKHRoaXMgPT09IHRhcmdldCkgcmV0dXJuIDAKCiAgdmFyIHggPSB0aGlzRW5kIC0gdGhpc1N0YXJ0CiAgdmFyIHkgPSBlbmQgLSBzdGFydAogIHZhciBsZW4gPSBNYXRoLm1pbih4LCB5KQoKICB2YXIgdGhpc0NvcHkgPSB0aGlzLnNsaWNlKHRoaXNTdGFydCwgdGhpc0VuZCkKICB2YXIgdGFyZ2V0Q29weSA9IHRhcmdldC5zbGljZShzdGFydCwgZW5kKQoKICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgKytpKSB7CiAgICBpZiAodGhpc0NvcHlbaV0gIT09IHRhcmdldENvcHlbaV0pIHsKICAgICAgeCA9IHRoaXNDb3B5W2ldCiAgICAgIHkgPSB0YXJnZXRDb3B5W2ldCiAgICAgIGJyZWFrCiAgICB9CiAgfQoKICBpZiAoeCA8IHkpIHJldHVybiAtMQogIGlmICh5IDwgeCkgcmV0dXJuIDEKICByZXR1cm4gMAp9CgovLyBGaW5kcyBlaXRoZXIgdGhlIGZpcnN0IGluZGV4IG9mIGB2YWxgIGluIGBidWZmZXJgIGF0IG9mZnNldCA+PSBgYnl0ZU9mZnNldGAsCi8vIE9SIHRoZSBsYXN0IGluZGV4IG9mIGB2YWxgIGluIGBidWZmZXJgIGF0IG9mZnNldCA8PSBgYnl0ZU9mZnNldGAuCi8vCi8vIEFyZ3VtZW50czoKLy8gLSBidWZmZXIgLSBhIEJ1ZmZlciB0byBzZWFyY2gKLy8gLSB2YWwgLSBhIHN0cmluZywgQnVmZmVyLCBvciBudW1iZXIKLy8gLSBieXRlT2Zmc2V0IC0gYW4gaW5kZXggaW50byBgYnVmZmVyYDsgd2lsbCBiZSBjbGFtcGVkIHRvIGFuIGludDMyCi8vIC0gZW5jb2RpbmcgLSBhbiBvcHRpb25hbCBlbmNvZGluZywgcmVsZXZhbnQgaXMgdmFsIGlzIGEgc3RyaW5nCi8vIC0gZGlyIC0gdHJ1ZSBmb3IgaW5kZXhPZiwgZmFsc2UgZm9yIGxhc3RJbmRleE9mCmZ1bmN0aW9uIGJpZGlyZWN0aW9uYWxJbmRleE9mIChidWZmZXIsIHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcsIGRpcikgewogIC8vIEVtcHR5IGJ1ZmZlciBtZWFucyBubyBtYXRjaAogIGlmIChidWZmZXIubGVuZ3RoID09PSAwKSByZXR1cm4gLTEKCiAgLy8gTm9ybWFsaXplIGJ5dGVPZmZzZXQKICBpZiAodHlwZW9mIGJ5dGVPZmZzZXQgPT09ICdzdHJpbmcnKSB7CiAgICBlbmNvZGluZyA9IGJ5dGVPZmZzZXQKICAgIGJ5dGVPZmZzZXQgPSAwCiAgfSBlbHNlIGlmIChieXRlT2Zmc2V0ID4gMHg3ZmZmZmZmZikgewogICAgYnl0ZU9mZnNldCA9IDB4N2ZmZmZmZmYKICB9IGVsc2UgaWYgKGJ5dGVPZmZzZXQgPCAtMHg4MDAwMDAwMCkgewogICAgYnl0ZU9mZnNldCA9IC0weDgwMDAwMDAwCiAgfQogIGJ5dGVPZmZzZXQgPSArYnl0ZU9mZnNldCAvLyBDb2VyY2UgdG8gTnVtYmVyLgogIGlmIChudW1iZXJJc05hTihieXRlT2Zmc2V0KSkgewogICAgLy8gYnl0ZU9mZnNldDogaXQgaXQncyB1bmRlZmluZWQsIG51bGwsIE5hTiwgImZvbyIsIGV0Yywgc2VhcmNoIHdob2xlIGJ1ZmZlcgogICAgYnl0ZU9mZnNldCA9IGRpciA/IDAgOiAoYnVmZmVyLmxlbmd0aCAtIDEpCiAgfQoKICAvLyBOb3JtYWxpemUgYnl0ZU9mZnNldDogbmVnYXRpdmUgb2Zmc2V0cyBzdGFydCBmcm9tIHRoZSBlbmQgb2YgdGhlIGJ1ZmZlcgogIGlmIChieXRlT2Zmc2V0IDwgMCkgYnl0ZU9mZnNldCA9IGJ1ZmZlci5sZW5ndGggKyBieXRlT2Zmc2V0CiAgaWYgKGJ5dGVPZmZzZXQgPj0gYnVmZmVyLmxlbmd0aCkgewogICAgaWYgKGRpcikgcmV0dXJuIC0xCiAgICBlbHNlIGJ5dGVPZmZzZXQgPSBidWZmZXIubGVuZ3RoIC0gMQogIH0gZWxzZSBpZiAoYnl0ZU9mZnNldCA8IDApIHsKICAgIGlmIChkaXIpIGJ5dGVPZmZzZXQgPSAwCiAgICBlbHNlIHJldHVybiAtMQogIH0KCiAgLy8gTm9ybWFsaXplIHZhbAogIGlmICh0eXBlb2YgdmFsID09PSAnc3RyaW5nJykgewogICAgdmFsID0gQnVmZmVyLmZyb20odmFsLCBlbmNvZGluZykKICB9CgogIC8vIEZpbmFsbHksIHNlYXJjaCBlaXRoZXIgaW5kZXhPZiAoaWYgZGlyIGlzIHRydWUpIG9yIGxhc3RJbmRleE9mCiAgaWYgKEJ1ZmZlci5pc0J1ZmZlcih2YWwpKSB7CiAgICAvLyBTcGVjaWFsIGNhc2U6IGxvb2tpbmcgZm9yIGVtcHR5IHN0cmluZy9idWZmZXIgYWx3YXlzIGZhaWxzCiAgICBpZiAodmFsLmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm4gLTEKICAgIH0KICAgIHJldHVybiBhcnJheUluZGV4T2YoYnVmZmVyLCB2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCBkaXIpCiAgfSBlbHNlIGlmICh0eXBlb2YgdmFsID09PSAnbnVtYmVyJykgewogICAgdmFsID0gdmFsICYgMHhGRiAvLyBTZWFyY2ggZm9yIGEgYnl0ZSB2YWx1ZSBbMC0yNTVdCiAgICBpZiAodHlwZW9mIFVpbnQ4QXJyYXkucHJvdG90eXBlLmluZGV4T2YgPT09ICdmdW5jdGlvbicpIHsKICAgICAgaWYgKGRpcikgewogICAgICAgIHJldHVybiBVaW50OEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwoYnVmZmVyLCB2YWwsIGJ5dGVPZmZzZXQpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIFVpbnQ4QXJyYXkucHJvdG90eXBlLmxhc3RJbmRleE9mLmNhbGwoYnVmZmVyLCB2YWwsIGJ5dGVPZmZzZXQpCiAgICAgIH0KICAgIH0KICAgIHJldHVybiBhcnJheUluZGV4T2YoYnVmZmVyLCBbIHZhbCBdLCBieXRlT2Zmc2V0LCBlbmNvZGluZywgZGlyKQogIH0KCiAgdGhyb3cgbmV3IFR5cGVFcnJvcigndmFsIG11c3QgYmUgc3RyaW5nLCBudW1iZXIgb3IgQnVmZmVyJykKfQoKZnVuY3Rpb24gYXJyYXlJbmRleE9mIChhcnIsIHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcsIGRpcikgewogIHZhciBpbmRleFNpemUgPSAxCiAgdmFyIGFyckxlbmd0aCA9IGFyci5sZW5ndGgKICB2YXIgdmFsTGVuZ3RoID0gdmFsLmxlbmd0aAoKICBpZiAoZW5jb2RpbmcgIT09IHVuZGVmaW5lZCkgewogICAgZW5jb2RpbmcgPSBTdHJpbmcoZW5jb2RpbmcpLnRvTG93ZXJDYXNlKCkKICAgIGlmIChlbmNvZGluZyA9PT0gJ3VjczInIHx8IGVuY29kaW5nID09PSAndWNzLTInIHx8CiAgICAgICAgZW5jb2RpbmcgPT09ICd1dGYxNmxlJyB8fCBlbmNvZGluZyA9PT0gJ3V0Zi0xNmxlJykgewogICAgICBpZiAoYXJyLmxlbmd0aCA8IDIgfHwgdmFsLmxlbmd0aCA8IDIpIHsKICAgICAgICByZXR1cm4gLTEKICAgICAgfQogICAgICBpbmRleFNpemUgPSAyCiAgICAgIGFyckxlbmd0aCAvPSAyCiAgICAgIHZhbExlbmd0aCAvPSAyCiAgICAgIGJ5dGVPZmZzZXQgLz0gMgogICAgfQogIH0KCiAgZnVuY3Rpb24gcmVhZCAoYnVmLCBpKSB7CiAgICBpZiAoaW5kZXhTaXplID09PSAxKSB7CiAgICAgIHJldHVybiBidWZbaV0KICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBidWYucmVhZFVJbnQxNkJFKGkgKiBpbmRleFNpemUpCiAgICB9CiAgfQoKICB2YXIgaQogIGlmIChkaXIpIHsKICAgIHZhciBmb3VuZEluZGV4ID0gLTEKICAgIGZvciAoaSA9IGJ5dGVPZmZzZXQ7IGkgPCBhcnJMZW5ndGg7IGkrKykgewogICAgICBpZiAocmVhZChhcnIsIGkpID09PSByZWFkKHZhbCwgZm91bmRJbmRleCA9PT0gLTEgPyAwIDogaSAtIGZvdW5kSW5kZXgpKSB7CiAgICAgICAgaWYgKGZvdW5kSW5kZXggPT09IC0xKSBmb3VuZEluZGV4ID0gaQogICAgICAgIGlmIChpIC0gZm91bmRJbmRleCArIDEgPT09IHZhbExlbmd0aCkgcmV0dXJuIGZvdW5kSW5kZXggKiBpbmRleFNpemUKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoZm91bmRJbmRleCAhPT0gLTEpIGkgLT0gaSAtIGZvdW5kSW5kZXgKICAgICAgICBmb3VuZEluZGV4ID0gLTEKICAgICAgfQogICAgfQogIH0gZWxzZSB7CiAgICBpZiAoYnl0ZU9mZnNldCArIHZhbExlbmd0aCA+IGFyckxlbmd0aCkgYnl0ZU9mZnNldCA9IGFyckxlbmd0aCAtIHZhbExlbmd0aAogICAgZm9yIChpID0gYnl0ZU9mZnNldDsgaSA+PSAwOyBpLS0pIHsKICAgICAgdmFyIGZvdW5kID0gdHJ1ZQogICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHZhbExlbmd0aDsgaisrKSB7CiAgICAgICAgaWYgKHJlYWQoYXJyLCBpICsgaikgIT09IHJlYWQodmFsLCBqKSkgewogICAgICAgICAgZm91bmQgPSBmYWxzZQogICAgICAgICAgYnJlYWsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGZvdW5kKSByZXR1cm4gaQogICAgfQogIH0KCiAgcmV0dXJuIC0xCn0KCkJ1ZmZlci5wcm90b3R5cGUuaW5jbHVkZXMgPSBmdW5jdGlvbiBpbmNsdWRlcyAodmFsLCBieXRlT2Zmc2V0LCBlbmNvZGluZykgewogIHJldHVybiB0aGlzLmluZGV4T2YodmFsLCBieXRlT2Zmc2V0LCBlbmNvZGluZykgIT09IC0xCn0KCkJ1ZmZlci5wcm90b3R5cGUuaW5kZXhPZiA9IGZ1bmN0aW9uIGluZGV4T2YgKHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcpIHsKICByZXR1cm4gYmlkaXJlY3Rpb25hbEluZGV4T2YodGhpcywgdmFsLCBieXRlT2Zmc2V0LCBlbmNvZGluZywgdHJ1ZSkKfQoKQnVmZmVyLnByb3RvdHlwZS5sYXN0SW5kZXhPZiA9IGZ1bmN0aW9uIGxhc3RJbmRleE9mICh2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nKSB7CiAgcmV0dXJuIGJpZGlyZWN0aW9uYWxJbmRleE9mKHRoaXMsIHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcsIGZhbHNlKQp9CgpmdW5jdGlvbiBoZXhXcml0ZSAoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7CiAgb2Zmc2V0ID0gTnVtYmVyKG9mZnNldCkgfHwgMAogIHZhciByZW1haW5pbmcgPSBidWYubGVuZ3RoIC0gb2Zmc2V0CiAgaWYgKCFsZW5ndGgpIHsKICAgIGxlbmd0aCA9IHJlbWFpbmluZwogIH0gZWxzZSB7CiAgICBsZW5ndGggPSBOdW1iZXIobGVuZ3RoKQogICAgaWYgKGxlbmd0aCA+IHJlbWFpbmluZykgewogICAgICBsZW5ndGggPSByZW1haW5pbmcKICAgIH0KICB9CgogIHZhciBzdHJMZW4gPSBzdHJpbmcubGVuZ3RoCgogIGlmIChsZW5ndGggPiBzdHJMZW4gLyAyKSB7CiAgICBsZW5ndGggPSBzdHJMZW4gLyAyCiAgfQogIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgIHZhciBwYXJzZWQgPSBwYXJzZUludChzdHJpbmcuc3Vic3RyKGkgKiAyLCAyKSwgMTYpCiAgICBpZiAobnVtYmVySXNOYU4ocGFyc2VkKSkgcmV0dXJuIGkKICAgIGJ1ZltvZmZzZXQgKyBpXSA9IHBhcnNlZAogIH0KICByZXR1cm4gaQp9CgpmdW5jdGlvbiB1dGY4V3JpdGUgKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkgewogIHJldHVybiBibGl0QnVmZmVyKHV0ZjhUb0J5dGVzKHN0cmluZywgYnVmLmxlbmd0aCAtIG9mZnNldCksIGJ1Ziwgb2Zmc2V0LCBsZW5ndGgpCn0KCmZ1bmN0aW9uIGFzY2lpV3JpdGUgKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkgewogIHJldHVybiBibGl0QnVmZmVyKGFzY2lpVG9CeXRlcyhzdHJpbmcpLCBidWYsIG9mZnNldCwgbGVuZ3RoKQp9CgpmdW5jdGlvbiBsYXRpbjFXcml0ZSAoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7CiAgcmV0dXJuIGFzY2lpV3JpdGUoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKQp9CgpmdW5jdGlvbiBiYXNlNjRXcml0ZSAoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7CiAgcmV0dXJuIGJsaXRCdWZmZXIoYmFzZTY0VG9CeXRlcyhzdHJpbmcpLCBidWYsIG9mZnNldCwgbGVuZ3RoKQp9CgpmdW5jdGlvbiB1Y3MyV3JpdGUgKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkgewogIHJldHVybiBibGl0QnVmZmVyKHV0ZjE2bGVUb0J5dGVzKHN0cmluZywgYnVmLmxlbmd0aCAtIG9mZnNldCksIGJ1Ziwgb2Zmc2V0LCBsZW5ndGgpCn0KCkJ1ZmZlci5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbiB3cml0ZSAoc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCwgZW5jb2RpbmcpIHsKICAvLyBCdWZmZXIjd3JpdGUoc3RyaW5nKQogIGlmIChvZmZzZXQgPT09IHVuZGVmaW5lZCkgewogICAgZW5jb2RpbmcgPSAndXRmOCcKICAgIGxlbmd0aCA9IHRoaXMubGVuZ3RoCiAgICBvZmZzZXQgPSAwCiAgLy8gQnVmZmVyI3dyaXRlKHN0cmluZywgZW5jb2RpbmcpCiAgfSBlbHNlIGlmIChsZW5ndGggPT09IHVuZGVmaW5lZCAmJiB0eXBlb2Ygb2Zmc2V0ID09PSAnc3RyaW5nJykgewogICAgZW5jb2RpbmcgPSBvZmZzZXQKICAgIGxlbmd0aCA9IHRoaXMubGVuZ3RoCiAgICBvZmZzZXQgPSAwCiAgLy8gQnVmZmVyI3dyaXRlKHN0cmluZywgb2Zmc2V0WywgbGVuZ3RoXVssIGVuY29kaW5nXSkKICB9IGVsc2UgaWYgKGlzRmluaXRlKG9mZnNldCkpIHsKICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMAogICAgaWYgKGlzRmluaXRlKGxlbmd0aCkpIHsKICAgICAgbGVuZ3RoID0gbGVuZ3RoID4+PiAwCiAgICAgIGlmIChlbmNvZGluZyA9PT0gdW5kZWZpbmVkKSBlbmNvZGluZyA9ICd1dGY4JwogICAgfSBlbHNlIHsKICAgICAgZW5jb2RpbmcgPSBsZW5ndGgKICAgICAgbGVuZ3RoID0gdW5kZWZpbmVkCiAgICB9CiAgfSBlbHNlIHsKICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgJ0J1ZmZlci53cml0ZShzdHJpbmcsIGVuY29kaW5nLCBvZmZzZXRbLCBsZW5ndGhdKSBpcyBubyBsb25nZXIgc3VwcG9ydGVkJwogICAgKQogIH0KCiAgdmFyIHJlbWFpbmluZyA9IHRoaXMubGVuZ3RoIC0gb2Zmc2V0CiAgaWYgKGxlbmd0aCA9PT0gdW5kZWZpbmVkIHx8IGxlbmd0aCA+IHJlbWFpbmluZykgbGVuZ3RoID0gcmVtYWluaW5nCgogIGlmICgoc3RyaW5nLmxlbmd0aCA+IDAgJiYgKGxlbmd0aCA8IDAgfHwgb2Zmc2V0IDwgMCkpIHx8IG9mZnNldCA+IHRoaXMubGVuZ3RoKSB7CiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignQXR0ZW1wdCB0byB3cml0ZSBvdXRzaWRlIGJ1ZmZlciBib3VuZHMnKQogIH0KCiAgaWYgKCFlbmNvZGluZykgZW5jb2RpbmcgPSAndXRmOCcKCiAgdmFyIGxvd2VyZWRDYXNlID0gZmFsc2UKICBmb3IgKDs7KSB7CiAgICBzd2l0Y2ggKGVuY29kaW5nKSB7CiAgICAgIGNhc2UgJ2hleCc6CiAgICAgICAgcmV0dXJuIGhleFdyaXRlKHRoaXMsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpCgogICAgICBjYXNlICd1dGY4JzoKICAgICAgY2FzZSAndXRmLTgnOgogICAgICAgIHJldHVybiB1dGY4V3JpdGUodGhpcywgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkKCiAgICAgIGNhc2UgJ2FzY2lpJzoKICAgICAgICByZXR1cm4gYXNjaWlXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKQoKICAgICAgY2FzZSAnbGF0aW4xJzoKICAgICAgY2FzZSAnYmluYXJ5JzoKICAgICAgICByZXR1cm4gbGF0aW4xV3JpdGUodGhpcywgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkKCiAgICAgIGNhc2UgJ2Jhc2U2NCc6CiAgICAgICAgLy8gV2FybmluZzogbWF4TGVuZ3RoIG5vdCB0YWtlbiBpbnRvIGFjY291bnQgaW4gYmFzZTY0V3JpdGUKICAgICAgICByZXR1cm4gYmFzZTY0V3JpdGUodGhpcywgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkKCiAgICAgIGNhc2UgJ3VjczInOgogICAgICBjYXNlICd1Y3MtMic6CiAgICAgIGNhc2UgJ3V0ZjE2bGUnOgogICAgICBjYXNlICd1dGYtMTZsZSc6CiAgICAgICAgcmV0dXJuIHVjczJXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKQoKICAgICAgZGVmYXVsdDoKICAgICAgICBpZiAobG93ZXJlZENhc2UpIHRocm93IG5ldyBUeXBlRXJyb3IoJ1Vua25vd24gZW5jb2Rpbmc6ICcgKyBlbmNvZGluZykKICAgICAgICBlbmNvZGluZyA9ICgnJyArIGVuY29kaW5nKS50b0xvd2VyQ2FzZSgpCiAgICAgICAgbG93ZXJlZENhc2UgPSB0cnVlCiAgICB9CiAgfQp9CgpCdWZmZXIucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIHRvSlNPTiAoKSB7CiAgcmV0dXJuIHsKICAgIHR5cGU6ICdCdWZmZXInLAogICAgZGF0YTogQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGhpcy5fYXJyIHx8IHRoaXMsIDApCiAgfQp9CgpmdW5jdGlvbiBiYXNlNjRTbGljZSAoYnVmLCBzdGFydCwgZW5kKSB7CiAgaWYgKHN0YXJ0ID09PSAwICYmIGVuZCA9PT0gYnVmLmxlbmd0aCkgewogICAgcmV0dXJuIGJhc2U2NC5mcm9tQnl0ZUFycmF5KGJ1ZikKICB9IGVsc2UgewogICAgcmV0dXJuIGJhc2U2NC5mcm9tQnl0ZUFycmF5KGJ1Zi5zbGljZShzdGFydCwgZW5kKSkKICB9Cn0KCmZ1bmN0aW9uIHV0ZjhTbGljZSAoYnVmLCBzdGFydCwgZW5kKSB7CiAgZW5kID0gTWF0aC5taW4oYnVmLmxlbmd0aCwgZW5kKQogIHZhciByZXMgPSBbXQoKICB2YXIgaSA9IHN0YXJ0CiAgd2hpbGUgKGkgPCBlbmQpIHsKICAgIHZhciBmaXJzdEJ5dGUgPSBidWZbaV0KICAgIHZhciBjb2RlUG9pbnQgPSBudWxsCiAgICB2YXIgYnl0ZXNQZXJTZXF1ZW5jZSA9IChmaXJzdEJ5dGUgPiAweEVGKSA/IDQKICAgICAgOiAoZmlyc3RCeXRlID4gMHhERikgPyAzCiAgICAgICAgOiAoZmlyc3RCeXRlID4gMHhCRikgPyAyCiAgICAgICAgICA6IDEKCiAgICBpZiAoaSArIGJ5dGVzUGVyU2VxdWVuY2UgPD0gZW5kKSB7CiAgICAgIHZhciBzZWNvbmRCeXRlLCB0aGlyZEJ5dGUsIGZvdXJ0aEJ5dGUsIHRlbXBDb2RlUG9pbnQKCiAgICAgIHN3aXRjaCAoYnl0ZXNQZXJTZXF1ZW5jZSkgewogICAgICAgIGNhc2UgMToKICAgICAgICAgIGlmIChmaXJzdEJ5dGUgPCAweDgwKSB7CiAgICAgICAgICAgIGNvZGVQb2ludCA9IGZpcnN0Qnl0ZQogICAgICAgICAgfQogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBzZWNvbmRCeXRlID0gYnVmW2kgKyAxXQogICAgICAgICAgaWYgKChzZWNvbmRCeXRlICYgMHhDMCkgPT09IDB4ODApIHsKICAgICAgICAgICAgdGVtcENvZGVQb2ludCA9IChmaXJzdEJ5dGUgJiAweDFGKSA8PCAweDYgfCAoc2Vjb25kQnl0ZSAmIDB4M0YpCiAgICAgICAgICAgIGlmICh0ZW1wQ29kZVBvaW50ID4gMHg3RikgewogICAgICAgICAgICAgIGNvZGVQb2ludCA9IHRlbXBDb2RlUG9pbnQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlIDM6CiAgICAgICAgICBzZWNvbmRCeXRlID0gYnVmW2kgKyAxXQogICAgICAgICAgdGhpcmRCeXRlID0gYnVmW2kgKyAyXQogICAgICAgICAgaWYgKChzZWNvbmRCeXRlICYgMHhDMCkgPT09IDB4ODAgJiYgKHRoaXJkQnl0ZSAmIDB4QzApID09PSAweDgwKSB7CiAgICAgICAgICAgIHRlbXBDb2RlUG9pbnQgPSAoZmlyc3RCeXRlICYgMHhGKSA8PCAweEMgfCAoc2Vjb25kQnl0ZSAmIDB4M0YpIDw8IDB4NiB8ICh0aGlyZEJ5dGUgJiAweDNGKQogICAgICAgICAgICBpZiAodGVtcENvZGVQb2ludCA+IDB4N0ZGICYmICh0ZW1wQ29kZVBvaW50IDwgMHhEODAwIHx8IHRlbXBDb2RlUG9pbnQgPiAweERGRkYpKSB7CiAgICAgICAgICAgICAgY29kZVBvaW50ID0gdGVtcENvZGVQb2ludAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhawogICAgICAgIGNhc2UgNDoKICAgICAgICAgIHNlY29uZEJ5dGUgPSBidWZbaSArIDFdCiAgICAgICAgICB0aGlyZEJ5dGUgPSBidWZbaSArIDJdCiAgICAgICAgICBmb3VydGhCeXRlID0gYnVmW2kgKyAzXQogICAgICAgICAgaWYgKChzZWNvbmRCeXRlICYgMHhDMCkgPT09IDB4ODAgJiYgKHRoaXJkQnl0ZSAmIDB4QzApID09PSAweDgwICYmIChmb3VydGhCeXRlICYgMHhDMCkgPT09IDB4ODApIHsKICAgICAgICAgICAgdGVtcENvZGVQb2ludCA9IChmaXJzdEJ5dGUgJiAweEYpIDw8IDB4MTIgfCAoc2Vjb25kQnl0ZSAmIDB4M0YpIDw8IDB4QyB8ICh0aGlyZEJ5dGUgJiAweDNGKSA8PCAweDYgfCAoZm91cnRoQnl0ZSAmIDB4M0YpCiAgICAgICAgICAgIGlmICh0ZW1wQ29kZVBvaW50ID4gMHhGRkZGICYmIHRlbXBDb2RlUG9pbnQgPCAweDExMDAwMCkgewogICAgICAgICAgICAgIGNvZGVQb2ludCA9IHRlbXBDb2RlUG9pbnQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaWYgKGNvZGVQb2ludCA9PT0gbnVsbCkgewogICAgICAvLyB3ZSBkaWQgbm90IGdlbmVyYXRlIGEgdmFsaWQgY29kZVBvaW50IHNvIGluc2VydCBhCiAgICAgIC8vIHJlcGxhY2VtZW50IGNoYXIgKFUrRkZGRCkgYW5kIGFkdmFuY2Ugb25seSAxIGJ5dGUKICAgICAgY29kZVBvaW50ID0gMHhGRkZECiAgICAgIGJ5dGVzUGVyU2VxdWVuY2UgPSAxCiAgICB9IGVsc2UgaWYgKGNvZGVQb2ludCA+IDB4RkZGRikgewogICAgICAvLyBlbmNvZGUgdG8gdXRmMTYgKHN1cnJvZ2F0ZSBwYWlyIGRhbmNlKQogICAgICBjb2RlUG9pbnQgLT0gMHgxMDAwMAogICAgICByZXMucHVzaChjb2RlUG9pbnQgPj4+IDEwICYgMHgzRkYgfCAweEQ4MDApCiAgICAgIGNvZGVQb2ludCA9IDB4REMwMCB8IGNvZGVQb2ludCAmIDB4M0ZGCiAgICB9CgogICAgcmVzLnB1c2goY29kZVBvaW50KQogICAgaSArPSBieXRlc1BlclNlcXVlbmNlCiAgfQoKICByZXR1cm4gZGVjb2RlQ29kZVBvaW50c0FycmF5KHJlcykKfQoKLy8gQmFzZWQgb24gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMjI3NDcyNzIvNjgwNzQyLCB0aGUgYnJvd3NlciB3aXRoCi8vIHRoZSBsb3dlc3QgbGltaXQgaXMgQ2hyb21lLCB3aXRoIDB4MTAwMDAgYXJncy4KLy8gV2UgZ28gMSBtYWduaXR1ZGUgbGVzcywgZm9yIHNhZmV0eQp2YXIgTUFYX0FSR1VNRU5UU19MRU5HVEggPSAweDEwMDAKCmZ1bmN0aW9uIGRlY29kZUNvZGVQb2ludHNBcnJheSAoY29kZVBvaW50cykgewogIHZhciBsZW4gPSBjb2RlUG9pbnRzLmxlbmd0aAogIGlmIChsZW4gPD0gTUFYX0FSR1VNRU5UU19MRU5HVEgpIHsKICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KFN0cmluZywgY29kZVBvaW50cykgLy8gYXZvaWQgZXh0cmEgc2xpY2UoKQogIH0KCiAgLy8gRGVjb2RlIGluIGNodW5rcyB0byBhdm9pZCAiY2FsbCBzdGFjayBzaXplIGV4Y2VlZGVkIi4KICB2YXIgcmVzID0gJycKICB2YXIgaSA9IDAKICB3aGlsZSAoaSA8IGxlbikgewogICAgcmVzICs9IFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkoCiAgICAgIFN0cmluZywKICAgICAgY29kZVBvaW50cy5zbGljZShpLCBpICs9IE1BWF9BUkdVTUVOVFNfTEVOR1RIKQogICAgKQogIH0KICByZXR1cm4gcmVzCn0KCmZ1bmN0aW9uIGFzY2lpU2xpY2UgKGJ1Ziwgc3RhcnQsIGVuZCkgewogIHZhciByZXQgPSAnJwogIGVuZCA9IE1hdGgubWluKGJ1Zi5sZW5ndGgsIGVuZCkKCiAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyArK2kpIHsKICAgIHJldCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGJ1ZltpXSAmIDB4N0YpCiAgfQogIHJldHVybiByZXQKfQoKZnVuY3Rpb24gbGF0aW4xU2xpY2UgKGJ1Ziwgc3RhcnQsIGVuZCkgewogIHZhciByZXQgPSAnJwogIGVuZCA9IE1hdGgubWluKGJ1Zi5sZW5ndGgsIGVuZCkKCiAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyArK2kpIHsKICAgIHJldCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGJ1ZltpXSkKICB9CiAgcmV0dXJuIHJldAp9CgpmdW5jdGlvbiBoZXhTbGljZSAoYnVmLCBzdGFydCwgZW5kKSB7CiAgdmFyIGxlbiA9IGJ1Zi5sZW5ndGgKCiAgaWYgKCFzdGFydCB8fCBzdGFydCA8IDApIHN0YXJ0ID0gMAogIGlmICghZW5kIHx8IGVuZCA8IDAgfHwgZW5kID4gbGVuKSBlbmQgPSBsZW4KCiAgdmFyIG91dCA9ICcnCiAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyArK2kpIHsKICAgIG91dCArPSB0b0hleChidWZbaV0pCiAgfQogIHJldHVybiBvdXQKfQoKZnVuY3Rpb24gdXRmMTZsZVNsaWNlIChidWYsIHN0YXJ0LCBlbmQpIHsKICB2YXIgYnl0ZXMgPSBidWYuc2xpY2Uoc3RhcnQsIGVuZCkKICB2YXIgcmVzID0gJycKICBmb3IgKHZhciBpID0gMDsgaSA8IGJ5dGVzLmxlbmd0aDsgaSArPSAyKSB7CiAgICByZXMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShieXRlc1tpXSArIChieXRlc1tpICsgMV0gKiAyNTYpKQogIH0KICByZXR1cm4gcmVzCn0KCkJ1ZmZlci5wcm90b3R5cGUuc2xpY2UgPSBmdW5jdGlvbiBzbGljZSAoc3RhcnQsIGVuZCkgewogIHZhciBsZW4gPSB0aGlzLmxlbmd0aAogIHN0YXJ0ID0gfn5zdGFydAogIGVuZCA9IGVuZCA9PT0gdW5kZWZpbmVkID8gbGVuIDogfn5lbmQKCiAgaWYgKHN0YXJ0IDwgMCkgewogICAgc3RhcnQgKz0gbGVuCiAgICBpZiAoc3RhcnQgPCAwKSBzdGFydCA9IDAKICB9IGVsc2UgaWYgKHN0YXJ0ID4gbGVuKSB7CiAgICBzdGFydCA9IGxlbgogIH0KCiAgaWYgKGVuZCA8IDApIHsKICAgIGVuZCArPSBsZW4KICAgIGlmIChlbmQgPCAwKSBlbmQgPSAwCiAgfSBlbHNlIGlmIChlbmQgPiBsZW4pIHsKICAgIGVuZCA9IGxlbgogIH0KCiAgaWYgKGVuZCA8IHN0YXJ0KSBlbmQgPSBzdGFydAoKICB2YXIgbmV3QnVmID0gdGhpcy5zdWJhcnJheShzdGFydCwgZW5kKQogIC8vIFJldHVybiBhbiBhdWdtZW50ZWQgYFVpbnQ4QXJyYXlgIGluc3RhbmNlCiAgbmV3QnVmLl9fcHJvdG9fXyA9IEJ1ZmZlci5wcm90b3R5cGUKICByZXR1cm4gbmV3QnVmCn0KCi8qCiAqIE5lZWQgdG8gbWFrZSBzdXJlIHRoYXQgYnVmZmVyIGlzbid0IHRyeWluZyB0byB3cml0ZSBvdXQgb2YgYm91bmRzLgogKi8KZnVuY3Rpb24gY2hlY2tPZmZzZXQgKG9mZnNldCwgZXh0LCBsZW5ndGgpIHsKICBpZiAoKG9mZnNldCAlIDEpICE9PSAwIHx8IG9mZnNldCA8IDApIHRocm93IG5ldyBSYW5nZUVycm9yKCdvZmZzZXQgaXMgbm90IHVpbnQnKQogIGlmIChvZmZzZXQgKyBleHQgPiBsZW5ndGgpIHRocm93IG5ldyBSYW5nZUVycm9yKCdUcnlpbmcgdG8gYWNjZXNzIGJleW9uZCBidWZmZXIgbGVuZ3RoJykKfQoKQnVmZmVyLnByb3RvdHlwZS5yZWFkVUludExFID0gZnVuY3Rpb24gcmVhZFVJbnRMRSAob2Zmc2V0LCBieXRlTGVuZ3RoLCBub0Fzc2VydCkgewogIG9mZnNldCA9IG9mZnNldCA+Pj4gMAogIGJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoID4+PiAwCiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCBieXRlTGVuZ3RoLCB0aGlzLmxlbmd0aCkKCiAgdmFyIHZhbCA9IHRoaXNbb2Zmc2V0XQogIHZhciBtdWwgPSAxCiAgdmFyIGkgPSAwCiAgd2hpbGUgKCsraSA8IGJ5dGVMZW5ndGggJiYgKG11bCAqPSAweDEwMCkpIHsKICAgIHZhbCArPSB0aGlzW29mZnNldCArIGldICogbXVsCiAgfQoKICByZXR1cm4gdmFsCn0KCkJ1ZmZlci5wcm90b3R5cGUucmVhZFVJbnRCRSA9IGZ1bmN0aW9uIHJlYWRVSW50QkUgKG9mZnNldCwgYnl0ZUxlbmd0aCwgbm9Bc3NlcnQpIHsKICBvZmZzZXQgPSBvZmZzZXQgPj4+IDAKICBieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aCA+Pj4gMAogIGlmICghbm9Bc3NlcnQpIHsKICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgYnl0ZUxlbmd0aCwgdGhpcy5sZW5ndGgpCiAgfQoKICB2YXIgdmFsID0gdGhpc1tvZmZzZXQgKyAtLWJ5dGVMZW5ndGhdCiAgdmFyIG11bCA9IDEKICB3aGlsZSAoYnl0ZUxlbmd0aCA+IDAgJiYgKG11bCAqPSAweDEwMCkpIHsKICAgIHZhbCArPSB0aGlzW29mZnNldCArIC0tYnl0ZUxlbmd0aF0gKiBtdWwKICB9CgogIHJldHVybiB2YWwKfQoKQnVmZmVyLnByb3RvdHlwZS5yZWFkVUludDggPSBmdW5jdGlvbiByZWFkVUludDggKG9mZnNldCwgbm9Bc3NlcnQpIHsKICBvZmZzZXQgPSBvZmZzZXQgPj4+IDAKICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDEsIHRoaXMubGVuZ3RoKQogIHJldHVybiB0aGlzW29mZnNldF0KfQoKQnVmZmVyLnByb3RvdHlwZS5yZWFkVUludDE2TEUgPSBmdW5jdGlvbiByZWFkVUludDE2TEUgKG9mZnNldCwgbm9Bc3NlcnQpIHsKICBvZmZzZXQgPSBvZmZzZXQgPj4+IDAKICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDIsIHRoaXMubGVuZ3RoKQogIHJldHVybiB0aGlzW29mZnNldF0gfCAodGhpc1tvZmZzZXQgKyAxXSA8PCA4KQp9CgpCdWZmZXIucHJvdG90eXBlLnJlYWRVSW50MTZCRSA9IGZ1bmN0aW9uIHJlYWRVSW50MTZCRSAob2Zmc2V0LCBub0Fzc2VydCkgewogIG9mZnNldCA9IG9mZnNldCA+Pj4gMAogIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgMiwgdGhpcy5sZW5ndGgpCiAgcmV0dXJuICh0aGlzW29mZnNldF0gPDwgOCkgfCB0aGlzW29mZnNldCArIDFdCn0KCkJ1ZmZlci5wcm90b3R5cGUucmVhZFVJbnQzMkxFID0gZnVuY3Rpb24gcmVhZFVJbnQzMkxFIChvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwCiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCA0LCB0aGlzLmxlbmd0aCkKCiAgcmV0dXJuICgodGhpc1tvZmZzZXRdKSB8CiAgICAgICh0aGlzW29mZnNldCArIDFdIDw8IDgpIHwKICAgICAgKHRoaXNbb2Zmc2V0ICsgMl0gPDwgMTYpKSArCiAgICAgICh0aGlzW29mZnNldCArIDNdICogMHgxMDAwMDAwKQp9CgpCdWZmZXIucHJvdG90eXBlLnJlYWRVSW50MzJCRSA9IGZ1bmN0aW9uIHJlYWRVSW50MzJCRSAob2Zmc2V0LCBub0Fzc2VydCkgewogIG9mZnNldCA9IG9mZnNldCA+Pj4gMAogIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpCgogIHJldHVybiAodGhpc1tvZmZzZXRdICogMHgxMDAwMDAwKSArCiAgICAoKHRoaXNbb2Zmc2V0ICsgMV0gPDwgMTYpIHwKICAgICh0aGlzW29mZnNldCArIDJdIDw8IDgpIHwKICAgIHRoaXNbb2Zmc2V0ICsgM10pCn0KCkJ1ZmZlci5wcm90b3R5cGUucmVhZEludExFID0gZnVuY3Rpb24gcmVhZEludExFIChvZmZzZXQsIGJ5dGVMZW5ndGgsIG5vQXNzZXJ0KSB7CiAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwCiAgYnl0ZUxlbmd0aCA9IGJ5dGVMZW5ndGggPj4+IDAKICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIGJ5dGVMZW5ndGgsIHRoaXMubGVuZ3RoKQoKICB2YXIgdmFsID0gdGhpc1tvZmZzZXRdCiAgdmFyIG11bCA9IDEKICB2YXIgaSA9IDAKICB3aGlsZSAoKytpIDwgYnl0ZUxlbmd0aCAmJiAobXVsICo9IDB4MTAwKSkgewogICAgdmFsICs9IHRoaXNbb2Zmc2V0ICsgaV0gKiBtdWwKICB9CiAgbXVsICo9IDB4ODAKCiAgaWYgKHZhbCA+PSBtdWwpIHZhbCAtPSBNYXRoLnBvdygyLCA4ICogYnl0ZUxlbmd0aCkKCiAgcmV0dXJuIHZhbAp9CgpCdWZmZXIucHJvdG90eXBlLnJlYWRJbnRCRSA9IGZ1bmN0aW9uIHJlYWRJbnRCRSAob2Zmc2V0LCBieXRlTGVuZ3RoLCBub0Fzc2VydCkgewogIG9mZnNldCA9IG9mZnNldCA+Pj4gMAogIGJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoID4+PiAwCiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCBieXRlTGVuZ3RoLCB0aGlzLmxlbmd0aCkKCiAgdmFyIGkgPSBieXRlTGVuZ3RoCiAgdmFyIG11bCA9IDEKICB2YXIgdmFsID0gdGhpc1tvZmZzZXQgKyAtLWldCiAgd2hpbGUgKGkgPiAwICYmIChtdWwgKj0gMHgxMDApKSB7CiAgICB2YWwgKz0gdGhpc1tvZmZzZXQgKyAtLWldICogbXVsCiAgfQogIG11bCAqPSAweDgwCgogIGlmICh2YWwgPj0gbXVsKSB2YWwgLT0gTWF0aC5wb3coMiwgOCAqIGJ5dGVMZW5ndGgpCgogIHJldHVybiB2YWwKfQoKQnVmZmVyLnByb3RvdHlwZS5yZWFkSW50OCA9IGZ1bmN0aW9uIHJlYWRJbnQ4IChvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwCiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCAxLCB0aGlzLmxlbmd0aCkKICBpZiAoISh0aGlzW29mZnNldF0gJiAweDgwKSkgcmV0dXJuICh0aGlzW29mZnNldF0pCiAgcmV0dXJuICgoMHhmZiAtIHRoaXNbb2Zmc2V0XSArIDEpICogLTEpCn0KCkJ1ZmZlci5wcm90b3R5cGUucmVhZEludDE2TEUgPSBmdW5jdGlvbiByZWFkSW50MTZMRSAob2Zmc2V0LCBub0Fzc2VydCkgewogIG9mZnNldCA9IG9mZnNldCA+Pj4gMAogIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgMiwgdGhpcy5sZW5ndGgpCiAgdmFyIHZhbCA9IHRoaXNbb2Zmc2V0XSB8ICh0aGlzW29mZnNldCArIDFdIDw8IDgpCiAgcmV0dXJuICh2YWwgJiAweDgwMDApID8gdmFsIHwgMHhGRkZGMDAwMCA6IHZhbAp9CgpCdWZmZXIucHJvdG90eXBlLnJlYWRJbnQxNkJFID0gZnVuY3Rpb24gcmVhZEludDE2QkUgKG9mZnNldCwgbm9Bc3NlcnQpIHsKICBvZmZzZXQgPSBvZmZzZXQgPj4+IDAKICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDIsIHRoaXMubGVuZ3RoKQogIHZhciB2YWwgPSB0aGlzW29mZnNldCArIDFdIHwgKHRoaXNbb2Zmc2V0XSA8PCA4KQogIHJldHVybiAodmFsICYgMHg4MDAwKSA/IHZhbCB8IDB4RkZGRjAwMDAgOiB2YWwKfQoKQnVmZmVyLnByb3RvdHlwZS5yZWFkSW50MzJMRSA9IGZ1bmN0aW9uIHJlYWRJbnQzMkxFIChvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwCiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCA0LCB0aGlzLmxlbmd0aCkKCiAgcmV0dXJuICh0aGlzW29mZnNldF0pIHwKICAgICh0aGlzW29mZnNldCArIDFdIDw8IDgpIHwKICAgICh0aGlzW29mZnNldCArIDJdIDw8IDE2KSB8CiAgICAodGhpc1tvZmZzZXQgKyAzXSA8PCAyNCkKfQoKQnVmZmVyLnByb3RvdHlwZS5yZWFkSW50MzJCRSA9IGZ1bmN0aW9uIHJlYWRJbnQzMkJFIChvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwCiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCA0LCB0aGlzLmxlbmd0aCkKCiAgcmV0dXJuICh0aGlzW29mZnNldF0gPDwgMjQpIHwKICAgICh0aGlzW29mZnNldCArIDFdIDw8IDE2KSB8CiAgICAodGhpc1tvZmZzZXQgKyAyXSA8PCA4KSB8CiAgICAodGhpc1tvZmZzZXQgKyAzXSkKfQoKQnVmZmVyLnByb3RvdHlwZS5yZWFkRmxvYXRMRSA9IGZ1bmN0aW9uIHJlYWRGbG9hdExFIChvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwCiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCA0LCB0aGlzLmxlbmd0aCkKICByZXR1cm4gaWVlZTc1NC5yZWFkKHRoaXMsIG9mZnNldCwgdHJ1ZSwgMjMsIDQpCn0KCkJ1ZmZlci5wcm90b3R5cGUucmVhZEZsb2F0QkUgPSBmdW5jdGlvbiByZWFkRmxvYXRCRSAob2Zmc2V0LCBub0Fzc2VydCkgewogIG9mZnNldCA9IG9mZnNldCA+Pj4gMAogIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpCiAgcmV0dXJuIGllZWU3NTQucmVhZCh0aGlzLCBvZmZzZXQsIGZhbHNlLCAyMywgNCkKfQoKQnVmZmVyLnByb3RvdHlwZS5yZWFkRG91YmxlTEUgPSBmdW5jdGlvbiByZWFkRG91YmxlTEUgKG9mZnNldCwgbm9Bc3NlcnQpIHsKICBvZmZzZXQgPSBvZmZzZXQgPj4+IDAKICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDgsIHRoaXMubGVuZ3RoKQogIHJldHVybiBpZWVlNzU0LnJlYWQodGhpcywgb2Zmc2V0LCB0cnVlLCA1MiwgOCkKfQoKQnVmZmVyLnByb3RvdHlwZS5yZWFkRG91YmxlQkUgPSBmdW5jdGlvbiByZWFkRG91YmxlQkUgKG9mZnNldCwgbm9Bc3NlcnQpIHsKICBvZmZzZXQgPSBvZmZzZXQgPj4+IDAKICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDgsIHRoaXMubGVuZ3RoKQogIHJldHVybiBpZWVlNzU0LnJlYWQodGhpcywgb2Zmc2V0LCBmYWxzZSwgNTIsIDgpCn0KCmZ1bmN0aW9uIGNoZWNrSW50IChidWYsIHZhbHVlLCBvZmZzZXQsIGV4dCwgbWF4LCBtaW4pIHsKICBpZiAoIUJ1ZmZlci5pc0J1ZmZlcihidWYpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCciYnVmZmVyIiBhcmd1bWVudCBtdXN0IGJlIGEgQnVmZmVyIGluc3RhbmNlJykKICBpZiAodmFsdWUgPiBtYXggfHwgdmFsdWUgPCBtaW4pIHRocm93IG5ldyBSYW5nZUVycm9yKCcidmFsdWUiIGFyZ3VtZW50IGlzIG91dCBvZiBib3VuZHMnKQogIGlmIChvZmZzZXQgKyBleHQgPiBidWYubGVuZ3RoKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcignSW5kZXggb3V0IG9mIHJhbmdlJykKfQoKQnVmZmVyLnByb3RvdHlwZS53cml0ZVVJbnRMRSA9IGZ1bmN0aW9uIHdyaXRlVUludExFICh2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBub0Fzc2VydCkgewogIHZhbHVlID0gK3ZhbHVlCiAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwCiAgYnl0ZUxlbmd0aCA9IGJ5dGVMZW5ndGggPj4+IDAKICBpZiAoIW5vQXNzZXJ0KSB7CiAgICB2YXIgbWF4Qnl0ZXMgPSBNYXRoLnBvdygyLCA4ICogYnl0ZUxlbmd0aCkgLSAxCiAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBtYXhCeXRlcywgMCkKICB9CgogIHZhciBtdWwgPSAxCiAgdmFyIGkgPSAwCiAgdGhpc1tvZmZzZXRdID0gdmFsdWUgJiAweEZGCiAgd2hpbGUgKCsraSA8IGJ5dGVMZW5ndGggJiYgKG11bCAqPSAweDEwMCkpIHsKICAgIHRoaXNbb2Zmc2V0ICsgaV0gPSAodmFsdWUgLyBtdWwpICYgMHhGRgogIH0KCiAgcmV0dXJuIG9mZnNldCArIGJ5dGVMZW5ndGgKfQoKQnVmZmVyLnByb3RvdHlwZS53cml0ZVVJbnRCRSA9IGZ1bmN0aW9uIHdyaXRlVUludEJFICh2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBub0Fzc2VydCkgewogIHZhbHVlID0gK3ZhbHVlCiAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwCiAgYnl0ZUxlbmd0aCA9IGJ5dGVMZW5ndGggPj4+IDAKICBpZiAoIW5vQXNzZXJ0KSB7CiAgICB2YXIgbWF4Qnl0ZXMgPSBNYXRoLnBvdygyLCA4ICogYnl0ZUxlbmd0aCkgLSAxCiAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBtYXhCeXRlcywgMCkKICB9CgogIHZhciBpID0gYnl0ZUxlbmd0aCAtIDEKICB2YXIgbXVsID0gMQogIHRoaXNbb2Zmc2V0ICsgaV0gPSB2YWx1ZSAmIDB4RkYKICB3aGlsZSAoLS1pID49IDAgJiYgKG11bCAqPSAweDEwMCkpIHsKICAgIHRoaXNbb2Zmc2V0ICsgaV0gPSAodmFsdWUgLyBtdWwpICYgMHhGRgogIH0KCiAgcmV0dXJuIG9mZnNldCArIGJ5dGVMZW5ndGgKfQoKQnVmZmVyLnByb3RvdHlwZS53cml0ZVVJbnQ4ID0gZnVuY3Rpb24gd3JpdGVVSW50OCAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHsKICB2YWx1ZSA9ICt2YWx1ZQogIG9mZnNldCA9IG9mZnNldCA+Pj4gMAogIGlmICghbm9Bc3NlcnQpIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDEsIDB4ZmYsIDApCiAgdGhpc1tvZmZzZXRdID0gKHZhbHVlICYgMHhmZikKICByZXR1cm4gb2Zmc2V0ICsgMQp9CgpCdWZmZXIucHJvdG90eXBlLndyaXRlVUludDE2TEUgPSBmdW5jdGlvbiB3cml0ZVVJbnQxNkxFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogIHZhbHVlID0gK3ZhbHVlCiAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwCiAgaWYgKCFub0Fzc2VydCkgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgMiwgMHhmZmZmLCAwKQogIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSAmIDB4ZmYpCiAgdGhpc1tvZmZzZXQgKyAxXSA9ICh2YWx1ZSA+Pj4gOCkKICByZXR1cm4gb2Zmc2V0ICsgMgp9CgpCdWZmZXIucHJvdG90eXBlLndyaXRlVUludDE2QkUgPSBmdW5jdGlvbiB3cml0ZVVJbnQxNkJFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogIHZhbHVlID0gK3ZhbHVlCiAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwCiAgaWYgKCFub0Fzc2VydCkgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgMiwgMHhmZmZmLCAwKQogIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSA+Pj4gOCkKICB0aGlzW29mZnNldCArIDFdID0gKHZhbHVlICYgMHhmZikKICByZXR1cm4gb2Zmc2V0ICsgMgp9CgpCdWZmZXIucHJvdG90eXBlLndyaXRlVUludDMyTEUgPSBmdW5jdGlvbiB3cml0ZVVJbnQzMkxFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogIHZhbHVlID0gK3ZhbHVlCiAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwCiAgaWYgKCFub0Fzc2VydCkgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgNCwgMHhmZmZmZmZmZiwgMCkKICB0aGlzW29mZnNldCArIDNdID0gKHZhbHVlID4+PiAyNCkKICB0aGlzW29mZnNldCArIDJdID0gKHZhbHVlID4+PiAxNikKICB0aGlzW29mZnNldCArIDFdID0gKHZhbHVlID4+PiA4KQogIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSAmIDB4ZmYpCiAgcmV0dXJuIG9mZnNldCArIDQKfQoKQnVmZmVyLnByb3RvdHlwZS53cml0ZVVJbnQzMkJFID0gZnVuY3Rpb24gd3JpdGVVSW50MzJCRSAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHsKICB2YWx1ZSA9ICt2YWx1ZQogIG9mZnNldCA9IG9mZnNldCA+Pj4gMAogIGlmICghbm9Bc3NlcnQpIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDQsIDB4ZmZmZmZmZmYsIDApCiAgdGhpc1tvZmZzZXRdID0gKHZhbHVlID4+PiAyNCkKICB0aGlzW29mZnNldCArIDFdID0gKHZhbHVlID4+PiAxNikKICB0aGlzW29mZnNldCArIDJdID0gKHZhbHVlID4+PiA4KQogIHRoaXNbb2Zmc2V0ICsgM10gPSAodmFsdWUgJiAweGZmKQogIHJldHVybiBvZmZzZXQgKyA0Cn0KCkJ1ZmZlci5wcm90b3R5cGUud3JpdGVJbnRMRSA9IGZ1bmN0aW9uIHdyaXRlSW50TEUgKHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIG5vQXNzZXJ0KSB7CiAgdmFsdWUgPSArdmFsdWUKICBvZmZzZXQgPSBvZmZzZXQgPj4+IDAKICBpZiAoIW5vQXNzZXJ0KSB7CiAgICB2YXIgbGltaXQgPSBNYXRoLnBvdygyLCAoOCAqIGJ5dGVMZW5ndGgpIC0gMSkKCiAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBsaW1pdCAtIDEsIC1saW1pdCkKICB9CgogIHZhciBpID0gMAogIHZhciBtdWwgPSAxCiAgdmFyIHN1YiA9IDAKICB0aGlzW29mZnNldF0gPSB2YWx1ZSAmIDB4RkYKICB3aGlsZSAoKytpIDwgYnl0ZUxlbmd0aCAmJiAobXVsICo9IDB4MTAwKSkgewogICAgaWYgKHZhbHVlIDwgMCAmJiBzdWIgPT09IDAgJiYgdGhpc1tvZmZzZXQgKyBpIC0gMV0gIT09IDApIHsKICAgICAgc3ViID0gMQogICAgfQogICAgdGhpc1tvZmZzZXQgKyBpXSA9ICgodmFsdWUgLyBtdWwpID4+IDApIC0gc3ViICYgMHhGRgogIH0KCiAgcmV0dXJuIG9mZnNldCArIGJ5dGVMZW5ndGgKfQoKQnVmZmVyLnByb3RvdHlwZS53cml0ZUludEJFID0gZnVuY3Rpb24gd3JpdGVJbnRCRSAodmFsdWUsIG9mZnNldCwgYnl0ZUxlbmd0aCwgbm9Bc3NlcnQpIHsKICB2YWx1ZSA9ICt2YWx1ZQogIG9mZnNldCA9IG9mZnNldCA+Pj4gMAogIGlmICghbm9Bc3NlcnQpIHsKICAgIHZhciBsaW1pdCA9IE1hdGgucG93KDIsICg4ICogYnl0ZUxlbmd0aCkgLSAxKQoKICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIGxpbWl0IC0gMSwgLWxpbWl0KQogIH0KCiAgdmFyIGkgPSBieXRlTGVuZ3RoIC0gMQogIHZhciBtdWwgPSAxCiAgdmFyIHN1YiA9IDAKICB0aGlzW29mZnNldCArIGldID0gdmFsdWUgJiAweEZGCiAgd2hpbGUgKC0taSA+PSAwICYmIChtdWwgKj0gMHgxMDApKSB7CiAgICBpZiAodmFsdWUgPCAwICYmIHN1YiA9PT0gMCAmJiB0aGlzW29mZnNldCArIGkgKyAxXSAhPT0gMCkgewogICAgICBzdWIgPSAxCiAgICB9CiAgICB0aGlzW29mZnNldCArIGldID0gKCh2YWx1ZSAvIG11bCkgPj4gMCkgLSBzdWIgJiAweEZGCiAgfQoKICByZXR1cm4gb2Zmc2V0ICsgYnl0ZUxlbmd0aAp9CgpCdWZmZXIucHJvdG90eXBlLndyaXRlSW50OCA9IGZ1bmN0aW9uIHdyaXRlSW50OCAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHsKICB2YWx1ZSA9ICt2YWx1ZQogIG9mZnNldCA9IG9mZnNldCA+Pj4gMAogIGlmICghbm9Bc3NlcnQpIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDEsIDB4N2YsIC0weDgwKQogIGlmICh2YWx1ZSA8IDApIHZhbHVlID0gMHhmZiArIHZhbHVlICsgMQogIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSAmIDB4ZmYpCiAgcmV0dXJuIG9mZnNldCArIDEKfQoKQnVmZmVyLnByb3RvdHlwZS53cml0ZUludDE2TEUgPSBmdW5jdGlvbiB3cml0ZUludDE2TEUgKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgdmFsdWUgPSArdmFsdWUKICBvZmZzZXQgPSBvZmZzZXQgPj4+IDAKICBpZiAoIW5vQXNzZXJ0KSBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCAyLCAweDdmZmYsIC0weDgwMDApCiAgdGhpc1tvZmZzZXRdID0gKHZhbHVlICYgMHhmZikKICB0aGlzW29mZnNldCArIDFdID0gKHZhbHVlID4+PiA4KQogIHJldHVybiBvZmZzZXQgKyAyCn0KCkJ1ZmZlci5wcm90b3R5cGUud3JpdGVJbnQxNkJFID0gZnVuY3Rpb24gd3JpdGVJbnQxNkJFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogIHZhbHVlID0gK3ZhbHVlCiAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwCiAgaWYgKCFub0Fzc2VydCkgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgMiwgMHg3ZmZmLCAtMHg4MDAwKQogIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSA+Pj4gOCkKICB0aGlzW29mZnNldCArIDFdID0gKHZhbHVlICYgMHhmZikKICByZXR1cm4gb2Zmc2V0ICsgMgp9CgpCdWZmZXIucHJvdG90eXBlLndyaXRlSW50MzJMRSA9IGZ1bmN0aW9uIHdyaXRlSW50MzJMRSAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHsKICB2YWx1ZSA9ICt2YWx1ZQogIG9mZnNldCA9IG9mZnNldCA+Pj4gMAogIGlmICghbm9Bc3NlcnQpIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDQsIDB4N2ZmZmZmZmYsIC0weDgwMDAwMDAwKQogIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSAmIDB4ZmYpCiAgdGhpc1tvZmZzZXQgKyAxXSA9ICh2YWx1ZSA+Pj4gOCkKICB0aGlzW29mZnNldCArIDJdID0gKHZhbHVlID4+PiAxNikKICB0aGlzW29mZnNldCArIDNdID0gKHZhbHVlID4+PiAyNCkKICByZXR1cm4gb2Zmc2V0ICsgNAp9CgpCdWZmZXIucHJvdG90eXBlLndyaXRlSW50MzJCRSA9IGZ1bmN0aW9uIHdyaXRlSW50MzJCRSAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHsKICB2YWx1ZSA9ICt2YWx1ZQogIG9mZnNldCA9IG9mZnNldCA+Pj4gMAogIGlmICghbm9Bc3NlcnQpIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDQsIDB4N2ZmZmZmZmYsIC0weDgwMDAwMDAwKQogIGlmICh2YWx1ZSA8IDApIHZhbHVlID0gMHhmZmZmZmZmZiArIHZhbHVlICsgMQogIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSA+Pj4gMjQpCiAgdGhpc1tvZmZzZXQgKyAxXSA9ICh2YWx1ZSA+Pj4gMTYpCiAgdGhpc1tvZmZzZXQgKyAyXSA9ICh2YWx1ZSA+Pj4gOCkKICB0aGlzW29mZnNldCArIDNdID0gKHZhbHVlICYgMHhmZikKICByZXR1cm4gb2Zmc2V0ICsgNAp9CgpmdW5jdGlvbiBjaGVja0lFRUU3NTQgKGJ1ZiwgdmFsdWUsIG9mZnNldCwgZXh0LCBtYXgsIG1pbikgewogIGlmIChvZmZzZXQgKyBleHQgPiBidWYubGVuZ3RoKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcignSW5kZXggb3V0IG9mIHJhbmdlJykKICBpZiAob2Zmc2V0IDwgMCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0luZGV4IG91dCBvZiByYW5nZScpCn0KCmZ1bmN0aW9uIHdyaXRlRmxvYXQgKGJ1ZiwgdmFsdWUsIG9mZnNldCwgbGl0dGxlRW5kaWFuLCBub0Fzc2VydCkgewogIHZhbHVlID0gK3ZhbHVlCiAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwCiAgaWYgKCFub0Fzc2VydCkgewogICAgY2hlY2tJRUVFNzU0KGJ1ZiwgdmFsdWUsIG9mZnNldCwgNCwgMy40MDI4MjM0NjYzODUyODg2ZSszOCwgLTMuNDAyODIzNDY2Mzg1Mjg4NmUrMzgpCiAgfQogIGllZWU3NTQud3JpdGUoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIDIzLCA0KQogIHJldHVybiBvZmZzZXQgKyA0Cn0KCkJ1ZmZlci5wcm90b3R5cGUud3JpdGVGbG9hdExFID0gZnVuY3Rpb24gd3JpdGVGbG9hdExFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogIHJldHVybiB3cml0ZUZsb2F0KHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUsIG5vQXNzZXJ0KQp9CgpCdWZmZXIucHJvdG90eXBlLndyaXRlRmxvYXRCRSA9IGZ1bmN0aW9uIHdyaXRlRmxvYXRCRSAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHsKICByZXR1cm4gd3JpdGVGbG9hdCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBmYWxzZSwgbm9Bc3NlcnQpCn0KCmZ1bmN0aW9uIHdyaXRlRG91YmxlIChidWYsIHZhbHVlLCBvZmZzZXQsIGxpdHRsZUVuZGlhbiwgbm9Bc3NlcnQpIHsKICB2YWx1ZSA9ICt2YWx1ZQogIG9mZnNldCA9IG9mZnNldCA+Pj4gMAogIGlmICghbm9Bc3NlcnQpIHsKICAgIGNoZWNrSUVFRTc1NChidWYsIHZhbHVlLCBvZmZzZXQsIDgsIDEuNzk3NjkzMTM0ODYyMzE1N0UrMzA4LCAtMS43OTc2OTMxMzQ4NjIzMTU3RSszMDgpCiAgfQogIGllZWU3NTQud3JpdGUoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIDUyLCA4KQogIHJldHVybiBvZmZzZXQgKyA4Cn0KCkJ1ZmZlci5wcm90b3R5cGUud3JpdGVEb3VibGVMRSA9IGZ1bmN0aW9uIHdyaXRlRG91YmxlTEUgKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgcmV0dXJuIHdyaXRlRG91YmxlKHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUsIG5vQXNzZXJ0KQp9CgpCdWZmZXIucHJvdG90eXBlLndyaXRlRG91YmxlQkUgPSBmdW5jdGlvbiB3cml0ZURvdWJsZUJFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogIHJldHVybiB3cml0ZURvdWJsZSh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBmYWxzZSwgbm9Bc3NlcnQpCn0KCi8vIGNvcHkodGFyZ2V0QnVmZmVyLCB0YXJnZXRTdGFydD0wLCBzb3VyY2VTdGFydD0wLCBzb3VyY2VFbmQ9YnVmZmVyLmxlbmd0aCkKQnVmZmVyLnByb3RvdHlwZS5jb3B5ID0gZnVuY3Rpb24gY29weSAodGFyZ2V0LCB0YXJnZXRTdGFydCwgc3RhcnQsIGVuZCkgewogIGlmICghQnVmZmVyLmlzQnVmZmVyKHRhcmdldCkpIHRocm93IG5ldyBUeXBlRXJyb3IoJ2FyZ3VtZW50IHNob3VsZCBiZSBhIEJ1ZmZlcicpCiAgaWYgKCFzdGFydCkgc3RhcnQgPSAwCiAgaWYgKCFlbmQgJiYgZW5kICE9PSAwKSBlbmQgPSB0aGlzLmxlbmd0aAogIGlmICh0YXJnZXRTdGFydCA+PSB0YXJnZXQubGVuZ3RoKSB0YXJnZXRTdGFydCA9IHRhcmdldC5sZW5ndGgKICBpZiAoIXRhcmdldFN0YXJ0KSB0YXJnZXRTdGFydCA9IDAKICBpZiAoZW5kID4gMCAmJiBlbmQgPCBzdGFydCkgZW5kID0gc3RhcnQKCiAgLy8gQ29weSAwIGJ5dGVzOyB3ZSdyZSBkb25lCiAgaWYgKGVuZCA9PT0gc3RhcnQpIHJldHVybiAwCiAgaWYgKHRhcmdldC5sZW5ndGggPT09IDAgfHwgdGhpcy5sZW5ndGggPT09IDApIHJldHVybiAwCgogIC8vIEZhdGFsIGVycm9yIGNvbmRpdGlvbnMKICBpZiAodGFyZ2V0U3RhcnQgPCAwKSB7CiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigndGFyZ2V0U3RhcnQgb3V0IG9mIGJvdW5kcycpCiAgfQogIGlmIChzdGFydCA8IDAgfHwgc3RhcnQgPj0gdGhpcy5sZW5ndGgpIHRocm93IG5ldyBSYW5nZUVycm9yKCdJbmRleCBvdXQgb2YgcmFuZ2UnKQogIGlmIChlbmQgPCAwKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcignc291cmNlRW5kIG91dCBvZiBib3VuZHMnKQoKICAvLyBBcmUgd2Ugb29iPwogIGlmIChlbmQgPiB0aGlzLmxlbmd0aCkgZW5kID0gdGhpcy5sZW5ndGgKICBpZiAodGFyZ2V0Lmxlbmd0aCAtIHRhcmdldFN0YXJ0IDwgZW5kIC0gc3RhcnQpIHsKICAgIGVuZCA9IHRhcmdldC5sZW5ndGggLSB0YXJnZXRTdGFydCArIHN0YXJ0CiAgfQoKICB2YXIgbGVuID0gZW5kIC0gc3RhcnQKCiAgaWYgKHRoaXMgPT09IHRhcmdldCAmJiB0eXBlb2YgVWludDhBcnJheS5wcm90b3R5cGUuY29weVdpdGhpbiA9PT0gJ2Z1bmN0aW9uJykgewogICAgLy8gVXNlIGJ1aWx0LWluIHdoZW4gYXZhaWxhYmxlLCBtaXNzaW5nIGZyb20gSUUxMQogICAgdGhpcy5jb3B5V2l0aGluKHRhcmdldFN0YXJ0LCBzdGFydCwgZW5kKQogIH0gZWxzZSBpZiAodGhpcyA9PT0gdGFyZ2V0ICYmIHN0YXJ0IDwgdGFyZ2V0U3RhcnQgJiYgdGFyZ2V0U3RhcnQgPCBlbmQpIHsKICAgIC8vIGRlc2NlbmRpbmcgY29weSBmcm9tIGVuZAogICAgZm9yICh2YXIgaSA9IGxlbiAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgIHRhcmdldFtpICsgdGFyZ2V0U3RhcnRdID0gdGhpc1tpICsgc3RhcnRdCiAgICB9CiAgfSBlbHNlIHsKICAgIFVpbnQ4QXJyYXkucHJvdG90eXBlLnNldC5jYWxsKAogICAgICB0YXJnZXQsCiAgICAgIHRoaXMuc3ViYXJyYXkoc3RhcnQsIGVuZCksCiAgICAgIHRhcmdldFN0YXJ0CiAgICApCiAgfQoKICByZXR1cm4gbGVuCn0KCi8vIFVzYWdlOgovLyAgICBidWZmZXIuZmlsbChudW1iZXJbLCBvZmZzZXRbLCBlbmRdXSkKLy8gICAgYnVmZmVyLmZpbGwoYnVmZmVyWywgb2Zmc2V0WywgZW5kXV0pCi8vICAgIGJ1ZmZlci5maWxsKHN0cmluZ1ssIG9mZnNldFssIGVuZF1dWywgZW5jb2RpbmddKQpCdWZmZXIucHJvdG90eXBlLmZpbGwgPSBmdW5jdGlvbiBmaWxsICh2YWwsIHN0YXJ0LCBlbmQsIGVuY29kaW5nKSB7CiAgLy8gSGFuZGxlIHN0cmluZyBjYXNlczoKICBpZiAodHlwZW9mIHZhbCA9PT0gJ3N0cmluZycpIHsKICAgIGlmICh0eXBlb2Ygc3RhcnQgPT09ICdzdHJpbmcnKSB7CiAgICAgIGVuY29kaW5nID0gc3RhcnQKICAgICAgc3RhcnQgPSAwCiAgICAgIGVuZCA9IHRoaXMubGVuZ3RoCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBlbmQgPT09ICdzdHJpbmcnKSB7CiAgICAgIGVuY29kaW5nID0gZW5kCiAgICAgIGVuZCA9IHRoaXMubGVuZ3RoCiAgICB9CiAgICBpZiAoZW5jb2RpbmcgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2YgZW5jb2RpbmcgIT09ICdzdHJpbmcnKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ2VuY29kaW5nIG11c3QgYmUgYSBzdHJpbmcnKQogICAgfQogICAgaWYgKHR5cGVvZiBlbmNvZGluZyA9PT0gJ3N0cmluZycgJiYgIUJ1ZmZlci5pc0VuY29kaW5nKGVuY29kaW5nKSkgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdVbmtub3duIGVuY29kaW5nOiAnICsgZW5jb2RpbmcpCiAgICB9CiAgICBpZiAodmFsLmxlbmd0aCA9PT0gMSkgewogICAgICB2YXIgY29kZSA9IHZhbC5jaGFyQ29kZUF0KDApCiAgICAgIGlmICgoZW5jb2RpbmcgPT09ICd1dGY4JyAmJiBjb2RlIDwgMTI4KSB8fAogICAgICAgICAgZW5jb2RpbmcgPT09ICdsYXRpbjEnKSB7CiAgICAgICAgLy8gRmFzdCBwYXRoOiBJZiBgdmFsYCBmaXRzIGludG8gYSBzaW5nbGUgYnl0ZSwgdXNlIHRoYXQgbnVtZXJpYyB2YWx1ZS4KICAgICAgICB2YWwgPSBjb2RlCiAgICAgIH0KICAgIH0KICB9IGVsc2UgaWYgKHR5cGVvZiB2YWwgPT09ICdudW1iZXInKSB7CiAgICB2YWwgPSB2YWwgJiAyNTUKICB9CgogIC8vIEludmFsaWQgcmFuZ2VzIGFyZSBub3Qgc2V0IHRvIGEgZGVmYXVsdCwgc28gY2FuIHJhbmdlIGNoZWNrIGVhcmx5LgogIGlmIChzdGFydCA8IDAgfHwgdGhpcy5sZW5ndGggPCBzdGFydCB8fCB0aGlzLmxlbmd0aCA8IGVuZCkgewogICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ091dCBvZiByYW5nZSBpbmRleCcpCiAgfQoKICBpZiAoZW5kIDw9IHN0YXJ0KSB7CiAgICByZXR1cm4gdGhpcwogIH0KCiAgc3RhcnQgPSBzdGFydCA+Pj4gMAogIGVuZCA9IGVuZCA9PT0gdW5kZWZpbmVkID8gdGhpcy5sZW5ndGggOiBlbmQgPj4+IDAKCiAgaWYgKCF2YWwpIHZhbCA9IDAKCiAgdmFyIGkKICBpZiAodHlwZW9mIHZhbCA9PT0gJ251bWJlcicpIHsKICAgIGZvciAoaSA9IHN0YXJ0OyBpIDwgZW5kOyArK2kpIHsKICAgICAgdGhpc1tpXSA9IHZhbAogICAgfQogIH0gZWxzZSB7CiAgICB2YXIgYnl0ZXMgPSBCdWZmZXIuaXNCdWZmZXIodmFsKQogICAgICA/IHZhbAogICAgICA6IEJ1ZmZlci5mcm9tKHZhbCwgZW5jb2RpbmcpCiAgICB2YXIgbGVuID0gYnl0ZXMubGVuZ3RoCiAgICBpZiAobGVuID09PSAwKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RoZSB2YWx1ZSAiJyArIHZhbCArCiAgICAgICAgJyIgaXMgaW52YWxpZCBmb3IgYXJndW1lbnQgInZhbHVlIicpCiAgICB9CiAgICBmb3IgKGkgPSAwOyBpIDwgZW5kIC0gc3RhcnQ7ICsraSkgewogICAgICB0aGlzW2kgKyBzdGFydF0gPSBieXRlc1tpICUgbGVuXQogICAgfQogIH0KCiAgcmV0dXJuIHRoaXMKfQoKLy8gSEVMUEVSIEZVTkNUSU9OUwovLyA9PT09PT09PT09PT09PT09Cgp2YXIgSU5WQUxJRF9CQVNFNjRfUkUgPSAvW14rLzAtOUEtWmEtei1fXS9nCgpmdW5jdGlvbiBiYXNlNjRjbGVhbiAoc3RyKSB7CiAgLy8gTm9kZSB0YWtlcyBlcXVhbCBzaWducyBhcyBlbmQgb2YgdGhlIEJhc2U2NCBlbmNvZGluZwogIHN0ciA9IHN0ci5zcGxpdCgnPScpWzBdCiAgLy8gTm9kZSBzdHJpcHMgb3V0IGludmFsaWQgY2hhcmFjdGVycyBsaWtlIFxuIGFuZCBcdCBmcm9tIHRoZSBzdHJpbmcsIGJhc2U2NC1qcyBkb2VzIG5vdAogIHN0ciA9IHN0ci50cmltKCkucmVwbGFjZShJTlZBTElEX0JBU0U2NF9SRSwgJycpCiAgLy8gTm9kZSBjb252ZXJ0cyBzdHJpbmdzIHdpdGggbGVuZ3RoIDwgMiB0byAnJwogIGlmIChzdHIubGVuZ3RoIDwgMikgcmV0dXJuICcnCiAgLy8gTm9kZSBhbGxvd3MgZm9yIG5vbi1wYWRkZWQgYmFzZTY0IHN0cmluZ3MgKG1pc3NpbmcgdHJhaWxpbmcgPT09KSwgYmFzZTY0LWpzIGRvZXMgbm90CiAgd2hpbGUgKHN0ci5sZW5ndGggJSA0ICE9PSAwKSB7CiAgICBzdHIgPSBzdHIgKyAnPScKICB9CiAgcmV0dXJuIHN0cgp9CgpmdW5jdGlvbiB0b0hleCAobikgewogIGlmIChuIDwgMTYpIHJldHVybiAnMCcgKyBuLnRvU3RyaW5nKDE2KQogIHJldHVybiBuLnRvU3RyaW5nKDE2KQp9CgpmdW5jdGlvbiB1dGY4VG9CeXRlcyAoc3RyaW5nLCB1bml0cykgewogIHVuaXRzID0gdW5pdHMgfHwgSW5maW5pdHkKICB2YXIgY29kZVBvaW50CiAgdmFyIGxlbmd0aCA9IHN0cmluZy5sZW5ndGgKICB2YXIgbGVhZFN1cnJvZ2F0ZSA9IG51bGwKICB2YXIgYnl0ZXMgPSBbXQoKICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICBjb2RlUG9pbnQgPSBzdHJpbmcuY2hhckNvZGVBdChpKQoKICAgIC8vIGlzIHN1cnJvZ2F0ZSBjb21wb25lbnQKICAgIGlmIChjb2RlUG9pbnQgPiAweEQ3RkYgJiYgY29kZVBvaW50IDwgMHhFMDAwKSB7CiAgICAgIC8vIGxhc3QgY2hhciB3YXMgYSBsZWFkCiAgICAgIGlmICghbGVhZFN1cnJvZ2F0ZSkgewogICAgICAgIC8vIG5vIGxlYWQgeWV0CiAgICAgICAgaWYgKGNvZGVQb2ludCA+IDB4REJGRikgewogICAgICAgICAgLy8gdW5leHBlY3RlZCB0cmFpbAogICAgICAgICAgaWYgKCh1bml0cyAtPSAzKSA+IC0xKSBieXRlcy5wdXNoKDB4RUYsIDB4QkYsIDB4QkQpCiAgICAgICAgICBjb250aW51ZQogICAgICAgIH0gZWxzZSBpZiAoaSArIDEgPT09IGxlbmd0aCkgewogICAgICAgICAgLy8gdW5wYWlyZWQgbGVhZAogICAgICAgICAgaWYgKCh1bml0cyAtPSAzKSA+IC0xKSBieXRlcy5wdXNoKDB4RUYsIDB4QkYsIDB4QkQpCiAgICAgICAgICBjb250aW51ZQogICAgICAgIH0KCiAgICAgICAgLy8gdmFsaWQgbGVhZAogICAgICAgIGxlYWRTdXJyb2dhdGUgPSBjb2RlUG9pbnQKCiAgICAgICAgY29udGludWUKICAgICAgfQoKICAgICAgLy8gMiBsZWFkcyBpbiBhIHJvdwogICAgICBpZiAoY29kZVBvaW50IDwgMHhEQzAwKSB7CiAgICAgICAgaWYgKCh1bml0cyAtPSAzKSA+IC0xKSBieXRlcy5wdXNoKDB4RUYsIDB4QkYsIDB4QkQpCiAgICAgICAgbGVhZFN1cnJvZ2F0ZSA9IGNvZGVQb2ludAogICAgICAgIGNvbnRpbnVlCiAgICAgIH0KCiAgICAgIC8vIHZhbGlkIHN1cnJvZ2F0ZSBwYWlyCiAgICAgIGNvZGVQb2ludCA9IChsZWFkU3Vycm9nYXRlIC0gMHhEODAwIDw8IDEwIHwgY29kZVBvaW50IC0gMHhEQzAwKSArIDB4MTAwMDAKICAgIH0gZWxzZSBpZiAobGVhZFN1cnJvZ2F0ZSkgewogICAgICAvLyB2YWxpZCBibXAgY2hhciwgYnV0IGxhc3QgY2hhciB3YXMgYSBsZWFkCiAgICAgIGlmICgodW5pdHMgLT0gMykgPiAtMSkgYnl0ZXMucHVzaCgweEVGLCAweEJGLCAweEJEKQogICAgfQoKICAgIGxlYWRTdXJyb2dhdGUgPSBudWxsCgogICAgLy8gZW5jb2RlIHV0ZjgKICAgIGlmIChjb2RlUG9pbnQgPCAweDgwKSB7CiAgICAgIGlmICgodW5pdHMgLT0gMSkgPCAwKSBicmVhawogICAgICBieXRlcy5wdXNoKGNvZGVQb2ludCkKICAgIH0gZWxzZSBpZiAoY29kZVBvaW50IDwgMHg4MDApIHsKICAgICAgaWYgKCh1bml0cyAtPSAyKSA8IDApIGJyZWFrCiAgICAgIGJ5dGVzLnB1c2goCiAgICAgICAgY29kZVBvaW50ID4+IDB4NiB8IDB4QzAsCiAgICAgICAgY29kZVBvaW50ICYgMHgzRiB8IDB4ODAKICAgICAgKQogICAgfSBlbHNlIGlmIChjb2RlUG9pbnQgPCAweDEwMDAwKSB7CiAgICAgIGlmICgodW5pdHMgLT0gMykgPCAwKSBicmVhawogICAgICBieXRlcy5wdXNoKAogICAgICAgIGNvZGVQb2ludCA+PiAweEMgfCAweEUwLAogICAgICAgIGNvZGVQb2ludCA+PiAweDYgJiAweDNGIHwgMHg4MCwKICAgICAgICBjb2RlUG9pbnQgJiAweDNGIHwgMHg4MAogICAgICApCiAgICB9IGVsc2UgaWYgKGNvZGVQb2ludCA8IDB4MTEwMDAwKSB7CiAgICAgIGlmICgodW5pdHMgLT0gNCkgPCAwKSBicmVhawogICAgICBieXRlcy5wdXNoKAogICAgICAgIGNvZGVQb2ludCA+PiAweDEyIHwgMHhGMCwKICAgICAgICBjb2RlUG9pbnQgPj4gMHhDICYgMHgzRiB8IDB4ODAsCiAgICAgICAgY29kZVBvaW50ID4+IDB4NiAmIDB4M0YgfCAweDgwLAogICAgICAgIGNvZGVQb2ludCAmIDB4M0YgfCAweDgwCiAgICAgICkKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBjb2RlIHBvaW50JykKICAgIH0KICB9CgogIHJldHVybiBieXRlcwp9CgpmdW5jdGlvbiBhc2NpaVRvQnl0ZXMgKHN0cikgewogIHZhciBieXRlQXJyYXkgPSBbXQogIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgKytpKSB7CiAgICAvLyBOb2RlJ3MgY29kZSBzZWVtcyB0byBiZSBkb2luZyB0aGlzIGFuZCBub3QgJiAweDdGLi4KICAgIGJ5dGVBcnJheS5wdXNoKHN0ci5jaGFyQ29kZUF0KGkpICYgMHhGRikKICB9CiAgcmV0dXJuIGJ5dGVBcnJheQp9CgpmdW5jdGlvbiB1dGYxNmxlVG9CeXRlcyAoc3RyLCB1bml0cykgewogIHZhciBjLCBoaSwgbG8KICB2YXIgYnl0ZUFycmF5ID0gW10KICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7ICsraSkgewogICAgaWYgKCh1bml0cyAtPSAyKSA8IDApIGJyZWFrCgogICAgYyA9IHN0ci5jaGFyQ29kZUF0KGkpCiAgICBoaSA9IGMgPj4gOAogICAgbG8gPSBjICUgMjU2CiAgICBieXRlQXJyYXkucHVzaChsbykKICAgIGJ5dGVBcnJheS5wdXNoKGhpKQogIH0KCiAgcmV0dXJuIGJ5dGVBcnJheQp9CgpmdW5jdGlvbiBiYXNlNjRUb0J5dGVzIChzdHIpIHsKICByZXR1cm4gYmFzZTY0LnRvQnl0ZUFycmF5KGJhc2U2NGNsZWFuKHN0cikpCn0KCmZ1bmN0aW9uIGJsaXRCdWZmZXIgKHNyYywgZHN0LCBvZmZzZXQsIGxlbmd0aCkgewogIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgIGlmICgoaSArIG9mZnNldCA+PSBkc3QubGVuZ3RoKSB8fCAoaSA+PSBzcmMubGVuZ3RoKSkgYnJlYWsKICAgIGRzdFtpICsgb2Zmc2V0XSA9IHNyY1tpXQogIH0KICByZXR1cm4gaQp9CgovLyBBcnJheUJ1ZmZlciBvciBVaW50OEFycmF5IG9iamVjdHMgZnJvbSBvdGhlciBjb250ZXh0cyAoaS5lLiBpZnJhbWVzKSBkbyBub3QgcGFzcwovLyB0aGUgYGluc3RhbmNlb2ZgIGNoZWNrIGJ1dCB0aGV5IHNob3VsZCBiZSB0cmVhdGVkIGFzIG9mIHRoYXQgdHlwZS4KLy8gU2VlOiBodHRwczovL2dpdGh1Yi5jb20vZmVyb3NzL2J1ZmZlci9pc3N1ZXMvMTY2CmZ1bmN0aW9uIGlzSW5zdGFuY2UgKG9iaiwgdHlwZSkgewogIHJldHVybiBvYmogaW5zdGFuY2VvZiB0eXBlIHx8CiAgICAob2JqICE9IG51bGwgJiYgb2JqLmNvbnN0cnVjdG9yICE9IG51bGwgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgIT0gbnVsbCAmJgogICAgICBvYmouY29uc3RydWN0b3IubmFtZSA9PT0gdHlwZS5uYW1lKQp9CmZ1bmN0aW9uIG51bWJlcklzTmFOIChvYmopIHsKICAvLyBGb3IgSUUxMSBzdXBwb3J0CiAgcmV0dXJuIG9iaiAhPT0gb2JqIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tc2VsZi1jb21wYXJlCn0KCn0pLmNhbGwodGhpcyl9KS5jYWxsKHRoaXMscmVxdWlyZSgiYnVmZmVyIikuQnVmZmVyKQp9LHsiYmFzZTY0LWpzIjoxOCwiYnVmZmVyIjoxOSwiaWVlZTc1NCI6MzF9XSwyMDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBHZXRJbnRyaW5zaWMgPSByZXF1aXJlKCdnZXQtaW50cmluc2ljJyk7Cgp2YXIgY2FsbEJpbmQgPSByZXF1aXJlKCcuLycpOwoKdmFyICRpbmRleE9mID0gY2FsbEJpbmQoR2V0SW50cmluc2ljKCdTdHJpbmcucHJvdG90eXBlLmluZGV4T2YnKSk7Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGNhbGxCb3VuZEludHJpbnNpYyhuYW1lLCBhbGxvd01pc3NpbmcpIHsKCXZhciBpbnRyaW5zaWMgPSBHZXRJbnRyaW5zaWMobmFtZSwgISFhbGxvd01pc3NpbmcpOwoJaWYgKHR5cGVvZiBpbnRyaW5zaWMgPT09ICdmdW5jdGlvbicgJiYgJGluZGV4T2YobmFtZSwgJy5wcm90b3R5cGUuJykgPiAtMSkgewoJCXJldHVybiBjYWxsQmluZChpbnRyaW5zaWMpOwoJfQoJcmV0dXJuIGludHJpbnNpYzsKfTsKCn0seyIuLyI6MjEsImdldC1pbnRyaW5zaWMiOjI3fV0sMjE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgYmluZCA9IHJlcXVpcmUoJ2Z1bmN0aW9uLWJpbmQnKTsKdmFyIEdldEludHJpbnNpYyA9IHJlcXVpcmUoJ2dldC1pbnRyaW5zaWMnKTsKCnZhciAkYXBwbHkgPSBHZXRJbnRyaW5zaWMoJyVGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHklJyk7CnZhciAkY2FsbCA9IEdldEludHJpbnNpYygnJUZ1bmN0aW9uLnByb3RvdHlwZS5jYWxsJScpOwp2YXIgJHJlZmxlY3RBcHBseSA9IEdldEludHJpbnNpYygnJVJlZmxlY3QuYXBwbHklJywgdHJ1ZSkgfHwgYmluZC5jYWxsKCRjYWxsLCAkYXBwbHkpOwoKdmFyICRkZWZpbmVQcm9wZXJ0eSA9IEdldEludHJpbnNpYygnJU9iamVjdC5kZWZpbmVQcm9wZXJ0eSUnLCB0cnVlKTsKCmlmICgkZGVmaW5lUHJvcGVydHkpIHsKCXRyeSB7CgkJJGRlZmluZVByb3BlcnR5KHt9LCAnYScsIHsgdmFsdWU6IDEgfSk7Cgl9IGNhdGNoIChlKSB7CgkJLy8gSUUgOCBoYXMgYSBicm9rZW4gZGVmaW5lUHJvcGVydHkKCQkkZGVmaW5lUHJvcGVydHkgPSBudWxsOwoJfQp9Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGNhbGxCaW5kKCkgewoJcmV0dXJuICRyZWZsZWN0QXBwbHkoYmluZCwgJGNhbGwsIGFyZ3VtZW50cyk7Cn07Cgp2YXIgYXBwbHlCaW5kID0gZnVuY3Rpb24gYXBwbHlCaW5kKCkgewoJcmV0dXJuICRyZWZsZWN0QXBwbHkoYmluZCwgJGFwcGx5LCBhcmd1bWVudHMpOwp9OwoKaWYgKCRkZWZpbmVQcm9wZXJ0eSkgewoJJGRlZmluZVByb3BlcnR5KG1vZHVsZS5leHBvcnRzLCAnYXBwbHknLCB7IHZhbHVlOiBhcHBseUJpbmQgfSk7Cn0gZWxzZSB7Cgltb2R1bGUuZXhwb3J0cy5hcHBseSA9IGFwcGx5QmluZDsKfQoKfSx7ImZ1bmN0aW9uLWJpbmQiOjI2LCJnZXQtaW50cmluc2ljIjoyN31dLDIyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKLyogZ2xvYmFscwoJQWdncmVnYXRlRXJyb3IsCglBdG9taWNzLAoJRmluYWxpemF0aW9uUmVnaXN0cnksCglTaGFyZWRBcnJheUJ1ZmZlciwKCVdlYWtSZWYsCiovCgp2YXIgdW5kZWZpbmVkOwoKdmFyICRTeW50YXhFcnJvciA9IFN5bnRheEVycm9yOwp2YXIgJEZ1bmN0aW9uID0gRnVuY3Rpb247CnZhciAkVHlwZUVycm9yID0gVHlwZUVycm9yOwoKLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbnNpc3RlbnQtcmV0dXJuCnZhciBnZXRFdmFsbGVkQ29uc3RydWN0b3IgPSBmdW5jdGlvbiAoZXhwcmVzc2lvblN5bnRheCkgewoJdHJ5IHsKCQkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tbmV3LWZ1bmMKCQlyZXR1cm4gRnVuY3Rpb24oJyJ1c2Ugc3RyaWN0IjsgcmV0dXJuICgnICsgZXhwcmVzc2lvblN5bnRheCArICcpLmNvbnN0cnVjdG9yOycpKCk7Cgl9IGNhdGNoIChlKSB7fQp9OwoKdmFyICRnT1BEID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcjsKaWYgKCRnT1BEKSB7Cgl0cnkgewoJCSRnT1BEKHt9LCAnJyk7Cgl9IGNhdGNoIChlKSB7CgkJJGdPUEQgPSBudWxsOyAvLyB0aGlzIGlzIElFIDgsIHdoaWNoIGhhcyBhIGJyb2tlbiBnT1BECgl9Cn0KCnZhciB0aHJvd1R5cGVFcnJvciA9IGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3ICRUeXBlRXJyb3IoKTsgfTsKdmFyIFRocm93VHlwZUVycm9yID0gJGdPUEQKCT8gKGZ1bmN0aW9uICgpIHsKCQl0cnkgewoJCQkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLWV4cHJlc3Npb25zLCBuby1jYWxsZXIsIG5vLXJlc3RyaWN0ZWQtcHJvcGVydGllcwoJCQlhcmd1bWVudHMuY2FsbGVlOyAvLyBJRSA4IGRvZXMgbm90IHRocm93IGhlcmUKCQkJcmV0dXJuIHRocm93VHlwZUVycm9yOwoJCX0gY2F0Y2ggKGNhbGxlZVRocm93cykgewoJCQl0cnkgewoJCQkJLy8gSUUgOCB0aHJvd3Mgb24gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihhcmd1bWVudHMsICcnKQoJCQkJcmV0dXJuICRnT1BEKGFyZ3VtZW50cywgJ2NhbGxlZScpLmdldDsKCQkJfSBjYXRjaCAoZ09QRHRocm93cykgewoJCQkJcmV0dXJuIHRocm93VHlwZUVycm9yOwoJCQl9CgkJfQoJfSgpKQoJOiB0aHJvd1R5cGVFcnJvcjsKCnZhciBoYXNTeW1ib2xzID0gcmVxdWlyZSgnaGFzLXN5bWJvbHMnKSgpOwoKdmFyIGdldFByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uICh4KSB7IHJldHVybiB4Ll9fcHJvdG9fXzsgfTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1wcm90bwoKdmFyIGFzeW5jR2VuRnVuY3Rpb24gPSBnZXRFdmFsbGVkQ29uc3RydWN0b3IoJ2FzeW5jIGZ1bmN0aW9uKiAoKSB7fScpOwp2YXIgYXN5bmNHZW5GdW5jdGlvblByb3RvdHlwZSA9IGFzeW5jR2VuRnVuY3Rpb24gPyBhc3luY0dlbkZ1bmN0aW9uLnByb3RvdHlwZSA6IHVuZGVmaW5lZDsKdmFyIGFzeW5jR2VuUHJvdG90eXBlID0gYXN5bmNHZW5GdW5jdGlvblByb3RvdHlwZSA/IGFzeW5jR2VuRnVuY3Rpb25Qcm90b3R5cGUucHJvdG90eXBlIDogdW5kZWZpbmVkOwoKdmFyIFR5cGVkQXJyYXkgPSB0eXBlb2YgVWludDhBcnJheSA9PT0gJ3VuZGVmaW5lZCcgPyB1bmRlZmluZWQgOiBnZXRQcm90byhVaW50OEFycmF5KTsKCnZhciBJTlRSSU5TSUNTID0gewoJJyVBZ2dyZWdhdGVFcnJvciUnOiB0eXBlb2YgQWdncmVnYXRlRXJyb3IgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogQWdncmVnYXRlRXJyb3IsCgknJUFycmF5JSc6IEFycmF5LAoJJyVBcnJheUJ1ZmZlciUnOiB0eXBlb2YgQXJyYXlCdWZmZXIgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogQXJyYXlCdWZmZXIsCgknJUFycmF5SXRlcmF0b3JQcm90b3R5cGUlJzogaGFzU3ltYm9scyA/IGdldFByb3RvKFtdW1N5bWJvbC5pdGVyYXRvcl0oKSkgOiB1bmRlZmluZWQsCgknJUFzeW5jRnJvbVN5bmNJdGVyYXRvclByb3RvdHlwZSUnOiB1bmRlZmluZWQsCgknJUFzeW5jRnVuY3Rpb24lJzogZ2V0RXZhbGxlZENvbnN0cnVjdG9yKCdhc3luYyBmdW5jdGlvbiAoKSB7fScpLAoJJyVBc3luY0dlbmVyYXRvciUnOiBhc3luY0dlbkZ1bmN0aW9uUHJvdG90eXBlLAoJJyVBc3luY0dlbmVyYXRvckZ1bmN0aW9uJSc6IGFzeW5jR2VuRnVuY3Rpb24sCgknJUFzeW5jSXRlcmF0b3JQcm90b3R5cGUlJzogYXN5bmNHZW5Qcm90b3R5cGUgPyBnZXRQcm90byhhc3luY0dlblByb3RvdHlwZSkgOiB1bmRlZmluZWQsCgknJUF0b21pY3MlJzogdHlwZW9mIEF0b21pY3MgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogQXRvbWljcywKCSclQmlnSW50JSc6IHR5cGVvZiBCaWdJbnQgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogQmlnSW50LAoJJyVCb29sZWFuJSc6IEJvb2xlYW4sCgknJURhdGFWaWV3JSc6IHR5cGVvZiBEYXRhVmlldyA9PT0gJ3VuZGVmaW5lZCcgPyB1bmRlZmluZWQgOiBEYXRhVmlldywKCSclRGF0ZSUnOiBEYXRlLAoJJyVkZWNvZGVVUkklJzogZGVjb2RlVVJJLAoJJyVkZWNvZGVVUklDb21wb25lbnQlJzogZGVjb2RlVVJJQ29tcG9uZW50LAoJJyVlbmNvZGVVUkklJzogZW5jb2RlVVJJLAoJJyVlbmNvZGVVUklDb21wb25lbnQlJzogZW5jb2RlVVJJQ29tcG9uZW50LAoJJyVFcnJvciUnOiBFcnJvciwKCSclZXZhbCUnOiBldmFsLCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV2YWwKCSclRXZhbEVycm9yJSc6IEV2YWxFcnJvciwKCSclRmxvYXQzMkFycmF5JSc6IHR5cGVvZiBGbG9hdDMyQXJyYXkgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogRmxvYXQzMkFycmF5LAoJJyVGbG9hdDY0QXJyYXklJzogdHlwZW9mIEZsb2F0NjRBcnJheSA9PT0gJ3VuZGVmaW5lZCcgPyB1bmRlZmluZWQgOiBGbG9hdDY0QXJyYXksCgknJUZpbmFsaXphdGlvblJlZ2lzdHJ5JSc6IHR5cGVvZiBGaW5hbGl6YXRpb25SZWdpc3RyeSA9PT0gJ3VuZGVmaW5lZCcgPyB1bmRlZmluZWQgOiBGaW5hbGl6YXRpb25SZWdpc3RyeSwKCSclRnVuY3Rpb24lJzogJEZ1bmN0aW9uLAoJJyVHZW5lcmF0b3JGdW5jdGlvbiUnOiBnZXRFdmFsbGVkQ29uc3RydWN0b3IoJ2Z1bmN0aW9uKiAoKSB7fScpLAoJJyVJbnQ4QXJyYXklJzogdHlwZW9mIEludDhBcnJheSA9PT0gJ3VuZGVmaW5lZCcgPyB1bmRlZmluZWQgOiBJbnQ4QXJyYXksCgknJUludDE2QXJyYXklJzogdHlwZW9mIEludDE2QXJyYXkgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogSW50MTZBcnJheSwKCSclSW50MzJBcnJheSUnOiB0eXBlb2YgSW50MzJBcnJheSA9PT0gJ3VuZGVmaW5lZCcgPyB1bmRlZmluZWQgOiBJbnQzMkFycmF5LAoJJyVpc0Zpbml0ZSUnOiBpc0Zpbml0ZSwKCSclaXNOYU4lJzogaXNOYU4sCgknJUl0ZXJhdG9yUHJvdG90eXBlJSc6IGhhc1N5bWJvbHMgPyBnZXRQcm90byhnZXRQcm90byhbXVtTeW1ib2wuaXRlcmF0b3JdKCkpKSA6IHVuZGVmaW5lZCwKCSclSlNPTiUnOiB0eXBlb2YgSlNPTiA9PT0gJ29iamVjdCcgPyBKU09OIDogdW5kZWZpbmVkLAoJJyVNYXAlJzogdHlwZW9mIE1hcCA9PT0gJ3VuZGVmaW5lZCcgPyB1bmRlZmluZWQgOiBNYXAsCgknJU1hcEl0ZXJhdG9yUHJvdG90eXBlJSc6IHR5cGVvZiBNYXAgPT09ICd1bmRlZmluZWQnIHx8ICFoYXNTeW1ib2xzID8gdW5kZWZpbmVkIDogZ2V0UHJvdG8obmV3IE1hcCgpW1N5bWJvbC5pdGVyYXRvcl0oKSksCgknJU1hdGglJzogTWF0aCwKCSclTnVtYmVyJSc6IE51bWJlciwKCSclT2JqZWN0JSc6IE9iamVjdCwKCSclcGFyc2VGbG9hdCUnOiBwYXJzZUZsb2F0LAoJJyVwYXJzZUludCUnOiBwYXJzZUludCwKCSclUHJvbWlzZSUnOiB0eXBlb2YgUHJvbWlzZSA9PT0gJ3VuZGVmaW5lZCcgPyB1bmRlZmluZWQgOiBQcm9taXNlLAoJJyVQcm94eSUnOiB0eXBlb2YgUHJveHkgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogUHJveHksCgknJVJhbmdlRXJyb3IlJzogUmFuZ2VFcnJvciwKCSclUmVmZXJlbmNlRXJyb3IlJzogUmVmZXJlbmNlRXJyb3IsCgknJVJlZmxlY3QlJzogdHlwZW9mIFJlZmxlY3QgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogUmVmbGVjdCwKCSclUmVnRXhwJSc6IFJlZ0V4cCwKCSclU2V0JSc6IHR5cGVvZiBTZXQgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogU2V0LAoJJyVTZXRJdGVyYXRvclByb3RvdHlwZSUnOiB0eXBlb2YgU2V0ID09PSAndW5kZWZpbmVkJyB8fCAhaGFzU3ltYm9scyA/IHVuZGVmaW5lZCA6IGdldFByb3RvKG5ldyBTZXQoKVtTeW1ib2wuaXRlcmF0b3JdKCkpLAoJJyVTaGFyZWRBcnJheUJ1ZmZlciUnOiB0eXBlb2YgU2hhcmVkQXJyYXlCdWZmZXIgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogU2hhcmVkQXJyYXlCdWZmZXIsCgknJVN0cmluZyUnOiBTdHJpbmcsCgknJVN0cmluZ0l0ZXJhdG9yUHJvdG90eXBlJSc6IGhhc1N5bWJvbHMgPyBnZXRQcm90bygnJ1tTeW1ib2wuaXRlcmF0b3JdKCkpIDogdW5kZWZpbmVkLAoJJyVTeW1ib2wlJzogaGFzU3ltYm9scyA/IFN5bWJvbCA6IHVuZGVmaW5lZCwKCSclU3ludGF4RXJyb3IlJzogJFN5bnRheEVycm9yLAoJJyVUaHJvd1R5cGVFcnJvciUnOiBUaHJvd1R5cGVFcnJvciwKCSclVHlwZWRBcnJheSUnOiBUeXBlZEFycmF5LAoJJyVUeXBlRXJyb3IlJzogJFR5cGVFcnJvciwKCSclVWludDhBcnJheSUnOiB0eXBlb2YgVWludDhBcnJheSA9PT0gJ3VuZGVmaW5lZCcgPyB1bmRlZmluZWQgOiBVaW50OEFycmF5LAoJJyVVaW50OENsYW1wZWRBcnJheSUnOiB0eXBlb2YgVWludDhDbGFtcGVkQXJyYXkgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogVWludDhDbGFtcGVkQXJyYXksCgknJVVpbnQxNkFycmF5JSc6IHR5cGVvZiBVaW50MTZBcnJheSA9PT0gJ3VuZGVmaW5lZCcgPyB1bmRlZmluZWQgOiBVaW50MTZBcnJheSwKCSclVWludDMyQXJyYXklJzogdHlwZW9mIFVpbnQzMkFycmF5ID09PSAndW5kZWZpbmVkJyA/IHVuZGVmaW5lZCA6IFVpbnQzMkFycmF5LAoJJyVVUklFcnJvciUnOiBVUklFcnJvciwKCSclV2Vha01hcCUnOiB0eXBlb2YgV2Vha01hcCA9PT0gJ3VuZGVmaW5lZCcgPyB1bmRlZmluZWQgOiBXZWFrTWFwLAoJJyVXZWFrUmVmJSc6IHR5cGVvZiBXZWFrUmVmID09PSAndW5kZWZpbmVkJyA/IHVuZGVmaW5lZCA6IFdlYWtSZWYsCgknJVdlYWtTZXQlJzogdHlwZW9mIFdlYWtTZXQgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogV2Vha1NldAp9OwoKdmFyIExFR0FDWV9BTElBU0VTID0gewoJJyVBcnJheUJ1ZmZlclByb3RvdHlwZSUnOiBbJ0FycmF5QnVmZmVyJywgJ3Byb3RvdHlwZSddLAoJJyVBcnJheVByb3RvdHlwZSUnOiBbJ0FycmF5JywgJ3Byb3RvdHlwZSddLAoJJyVBcnJheVByb3RvX2VudHJpZXMlJzogWydBcnJheScsICdwcm90b3R5cGUnLCAnZW50cmllcyddLAoJJyVBcnJheVByb3RvX2ZvckVhY2glJzogWydBcnJheScsICdwcm90b3R5cGUnLCAnZm9yRWFjaCddLAoJJyVBcnJheVByb3RvX2tleXMlJzogWydBcnJheScsICdwcm90b3R5cGUnLCAna2V5cyddLAoJJyVBcnJheVByb3RvX3ZhbHVlcyUnOiBbJ0FycmF5JywgJ3Byb3RvdHlwZScsICd2YWx1ZXMnXSwKCSclQXN5bmNGdW5jdGlvblByb3RvdHlwZSUnOiBbJ0FzeW5jRnVuY3Rpb24nLCAncHJvdG90eXBlJ10sCgknJUFzeW5jR2VuZXJhdG9yJSc6IFsnQXN5bmNHZW5lcmF0b3JGdW5jdGlvbicsICdwcm90b3R5cGUnXSwKCSclQXN5bmNHZW5lcmF0b3JQcm90b3R5cGUlJzogWydBc3luY0dlbmVyYXRvckZ1bmN0aW9uJywgJ3Byb3RvdHlwZScsICdwcm90b3R5cGUnXSwKCSclQm9vbGVhblByb3RvdHlwZSUnOiBbJ0Jvb2xlYW4nLCAncHJvdG90eXBlJ10sCgknJURhdGFWaWV3UHJvdG90eXBlJSc6IFsnRGF0YVZpZXcnLCAncHJvdG90eXBlJ10sCgknJURhdGVQcm90b3R5cGUlJzogWydEYXRlJywgJ3Byb3RvdHlwZSddLAoJJyVFcnJvclByb3RvdHlwZSUnOiBbJ0Vycm9yJywgJ3Byb3RvdHlwZSddLAoJJyVFdmFsRXJyb3JQcm90b3R5cGUlJzogWydFdmFsRXJyb3InLCAncHJvdG90eXBlJ10sCgknJUZsb2F0MzJBcnJheVByb3RvdHlwZSUnOiBbJ0Zsb2F0MzJBcnJheScsICdwcm90b3R5cGUnXSwKCSclRmxvYXQ2NEFycmF5UHJvdG90eXBlJSc6IFsnRmxvYXQ2NEFycmF5JywgJ3Byb3RvdHlwZSddLAoJJyVGdW5jdGlvblByb3RvdHlwZSUnOiBbJ0Z1bmN0aW9uJywgJ3Byb3RvdHlwZSddLAoJJyVHZW5lcmF0b3IlJzogWydHZW5lcmF0b3JGdW5jdGlvbicsICdwcm90b3R5cGUnXSwKCSclR2VuZXJhdG9yUHJvdG90eXBlJSc6IFsnR2VuZXJhdG9yRnVuY3Rpb24nLCAncHJvdG90eXBlJywgJ3Byb3RvdHlwZSddLAoJJyVJbnQ4QXJyYXlQcm90b3R5cGUlJzogWydJbnQ4QXJyYXknLCAncHJvdG90eXBlJ10sCgknJUludDE2QXJyYXlQcm90b3R5cGUlJzogWydJbnQxNkFycmF5JywgJ3Byb3RvdHlwZSddLAoJJyVJbnQzMkFycmF5UHJvdG90eXBlJSc6IFsnSW50MzJBcnJheScsICdwcm90b3R5cGUnXSwKCSclSlNPTlBhcnNlJSc6IFsnSlNPTicsICdwYXJzZSddLAoJJyVKU09OU3RyaW5naWZ5JSc6IFsnSlNPTicsICdzdHJpbmdpZnknXSwKCSclTWFwUHJvdG90eXBlJSc6IFsnTWFwJywgJ3Byb3RvdHlwZSddLAoJJyVOdW1iZXJQcm90b3R5cGUlJzogWydOdW1iZXInLCAncHJvdG90eXBlJ10sCgknJU9iamVjdFByb3RvdHlwZSUnOiBbJ09iamVjdCcsICdwcm90b3R5cGUnXSwKCSclT2JqUHJvdG9fdG9TdHJpbmclJzogWydPYmplY3QnLCAncHJvdG90eXBlJywgJ3RvU3RyaW5nJ10sCgknJU9ialByb3RvX3ZhbHVlT2YlJzogWydPYmplY3QnLCAncHJvdG90eXBlJywgJ3ZhbHVlT2YnXSwKCSclUHJvbWlzZVByb3RvdHlwZSUnOiBbJ1Byb21pc2UnLCAncHJvdG90eXBlJ10sCgknJVByb21pc2VQcm90b190aGVuJSc6IFsnUHJvbWlzZScsICdwcm90b3R5cGUnLCAndGhlbiddLAoJJyVQcm9taXNlX2FsbCUnOiBbJ1Byb21pc2UnLCAnYWxsJ10sCgknJVByb21pc2VfcmVqZWN0JSc6IFsnUHJvbWlzZScsICdyZWplY3QnXSwKCSclUHJvbWlzZV9yZXNvbHZlJSc6IFsnUHJvbWlzZScsICdyZXNvbHZlJ10sCgknJVJhbmdlRXJyb3JQcm90b3R5cGUlJzogWydSYW5nZUVycm9yJywgJ3Byb3RvdHlwZSddLAoJJyVSZWZlcmVuY2VFcnJvclByb3RvdHlwZSUnOiBbJ1JlZmVyZW5jZUVycm9yJywgJ3Byb3RvdHlwZSddLAoJJyVSZWdFeHBQcm90b3R5cGUlJzogWydSZWdFeHAnLCAncHJvdG90eXBlJ10sCgknJVNldFByb3RvdHlwZSUnOiBbJ1NldCcsICdwcm90b3R5cGUnXSwKCSclU2hhcmVkQXJyYXlCdWZmZXJQcm90b3R5cGUlJzogWydTaGFyZWRBcnJheUJ1ZmZlcicsICdwcm90b3R5cGUnXSwKCSclU3RyaW5nUHJvdG90eXBlJSc6IFsnU3RyaW5nJywgJ3Byb3RvdHlwZSddLAoJJyVTeW1ib2xQcm90b3R5cGUlJzogWydTeW1ib2wnLCAncHJvdG90eXBlJ10sCgknJVN5bnRheEVycm9yUHJvdG90eXBlJSc6IFsnU3ludGF4RXJyb3InLCAncHJvdG90eXBlJ10sCgknJVR5cGVkQXJyYXlQcm90b3R5cGUlJzogWydUeXBlZEFycmF5JywgJ3Byb3RvdHlwZSddLAoJJyVUeXBlRXJyb3JQcm90b3R5cGUlJzogWydUeXBlRXJyb3InLCAncHJvdG90eXBlJ10sCgknJVVpbnQ4QXJyYXlQcm90b3R5cGUlJzogWydVaW50OEFycmF5JywgJ3Byb3RvdHlwZSddLAoJJyVVaW50OENsYW1wZWRBcnJheVByb3RvdHlwZSUnOiBbJ1VpbnQ4Q2xhbXBlZEFycmF5JywgJ3Byb3RvdHlwZSddLAoJJyVVaW50MTZBcnJheVByb3RvdHlwZSUnOiBbJ1VpbnQxNkFycmF5JywgJ3Byb3RvdHlwZSddLAoJJyVVaW50MzJBcnJheVByb3RvdHlwZSUnOiBbJ1VpbnQzMkFycmF5JywgJ3Byb3RvdHlwZSddLAoJJyVVUklFcnJvclByb3RvdHlwZSUnOiBbJ1VSSUVycm9yJywgJ3Byb3RvdHlwZSddLAoJJyVXZWFrTWFwUHJvdG90eXBlJSc6IFsnV2Vha01hcCcsICdwcm90b3R5cGUnXSwKCSclV2Vha1NldFByb3RvdHlwZSUnOiBbJ1dlYWtTZXQnLCAncHJvdG90eXBlJ10KfTsKCnZhciBiaW5kID0gcmVxdWlyZSgnZnVuY3Rpb24tYmluZCcpOwp2YXIgaGFzT3duID0gcmVxdWlyZSgnaGFzJyk7CnZhciAkY29uY2F0ID0gYmluZC5jYWxsKEZ1bmN0aW9uLmNhbGwsIEFycmF5LnByb3RvdHlwZS5jb25jYXQpOwp2YXIgJHNwbGljZUFwcGx5ID0gYmluZC5jYWxsKEZ1bmN0aW9uLmFwcGx5LCBBcnJheS5wcm90b3R5cGUuc3BsaWNlKTsKdmFyICRyZXBsYWNlID0gYmluZC5jYWxsKEZ1bmN0aW9uLmNhbGwsIFN0cmluZy5wcm90b3R5cGUucmVwbGFjZSk7CgovKiBhZGFwdGVkIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2xvZGFzaC9sb2Rhc2gvYmxvYi80LjE3LjE1L2Rpc3QvbG9kYXNoLmpzI0w2NzM1LUw2NzQ0ICovCnZhciByZVByb3BOYW1lID0gL1teJS5bXF1dK3xcWyg/OigtP1xkKyg/OlwuXGQrKT8pfChbIiddKSgoPzooPyFcMilbXlxcXXxcXC4pKj8pXDIpXF18KD89KD86XC58XFtcXSkoPzpcLnxcW1xdfCUkKSkvZzsKdmFyIHJlRXNjYXBlQ2hhciA9IC9cXChcXCk/L2c7IC8qKiBVc2VkIHRvIG1hdGNoIGJhY2tzbGFzaGVzIGluIHByb3BlcnR5IHBhdGhzLiAqLwp2YXIgc3RyaW5nVG9QYXRoID0gZnVuY3Rpb24gc3RyaW5nVG9QYXRoKHN0cmluZykgewoJdmFyIHJlc3VsdCA9IFtdOwoJJHJlcGxhY2Uoc3RyaW5nLCByZVByb3BOYW1lLCBmdW5jdGlvbiAobWF0Y2gsIG51bWJlciwgcXVvdGUsIHN1YlN0cmluZykgewoJCXJlc3VsdFtyZXN1bHQubGVuZ3RoXSA9IHF1b3RlID8gJHJlcGxhY2Uoc3ViU3RyaW5nLCByZUVzY2FwZUNoYXIsICckMScpIDogbnVtYmVyIHx8IG1hdGNoOwoJfSk7CglyZXR1cm4gcmVzdWx0Owp9OwovKiBlbmQgYWRhcHRhdGlvbiAqLwoKdmFyIGdldEJhc2VJbnRyaW5zaWMgPSBmdW5jdGlvbiBnZXRCYXNlSW50cmluc2ljKG5hbWUsIGFsbG93TWlzc2luZykgewoJdmFyIGludHJpbnNpY05hbWUgPSBuYW1lOwoJdmFyIGFsaWFzOwoJaWYgKGhhc093bihMRUdBQ1lfQUxJQVNFUywgaW50cmluc2ljTmFtZSkpIHsKCQlhbGlhcyA9IExFR0FDWV9BTElBU0VTW2ludHJpbnNpY05hbWVdOwoJCWludHJpbnNpY05hbWUgPSAnJScgKyBhbGlhc1swXSArICclJzsKCX0KCglpZiAoaGFzT3duKElOVFJJTlNJQ1MsIGludHJpbnNpY05hbWUpKSB7CgkJdmFyIHZhbHVlID0gSU5UUklOU0lDU1tpbnRyaW5zaWNOYW1lXTsKCQlpZiAodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJyAmJiAhYWxsb3dNaXNzaW5nKSB7CgkJCXRocm93IG5ldyAkVHlwZUVycm9yKCdpbnRyaW5zaWMgJyArIG5hbWUgKyAnIGV4aXN0cywgYnV0IGlzIG5vdCBhdmFpbGFibGUuIFBsZWFzZSBmaWxlIGFuIGlzc3VlIScpOwoJCX0KCgkJcmV0dXJuIHsKCQkJYWxpYXM6IGFsaWFzLAoJCQluYW1lOiBpbnRyaW5zaWNOYW1lLAoJCQl2YWx1ZTogdmFsdWUKCQl9OwoJfQoKCXRocm93IG5ldyAkU3ludGF4RXJyb3IoJ2ludHJpbnNpYyAnICsgbmFtZSArICcgZG9lcyBub3QgZXhpc3QhJyk7Cn07Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIEdldEludHJpbnNpYyhuYW1lLCBhbGxvd01pc3NpbmcpIHsKCWlmICh0eXBlb2YgbmFtZSAhPT0gJ3N0cmluZycgfHwgbmFtZS5sZW5ndGggPT09IDApIHsKCQl0aHJvdyBuZXcgJFR5cGVFcnJvcignaW50cmluc2ljIG5hbWUgbXVzdCBiZSBhIG5vbi1lbXB0eSBzdHJpbmcnKTsKCX0KCWlmIChhcmd1bWVudHMubGVuZ3RoID4gMSAmJiB0eXBlb2YgYWxsb3dNaXNzaW5nICE9PSAnYm9vbGVhbicpIHsKCQl0aHJvdyBuZXcgJFR5cGVFcnJvcignImFsbG93TWlzc2luZyIgYXJndW1lbnQgbXVzdCBiZSBhIGJvb2xlYW4nKTsKCX0KCgl2YXIgcGFydHMgPSBzdHJpbmdUb1BhdGgobmFtZSk7Cgl2YXIgaW50cmluc2ljQmFzZU5hbWUgPSBwYXJ0cy5sZW5ndGggPiAwID8gcGFydHNbMF0gOiAnJzsKCgl2YXIgaW50cmluc2ljID0gZ2V0QmFzZUludHJpbnNpYygnJScgKyBpbnRyaW5zaWNCYXNlTmFtZSArICclJywgYWxsb3dNaXNzaW5nKTsKCXZhciBpbnRyaW5zaWNSZWFsTmFtZSA9IGludHJpbnNpYy5uYW1lOwoJdmFyIHZhbHVlID0gaW50cmluc2ljLnZhbHVlOwoJdmFyIHNraXBGdXJ0aGVyQ2FjaGluZyA9IGZhbHNlOwoKCXZhciBhbGlhcyA9IGludHJpbnNpYy5hbGlhczsKCWlmIChhbGlhcykgewoJCWludHJpbnNpY0Jhc2VOYW1lID0gYWxpYXNbMF07CgkJJHNwbGljZUFwcGx5KHBhcnRzLCAkY29uY2F0KFswLCAxXSwgYWxpYXMpKTsKCX0KCglmb3IgKHZhciBpID0gMSwgaXNPd24gPSB0cnVlOyBpIDwgcGFydHMubGVuZ3RoOyBpICs9IDEpIHsKCQl2YXIgcGFydCA9IHBhcnRzW2ldOwoJCWlmIChwYXJ0ID09PSAnY29uc3RydWN0b3InIHx8ICFpc093bikgewoJCQlza2lwRnVydGhlckNhY2hpbmcgPSB0cnVlOwoJCX0KCgkJaW50cmluc2ljQmFzZU5hbWUgKz0gJy4nICsgcGFydDsKCQlpbnRyaW5zaWNSZWFsTmFtZSA9ICclJyArIGludHJpbnNpY0Jhc2VOYW1lICsgJyUnOwoKCQlpZiAoaGFzT3duKElOVFJJTlNJQ1MsIGludHJpbnNpY1JlYWxOYW1lKSkgewoJCQl2YWx1ZSA9IElOVFJJTlNJQ1NbaW50cmluc2ljUmVhbE5hbWVdOwoJCX0gZWxzZSBpZiAodmFsdWUgIT0gbnVsbCkgewoJCQlpZiAoJGdPUEQgJiYgKGkgKyAxKSA+PSBwYXJ0cy5sZW5ndGgpIHsKCQkJCXZhciBkZXNjID0gJGdPUEQodmFsdWUsIHBhcnQpOwoJCQkJaXNPd24gPSAhIWRlc2M7CgoJCQkJaWYgKCFhbGxvd01pc3NpbmcgJiYgIShwYXJ0IGluIHZhbHVlKSkgewoJCQkJCXRocm93IG5ldyAkVHlwZUVycm9yKCdiYXNlIGludHJpbnNpYyBmb3IgJyArIG5hbWUgKyAnIGV4aXN0cywgYnV0IHRoZSBwcm9wZXJ0eSBpcyBub3QgYXZhaWxhYmxlLicpOwoJCQkJfQoJCQkJLy8gQnkgY29udmVudGlvbiwgd2hlbiBhIGRhdGEgcHJvcGVydHkgaXMgY29udmVydGVkIHRvIGFuIGFjY2Vzc29yCgkJCQkvLyBwcm9wZXJ0eSB0byBlbXVsYXRlIGEgZGF0YSBwcm9wZXJ0eSB0aGF0IGRvZXMgbm90IHN1ZmZlciBmcm9tCgkJCQkvLyB0aGUgb3ZlcnJpZGUgbWlzdGFrZSwgdGhhdCBhY2Nlc3NvcidzIGdldHRlciBpcyBtYXJrZWQgd2l0aAoJCQkJLy8gYW4gYG9yaWdpbmFsVmFsdWVgIHByb3BlcnR5LiBIZXJlLCB3aGVuIHdlIGRldGVjdCB0aGlzLCB3ZQoJCQkJLy8gdXBob2xkIHRoZSBpbGx1c2lvbiBieSBwcmV0ZW5kaW5nIHRvIHNlZSB0aGF0IG9yaWdpbmFsIGRhdGEKCQkJCS8vIHByb3BlcnR5LCBpLmUuLCByZXR1cm5pbmcgdGhlIHZhbHVlIHJhdGhlciB0aGFuIHRoZSBnZXR0ZXIKCQkJCS8vIGl0c2VsZi4KCQkJCWlmIChpc093biAmJiAnZ2V0JyBpbiBkZXNjICYmICEoJ29yaWdpbmFsVmFsdWUnIGluIGRlc2MuZ2V0KSkgewoJCQkJCXZhbHVlID0gZGVzYy5nZXQ7CgkJCQl9IGVsc2UgewoJCQkJCXZhbHVlID0gdmFsdWVbcGFydF07CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlpc093biA9IGhhc093bih2YWx1ZSwgcGFydCk7CgkJCQl2YWx1ZSA9IHZhbHVlW3BhcnRdOwoJCQl9CgoJCQlpZiAoaXNPd24gJiYgIXNraXBGdXJ0aGVyQ2FjaGluZykgewoJCQkJSU5UUklOU0lDU1tpbnRyaW5zaWNSZWFsTmFtZV0gPSB2YWx1ZTsKCQkJfQoJCX0KCX0KCXJldHVybiB2YWx1ZTsKfTsKCn0seyJmdW5jdGlvbi1iaW5kIjoyNiwiaGFzIjozMCwiaGFzLXN5bWJvbHMiOjI4fV0sMjM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgR2V0SW50cmluc2ljID0gcmVxdWlyZSgnLi4vR2V0SW50cmluc2ljJyk7Cgp2YXIgJGdPUEQgPSBHZXRJbnRyaW5zaWMoJyVPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yJScpOwppZiAoJGdPUEQpIHsKCXRyeSB7CgkJJGdPUEQoW10sICdsZW5ndGgnKTsKCX0gY2F0Y2ggKGUpIHsKCQkvLyBJRSA4IGhhcyBhIGJyb2tlbiBnT1BECgkJJGdPUEQgPSBudWxsOwoJfQp9Cgptb2R1bGUuZXhwb3J0cyA9ICRnT1BEOwoKfSx7Ii4uL0dldEludHJpbnNpYyI6MjJ9XSwyNDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cgp2YXIgaGFzT3duID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKdmFyIHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gZm9yRWFjaCAob2JqLCBmbiwgY3R4KSB7CiAgICBpZiAodG9TdHJpbmcuY2FsbChmbikgIT09ICdbb2JqZWN0IEZ1bmN0aW9uXScpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdpdGVyYXRvciBtdXN0IGJlIGEgZnVuY3Rpb24nKTsKICAgIH0KICAgIHZhciBsID0gb2JqLmxlbmd0aDsKICAgIGlmIChsID09PSArbCkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgIGZuLmNhbGwoY3R4LCBvYmpbaV0sIGksIG9iaik7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICBmb3IgKHZhciBrIGluIG9iaikgewogICAgICAgICAgICBpZiAoaGFzT3duLmNhbGwob2JqLCBrKSkgewogICAgICAgICAgICAgICAgZm4uY2FsbChjdHgsIG9ialtrXSwgaywgb2JqKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfTsKCgp9LHt9XSwyNTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCi8qIGVzbGludCBuby1pbnZhbGlkLXRoaXM6IDEgKi8KCnZhciBFUlJPUl9NRVNTQUdFID0gJ0Z1bmN0aW9uLnByb3RvdHlwZS5iaW5kIGNhbGxlZCBvbiBpbmNvbXBhdGlibGUgJzsKdmFyIHNsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlOwp2YXIgdG9TdHIgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nOwp2YXIgZnVuY1R5cGUgPSAnW29iamVjdCBGdW5jdGlvbl0nOwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBiaW5kKHRoYXQpIHsKICAgIHZhciB0YXJnZXQgPSB0aGlzOwogICAgaWYgKHR5cGVvZiB0YXJnZXQgIT09ICdmdW5jdGlvbicgfHwgdG9TdHIuY2FsbCh0YXJnZXQpICE9PSBmdW5jVHlwZSkgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoRVJST1JfTUVTU0FHRSArIHRhcmdldCk7CiAgICB9CiAgICB2YXIgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKCiAgICB2YXIgYm91bmQ7CiAgICB2YXIgYmluZGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh0aGlzIGluc3RhbmNlb2YgYm91bmQpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHRhcmdldC5hcHBseSgKICAgICAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgICAgICBhcmdzLmNvbmNhdChzbGljZS5jYWxsKGFyZ3VtZW50cykpCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGlmIChPYmplY3QocmVzdWx0KSA9PT0gcmVzdWx0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiB0YXJnZXQuYXBwbHkoCiAgICAgICAgICAgICAgICB0aGF0LAogICAgICAgICAgICAgICAgYXJncy5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMpKQogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH07CgogICAgdmFyIGJvdW5kTGVuZ3RoID0gTWF0aC5tYXgoMCwgdGFyZ2V0Lmxlbmd0aCAtIGFyZ3MubGVuZ3RoKTsKICAgIHZhciBib3VuZEFyZ3MgPSBbXTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYm91bmRMZW5ndGg7IGkrKykgewogICAgICAgIGJvdW5kQXJncy5wdXNoKCckJyArIGkpOwogICAgfQoKICAgIGJvdW5kID0gRnVuY3Rpb24oJ2JpbmRlcicsICdyZXR1cm4gZnVuY3Rpb24gKCcgKyBib3VuZEFyZ3Muam9pbignLCcpICsgJyl7IHJldHVybiBiaW5kZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpOyB9JykoYmluZGVyKTsKCiAgICBpZiAodGFyZ2V0LnByb3RvdHlwZSkgewogICAgICAgIHZhciBFbXB0eSA9IGZ1bmN0aW9uIEVtcHR5KCkge307CiAgICAgICAgRW1wdHkucHJvdG90eXBlID0gdGFyZ2V0LnByb3RvdHlwZTsKICAgICAgICBib3VuZC5wcm90b3R5cGUgPSBuZXcgRW1wdHkoKTsKICAgICAgICBFbXB0eS5wcm90b3R5cGUgPSBudWxsOwogICAgfQoKICAgIHJldHVybiBib3VuZDsKfTsKCn0se31dLDI2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIGltcGxlbWVudGF0aW9uID0gcmVxdWlyZSgnLi9pbXBsZW1lbnRhdGlvbicpOwoKbW9kdWxlLmV4cG9ydHMgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZCB8fCBpbXBsZW1lbnRhdGlvbjsKCn0seyIuL2ltcGxlbWVudGF0aW9uIjoyNX1dLDI3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKLyogZ2xvYmFscwoJQWdncmVnYXRlRXJyb3IsCglBdG9taWNzLAoJRmluYWxpemF0aW9uUmVnaXN0cnksCglTaGFyZWRBcnJheUJ1ZmZlciwKCVdlYWtSZWYsCiovCgp2YXIgdW5kZWZpbmVkOwoKdmFyICRTeW50YXhFcnJvciA9IFN5bnRheEVycm9yOwp2YXIgJEZ1bmN0aW9uID0gRnVuY3Rpb247CnZhciAkVHlwZUVycm9yID0gVHlwZUVycm9yOwoKLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbnNpc3RlbnQtcmV0dXJuCnZhciBnZXRFdmFsbGVkQ29uc3RydWN0b3IgPSBmdW5jdGlvbiAoZXhwcmVzc2lvblN5bnRheCkgewoJdHJ5IHsKCQkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tbmV3LWZ1bmMKCQlyZXR1cm4gRnVuY3Rpb24oJyJ1c2Ugc3RyaWN0IjsgcmV0dXJuICgnICsgZXhwcmVzc2lvblN5bnRheCArICcpLmNvbnN0cnVjdG9yOycpKCk7Cgl9IGNhdGNoIChlKSB7fQp9OwoKdmFyICRnT1BEID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcjsKaWYgKCRnT1BEKSB7Cgl0cnkgewoJCSRnT1BEKHt9LCAnJyk7Cgl9IGNhdGNoIChlKSB7CgkJJGdPUEQgPSBudWxsOyAvLyB0aGlzIGlzIElFIDgsIHdoaWNoIGhhcyBhIGJyb2tlbiBnT1BECgl9Cn0KCnZhciB0aHJvd1R5cGVFcnJvciA9IGZ1bmN0aW9uICgpIHsKCXRocm93IG5ldyAkVHlwZUVycm9yKCk7Cn07CnZhciBUaHJvd1R5cGVFcnJvciA9ICRnT1BECgk/IChmdW5jdGlvbiAoKSB7CgkJdHJ5IHsKCQkJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC1leHByZXNzaW9ucywgbm8tY2FsbGVyLCBuby1yZXN0cmljdGVkLXByb3BlcnRpZXMKCQkJYXJndW1lbnRzLmNhbGxlZTsgLy8gSUUgOCBkb2VzIG5vdCB0aHJvdyBoZXJlCgkJCXJldHVybiB0aHJvd1R5cGVFcnJvcjsKCQl9IGNhdGNoIChjYWxsZWVUaHJvd3MpIHsKCQkJdHJ5IHsKCQkJCS8vIElFIDggdGhyb3dzIG9uIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoYXJndW1lbnRzLCAnJykKCQkJCXJldHVybiAkZ09QRChhcmd1bWVudHMsICdjYWxsZWUnKS5nZXQ7CgkJCX0gY2F0Y2ggKGdPUER0aHJvd3MpIHsKCQkJCXJldHVybiB0aHJvd1R5cGVFcnJvcjsKCQkJfQoJCX0KCX0oKSkKCTogdGhyb3dUeXBlRXJyb3I7Cgp2YXIgaGFzU3ltYm9scyA9IHJlcXVpcmUoJ2hhcy1zeW1ib2xzJykoKTsKCnZhciBnZXRQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5fX3Byb3RvX187IH07IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcHJvdG8KCnZhciBhc3luY0dlbkZ1bmN0aW9uID0gZ2V0RXZhbGxlZENvbnN0cnVjdG9yKCdhc3luYyBmdW5jdGlvbiogKCkge30nKTsKdmFyIGFzeW5jR2VuRnVuY3Rpb25Qcm90b3R5cGUgPSBhc3luY0dlbkZ1bmN0aW9uID8gYXN5bmNHZW5GdW5jdGlvbi5wcm90b3R5cGUgOiB1bmRlZmluZWQ7CnZhciBhc3luY0dlblByb3RvdHlwZSA9IGFzeW5jR2VuRnVuY3Rpb25Qcm90b3R5cGUgPyBhc3luY0dlbkZ1bmN0aW9uUHJvdG90eXBlLnByb3RvdHlwZSA6IHVuZGVmaW5lZDsKCnZhciBUeXBlZEFycmF5ID0gdHlwZW9mIFVpbnQ4QXJyYXkgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogZ2V0UHJvdG8oVWludDhBcnJheSk7Cgp2YXIgSU5UUklOU0lDUyA9IHsKCSclQWdncmVnYXRlRXJyb3IlJzogdHlwZW9mIEFnZ3JlZ2F0ZUVycm9yID09PSAndW5kZWZpbmVkJyA/IHVuZGVmaW5lZCA6IEFnZ3JlZ2F0ZUVycm9yLAoJJyVBcnJheSUnOiBBcnJheSwKCSclQXJyYXlCdWZmZXIlJzogdHlwZW9mIEFycmF5QnVmZmVyID09PSAndW5kZWZpbmVkJyA/IHVuZGVmaW5lZCA6IEFycmF5QnVmZmVyLAoJJyVBcnJheUl0ZXJhdG9yUHJvdG90eXBlJSc6IGhhc1N5bWJvbHMgPyBnZXRQcm90byhbXVtTeW1ib2wuaXRlcmF0b3JdKCkpIDogdW5kZWZpbmVkLAoJJyVBc3luY0Zyb21TeW5jSXRlcmF0b3JQcm90b3R5cGUlJzogdW5kZWZpbmVkLAoJJyVBc3luY0Z1bmN0aW9uJSc6IGdldEV2YWxsZWRDb25zdHJ1Y3RvcignYXN5bmMgZnVuY3Rpb24gKCkge30nKSwKCSclQXN5bmNHZW5lcmF0b3IlJzogYXN5bmNHZW5GdW5jdGlvblByb3RvdHlwZSwKCSclQXN5bmNHZW5lcmF0b3JGdW5jdGlvbiUnOiBhc3luY0dlbkZ1bmN0aW9uLAoJJyVBc3luY0l0ZXJhdG9yUHJvdG90eXBlJSc6IGFzeW5jR2VuUHJvdG90eXBlID8gZ2V0UHJvdG8oYXN5bmNHZW5Qcm90b3R5cGUpIDogdW5kZWZpbmVkLAoJJyVBdG9taWNzJSc6IHR5cGVvZiBBdG9taWNzID09PSAndW5kZWZpbmVkJyA/IHVuZGVmaW5lZCA6IEF0b21pY3MsCgknJUJpZ0ludCUnOiB0eXBlb2YgQmlnSW50ID09PSAndW5kZWZpbmVkJyA/IHVuZGVmaW5lZCA6IEJpZ0ludCwKCSclQm9vbGVhbiUnOiBCb29sZWFuLAoJJyVEYXRhVmlldyUnOiB0eXBlb2YgRGF0YVZpZXcgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogRGF0YVZpZXcsCgknJURhdGUlJzogRGF0ZSwKCSclZGVjb2RlVVJJJSc6IGRlY29kZVVSSSwKCSclZGVjb2RlVVJJQ29tcG9uZW50JSc6IGRlY29kZVVSSUNvbXBvbmVudCwKCSclZW5jb2RlVVJJJSc6IGVuY29kZVVSSSwKCSclZW5jb2RlVVJJQ29tcG9uZW50JSc6IGVuY29kZVVSSUNvbXBvbmVudCwKCSclRXJyb3IlJzogRXJyb3IsCgknJWV2YWwlJzogZXZhbCwgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsCgknJUV2YWxFcnJvciUnOiBFdmFsRXJyb3IsCgknJUZsb2F0MzJBcnJheSUnOiB0eXBlb2YgRmxvYXQzMkFycmF5ID09PSAndW5kZWZpbmVkJyA/IHVuZGVmaW5lZCA6IEZsb2F0MzJBcnJheSwKCSclRmxvYXQ2NEFycmF5JSc6IHR5cGVvZiBGbG9hdDY0QXJyYXkgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogRmxvYXQ2NEFycmF5LAoJJyVGaW5hbGl6YXRpb25SZWdpc3RyeSUnOiB0eXBlb2YgRmluYWxpemF0aW9uUmVnaXN0cnkgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogRmluYWxpemF0aW9uUmVnaXN0cnksCgknJUZ1bmN0aW9uJSc6ICRGdW5jdGlvbiwKCSclR2VuZXJhdG9yRnVuY3Rpb24lJzogZ2V0RXZhbGxlZENvbnN0cnVjdG9yKCdmdW5jdGlvbiogKCkge30nKSwKCSclSW50OEFycmF5JSc6IHR5cGVvZiBJbnQ4QXJyYXkgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogSW50OEFycmF5LAoJJyVJbnQxNkFycmF5JSc6IHR5cGVvZiBJbnQxNkFycmF5ID09PSAndW5kZWZpbmVkJyA/IHVuZGVmaW5lZCA6IEludDE2QXJyYXksCgknJUludDMyQXJyYXklJzogdHlwZW9mIEludDMyQXJyYXkgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogSW50MzJBcnJheSwKCSclaXNGaW5pdGUlJzogaXNGaW5pdGUsCgknJWlzTmFOJSc6IGlzTmFOLAoJJyVJdGVyYXRvclByb3RvdHlwZSUnOiBoYXNTeW1ib2xzID8gZ2V0UHJvdG8oZ2V0UHJvdG8oW11bU3ltYm9sLml0ZXJhdG9yXSgpKSkgOiB1bmRlZmluZWQsCgknJUpTT04lJzogdHlwZW9mIEpTT04gPT09ICdvYmplY3QnID8gSlNPTiA6IHVuZGVmaW5lZCwKCSclTWFwJSc6IHR5cGVvZiBNYXAgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogTWFwLAoJJyVNYXBJdGVyYXRvclByb3RvdHlwZSUnOiB0eXBlb2YgTWFwID09PSAndW5kZWZpbmVkJyB8fCAhaGFzU3ltYm9scyA/IHVuZGVmaW5lZCA6IGdldFByb3RvKG5ldyBNYXAoKVtTeW1ib2wuaXRlcmF0b3JdKCkpLAoJJyVNYXRoJSc6IE1hdGgsCgknJU51bWJlciUnOiBOdW1iZXIsCgknJU9iamVjdCUnOiBPYmplY3QsCgknJXBhcnNlRmxvYXQlJzogcGFyc2VGbG9hdCwKCSclcGFyc2VJbnQlJzogcGFyc2VJbnQsCgknJVByb21pc2UlJzogdHlwZW9mIFByb21pc2UgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogUHJvbWlzZSwKCSclUHJveHklJzogdHlwZW9mIFByb3h5ID09PSAndW5kZWZpbmVkJyA/IHVuZGVmaW5lZCA6IFByb3h5LAoJJyVSYW5nZUVycm9yJSc6IFJhbmdlRXJyb3IsCgknJVJlZmVyZW5jZUVycm9yJSc6IFJlZmVyZW5jZUVycm9yLAoJJyVSZWZsZWN0JSc6IHR5cGVvZiBSZWZsZWN0ID09PSAndW5kZWZpbmVkJyA/IHVuZGVmaW5lZCA6IFJlZmxlY3QsCgknJVJlZ0V4cCUnOiBSZWdFeHAsCgknJVNldCUnOiB0eXBlb2YgU2V0ID09PSAndW5kZWZpbmVkJyA/IHVuZGVmaW5lZCA6IFNldCwKCSclU2V0SXRlcmF0b3JQcm90b3R5cGUlJzogdHlwZW9mIFNldCA9PT0gJ3VuZGVmaW5lZCcgfHwgIWhhc1N5bWJvbHMgPyB1bmRlZmluZWQgOiBnZXRQcm90byhuZXcgU2V0KClbU3ltYm9sLml0ZXJhdG9yXSgpKSwKCSclU2hhcmVkQXJyYXlCdWZmZXIlJzogdHlwZW9mIFNoYXJlZEFycmF5QnVmZmVyID09PSAndW5kZWZpbmVkJyA/IHVuZGVmaW5lZCA6IFNoYXJlZEFycmF5QnVmZmVyLAoJJyVTdHJpbmclJzogU3RyaW5nLAoJJyVTdHJpbmdJdGVyYXRvclByb3RvdHlwZSUnOiBoYXNTeW1ib2xzID8gZ2V0UHJvdG8oJydbU3ltYm9sLml0ZXJhdG9yXSgpKSA6IHVuZGVmaW5lZCwKCSclU3ltYm9sJSc6IGhhc1N5bWJvbHMgPyBTeW1ib2wgOiB1bmRlZmluZWQsCgknJVN5bnRheEVycm9yJSc6ICRTeW50YXhFcnJvciwKCSclVGhyb3dUeXBlRXJyb3IlJzogVGhyb3dUeXBlRXJyb3IsCgknJVR5cGVkQXJyYXklJzogVHlwZWRBcnJheSwKCSclVHlwZUVycm9yJSc6ICRUeXBlRXJyb3IsCgknJVVpbnQ4QXJyYXklJzogdHlwZW9mIFVpbnQ4QXJyYXkgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogVWludDhBcnJheSwKCSclVWludDhDbGFtcGVkQXJyYXklJzogdHlwZW9mIFVpbnQ4Q2xhbXBlZEFycmF5ID09PSAndW5kZWZpbmVkJyA/IHVuZGVmaW5lZCA6IFVpbnQ4Q2xhbXBlZEFycmF5LAoJJyVVaW50MTZBcnJheSUnOiB0eXBlb2YgVWludDE2QXJyYXkgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogVWludDE2QXJyYXksCgknJVVpbnQzMkFycmF5JSc6IHR5cGVvZiBVaW50MzJBcnJheSA9PT0gJ3VuZGVmaW5lZCcgPyB1bmRlZmluZWQgOiBVaW50MzJBcnJheSwKCSclVVJJRXJyb3IlJzogVVJJRXJyb3IsCgknJVdlYWtNYXAlJzogdHlwZW9mIFdlYWtNYXAgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogV2Vha01hcCwKCSclV2Vha1JlZiUnOiB0eXBlb2YgV2Vha1JlZiA9PT0gJ3VuZGVmaW5lZCcgPyB1bmRlZmluZWQgOiBXZWFrUmVmLAoJJyVXZWFrU2V0JSc6IHR5cGVvZiBXZWFrU2V0ID09PSAndW5kZWZpbmVkJyA/IHVuZGVmaW5lZCA6IFdlYWtTZXQKfTsKCnZhciBMRUdBQ1lfQUxJQVNFUyA9IHsKCSclQXJyYXlCdWZmZXJQcm90b3R5cGUlJzogWydBcnJheUJ1ZmZlcicsICdwcm90b3R5cGUnXSwKCSclQXJyYXlQcm90b3R5cGUlJzogWydBcnJheScsICdwcm90b3R5cGUnXSwKCSclQXJyYXlQcm90b19lbnRyaWVzJSc6IFsnQXJyYXknLCAncHJvdG90eXBlJywgJ2VudHJpZXMnXSwKCSclQXJyYXlQcm90b19mb3JFYWNoJSc6IFsnQXJyYXknLCAncHJvdG90eXBlJywgJ2ZvckVhY2gnXSwKCSclQXJyYXlQcm90b19rZXlzJSc6IFsnQXJyYXknLCAncHJvdG90eXBlJywgJ2tleXMnXSwKCSclQXJyYXlQcm90b192YWx1ZXMlJzogWydBcnJheScsICdwcm90b3R5cGUnLCAndmFsdWVzJ10sCgknJUFzeW5jRnVuY3Rpb25Qcm90b3R5cGUlJzogWydBc3luY0Z1bmN0aW9uJywgJ3Byb3RvdHlwZSddLAoJJyVBc3luY0dlbmVyYXRvciUnOiBbJ0FzeW5jR2VuZXJhdG9yRnVuY3Rpb24nLCAncHJvdG90eXBlJ10sCgknJUFzeW5jR2VuZXJhdG9yUHJvdG90eXBlJSc6IFsnQXN5bmNHZW5lcmF0b3JGdW5jdGlvbicsICdwcm90b3R5cGUnLCAncHJvdG90eXBlJ10sCgknJUJvb2xlYW5Qcm90b3R5cGUlJzogWydCb29sZWFuJywgJ3Byb3RvdHlwZSddLAoJJyVEYXRhVmlld1Byb3RvdHlwZSUnOiBbJ0RhdGFWaWV3JywgJ3Byb3RvdHlwZSddLAoJJyVEYXRlUHJvdG90eXBlJSc6IFsnRGF0ZScsICdwcm90b3R5cGUnXSwKCSclRXJyb3JQcm90b3R5cGUlJzogWydFcnJvcicsICdwcm90b3R5cGUnXSwKCSclRXZhbEVycm9yUHJvdG90eXBlJSc6IFsnRXZhbEVycm9yJywgJ3Byb3RvdHlwZSddLAoJJyVGbG9hdDMyQXJyYXlQcm90b3R5cGUlJzogWydGbG9hdDMyQXJyYXknLCAncHJvdG90eXBlJ10sCgknJUZsb2F0NjRBcnJheVByb3RvdHlwZSUnOiBbJ0Zsb2F0NjRBcnJheScsICdwcm90b3R5cGUnXSwKCSclRnVuY3Rpb25Qcm90b3R5cGUlJzogWydGdW5jdGlvbicsICdwcm90b3R5cGUnXSwKCSclR2VuZXJhdG9yJSc6IFsnR2VuZXJhdG9yRnVuY3Rpb24nLCAncHJvdG90eXBlJ10sCgknJUdlbmVyYXRvclByb3RvdHlwZSUnOiBbJ0dlbmVyYXRvckZ1bmN0aW9uJywgJ3Byb3RvdHlwZScsICdwcm90b3R5cGUnXSwKCSclSW50OEFycmF5UHJvdG90eXBlJSc6IFsnSW50OEFycmF5JywgJ3Byb3RvdHlwZSddLAoJJyVJbnQxNkFycmF5UHJvdG90eXBlJSc6IFsnSW50MTZBcnJheScsICdwcm90b3R5cGUnXSwKCSclSW50MzJBcnJheVByb3RvdHlwZSUnOiBbJ0ludDMyQXJyYXknLCAncHJvdG90eXBlJ10sCgknJUpTT05QYXJzZSUnOiBbJ0pTT04nLCAncGFyc2UnXSwKCSclSlNPTlN0cmluZ2lmeSUnOiBbJ0pTT04nLCAnc3RyaW5naWZ5J10sCgknJU1hcFByb3RvdHlwZSUnOiBbJ01hcCcsICdwcm90b3R5cGUnXSwKCSclTnVtYmVyUHJvdG90eXBlJSc6IFsnTnVtYmVyJywgJ3Byb3RvdHlwZSddLAoJJyVPYmplY3RQcm90b3R5cGUlJzogWydPYmplY3QnLCAncHJvdG90eXBlJ10sCgknJU9ialByb3RvX3RvU3RyaW5nJSc6IFsnT2JqZWN0JywgJ3Byb3RvdHlwZScsICd0b1N0cmluZyddLAoJJyVPYmpQcm90b192YWx1ZU9mJSc6IFsnT2JqZWN0JywgJ3Byb3RvdHlwZScsICd2YWx1ZU9mJ10sCgknJVByb21pc2VQcm90b3R5cGUlJzogWydQcm9taXNlJywgJ3Byb3RvdHlwZSddLAoJJyVQcm9taXNlUHJvdG9fdGhlbiUnOiBbJ1Byb21pc2UnLCAncHJvdG90eXBlJywgJ3RoZW4nXSwKCSclUHJvbWlzZV9hbGwlJzogWydQcm9taXNlJywgJ2FsbCddLAoJJyVQcm9taXNlX3JlamVjdCUnOiBbJ1Byb21pc2UnLCAncmVqZWN0J10sCgknJVByb21pc2VfcmVzb2x2ZSUnOiBbJ1Byb21pc2UnLCAncmVzb2x2ZSddLAoJJyVSYW5nZUVycm9yUHJvdG90eXBlJSc6IFsnUmFuZ2VFcnJvcicsICdwcm90b3R5cGUnXSwKCSclUmVmZXJlbmNlRXJyb3JQcm90b3R5cGUlJzogWydSZWZlcmVuY2VFcnJvcicsICdwcm90b3R5cGUnXSwKCSclUmVnRXhwUHJvdG90eXBlJSc6IFsnUmVnRXhwJywgJ3Byb3RvdHlwZSddLAoJJyVTZXRQcm90b3R5cGUlJzogWydTZXQnLCAncHJvdG90eXBlJ10sCgknJVNoYXJlZEFycmF5QnVmZmVyUHJvdG90eXBlJSc6IFsnU2hhcmVkQXJyYXlCdWZmZXInLCAncHJvdG90eXBlJ10sCgknJVN0cmluZ1Byb3RvdHlwZSUnOiBbJ1N0cmluZycsICdwcm90b3R5cGUnXSwKCSclU3ltYm9sUHJvdG90eXBlJSc6IFsnU3ltYm9sJywgJ3Byb3RvdHlwZSddLAoJJyVTeW50YXhFcnJvclByb3RvdHlwZSUnOiBbJ1N5bnRheEVycm9yJywgJ3Byb3RvdHlwZSddLAoJJyVUeXBlZEFycmF5UHJvdG90eXBlJSc6IFsnVHlwZWRBcnJheScsICdwcm90b3R5cGUnXSwKCSclVHlwZUVycm9yUHJvdG90eXBlJSc6IFsnVHlwZUVycm9yJywgJ3Byb3RvdHlwZSddLAoJJyVVaW50OEFycmF5UHJvdG90eXBlJSc6IFsnVWludDhBcnJheScsICdwcm90b3R5cGUnXSwKCSclVWludDhDbGFtcGVkQXJyYXlQcm90b3R5cGUlJzogWydVaW50OENsYW1wZWRBcnJheScsICdwcm90b3R5cGUnXSwKCSclVWludDE2QXJyYXlQcm90b3R5cGUlJzogWydVaW50MTZBcnJheScsICdwcm90b3R5cGUnXSwKCSclVWludDMyQXJyYXlQcm90b3R5cGUlJzogWydVaW50MzJBcnJheScsICdwcm90b3R5cGUnXSwKCSclVVJJRXJyb3JQcm90b3R5cGUlJzogWydVUklFcnJvcicsICdwcm90b3R5cGUnXSwKCSclV2Vha01hcFByb3RvdHlwZSUnOiBbJ1dlYWtNYXAnLCAncHJvdG90eXBlJ10sCgknJVdlYWtTZXRQcm90b3R5cGUlJzogWydXZWFrU2V0JywgJ3Byb3RvdHlwZSddCn07Cgp2YXIgYmluZCA9IHJlcXVpcmUoJ2Z1bmN0aW9uLWJpbmQnKTsKdmFyIGhhc093biA9IHJlcXVpcmUoJ2hhcycpOwp2YXIgJGNvbmNhdCA9IGJpbmQuY2FsbChGdW5jdGlvbi5jYWxsLCBBcnJheS5wcm90b3R5cGUuY29uY2F0KTsKdmFyICRzcGxpY2VBcHBseSA9IGJpbmQuY2FsbChGdW5jdGlvbi5hcHBseSwgQXJyYXkucHJvdG90eXBlLnNwbGljZSk7CnZhciAkcmVwbGFjZSA9IGJpbmQuY2FsbChGdW5jdGlvbi5jYWxsLCBTdHJpbmcucHJvdG90eXBlLnJlcGxhY2UpOwp2YXIgJHN0clNsaWNlID0gYmluZC5jYWxsKEZ1bmN0aW9uLmNhbGwsIFN0cmluZy5wcm90b3R5cGUuc2xpY2UpOwoKLyogYWRhcHRlZCBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9sb2Rhc2gvbG9kYXNoL2Jsb2IvNC4xNy4xNS9kaXN0L2xvZGFzaC5qcyNMNjczNS1MNjc0NCAqLwp2YXIgcmVQcm9wTmFtZSA9IC9bXiUuW1xdXSt8XFsoPzooLT9cZCsoPzpcLlxkKyk/KXwoWyInXSkoKD86KD8hXDIpW15cXF18XFwuKSo/KVwyKVxdfCg/PSg/OlwufFxbXF0pKD86XC58XFtcXXwlJCkpL2c7CnZhciByZUVzY2FwZUNoYXIgPSAvXFwoXFwpPy9nOyAvKiogVXNlZCB0byBtYXRjaCBiYWNrc2xhc2hlcyBpbiBwcm9wZXJ0eSBwYXRocy4gKi8KdmFyIHN0cmluZ1RvUGF0aCA9IGZ1bmN0aW9uIHN0cmluZ1RvUGF0aChzdHJpbmcpIHsKCXZhciBmaXJzdCA9ICRzdHJTbGljZShzdHJpbmcsIDAsIDEpOwoJdmFyIGxhc3QgPSAkc3RyU2xpY2Uoc3RyaW5nLCAtMSk7CglpZiAoZmlyc3QgPT09ICclJyAmJiBsYXN0ICE9PSAnJScpIHsKCQl0aHJvdyBuZXcgJFN5bnRheEVycm9yKCdpbnZhbGlkIGludHJpbnNpYyBzeW50YXgsIGV4cGVjdGVkIGNsb3NpbmcgYCVgJyk7Cgl9IGVsc2UgaWYgKGxhc3QgPT09ICclJyAmJiBmaXJzdCAhPT0gJyUnKSB7CgkJdGhyb3cgbmV3ICRTeW50YXhFcnJvcignaW52YWxpZCBpbnRyaW5zaWMgc3ludGF4LCBleHBlY3RlZCBvcGVuaW5nIGAlYCcpOwoJfQoJdmFyIHJlc3VsdCA9IFtdOwoJJHJlcGxhY2Uoc3RyaW5nLCByZVByb3BOYW1lLCBmdW5jdGlvbiAobWF0Y2gsIG51bWJlciwgcXVvdGUsIHN1YlN0cmluZykgewoJCXJlc3VsdFtyZXN1bHQubGVuZ3RoXSA9IHF1b3RlID8gJHJlcGxhY2Uoc3ViU3RyaW5nLCByZUVzY2FwZUNoYXIsICckMScpIDogbnVtYmVyIHx8IG1hdGNoOwoJfSk7CglyZXR1cm4gcmVzdWx0Owp9OwovKiBlbmQgYWRhcHRhdGlvbiAqLwoKdmFyIGdldEJhc2VJbnRyaW5zaWMgPSBmdW5jdGlvbiBnZXRCYXNlSW50cmluc2ljKG5hbWUsIGFsbG93TWlzc2luZykgewoJdmFyIGludHJpbnNpY05hbWUgPSBuYW1lOwoJdmFyIGFsaWFzOwoJaWYgKGhhc093bihMRUdBQ1lfQUxJQVNFUywgaW50cmluc2ljTmFtZSkpIHsKCQlhbGlhcyA9IExFR0FDWV9BTElBU0VTW2ludHJpbnNpY05hbWVdOwoJCWludHJpbnNpY05hbWUgPSAnJScgKyBhbGlhc1swXSArICclJzsKCX0KCglpZiAoaGFzT3duKElOVFJJTlNJQ1MsIGludHJpbnNpY05hbWUpKSB7CgkJdmFyIHZhbHVlID0gSU5UUklOU0lDU1tpbnRyaW5zaWNOYW1lXTsKCQlpZiAodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJyAmJiAhYWxsb3dNaXNzaW5nKSB7CgkJCXRocm93IG5ldyAkVHlwZUVycm9yKCdpbnRyaW5zaWMgJyArIG5hbWUgKyAnIGV4aXN0cywgYnV0IGlzIG5vdCBhdmFpbGFibGUuIFBsZWFzZSBmaWxlIGFuIGlzc3VlIScpOwoJCX0KCgkJcmV0dXJuIHsKCQkJYWxpYXM6IGFsaWFzLAoJCQluYW1lOiBpbnRyaW5zaWNOYW1lLAoJCQl2YWx1ZTogdmFsdWUKCQl9OwoJfQoKCXRocm93IG5ldyAkU3ludGF4RXJyb3IoJ2ludHJpbnNpYyAnICsgbmFtZSArICcgZG9lcyBub3QgZXhpc3QhJyk7Cn07Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIEdldEludHJpbnNpYyhuYW1lLCBhbGxvd01pc3NpbmcpIHsKCWlmICh0eXBlb2YgbmFtZSAhPT0gJ3N0cmluZycgfHwgbmFtZS5sZW5ndGggPT09IDApIHsKCQl0aHJvdyBuZXcgJFR5cGVFcnJvcignaW50cmluc2ljIG5hbWUgbXVzdCBiZSBhIG5vbi1lbXB0eSBzdHJpbmcnKTsKCX0KCWlmIChhcmd1bWVudHMubGVuZ3RoID4gMSAmJiB0eXBlb2YgYWxsb3dNaXNzaW5nICE9PSAnYm9vbGVhbicpIHsKCQl0aHJvdyBuZXcgJFR5cGVFcnJvcignImFsbG93TWlzc2luZyIgYXJndW1lbnQgbXVzdCBiZSBhIGJvb2xlYW4nKTsKCX0KCgl2YXIgcGFydHMgPSBzdHJpbmdUb1BhdGgobmFtZSk7Cgl2YXIgaW50cmluc2ljQmFzZU5hbWUgPSBwYXJ0cy5sZW5ndGggPiAwID8gcGFydHNbMF0gOiAnJzsKCgl2YXIgaW50cmluc2ljID0gZ2V0QmFzZUludHJpbnNpYygnJScgKyBpbnRyaW5zaWNCYXNlTmFtZSArICclJywgYWxsb3dNaXNzaW5nKTsKCXZhciBpbnRyaW5zaWNSZWFsTmFtZSA9IGludHJpbnNpYy5uYW1lOwoJdmFyIHZhbHVlID0gaW50cmluc2ljLnZhbHVlOwoJdmFyIHNraXBGdXJ0aGVyQ2FjaGluZyA9IGZhbHNlOwoKCXZhciBhbGlhcyA9IGludHJpbnNpYy5hbGlhczsKCWlmIChhbGlhcykgewoJCWludHJpbnNpY0Jhc2VOYW1lID0gYWxpYXNbMF07CgkJJHNwbGljZUFwcGx5KHBhcnRzLCAkY29uY2F0KFswLCAxXSwgYWxpYXMpKTsKCX0KCglmb3IgKHZhciBpID0gMSwgaXNPd24gPSB0cnVlOyBpIDwgcGFydHMubGVuZ3RoOyBpICs9IDEpIHsKCQl2YXIgcGFydCA9IHBhcnRzW2ldOwoJCXZhciBmaXJzdCA9ICRzdHJTbGljZShwYXJ0LCAwLCAxKTsKCQl2YXIgbGFzdCA9ICRzdHJTbGljZShwYXJ0LCAtMSk7CgkJaWYgKAoJCQkoCgkJCQkoZmlyc3QgPT09ICciJyB8fCBmaXJzdCA9PT0gIiciIHx8IGZpcnN0ID09PSAnYCcpCgkJCQl8fCAobGFzdCA9PT0gJyInIHx8IGxhc3QgPT09ICInIiB8fCBsYXN0ID09PSAnYCcpCgkJCSkKCQkJJiYgZmlyc3QgIT09IGxhc3QKCQkpIHsKCQkJdGhyb3cgbmV3ICRTeW50YXhFcnJvcigncHJvcGVydHkgbmFtZXMgd2l0aCBxdW90ZXMgbXVzdCBoYXZlIG1hdGNoaW5nIHF1b3RlcycpOwoJCX0KCQlpZiAocGFydCA9PT0gJ2NvbnN0cnVjdG9yJyB8fCAhaXNPd24pIHsKCQkJc2tpcEZ1cnRoZXJDYWNoaW5nID0gdHJ1ZTsKCQl9CgoJCWludHJpbnNpY0Jhc2VOYW1lICs9ICcuJyArIHBhcnQ7CgkJaW50cmluc2ljUmVhbE5hbWUgPSAnJScgKyBpbnRyaW5zaWNCYXNlTmFtZSArICclJzsKCgkJaWYgKGhhc093bihJTlRSSU5TSUNTLCBpbnRyaW5zaWNSZWFsTmFtZSkpIHsKCQkJdmFsdWUgPSBJTlRSSU5TSUNTW2ludHJpbnNpY1JlYWxOYW1lXTsKCQl9IGVsc2UgaWYgKHZhbHVlICE9IG51bGwpIHsKCQkJaWYgKCEocGFydCBpbiB2YWx1ZSkpIHsKCQkJCWlmICghYWxsb3dNaXNzaW5nKSB7CgkJCQkJdGhyb3cgbmV3ICRUeXBlRXJyb3IoJ2Jhc2UgaW50cmluc2ljIGZvciAnICsgbmFtZSArICcgZXhpc3RzLCBidXQgdGhlIHByb3BlcnR5IGlzIG5vdCBhdmFpbGFibGUuJyk7CgkJCQl9CgkJCQlyZXR1cm4gdm9pZCB1bmRlZmluZWQ7CgkJCX0KCQkJaWYgKCRnT1BEICYmIChpICsgMSkgPj0gcGFydHMubGVuZ3RoKSB7CgkJCQl2YXIgZGVzYyA9ICRnT1BEKHZhbHVlLCBwYXJ0KTsKCQkJCWlzT3duID0gISFkZXNjOwoKCQkJCS8vIEJ5IGNvbnZlbnRpb24sIHdoZW4gYSBkYXRhIHByb3BlcnR5IGlzIGNvbnZlcnRlZCB0byBhbiBhY2Nlc3NvcgoJCQkJLy8gcHJvcGVydHkgdG8gZW11bGF0ZSBhIGRhdGEgcHJvcGVydHkgdGhhdCBkb2VzIG5vdCBzdWZmZXIgZnJvbQoJCQkJLy8gdGhlIG92ZXJyaWRlIG1pc3Rha2UsIHRoYXQgYWNjZXNzb3IncyBnZXR0ZXIgaXMgbWFya2VkIHdpdGgKCQkJCS8vIGFuIGBvcmlnaW5hbFZhbHVlYCBwcm9wZXJ0eS4gSGVyZSwgd2hlbiB3ZSBkZXRlY3QgdGhpcywgd2UKCQkJCS8vIHVwaG9sZCB0aGUgaWxsdXNpb24gYnkgcHJldGVuZGluZyB0byBzZWUgdGhhdCBvcmlnaW5hbCBkYXRhCgkJCQkvLyBwcm9wZXJ0eSwgaS5lLiwgcmV0dXJuaW5nIHRoZSB2YWx1ZSByYXRoZXIgdGhhbiB0aGUgZ2V0dGVyCgkJCQkvLyBpdHNlbGYuCgkJCQlpZiAoaXNPd24gJiYgJ2dldCcgaW4gZGVzYyAmJiAhKCdvcmlnaW5hbFZhbHVlJyBpbiBkZXNjLmdldCkpIHsKCQkJCQl2YWx1ZSA9IGRlc2MuZ2V0OwoJCQkJfSBlbHNlIHsKCQkJCQl2YWx1ZSA9IHZhbHVlW3BhcnRdOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJaXNPd24gPSBoYXNPd24odmFsdWUsIHBhcnQpOwoJCQkJdmFsdWUgPSB2YWx1ZVtwYXJ0XTsKCQkJfQoKCQkJaWYgKGlzT3duICYmICFza2lwRnVydGhlckNhY2hpbmcpIHsKCQkJCUlOVFJJTlNJQ1NbaW50cmluc2ljUmVhbE5hbWVdID0gdmFsdWU7CgkJCX0KCQl9Cgl9CglyZXR1cm4gdmFsdWU7Cn07Cgp9LHsiZnVuY3Rpb24tYmluZCI6MjYsImhhcyI6MzAsImhhcy1zeW1ib2xzIjoyOH1dLDI4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKKGZ1bmN0aW9uIChnbG9iYWwpeyhmdW5jdGlvbiAoKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIG9yaWdTeW1ib2wgPSBnbG9iYWwuU3ltYm9sOwp2YXIgaGFzU3ltYm9sU2hhbSA9IHJlcXVpcmUoJy4vc2hhbXMnKTsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gaGFzTmF0aXZlU3ltYm9scygpIHsKCWlmICh0eXBlb2Ygb3JpZ1N5bWJvbCAhPT0gJ2Z1bmN0aW9uJykgeyByZXR1cm4gZmFsc2U7IH0KCWlmICh0eXBlb2YgU3ltYm9sICE9PSAnZnVuY3Rpb24nKSB7IHJldHVybiBmYWxzZTsgfQoJaWYgKHR5cGVvZiBvcmlnU3ltYm9sKCdmb28nKSAhPT0gJ3N5bWJvbCcpIHsgcmV0dXJuIGZhbHNlOyB9CglpZiAodHlwZW9mIFN5bWJvbCgnYmFyJykgIT09ICdzeW1ib2wnKSB7IHJldHVybiBmYWxzZTsgfQoKCXJldHVybiBoYXNTeW1ib2xTaGFtKCk7Cn07Cgp9KS5jYWxsKHRoaXMpfSkuY2FsbCh0aGlzLHR5cGVvZiBnbG9iYWwgIT09ICJ1bmRlZmluZWQiID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiID8gd2luZG93IDoge30pCn0seyIuL3NoYW1zIjoyOX1dLDI5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKLyogZXNsaW50IGNvbXBsZXhpdHk6IFsyLCAxOF0sIG1heC1zdGF0ZW1lbnRzOiBbMiwgMzNdICovCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gaGFzU3ltYm9scygpIHsKCWlmICh0eXBlb2YgU3ltYm9sICE9PSAnZnVuY3Rpb24nIHx8IHR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzICE9PSAnZnVuY3Rpb24nKSB7IHJldHVybiBmYWxzZTsgfQoJaWYgKHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICdzeW1ib2wnKSB7IHJldHVybiB0cnVlOyB9CgoJdmFyIG9iaiA9IHt9OwoJdmFyIHN5bSA9IFN5bWJvbCgndGVzdCcpOwoJdmFyIHN5bU9iaiA9IE9iamVjdChzeW0pOwoJaWYgKHR5cGVvZiBzeW0gPT09ICdzdHJpbmcnKSB7IHJldHVybiBmYWxzZTsgfQoKCWlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoc3ltKSAhPT0gJ1tvYmplY3QgU3ltYm9sXScpIHsgcmV0dXJuIGZhbHNlOyB9CglpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHN5bU9iaikgIT09ICdbb2JqZWN0IFN5bWJvbF0nKSB7IHJldHVybiBmYWxzZTsgfQoKCS8vIHRlbXAgZGlzYWJsZWQgcGVyIGh0dHBzOi8vZ2l0aHViLmNvbS9samhhcmIvb2JqZWN0LmFzc2lnbi9pc3N1ZXMvMTcKCS8vIGlmIChzeW0gaW5zdGFuY2VvZiBTeW1ib2wpIHsgcmV0dXJuIGZhbHNlOyB9CgkvLyB0ZW1wIGRpc2FibGVkIHBlciBodHRwczovL2dpdGh1Yi5jb20vV2ViUmVmbGVjdGlvbi9nZXQtb3duLXByb3BlcnR5LXN5bWJvbHMvaXNzdWVzLzQKCS8vIGlmICghKHN5bU9iaiBpbnN0YW5jZW9mIFN5bWJvbCkpIHsgcmV0dXJuIGZhbHNlOyB9CgoJLy8gaWYgKHR5cGVvZiBTeW1ib2wucHJvdG90eXBlLnRvU3RyaW5nICE9PSAnZnVuY3Rpb24nKSB7IHJldHVybiBmYWxzZTsgfQoJLy8gaWYgKFN0cmluZyhzeW0pICE9PSBTeW1ib2wucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoc3ltKSkgeyByZXR1cm4gZmFsc2U7IH0KCgl2YXIgc3ltVmFsID0gNDI7CglvYmpbc3ltXSA9IHN5bVZhbDsKCWZvciAoc3ltIGluIG9iaikgeyByZXR1cm4gZmFsc2U7IH0gLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1yZXN0cmljdGVkLXN5bnRheAoJaWYgKHR5cGVvZiBPYmplY3Qua2V5cyA9PT0gJ2Z1bmN0aW9uJyAmJiBPYmplY3Qua2V5cyhvYmopLmxlbmd0aCAhPT0gMCkgeyByZXR1cm4gZmFsc2U7IH0KCglpZiAodHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzID09PSAnZnVuY3Rpb24nICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKG9iaikubGVuZ3RoICE9PSAwKSB7IHJldHVybiBmYWxzZTsgfQoKCXZhciBzeW1zID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmopOwoJaWYgKHN5bXMubGVuZ3RoICE9PSAxIHx8IHN5bXNbMF0gIT09IHN5bSkgeyByZXR1cm4gZmFsc2U7IH0KCglpZiAoIU9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChvYmosIHN5bSkpIHsgcmV0dXJuIGZhbHNlOyB9CgoJaWYgKHR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID09PSAnZnVuY3Rpb24nKSB7CgkJdmFyIGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwgc3ltKTsKCQlpZiAoZGVzY3JpcHRvci52YWx1ZSAhPT0gc3ltVmFsIHx8IGRlc2NyaXB0b3IuZW51bWVyYWJsZSAhPT0gdHJ1ZSkgeyByZXR1cm4gZmFsc2U7IH0KCX0KCglyZXR1cm4gdHJ1ZTsKfTsKCn0se31dLDMwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIGJpbmQgPSByZXF1aXJlKCdmdW5jdGlvbi1iaW5kJyk7Cgptb2R1bGUuZXhwb3J0cyA9IGJpbmQuY2FsbChGdW5jdGlvbi5jYWxsLCBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5KTsKCn0seyJmdW5jdGlvbi1iaW5kIjoyNn1dLDMxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLyohIGllZWU3NTQuIEJTRC0zLUNsYXVzZSBMaWNlbnNlLiBGZXJvc3MgQWJvdWtoYWRpamVoIDxodHRwczovL2Zlcm9zcy5vcmcvb3BlbnNvdXJjZT4gKi8KZXhwb3J0cy5yZWFkID0gZnVuY3Rpb24gKGJ1ZmZlciwgb2Zmc2V0LCBpc0xFLCBtTGVuLCBuQnl0ZXMpIHsKICB2YXIgZSwgbQogIHZhciBlTGVuID0gKG5CeXRlcyAqIDgpIC0gbUxlbiAtIDEKICB2YXIgZU1heCA9ICgxIDw8IGVMZW4pIC0gMQogIHZhciBlQmlhcyA9IGVNYXggPj4gMQogIHZhciBuQml0cyA9IC03CiAgdmFyIGkgPSBpc0xFID8gKG5CeXRlcyAtIDEpIDogMAogIHZhciBkID0gaXNMRSA/IC0xIDogMQogIHZhciBzID0gYnVmZmVyW29mZnNldCArIGldCgogIGkgKz0gZAoKICBlID0gcyAmICgoMSA8PCAoLW5CaXRzKSkgLSAxKQogIHMgPj49ICgtbkJpdHMpCiAgbkJpdHMgKz0gZUxlbgogIGZvciAoOyBuQml0cyA+IDA7IGUgPSAoZSAqIDI1NikgKyBidWZmZXJbb2Zmc2V0ICsgaV0sIGkgKz0gZCwgbkJpdHMgLT0gOCkge30KCiAgbSA9IGUgJiAoKDEgPDwgKC1uQml0cykpIC0gMSkKICBlID4+PSAoLW5CaXRzKQogIG5CaXRzICs9IG1MZW4KICBmb3IgKDsgbkJpdHMgPiAwOyBtID0gKG0gKiAyNTYpICsgYnVmZmVyW29mZnNldCArIGldLCBpICs9IGQsIG5CaXRzIC09IDgpIHt9CgogIGlmIChlID09PSAwKSB7CiAgICBlID0gMSAtIGVCaWFzCiAgfSBlbHNlIGlmIChlID09PSBlTWF4KSB7CiAgICByZXR1cm4gbSA/IE5hTiA6ICgocyA/IC0xIDogMSkgKiBJbmZpbml0eSkKICB9IGVsc2UgewogICAgbSA9IG0gKyBNYXRoLnBvdygyLCBtTGVuKQogICAgZSA9IGUgLSBlQmlhcwogIH0KICByZXR1cm4gKHMgPyAtMSA6IDEpICogbSAqIE1hdGgucG93KDIsIGUgLSBtTGVuKQp9CgpleHBvcnRzLndyaXRlID0gZnVuY3Rpb24gKGJ1ZmZlciwgdmFsdWUsIG9mZnNldCwgaXNMRSwgbUxlbiwgbkJ5dGVzKSB7CiAgdmFyIGUsIG0sIGMKICB2YXIgZUxlbiA9IChuQnl0ZXMgKiA4KSAtIG1MZW4gLSAxCiAgdmFyIGVNYXggPSAoMSA8PCBlTGVuKSAtIDEKICB2YXIgZUJpYXMgPSBlTWF4ID4+IDEKICB2YXIgcnQgPSAobUxlbiA9PT0gMjMgPyBNYXRoLnBvdygyLCAtMjQpIC0gTWF0aC5wb3coMiwgLTc3KSA6IDApCiAgdmFyIGkgPSBpc0xFID8gMCA6IChuQnl0ZXMgLSAxKQogIHZhciBkID0gaXNMRSA/IDEgOiAtMQogIHZhciBzID0gdmFsdWUgPCAwIHx8ICh2YWx1ZSA9PT0gMCAmJiAxIC8gdmFsdWUgPCAwKSA/IDEgOiAwCgogIHZhbHVlID0gTWF0aC5hYnModmFsdWUpCgogIGlmIChpc05hTih2YWx1ZSkgfHwgdmFsdWUgPT09IEluZmluaXR5KSB7CiAgICBtID0gaXNOYU4odmFsdWUpID8gMSA6IDAKICAgIGUgPSBlTWF4CiAgfSBlbHNlIHsKICAgIGUgPSBNYXRoLmZsb29yKE1hdGgubG9nKHZhbHVlKSAvIE1hdGguTE4yKQogICAgaWYgKHZhbHVlICogKGMgPSBNYXRoLnBvdygyLCAtZSkpIDwgMSkgewogICAgICBlLS0KICAgICAgYyAqPSAyCiAgICB9CiAgICBpZiAoZSArIGVCaWFzID49IDEpIHsKICAgICAgdmFsdWUgKz0gcnQgLyBjCiAgICB9IGVsc2UgewogICAgICB2YWx1ZSArPSBydCAqIE1hdGgucG93KDIsIDEgLSBlQmlhcykKICAgIH0KICAgIGlmICh2YWx1ZSAqIGMgPj0gMikgewogICAgICBlKysKICAgICAgYyAvPSAyCiAgICB9CgogICAgaWYgKGUgKyBlQmlhcyA+PSBlTWF4KSB7CiAgICAgIG0gPSAwCiAgICAgIGUgPSBlTWF4CiAgICB9IGVsc2UgaWYgKGUgKyBlQmlhcyA+PSAxKSB7CiAgICAgIG0gPSAoKHZhbHVlICogYykgLSAxKSAqIE1hdGgucG93KDIsIG1MZW4pCiAgICAgIGUgPSBlICsgZUJpYXMKICAgIH0gZWxzZSB7CiAgICAgIG0gPSB2YWx1ZSAqIE1hdGgucG93KDIsIGVCaWFzIC0gMSkgKiBNYXRoLnBvdygyLCBtTGVuKQogICAgICBlID0gMAogICAgfQogIH0KCiAgZm9yICg7IG1MZW4gPj0gODsgYnVmZmVyW29mZnNldCArIGldID0gbSAmIDB4ZmYsIGkgKz0gZCwgbSAvPSAyNTYsIG1MZW4gLT0gOCkge30KCiAgZSA9IChlIDw8IG1MZW4pIHwgbQogIGVMZW4gKz0gbUxlbgogIGZvciAoOyBlTGVuID4gMDsgYnVmZmVyW29mZnNldCArIGldID0gZSAmIDB4ZmYsIGkgKz0gZCwgZSAvPSAyNTYsIGVMZW4gLT0gOCkge30KCiAgYnVmZmVyW29mZnNldCArIGkgLSBkXSB8PSBzICogMTI4Cn0KCn0se31dLDMyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKaWYgKHR5cGVvZiBPYmplY3QuY3JlYXRlID09PSAnZnVuY3Rpb24nKSB7CiAgLy8gaW1wbGVtZW50YXRpb24gZnJvbSBzdGFuZGFyZCBub2RlLmpzICd1dGlsJyBtb2R1bGUKICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGluaGVyaXRzKGN0b3IsIHN1cGVyQ3RvcikgewogICAgaWYgKHN1cGVyQ3RvcikgewogICAgICBjdG9yLnN1cGVyXyA9IHN1cGVyQ3RvcgogICAgICBjdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDdG9yLnByb3RvdHlwZSwgewogICAgICAgIGNvbnN0cnVjdG9yOiB7CiAgICAgICAgICB2YWx1ZTogY3RvciwKICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLAogICAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9CiAgICAgIH0pCiAgICB9CiAgfTsKfSBlbHNlIHsKICAvLyBvbGQgc2Nob29sIHNoaW0gZm9yIG9sZCBicm93c2VycwogIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gaW5oZXJpdHMoY3Rvciwgc3VwZXJDdG9yKSB7CiAgICBpZiAoc3VwZXJDdG9yKSB7CiAgICAgIGN0b3Iuc3VwZXJfID0gc3VwZXJDdG9yCiAgICAgIHZhciBUZW1wQ3RvciA9IGZ1bmN0aW9uICgpIHt9CiAgICAgIFRlbXBDdG9yLnByb3RvdHlwZSA9IHN1cGVyQ3Rvci5wcm90b3R5cGUKICAgICAgY3Rvci5wcm90b3R5cGUgPSBuZXcgVGVtcEN0b3IoKQogICAgICBjdG9yLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IGN0b3IKICAgIH0KICB9Cn0KCn0se31dLDMzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIGhhc1RvU3RyaW5nVGFnID0gdHlwZW9mIFN5bWJvbCA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgU3ltYm9sLnRvU3RyaW5nVGFnID09PSAnc3ltYm9sJzsKdmFyIGNhbGxCb3VuZCA9IHJlcXVpcmUoJ2NhbGwtYmluZC9jYWxsQm91bmQnKTsKCnZhciAkdG9TdHJpbmcgPSBjYWxsQm91bmQoJ09iamVjdC5wcm90b3R5cGUudG9TdHJpbmcnKTsKCnZhciBpc1N0YW5kYXJkQXJndW1lbnRzID0gZnVuY3Rpb24gaXNBcmd1bWVudHModmFsdWUpIHsKCWlmIChoYXNUb1N0cmluZ1RhZyAmJiB2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIFN5bWJvbC50b1N0cmluZ1RhZyBpbiB2YWx1ZSkgewoJCXJldHVybiBmYWxzZTsKCX0KCXJldHVybiAkdG9TdHJpbmcodmFsdWUpID09PSAnW29iamVjdCBBcmd1bWVudHNdJzsKfTsKCnZhciBpc0xlZ2FjeUFyZ3VtZW50cyA9IGZ1bmN0aW9uIGlzQXJndW1lbnRzKHZhbHVlKSB7CglpZiAoaXNTdGFuZGFyZEFyZ3VtZW50cyh2YWx1ZSkpIHsKCQlyZXR1cm4gdHJ1ZTsKCX0KCXJldHVybiB2YWx1ZSAhPT0gbnVsbCAmJgoJCXR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYKCQl0eXBlb2YgdmFsdWUubGVuZ3RoID09PSAnbnVtYmVyJyAmJgoJCXZhbHVlLmxlbmd0aCA+PSAwICYmCgkJJHRvU3RyaW5nKHZhbHVlKSAhPT0gJ1tvYmplY3QgQXJyYXldJyAmJgoJCSR0b1N0cmluZyh2YWx1ZS5jYWxsZWUpID09PSAnW29iamVjdCBGdW5jdGlvbl0nOwp9OwoKdmFyIHN1cHBvcnRzU3RhbmRhcmRBcmd1bWVudHMgPSAoZnVuY3Rpb24gKCkgewoJcmV0dXJuIGlzU3RhbmRhcmRBcmd1bWVudHMoYXJndW1lbnRzKTsKfSgpKTsKCmlzU3RhbmRhcmRBcmd1bWVudHMuaXNMZWdhY3lBcmd1bWVudHMgPSBpc0xlZ2FjeUFyZ3VtZW50czsgLy8gZm9yIHRlc3RzCgptb2R1bGUuZXhwb3J0cyA9IHN1cHBvcnRzU3RhbmRhcmRBcmd1bWVudHMgPyBpc1N0YW5kYXJkQXJndW1lbnRzIDogaXNMZWdhY3lBcmd1bWVudHM7Cgp9LHsiY2FsbC1iaW5kL2NhbGxCb3VuZCI6MjB9XSwzNDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8qIQogKiBEZXRlcm1pbmUgaWYgYW4gb2JqZWN0IGlzIGEgQnVmZmVyCiAqCiAqIEBhdXRob3IgICBGZXJvc3MgQWJvdWtoYWRpamVoIDxodHRwczovL2Zlcm9zcy5vcmc+CiAqIEBsaWNlbnNlICBNSVQKICovCgovLyBUaGUgX2lzQnVmZmVyIGNoZWNrIGlzIGZvciBTYWZhcmkgNS03IHN1cHBvcnQsIGJlY2F1c2UgaXQncyBtaXNzaW5nCi8vIE9iamVjdC5wcm90b3R5cGUuY29uc3RydWN0b3IuIFJlbW92ZSB0aGlzIGV2ZW50dWFsbHkKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob2JqKSB7CiAgcmV0dXJuIG9iaiAhPSBudWxsICYmIChpc0J1ZmZlcihvYmopIHx8IGlzU2xvd0J1ZmZlcihvYmopIHx8ICEhb2JqLl9pc0J1ZmZlcikKfQoKZnVuY3Rpb24gaXNCdWZmZXIgKG9iaikgewogIHJldHVybiAhIW9iai5jb25zdHJ1Y3RvciAmJiB0eXBlb2Ygb2JqLmNvbnN0cnVjdG9yLmlzQnVmZmVyID09PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5pc0J1ZmZlcihvYmopCn0KCi8vIEZvciBOb2RlIHYwLjEwIHN1cHBvcnQuIFJlbW92ZSB0aGlzIGV2ZW50dWFsbHkuCmZ1bmN0aW9uIGlzU2xvd0J1ZmZlciAob2JqKSB7CiAgcmV0dXJuIHR5cGVvZiBvYmoucmVhZEZsb2F0TEUgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIG9iai5zbGljZSA9PT0gJ2Z1bmN0aW9uJyAmJiBpc0J1ZmZlcihvYmouc2xpY2UoMCwgMCkpCn0KCn0se31dLDM1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIHRvU3RyID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsKdmFyIGZuVG9TdHIgPSBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmc7CnZhciBpc0ZuUmVnZXggPSAvXlxzKig/OmZ1bmN0aW9uKT9cKi87CnZhciBoYXNUb1N0cmluZ1RhZyA9IHR5cGVvZiBTeW1ib2wgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIFN5bWJvbC50b1N0cmluZ1RhZyA9PT0gJ3N5bWJvbCc7CnZhciBnZXRQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZjsKdmFyIGdldEdlbmVyYXRvckZ1bmMgPSBmdW5jdGlvbiAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY29uc2lzdGVudC1yZXR1cm4KCWlmICghaGFzVG9TdHJpbmdUYWcpIHsKCQlyZXR1cm4gZmFsc2U7Cgl9Cgl0cnkgewoJCXJldHVybiBGdW5jdGlvbigncmV0dXJuIGZ1bmN0aW9uKigpIHt9JykoKTsKCX0gY2F0Y2ggKGUpIHsKCX0KfTsKdmFyIGdlbmVyYXRvckZ1bmMgPSBnZXRHZW5lcmF0b3JGdW5jKCk7CnZhciBHZW5lcmF0b3JGdW5jdGlvbiA9IGdldFByb3RvICYmIGdlbmVyYXRvckZ1bmMgPyBnZXRQcm90byhnZW5lcmF0b3JGdW5jKSA6IGZhbHNlOwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBpc0dlbmVyYXRvckZ1bmN0aW9uKGZuKSB7CglpZiAodHlwZW9mIGZuICE9PSAnZnVuY3Rpb24nKSB7CgkJcmV0dXJuIGZhbHNlOwoJfQoJaWYgKGlzRm5SZWdleC50ZXN0KGZuVG9TdHIuY2FsbChmbikpKSB7CgkJcmV0dXJuIHRydWU7Cgl9CglpZiAoIWhhc1RvU3RyaW5nVGFnKSB7CgkJdmFyIHN0ciA9IHRvU3RyLmNhbGwoZm4pOwoJCXJldHVybiBzdHIgPT09ICdbb2JqZWN0IEdlbmVyYXRvckZ1bmN0aW9uXSc7Cgl9CglyZXR1cm4gZ2V0UHJvdG8gJiYgZ2V0UHJvdG8oZm4pID09PSBHZW5lcmF0b3JGdW5jdGlvbjsKfTsKCn0se31dLDM2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKKGZ1bmN0aW9uIChnbG9iYWwpeyhmdW5jdGlvbiAoKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIGZvckVhY2ggPSByZXF1aXJlKCdmb3JlYWNoJyk7CnZhciBhdmFpbGFibGVUeXBlZEFycmF5cyA9IHJlcXVpcmUoJ2F2YWlsYWJsZS10eXBlZC1hcnJheXMnKTsKdmFyIGNhbGxCb3VuZCA9IHJlcXVpcmUoJ2NhbGwtYmluZC9jYWxsQm91bmQnKTsKCnZhciAkdG9TdHJpbmcgPSBjYWxsQm91bmQoJ09iamVjdC5wcm90b3R5cGUudG9TdHJpbmcnKTsKdmFyIGhhc1N5bWJvbHMgPSByZXF1aXJlKCdoYXMtc3ltYm9scycpKCk7CnZhciBoYXNUb1N0cmluZ1RhZyA9IGhhc1N5bWJvbHMgJiYgdHlwZW9mIFN5bWJvbC50b1N0cmluZ1RhZyA9PT0gJ3N5bWJvbCc7Cgp2YXIgdHlwZWRBcnJheXMgPSBhdmFpbGFibGVUeXBlZEFycmF5cygpOwoKdmFyICRpbmRleE9mID0gY2FsbEJvdW5kKCdBcnJheS5wcm90b3R5cGUuaW5kZXhPZicsIHRydWUpIHx8IGZ1bmN0aW9uIGluZGV4T2YoYXJyYXksIHZhbHVlKSB7Cglmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSArPSAxKSB7CgkJaWYgKGFycmF5W2ldID09PSB2YWx1ZSkgewoJCQlyZXR1cm4gaTsKCQl9Cgl9CglyZXR1cm4gLTE7Cn07CnZhciAkc2xpY2UgPSBjYWxsQm91bmQoJ1N0cmluZy5wcm90b3R5cGUuc2xpY2UnKTsKdmFyIHRvU3RyVGFncyA9IHt9Owp2YXIgZ09QRCA9IHJlcXVpcmUoJ2VzLWFic3RyYWN0L2hlbHBlcnMvZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yJyk7CnZhciBnZXRQcm90b3R5cGVPZiA9IE9iamVjdC5nZXRQcm90b3R5cGVPZjsgLy8gcmVxdWlyZSgnZ2V0cHJvdG90eXBlb2YnKTsKaWYgKGhhc1RvU3RyaW5nVGFnICYmIGdPUEQgJiYgZ2V0UHJvdG90eXBlT2YpIHsKCWZvckVhY2godHlwZWRBcnJheXMsIGZ1bmN0aW9uICh0eXBlZEFycmF5KSB7CgkJdmFyIGFyciA9IG5ldyBnbG9iYWxbdHlwZWRBcnJheV0oKTsKCQlpZiAoIShTeW1ib2wudG9TdHJpbmdUYWcgaW4gYXJyKSkgewoJCQl0aHJvdyBuZXcgRXZhbEVycm9yKCd0aGlzIGVuZ2luZSBoYXMgc3VwcG9ydCBmb3IgU3ltYm9sLnRvU3RyaW5nVGFnLCBidXQgJyArIHR5cGVkQXJyYXkgKyAnIGRvZXMgbm90IGhhdmUgdGhlIHByb3BlcnR5ISBQbGVhc2UgcmVwb3J0IHRoaXMuJyk7CgkJfQoJCXZhciBwcm90byA9IGdldFByb3RvdHlwZU9mKGFycik7CgkJdmFyIGRlc2NyaXB0b3IgPSBnT1BEKHByb3RvLCBTeW1ib2wudG9TdHJpbmdUYWcpOwoJCWlmICghZGVzY3JpcHRvcikgewoJCQl2YXIgc3VwZXJQcm90byA9IGdldFByb3RvdHlwZU9mKHByb3RvKTsKCQkJZGVzY3JpcHRvciA9IGdPUEQoc3VwZXJQcm90bywgU3ltYm9sLnRvU3RyaW5nVGFnKTsKCQl9CgkJdG9TdHJUYWdzW3R5cGVkQXJyYXldID0gZGVzY3JpcHRvci5nZXQ7Cgl9KTsKfQoKdmFyIHRyeVR5cGVkQXJyYXlzID0gZnVuY3Rpb24gdHJ5QWxsVHlwZWRBcnJheXModmFsdWUpIHsKCXZhciBhbnlUcnVlID0gZmFsc2U7Cglmb3JFYWNoKHRvU3RyVGFncywgZnVuY3Rpb24gKGdldHRlciwgdHlwZWRBcnJheSkgewoJCWlmICghYW55VHJ1ZSkgewoJCQl0cnkgewoJCQkJYW55VHJ1ZSA9IGdldHRlci5jYWxsKHZhbHVlKSA9PT0gdHlwZWRBcnJheTsKCQkJfSBjYXRjaCAoZSkgeyAvKiovIH0KCQl9Cgl9KTsKCXJldHVybiBhbnlUcnVlOwp9OwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBpc1R5cGVkQXJyYXkodmFsdWUpIHsKCWlmICghdmFsdWUgfHwgdHlwZW9mIHZhbHVlICE9PSAnb2JqZWN0JykgeyByZXR1cm4gZmFsc2U7IH0KCWlmICghaGFzVG9TdHJpbmdUYWcpIHsKCQl2YXIgdGFnID0gJHNsaWNlKCR0b1N0cmluZyh2YWx1ZSksIDgsIC0xKTsKCQlyZXR1cm4gJGluZGV4T2YodHlwZWRBcnJheXMsIHRhZykgPiAtMTsKCX0KCWlmICghZ09QRCkgeyByZXR1cm4gZmFsc2U7IH0KCXJldHVybiB0cnlUeXBlZEFycmF5cyh2YWx1ZSk7Cn07Cgp9KS5jYWxsKHRoaXMpfSkuY2FsbCh0aGlzLHR5cGVvZiBnbG9iYWwgIT09ICJ1bmRlZmluZWQiID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiID8gd2luZG93IDoge30pCn0seyJhdmFpbGFibGUtdHlwZWQtYXJyYXlzIjoxNywiY2FsbC1iaW5kL2NhbGxCb3VuZCI6MjAsImVzLWFic3RyYWN0L2hlbHBlcnMvZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIjoyMywiZm9yZWFjaCI6MjQsImhhcy1zeW1ib2xzIjoyOH1dLDM3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKKGZ1bmN0aW9uIChwcm9jZXNzKXsoZnVuY3Rpb24gKCl7Ci8vICdwYXRoJyBtb2R1bGUgZXh0cmFjdGVkIGZyb20gTm9kZS5qcyB2OC4xMS4xIChvbmx5IHRoZSBwb3NpeCBwYXJ0KQovLyB0cmFuc3BsaXRlZCB3aXRoIEJhYmVsCgovLyBDb3B5cmlnaHQgSm95ZW50LCBJbmMuIGFuZCBvdGhlciBOb2RlIGNvbnRyaWJ1dG9ycy4KLy8KLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEKLy8gY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZQovLyAiU29mdHdhcmUiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nCi8vIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwKLy8gZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdAovLyBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUKLy8gZm9sbG93aW5nIGNvbmRpdGlvbnM6Ci8vCi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkCi8vIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgovLwovLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUwovLyBPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GCi8vIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4KLy8gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sCi8vIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUgovLyBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFCi8vIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCgondXNlIHN0cmljdCc7CgpmdW5jdGlvbiBhc3NlcnRQYXRoKHBhdGgpIHsKICBpZiAodHlwZW9mIHBhdGggIT09ICdzdHJpbmcnKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdQYXRoIG11c3QgYmUgYSBzdHJpbmcuIFJlY2VpdmVkICcgKyBKU09OLnN0cmluZ2lmeShwYXRoKSk7CiAgfQp9CgovLyBSZXNvbHZlcyAuIGFuZCAuLiBlbGVtZW50cyBpbiBhIHBhdGggd2l0aCBkaXJlY3RvcnkgbmFtZXMKZnVuY3Rpb24gbm9ybWFsaXplU3RyaW5nUG9zaXgocGF0aCwgYWxsb3dBYm92ZVJvb3QpIHsKICB2YXIgcmVzID0gJyc7CiAgdmFyIGxhc3RTZWdtZW50TGVuZ3RoID0gMDsKICB2YXIgbGFzdFNsYXNoID0gLTE7CiAgdmFyIGRvdHMgPSAwOwogIHZhciBjb2RlOwogIGZvciAodmFyIGkgPSAwOyBpIDw9IHBhdGgubGVuZ3RoOyArK2kpIHsKICAgIGlmIChpIDwgcGF0aC5sZW5ndGgpCiAgICAgIGNvZGUgPSBwYXRoLmNoYXJDb2RlQXQoaSk7CiAgICBlbHNlIGlmIChjb2RlID09PSA0NyAvKi8qLykKICAgICAgYnJlYWs7CiAgICBlbHNlCiAgICAgIGNvZGUgPSA0NyAvKi8qLzsKICAgIGlmIChjb2RlID09PSA0NyAvKi8qLykgewogICAgICBpZiAobGFzdFNsYXNoID09PSBpIC0gMSB8fCBkb3RzID09PSAxKSB7CiAgICAgICAgLy8gTk9PUAogICAgICB9IGVsc2UgaWYgKGxhc3RTbGFzaCAhPT0gaSAtIDEgJiYgZG90cyA9PT0gMikgewogICAgICAgIGlmIChyZXMubGVuZ3RoIDwgMiB8fCBsYXN0U2VnbWVudExlbmd0aCAhPT0gMiB8fCByZXMuY2hhckNvZGVBdChyZXMubGVuZ3RoIC0gMSkgIT09IDQ2IC8qLiovIHx8IHJlcy5jaGFyQ29kZUF0KHJlcy5sZW5ndGggLSAyKSAhPT0gNDYgLyouKi8pIHsKICAgICAgICAgIGlmIChyZXMubGVuZ3RoID4gMikgewogICAgICAgICAgICB2YXIgbGFzdFNsYXNoSW5kZXggPSByZXMubGFzdEluZGV4T2YoJy8nKTsKICAgICAgICAgICAgaWYgKGxhc3RTbGFzaEluZGV4ICE9PSByZXMubGVuZ3RoIC0gMSkgewogICAgICAgICAgICAgIGlmIChsYXN0U2xhc2hJbmRleCA9PT0gLTEpIHsKICAgICAgICAgICAgICAgIHJlcyA9ICcnOwogICAgICAgICAgICAgICAgbGFzdFNlZ21lbnRMZW5ndGggPSAwOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXMgPSByZXMuc2xpY2UoMCwgbGFzdFNsYXNoSW5kZXgpOwogICAgICAgICAgICAgICAgbGFzdFNlZ21lbnRMZW5ndGggPSByZXMubGVuZ3RoIC0gMSAtIHJlcy5sYXN0SW5kZXhPZignLycpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBsYXN0U2xhc2ggPSBpOwogICAgICAgICAgICAgIGRvdHMgPSAwOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKHJlcy5sZW5ndGggPT09IDIgfHwgcmVzLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICByZXMgPSAnJzsKICAgICAgICAgICAgbGFzdFNlZ21lbnRMZW5ndGggPSAwOwogICAgICAgICAgICBsYXN0U2xhc2ggPSBpOwogICAgICAgICAgICBkb3RzID0gMDsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChhbGxvd0Fib3ZlUm9vdCkgewogICAgICAgICAgaWYgKHJlcy5sZW5ndGggPiAwKQogICAgICAgICAgICByZXMgKz0gJy8uLic7CiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHJlcyA9ICcuLic7CiAgICAgICAgICBsYXN0U2VnbWVudExlbmd0aCA9IDI7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChyZXMubGVuZ3RoID4gMCkKICAgICAgICAgIHJlcyArPSAnLycgKyBwYXRoLnNsaWNlKGxhc3RTbGFzaCArIDEsIGkpOwogICAgICAgIGVsc2UKICAgICAgICAgIHJlcyA9IHBhdGguc2xpY2UobGFzdFNsYXNoICsgMSwgaSk7CiAgICAgICAgbGFzdFNlZ21lbnRMZW5ndGggPSBpIC0gbGFzdFNsYXNoIC0gMTsKICAgICAgfQogICAgICBsYXN0U2xhc2ggPSBpOwogICAgICBkb3RzID0gMDsKICAgIH0gZWxzZSBpZiAoY29kZSA9PT0gNDYgLyouKi8gJiYgZG90cyAhPT0gLTEpIHsKICAgICAgKytkb3RzOwogICAgfSBlbHNlIHsKICAgICAgZG90cyA9IC0xOwogICAgfQogIH0KICByZXR1cm4gcmVzOwp9CgpmdW5jdGlvbiBfZm9ybWF0KHNlcCwgcGF0aE9iamVjdCkgewogIHZhciBkaXIgPSBwYXRoT2JqZWN0LmRpciB8fCBwYXRoT2JqZWN0LnJvb3Q7CiAgdmFyIGJhc2UgPSBwYXRoT2JqZWN0LmJhc2UgfHwgKHBhdGhPYmplY3QubmFtZSB8fCAnJykgKyAocGF0aE9iamVjdC5leHQgfHwgJycpOwogIGlmICghZGlyKSB7CiAgICByZXR1cm4gYmFzZTsKICB9CiAgaWYgKGRpciA9PT0gcGF0aE9iamVjdC5yb290KSB7CiAgICByZXR1cm4gZGlyICsgYmFzZTsKICB9CiAgcmV0dXJuIGRpciArIHNlcCArIGJhc2U7Cn0KCnZhciBwb3NpeCA9IHsKICAvLyBwYXRoLnJlc29sdmUoW2Zyb20gLi4uXSwgdG8pCiAgcmVzb2x2ZTogZnVuY3Rpb24gcmVzb2x2ZSgpIHsKICAgIHZhciByZXNvbHZlZFBhdGggPSAnJzsKICAgIHZhciByZXNvbHZlZEFic29sdXRlID0gZmFsc2U7CiAgICB2YXIgY3dkOwoKICAgIGZvciAodmFyIGkgPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsgaSA+PSAtMSAmJiAhcmVzb2x2ZWRBYnNvbHV0ZTsgaS0tKSB7CiAgICAgIHZhciBwYXRoOwogICAgICBpZiAoaSA+PSAwKQogICAgICAgIHBhdGggPSBhcmd1bWVudHNbaV07CiAgICAgIGVsc2UgewogICAgICAgIGlmIChjd2QgPT09IHVuZGVmaW5lZCkKICAgICAgICAgIGN3ZCA9IHByb2Nlc3MuY3dkKCk7CiAgICAgICAgcGF0aCA9IGN3ZDsKICAgICAgfQoKICAgICAgYXNzZXJ0UGF0aChwYXRoKTsKCiAgICAgIC8vIFNraXAgZW1wdHkgZW50cmllcwogICAgICBpZiAocGF0aC5sZW5ndGggPT09IDApIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQoKICAgICAgcmVzb2x2ZWRQYXRoID0gcGF0aCArICcvJyArIHJlc29sdmVkUGF0aDsKICAgICAgcmVzb2x2ZWRBYnNvbHV0ZSA9IHBhdGguY2hhckNvZGVBdCgwKSA9PT0gNDcgLyovKi87CiAgICB9CgogICAgLy8gQXQgdGhpcyBwb2ludCB0aGUgcGF0aCBzaG91bGQgYmUgcmVzb2x2ZWQgdG8gYSBmdWxsIGFic29sdXRlIHBhdGgsIGJ1dAogICAgLy8gaGFuZGxlIHJlbGF0aXZlIHBhdGhzIHRvIGJlIHNhZmUgKG1pZ2h0IGhhcHBlbiB3aGVuIHByb2Nlc3MuY3dkKCkgZmFpbHMpCgogICAgLy8gTm9ybWFsaXplIHRoZSBwYXRoCiAgICByZXNvbHZlZFBhdGggPSBub3JtYWxpemVTdHJpbmdQb3NpeChyZXNvbHZlZFBhdGgsICFyZXNvbHZlZEFic29sdXRlKTsKCiAgICBpZiAocmVzb2x2ZWRBYnNvbHV0ZSkgewogICAgICBpZiAocmVzb2x2ZWRQYXRoLmxlbmd0aCA+IDApCiAgICAgICAgcmV0dXJuICcvJyArIHJlc29sdmVkUGF0aDsKICAgICAgZWxzZQogICAgICAgIHJldHVybiAnLyc7CiAgICB9IGVsc2UgaWYgKHJlc29sdmVkUGF0aC5sZW5ndGggPiAwKSB7CiAgICAgIHJldHVybiByZXNvbHZlZFBhdGg7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gJy4nOwogICAgfQogIH0sCgogIG5vcm1hbGl6ZTogZnVuY3Rpb24gbm9ybWFsaXplKHBhdGgpIHsKICAgIGFzc2VydFBhdGgocGF0aCk7CgogICAgaWYgKHBhdGgubGVuZ3RoID09PSAwKSByZXR1cm4gJy4nOwoKICAgIHZhciBpc0Fic29sdXRlID0gcGF0aC5jaGFyQ29kZUF0KDApID09PSA0NyAvKi8qLzsKICAgIHZhciB0cmFpbGluZ1NlcGFyYXRvciA9IHBhdGguY2hhckNvZGVBdChwYXRoLmxlbmd0aCAtIDEpID09PSA0NyAvKi8qLzsKCiAgICAvLyBOb3JtYWxpemUgdGhlIHBhdGgKICAgIHBhdGggPSBub3JtYWxpemVTdHJpbmdQb3NpeChwYXRoLCAhaXNBYnNvbHV0ZSk7CgogICAgaWYgKHBhdGgubGVuZ3RoID09PSAwICYmICFpc0Fic29sdXRlKSBwYXRoID0gJy4nOwogICAgaWYgKHBhdGgubGVuZ3RoID4gMCAmJiB0cmFpbGluZ1NlcGFyYXRvcikgcGF0aCArPSAnLyc7CgogICAgaWYgKGlzQWJzb2x1dGUpIHJldHVybiAnLycgKyBwYXRoOwogICAgcmV0dXJuIHBhdGg7CiAgfSwKCiAgaXNBYnNvbHV0ZTogZnVuY3Rpb24gaXNBYnNvbHV0ZShwYXRoKSB7CiAgICBhc3NlcnRQYXRoKHBhdGgpOwogICAgcmV0dXJuIHBhdGgubGVuZ3RoID4gMCAmJiBwYXRoLmNoYXJDb2RlQXQoMCkgPT09IDQ3IC8qLyovOwogIH0sCgogIGpvaW46IGZ1bmN0aW9uIGpvaW4oKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkKICAgICAgcmV0dXJuICcuJzsKICAgIHZhciBqb2luZWQ7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7ICsraSkgewogICAgICB2YXIgYXJnID0gYXJndW1lbnRzW2ldOwogICAgICBhc3NlcnRQYXRoKGFyZyk7CiAgICAgIGlmIChhcmcubGVuZ3RoID4gMCkgewogICAgICAgIGlmIChqb2luZWQgPT09IHVuZGVmaW5lZCkKICAgICAgICAgIGpvaW5lZCA9IGFyZzsKICAgICAgICBlbHNlCiAgICAgICAgICBqb2luZWQgKz0gJy8nICsgYXJnOwogICAgICB9CiAgICB9CiAgICBpZiAoam9pbmVkID09PSB1bmRlZmluZWQpCiAgICAgIHJldHVybiAnLic7CiAgICByZXR1cm4gcG9zaXgubm9ybWFsaXplKGpvaW5lZCk7CiAgfSwKCiAgcmVsYXRpdmU6IGZ1bmN0aW9uIHJlbGF0aXZlKGZyb20sIHRvKSB7CiAgICBhc3NlcnRQYXRoKGZyb20pOwogICAgYXNzZXJ0UGF0aCh0byk7CgogICAgaWYgKGZyb20gPT09IHRvKSByZXR1cm4gJyc7CgogICAgZnJvbSA9IHBvc2l4LnJlc29sdmUoZnJvbSk7CiAgICB0byA9IHBvc2l4LnJlc29sdmUodG8pOwoKICAgIGlmIChmcm9tID09PSB0bykgcmV0dXJuICcnOwoKICAgIC8vIFRyaW0gYW55IGxlYWRpbmcgYmFja3NsYXNoZXMKICAgIHZhciBmcm9tU3RhcnQgPSAxOwogICAgZm9yICg7IGZyb21TdGFydCA8IGZyb20ubGVuZ3RoOyArK2Zyb21TdGFydCkgewogICAgICBpZiAoZnJvbS5jaGFyQ29kZUF0KGZyb21TdGFydCkgIT09IDQ3IC8qLyovKQogICAgICAgIGJyZWFrOwogICAgfQogICAgdmFyIGZyb21FbmQgPSBmcm9tLmxlbmd0aDsKICAgIHZhciBmcm9tTGVuID0gZnJvbUVuZCAtIGZyb21TdGFydDsKCiAgICAvLyBUcmltIGFueSBsZWFkaW5nIGJhY2tzbGFzaGVzCiAgICB2YXIgdG9TdGFydCA9IDE7CiAgICBmb3IgKDsgdG9TdGFydCA8IHRvLmxlbmd0aDsgKyt0b1N0YXJ0KSB7CiAgICAgIGlmICh0by5jaGFyQ29kZUF0KHRvU3RhcnQpICE9PSA0NyAvKi8qLykKICAgICAgICBicmVhazsKICAgIH0KICAgIHZhciB0b0VuZCA9IHRvLmxlbmd0aDsKICAgIHZhciB0b0xlbiA9IHRvRW5kIC0gdG9TdGFydDsKCiAgICAvLyBDb21wYXJlIHBhdGhzIHRvIGZpbmQgdGhlIGxvbmdlc3QgY29tbW9uIHBhdGggZnJvbSByb290CiAgICB2YXIgbGVuZ3RoID0gZnJvbUxlbiA8IHRvTGVuID8gZnJvbUxlbiA6IHRvTGVuOwogICAgdmFyIGxhc3RDb21tb25TZXAgPSAtMTsKICAgIHZhciBpID0gMDsKICAgIGZvciAoOyBpIDw9IGxlbmd0aDsgKytpKSB7CiAgICAgIGlmIChpID09PSBsZW5ndGgpIHsKICAgICAgICBpZiAodG9MZW4gPiBsZW5ndGgpIHsKICAgICAgICAgIGlmICh0by5jaGFyQ29kZUF0KHRvU3RhcnQgKyBpKSA9PT0gNDcgLyovKi8pIHsKICAgICAgICAgICAgLy8gV2UgZ2V0IGhlcmUgaWYgYGZyb21gIGlzIHRoZSBleGFjdCBiYXNlIHBhdGggZm9yIGB0b2AuCiAgICAgICAgICAgIC8vIEZvciBleGFtcGxlOiBmcm9tPScvZm9vL2Jhcic7IHRvPScvZm9vL2Jhci9iYXonCiAgICAgICAgICAgIHJldHVybiB0by5zbGljZSh0b1N0YXJ0ICsgaSArIDEpOwogICAgICAgICAgfSBlbHNlIGlmIChpID09PSAwKSB7CiAgICAgICAgICAgIC8vIFdlIGdldCBoZXJlIGlmIGBmcm9tYCBpcyB0aGUgcm9vdAogICAgICAgICAgICAvLyBGb3IgZXhhbXBsZTogZnJvbT0nLyc7IHRvPScvZm9vJwogICAgICAgICAgICByZXR1cm4gdG8uc2xpY2UodG9TdGFydCArIGkpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZnJvbUxlbiA+IGxlbmd0aCkgewogICAgICAgICAgaWYgKGZyb20uY2hhckNvZGVBdChmcm9tU3RhcnQgKyBpKSA9PT0gNDcgLyovKi8pIHsKICAgICAgICAgICAgLy8gV2UgZ2V0IGhlcmUgaWYgYHRvYCBpcyB0aGUgZXhhY3QgYmFzZSBwYXRoIGZvciBgZnJvbWAuCiAgICAgICAgICAgIC8vIEZvciBleGFtcGxlOiBmcm9tPScvZm9vL2Jhci9iYXonOyB0bz0nL2Zvby9iYXInCiAgICAgICAgICAgIGxhc3RDb21tb25TZXAgPSBpOwogICAgICAgICAgfSBlbHNlIGlmIChpID09PSAwKSB7CiAgICAgICAgICAgIC8vIFdlIGdldCBoZXJlIGlmIGB0b2AgaXMgdGhlIHJvb3QuCiAgICAgICAgICAgIC8vIEZvciBleGFtcGxlOiBmcm9tPScvZm9vJzsgdG89Jy8nCiAgICAgICAgICAgIGxhc3RDb21tb25TZXAgPSAwOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgfQogICAgICB2YXIgZnJvbUNvZGUgPSBmcm9tLmNoYXJDb2RlQXQoZnJvbVN0YXJ0ICsgaSk7CiAgICAgIHZhciB0b0NvZGUgPSB0by5jaGFyQ29kZUF0KHRvU3RhcnQgKyBpKTsKICAgICAgaWYgKGZyb21Db2RlICE9PSB0b0NvZGUpCiAgICAgICAgYnJlYWs7CiAgICAgIGVsc2UgaWYgKGZyb21Db2RlID09PSA0NyAvKi8qLykKICAgICAgICBsYXN0Q29tbW9uU2VwID0gaTsKICAgIH0KCiAgICB2YXIgb3V0ID0gJyc7CiAgICAvLyBHZW5lcmF0ZSB0aGUgcmVsYXRpdmUgcGF0aCBiYXNlZCBvbiB0aGUgcGF0aCBkaWZmZXJlbmNlIGJldHdlZW4gYHRvYAogICAgLy8gYW5kIGBmcm9tYAogICAgZm9yIChpID0gZnJvbVN0YXJ0ICsgbGFzdENvbW1vblNlcCArIDE7IGkgPD0gZnJvbUVuZDsgKytpKSB7CiAgICAgIGlmIChpID09PSBmcm9tRW5kIHx8IGZyb20uY2hhckNvZGVBdChpKSA9PT0gNDcgLyovKi8pIHsKICAgICAgICBpZiAob3V0Lmxlbmd0aCA9PT0gMCkKICAgICAgICAgIG91dCArPSAnLi4nOwogICAgICAgIGVsc2UKICAgICAgICAgIG91dCArPSAnLy4uJzsKICAgICAgfQogICAgfQoKICAgIC8vIExhc3RseSwgYXBwZW5kIHRoZSByZXN0IG9mIHRoZSBkZXN0aW5hdGlvbiAoYHRvYCkgcGF0aCB0aGF0IGNvbWVzIGFmdGVyCiAgICAvLyB0aGUgY29tbW9uIHBhdGggcGFydHMKICAgIGlmIChvdXQubGVuZ3RoID4gMCkKICAgICAgcmV0dXJuIG91dCArIHRvLnNsaWNlKHRvU3RhcnQgKyBsYXN0Q29tbW9uU2VwKTsKICAgIGVsc2UgewogICAgICB0b1N0YXJ0ICs9IGxhc3RDb21tb25TZXA7CiAgICAgIGlmICh0by5jaGFyQ29kZUF0KHRvU3RhcnQpID09PSA0NyAvKi8qLykKICAgICAgICArK3RvU3RhcnQ7CiAgICAgIHJldHVybiB0by5zbGljZSh0b1N0YXJ0KTsKICAgIH0KICB9LAoKICBfbWFrZUxvbmc6IGZ1bmN0aW9uIF9tYWtlTG9uZyhwYXRoKSB7CiAgICByZXR1cm4gcGF0aDsKICB9LAoKICBkaXJuYW1lOiBmdW5jdGlvbiBkaXJuYW1lKHBhdGgpIHsKICAgIGFzc2VydFBhdGgocGF0aCk7CiAgICBpZiAocGF0aC5sZW5ndGggPT09IDApIHJldHVybiAnLic7CiAgICB2YXIgY29kZSA9IHBhdGguY2hhckNvZGVBdCgwKTsKICAgIHZhciBoYXNSb290ID0gY29kZSA9PT0gNDcgLyovKi87CiAgICB2YXIgZW5kID0gLTE7CiAgICB2YXIgbWF0Y2hlZFNsYXNoID0gdHJ1ZTsKICAgIGZvciAodmFyIGkgPSBwYXRoLmxlbmd0aCAtIDE7IGkgPj0gMTsgLS1pKSB7CiAgICAgIGNvZGUgPSBwYXRoLmNoYXJDb2RlQXQoaSk7CiAgICAgIGlmIChjb2RlID09PSA0NyAvKi8qLykgewogICAgICAgICAgaWYgKCFtYXRjaGVkU2xhc2gpIHsKICAgICAgICAgICAgZW5kID0gaTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBXZSBzYXcgdGhlIGZpcnN0IG5vbi1wYXRoIHNlcGFyYXRvcgogICAgICAgIG1hdGNoZWRTbGFzaCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogICAgaWYgKGVuZCA9PT0gLTEpIHJldHVybiBoYXNSb290ID8gJy8nIDogJy4nOwogICAgaWYgKGhhc1Jvb3QgJiYgZW5kID09PSAxKSByZXR1cm4gJy8vJzsKICAgIHJldHVybiBwYXRoLnNsaWNlKDAsIGVuZCk7CiAgfSwKCiAgYmFzZW5hbWU6IGZ1bmN0aW9uIGJhc2VuYW1lKHBhdGgsIGV4dCkgewogICAgaWYgKGV4dCAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBleHQgIT09ICdzdHJpbmcnKSB0aHJvdyBuZXcgVHlwZUVycm9yKCciZXh0IiBhcmd1bWVudCBtdXN0IGJlIGEgc3RyaW5nJyk7CiAgICBhc3NlcnRQYXRoKHBhdGgpOwoKICAgIHZhciBzdGFydCA9IDA7CiAgICB2YXIgZW5kID0gLTE7CiAgICB2YXIgbWF0Y2hlZFNsYXNoID0gdHJ1ZTsKICAgIHZhciBpOwoKICAgIGlmIChleHQgIT09IHVuZGVmaW5lZCAmJiBleHQubGVuZ3RoID4gMCAmJiBleHQubGVuZ3RoIDw9IHBhdGgubGVuZ3RoKSB7CiAgICAgIGlmIChleHQubGVuZ3RoID09PSBwYXRoLmxlbmd0aCAmJiBleHQgPT09IHBhdGgpIHJldHVybiAnJzsKICAgICAgdmFyIGV4dElkeCA9IGV4dC5sZW5ndGggLSAxOwogICAgICB2YXIgZmlyc3ROb25TbGFzaEVuZCA9IC0xOwogICAgICBmb3IgKGkgPSBwYXRoLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgdmFyIGNvZGUgPSBwYXRoLmNoYXJDb2RlQXQoaSk7CiAgICAgICAgaWYgKGNvZGUgPT09IDQ3IC8qLyovKSB7CiAgICAgICAgICAgIC8vIElmIHdlIHJlYWNoZWQgYSBwYXRoIHNlcGFyYXRvciB0aGF0IHdhcyBub3QgcGFydCBvZiBhIHNldCBvZiBwYXRoCiAgICAgICAgICAgIC8vIHNlcGFyYXRvcnMgYXQgdGhlIGVuZCBvZiB0aGUgc3RyaW5nLCBzdG9wIG5vdwogICAgICAgICAgICBpZiAoIW1hdGNoZWRTbGFzaCkgewogICAgICAgICAgICAgIHN0YXJ0ID0gaSArIDE7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoZmlyc3ROb25TbGFzaEVuZCA9PT0gLTEpIHsKICAgICAgICAgICAgLy8gV2Ugc2F3IHRoZSBmaXJzdCBub24tcGF0aCBzZXBhcmF0b3IsIHJlbWVtYmVyIHRoaXMgaW5kZXggaW4gY2FzZQogICAgICAgICAgICAvLyB3ZSBuZWVkIGl0IGlmIHRoZSBleHRlbnNpb24gZW5kcyB1cCBub3QgbWF0Y2hpbmcKICAgICAgICAgICAgbWF0Y2hlZFNsYXNoID0gZmFsc2U7CiAgICAgICAgICAgIGZpcnN0Tm9uU2xhc2hFbmQgPSBpICsgMTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChleHRJZHggPj0gMCkgewogICAgICAgICAgICAvLyBUcnkgdG8gbWF0Y2ggdGhlIGV4cGxpY2l0IGV4dGVuc2lvbgogICAgICAgICAgICBpZiAoY29kZSA9PT0gZXh0LmNoYXJDb2RlQXQoZXh0SWR4KSkgewogICAgICAgICAgICAgIGlmICgtLWV4dElkeCA9PT0gLTEpIHsKICAgICAgICAgICAgICAgIC8vIFdlIG1hdGNoZWQgdGhlIGV4dGVuc2lvbiwgc28gbWFyayB0aGlzIGFzIHRoZSBlbmQgb2Ygb3VyIHBhdGgKICAgICAgICAgICAgICAgIC8vIGNvbXBvbmVudAogICAgICAgICAgICAgICAgZW5kID0gaTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gRXh0ZW5zaW9uIGRvZXMgbm90IG1hdGNoLCBzbyBvdXIgcmVzdWx0IGlzIHRoZSBlbnRpcmUgcGF0aAogICAgICAgICAgICAgIC8vIGNvbXBvbmVudAogICAgICAgICAgICAgIGV4dElkeCA9IC0xOwogICAgICAgICAgICAgIGVuZCA9IGZpcnN0Tm9uU2xhc2hFbmQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChzdGFydCA9PT0gZW5kKSBlbmQgPSBmaXJzdE5vblNsYXNoRW5kO2Vsc2UgaWYgKGVuZCA9PT0gLTEpIGVuZCA9IHBhdGgubGVuZ3RoOwogICAgICByZXR1cm4gcGF0aC5zbGljZShzdGFydCwgZW5kKTsKICAgIH0gZWxzZSB7CiAgICAgIGZvciAoaSA9IHBhdGgubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgICBpZiAocGF0aC5jaGFyQ29kZUF0KGkpID09PSA0NyAvKi8qLykgewogICAgICAgICAgICAvLyBJZiB3ZSByZWFjaGVkIGEgcGF0aCBzZXBhcmF0b3IgdGhhdCB3YXMgbm90IHBhcnQgb2YgYSBzZXQgb2YgcGF0aAogICAgICAgICAgICAvLyBzZXBhcmF0b3JzIGF0IHRoZSBlbmQgb2YgdGhlIHN0cmluZywgc3RvcCBub3cKICAgICAgICAgICAgaWYgKCFtYXRjaGVkU2xhc2gpIHsKICAgICAgICAgICAgICBzdGFydCA9IGkgKyAxOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKGVuZCA9PT0gLTEpIHsKICAgICAgICAgIC8vIFdlIHNhdyB0aGUgZmlyc3Qgbm9uLXBhdGggc2VwYXJhdG9yLCBtYXJrIHRoaXMgYXMgdGhlIGVuZCBvZiBvdXIKICAgICAgICAgIC8vIHBhdGggY29tcG9uZW50CiAgICAgICAgICBtYXRjaGVkU2xhc2ggPSBmYWxzZTsKICAgICAgICAgIGVuZCA9IGkgKyAxOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGVuZCA9PT0gLTEpIHJldHVybiAnJzsKICAgICAgcmV0dXJuIHBhdGguc2xpY2Uoc3RhcnQsIGVuZCk7CiAgICB9CiAgfSwKCiAgZXh0bmFtZTogZnVuY3Rpb24gZXh0bmFtZShwYXRoKSB7CiAgICBhc3NlcnRQYXRoKHBhdGgpOwogICAgdmFyIHN0YXJ0RG90ID0gLTE7CiAgICB2YXIgc3RhcnRQYXJ0ID0gMDsKICAgIHZhciBlbmQgPSAtMTsKICAgIHZhciBtYXRjaGVkU2xhc2ggPSB0cnVlOwogICAgLy8gVHJhY2sgdGhlIHN0YXRlIG9mIGNoYXJhY3RlcnMgKGlmIGFueSkgd2Ugc2VlIGJlZm9yZSBvdXIgZmlyc3QgZG90IGFuZAogICAgLy8gYWZ0ZXIgYW55IHBhdGggc2VwYXJhdG9yIHdlIGZpbmQKICAgIHZhciBwcmVEb3RTdGF0ZSA9IDA7CiAgICBmb3IgKHZhciBpID0gcGF0aC5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewogICAgICB2YXIgY29kZSA9IHBhdGguY2hhckNvZGVBdChpKTsKICAgICAgaWYgKGNvZGUgPT09IDQ3IC8qLyovKSB7CiAgICAgICAgICAvLyBJZiB3ZSByZWFjaGVkIGEgcGF0aCBzZXBhcmF0b3IgdGhhdCB3YXMgbm90IHBhcnQgb2YgYSBzZXQgb2YgcGF0aAogICAgICAgICAgLy8gc2VwYXJhdG9ycyBhdCB0aGUgZW5kIG9mIHRoZSBzdHJpbmcsIHN0b3Agbm93CiAgICAgICAgICBpZiAoIW1hdGNoZWRTbGFzaCkgewogICAgICAgICAgICBzdGFydFBhcnQgPSBpICsgMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgIGlmIChlbmQgPT09IC0xKSB7CiAgICAgICAgLy8gV2Ugc2F3IHRoZSBmaXJzdCBub24tcGF0aCBzZXBhcmF0b3IsIG1hcmsgdGhpcyBhcyB0aGUgZW5kIG9mIG91cgogICAgICAgIC8vIGV4dGVuc2lvbgogICAgICAgIG1hdGNoZWRTbGFzaCA9IGZhbHNlOwogICAgICAgIGVuZCA9IGkgKyAxOwogICAgICB9CiAgICAgIGlmIChjb2RlID09PSA0NiAvKi4qLykgewogICAgICAgICAgLy8gSWYgdGhpcyBpcyBvdXIgZmlyc3QgZG90LCBtYXJrIGl0IGFzIHRoZSBzdGFydCBvZiBvdXIgZXh0ZW5zaW9uCiAgICAgICAgICBpZiAoc3RhcnREb3QgPT09IC0xKQogICAgICAgICAgICBzdGFydERvdCA9IGk7CiAgICAgICAgICBlbHNlIGlmIChwcmVEb3RTdGF0ZSAhPT0gMSkKICAgICAgICAgICAgcHJlRG90U3RhdGUgPSAxOwogICAgICB9IGVsc2UgaWYgKHN0YXJ0RG90ICE9PSAtMSkgewogICAgICAgIC8vIFdlIHNhdyBhIG5vbi1kb3QgYW5kIG5vbi1wYXRoIHNlcGFyYXRvciBiZWZvcmUgb3VyIGRvdCwgc28gd2Ugc2hvdWxkCiAgICAgICAgLy8gaGF2ZSBhIGdvb2QgY2hhbmNlIGF0IGhhdmluZyBhIG5vbi1lbXB0eSBleHRlbnNpb24KICAgICAgICBwcmVEb3RTdGF0ZSA9IC0xOwogICAgICB9CiAgICB9CgogICAgaWYgKHN0YXJ0RG90ID09PSAtMSB8fCBlbmQgPT09IC0xIHx8CiAgICAgICAgLy8gV2Ugc2F3IGEgbm9uLWRvdCBjaGFyYWN0ZXIgaW1tZWRpYXRlbHkgYmVmb3JlIHRoZSBkb3QKICAgICAgICBwcmVEb3RTdGF0ZSA9PT0gMCB8fAogICAgICAgIC8vIFRoZSAocmlnaHQtbW9zdCkgdHJpbW1lZCBwYXRoIGNvbXBvbmVudCBpcyBleGFjdGx5ICcuLicKICAgICAgICBwcmVEb3RTdGF0ZSA9PT0gMSAmJiBzdGFydERvdCA9PT0gZW5kIC0gMSAmJiBzdGFydERvdCA9PT0gc3RhcnRQYXJ0ICsgMSkgewogICAgICByZXR1cm4gJyc7CiAgICB9CiAgICByZXR1cm4gcGF0aC5zbGljZShzdGFydERvdCwgZW5kKTsKICB9LAoKICBmb3JtYXQ6IGZ1bmN0aW9uIGZvcm1hdChwYXRoT2JqZWN0KSB7CiAgICBpZiAocGF0aE9iamVjdCA9PT0gbnVsbCB8fCB0eXBlb2YgcGF0aE9iamVjdCAhPT0gJ29iamVjdCcpIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVGhlICJwYXRoT2JqZWN0IiBhcmd1bWVudCBtdXN0IGJlIG9mIHR5cGUgT2JqZWN0LiBSZWNlaXZlZCB0eXBlICcgKyB0eXBlb2YgcGF0aE9iamVjdCk7CiAgICB9CiAgICByZXR1cm4gX2Zvcm1hdCgnLycsIHBhdGhPYmplY3QpOwogIH0sCgogIHBhcnNlOiBmdW5jdGlvbiBwYXJzZShwYXRoKSB7CiAgICBhc3NlcnRQYXRoKHBhdGgpOwoKICAgIHZhciByZXQgPSB7IHJvb3Q6ICcnLCBkaXI6ICcnLCBiYXNlOiAnJywgZXh0OiAnJywgbmFtZTogJycgfTsKICAgIGlmIChwYXRoLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHJldDsKICAgIHZhciBjb2RlID0gcGF0aC5jaGFyQ29kZUF0KDApOwogICAgdmFyIGlzQWJzb2x1dGUgPSBjb2RlID09PSA0NyAvKi8qLzsKICAgIHZhciBzdGFydDsKICAgIGlmIChpc0Fic29sdXRlKSB7CiAgICAgIHJldC5yb290ID0gJy8nOwogICAgICBzdGFydCA9IDE7CiAgICB9IGVsc2UgewogICAgICBzdGFydCA9IDA7CiAgICB9CiAgICB2YXIgc3RhcnREb3QgPSAtMTsKICAgIHZhciBzdGFydFBhcnQgPSAwOwogICAgdmFyIGVuZCA9IC0xOwogICAgdmFyIG1hdGNoZWRTbGFzaCA9IHRydWU7CiAgICB2YXIgaSA9IHBhdGgubGVuZ3RoIC0gMTsKCiAgICAvLyBUcmFjayB0aGUgc3RhdGUgb2YgY2hhcmFjdGVycyAoaWYgYW55KSB3ZSBzZWUgYmVmb3JlIG91ciBmaXJzdCBkb3QgYW5kCiAgICAvLyBhZnRlciBhbnkgcGF0aCBzZXBhcmF0b3Igd2UgZmluZAogICAgdmFyIHByZURvdFN0YXRlID0gMDsKCiAgICAvLyBHZXQgbm9uLWRpciBpbmZvCiAgICBmb3IgKDsgaSA+PSBzdGFydDsgLS1pKSB7CiAgICAgIGNvZGUgPSBwYXRoLmNoYXJDb2RlQXQoaSk7CiAgICAgIGlmIChjb2RlID09PSA0NyAvKi8qLykgewogICAgICAgICAgLy8gSWYgd2UgcmVhY2hlZCBhIHBhdGggc2VwYXJhdG9yIHRoYXQgd2FzIG5vdCBwYXJ0IG9mIGEgc2V0IG9mIHBhdGgKICAgICAgICAgIC8vIHNlcGFyYXRvcnMgYXQgdGhlIGVuZCBvZiB0aGUgc3RyaW5nLCBzdG9wIG5vdwogICAgICAgICAgaWYgKCFtYXRjaGVkU2xhc2gpIHsKICAgICAgICAgICAgc3RhcnRQYXJ0ID0gaSArIDE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICBpZiAoZW5kID09PSAtMSkgewogICAgICAgIC8vIFdlIHNhdyB0aGUgZmlyc3Qgbm9uLXBhdGggc2VwYXJhdG9yLCBtYXJrIHRoaXMgYXMgdGhlIGVuZCBvZiBvdXIKICAgICAgICAvLyBleHRlbnNpb24KICAgICAgICBtYXRjaGVkU2xhc2ggPSBmYWxzZTsKICAgICAgICBlbmQgPSBpICsgMTsKICAgICAgfQogICAgICBpZiAoY29kZSA9PT0gNDYgLyouKi8pIHsKICAgICAgICAgIC8vIElmIHRoaXMgaXMgb3VyIGZpcnN0IGRvdCwgbWFyayBpdCBhcyB0aGUgc3RhcnQgb2Ygb3VyIGV4dGVuc2lvbgogICAgICAgICAgaWYgKHN0YXJ0RG90ID09PSAtMSkgc3RhcnREb3QgPSBpO2Vsc2UgaWYgKHByZURvdFN0YXRlICE9PSAxKSBwcmVEb3RTdGF0ZSA9IDE7CiAgICAgICAgfSBlbHNlIGlmIChzdGFydERvdCAhPT0gLTEpIHsKICAgICAgICAvLyBXZSBzYXcgYSBub24tZG90IGFuZCBub24tcGF0aCBzZXBhcmF0b3IgYmVmb3JlIG91ciBkb3QsIHNvIHdlIHNob3VsZAogICAgICAgIC8vIGhhdmUgYSBnb29kIGNoYW5jZSBhdCBoYXZpbmcgYSBub24tZW1wdHkgZXh0ZW5zaW9uCiAgICAgICAgcHJlRG90U3RhdGUgPSAtMTsKICAgICAgfQogICAgfQoKICAgIGlmIChzdGFydERvdCA9PT0gLTEgfHwgZW5kID09PSAtMSB8fAogICAgLy8gV2Ugc2F3IGEgbm9uLWRvdCBjaGFyYWN0ZXIgaW1tZWRpYXRlbHkgYmVmb3JlIHRoZSBkb3QKICAgIHByZURvdFN0YXRlID09PSAwIHx8CiAgICAvLyBUaGUgKHJpZ2h0LW1vc3QpIHRyaW1tZWQgcGF0aCBjb21wb25lbnQgaXMgZXhhY3RseSAnLi4nCiAgICBwcmVEb3RTdGF0ZSA9PT0gMSAmJiBzdGFydERvdCA9PT0gZW5kIC0gMSAmJiBzdGFydERvdCA9PT0gc3RhcnRQYXJ0ICsgMSkgewogICAgICBpZiAoZW5kICE9PSAtMSkgewogICAgICAgIGlmIChzdGFydFBhcnQgPT09IDAgJiYgaXNBYnNvbHV0ZSkgcmV0LmJhc2UgPSByZXQubmFtZSA9IHBhdGguc2xpY2UoMSwgZW5kKTtlbHNlIHJldC5iYXNlID0gcmV0Lm5hbWUgPSBwYXRoLnNsaWNlKHN0YXJ0UGFydCwgZW5kKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgaWYgKHN0YXJ0UGFydCA9PT0gMCAmJiBpc0Fic29sdXRlKSB7CiAgICAgICAgcmV0Lm5hbWUgPSBwYXRoLnNsaWNlKDEsIHN0YXJ0RG90KTsKICAgICAgICByZXQuYmFzZSA9IHBhdGguc2xpY2UoMSwgZW5kKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXQubmFtZSA9IHBhdGguc2xpY2Uoc3RhcnRQYXJ0LCBzdGFydERvdCk7CiAgICAgICAgcmV0LmJhc2UgPSBwYXRoLnNsaWNlKHN0YXJ0UGFydCwgZW5kKTsKICAgICAgfQogICAgICByZXQuZXh0ID0gcGF0aC5zbGljZShzdGFydERvdCwgZW5kKTsKICAgIH0KCiAgICBpZiAoc3RhcnRQYXJ0ID4gMCkgcmV0LmRpciA9IHBhdGguc2xpY2UoMCwgc3RhcnRQYXJ0IC0gMSk7ZWxzZSBpZiAoaXNBYnNvbHV0ZSkgcmV0LmRpciA9ICcvJzsKCiAgICByZXR1cm4gcmV0OwogIH0sCgogIHNlcDogJy8nLAogIGRlbGltaXRlcjogJzonLAogIHdpbjMyOiBudWxsLAogIHBvc2l4OiBudWxsCn07Cgpwb3NpeC5wb3NpeCA9IHBvc2l4OwoKbW9kdWxlLmV4cG9ydHMgPSBwb3NpeDsKCn0pLmNhbGwodGhpcyl9KS5jYWxsKHRoaXMscmVxdWlyZSgnX3Byb2Nlc3MnKSkKfSx7Il9wcm9jZXNzIjozOH1dLDM4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gc2hpbSBmb3IgdXNpbmcgcHJvY2VzcyBpbiBicm93c2VyCnZhciBwcm9jZXNzID0gbW9kdWxlLmV4cG9ydHMgPSB7fTsKCi8vIGNhY2hlZCBmcm9tIHdoYXRldmVyIGdsb2JhbCBpcyBwcmVzZW50IHNvIHRoYXQgdGVzdCBydW5uZXJzIHRoYXQgc3R1YiBpdAovLyBkb24ndCBicmVhayB0aGluZ3MuICBCdXQgd2UgbmVlZCB0byB3cmFwIGl0IGluIGEgdHJ5IGNhdGNoIGluIGNhc2UgaXQgaXMKLy8gd3JhcHBlZCBpbiBzdHJpY3QgbW9kZSBjb2RlIHdoaWNoIGRvZXNuJ3QgZGVmaW5lIGFueSBnbG9iYWxzLiAgSXQncyBpbnNpZGUgYQovLyBmdW5jdGlvbiBiZWNhdXNlIHRyeS9jYXRjaGVzIGRlb3B0aW1pemUgaW4gY2VydGFpbiBlbmdpbmVzLgoKdmFyIGNhY2hlZFNldFRpbWVvdXQ7CnZhciBjYWNoZWRDbGVhclRpbWVvdXQ7CgpmdW5jdGlvbiBkZWZhdWx0U2V0VGltb3V0KCkgewogICAgdGhyb3cgbmV3IEVycm9yKCdzZXRUaW1lb3V0IGhhcyBub3QgYmVlbiBkZWZpbmVkJyk7Cn0KZnVuY3Rpb24gZGVmYXVsdENsZWFyVGltZW91dCAoKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ2NsZWFyVGltZW91dCBoYXMgbm90IGJlZW4gZGVmaW5lZCcpOwp9CihmdW5jdGlvbiAoKSB7CiAgICB0cnkgewogICAgICAgIGlmICh0eXBlb2Ygc2V0VGltZW91dCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBjYWNoZWRTZXRUaW1lb3V0ID0gc2V0VGltZW91dDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjYWNoZWRTZXRUaW1lb3V0ID0gZGVmYXVsdFNldFRpbW91dDsKICAgICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY2FjaGVkU2V0VGltZW91dCA9IGRlZmF1bHRTZXRUaW1vdXQ7CiAgICB9CiAgICB0cnkgewogICAgICAgIGlmICh0eXBlb2YgY2xlYXJUaW1lb3V0ID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGNsZWFyVGltZW91dDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjYWNoZWRDbGVhclRpbWVvdXQgPSBkZWZhdWx0Q2xlYXJUaW1lb3V0OwogICAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjYWNoZWRDbGVhclRpbWVvdXQgPSBkZWZhdWx0Q2xlYXJUaW1lb3V0OwogICAgfQp9ICgpKQpmdW5jdGlvbiBydW5UaW1lb3V0KGZ1bikgewogICAgaWYgKGNhY2hlZFNldFRpbWVvdXQgPT09IHNldFRpbWVvdXQpIHsKICAgICAgICAvL25vcm1hbCBlbnZpcm9tZW50cyBpbiBzYW5lIHNpdHVhdGlvbnMKICAgICAgICByZXR1cm4gc2V0VGltZW91dChmdW4sIDApOwogICAgfQogICAgLy8gaWYgc2V0VGltZW91dCB3YXNuJ3QgYXZhaWxhYmxlIGJ1dCB3YXMgbGF0dGVyIGRlZmluZWQKICAgIGlmICgoY2FjaGVkU2V0VGltZW91dCA9PT0gZGVmYXVsdFNldFRpbW91dCB8fCAhY2FjaGVkU2V0VGltZW91dCkgJiYgc2V0VGltZW91dCkgewogICAgICAgIGNhY2hlZFNldFRpbWVvdXQgPSBzZXRUaW1lb3V0OwogICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1biwgMCk7CiAgICB9CiAgICB0cnkgewogICAgICAgIC8vIHdoZW4gd2hlbiBzb21lYm9keSBoYXMgc2NyZXdlZCB3aXRoIHNldFRpbWVvdXQgYnV0IG5vIEkuRS4gbWFkZG5lc3MKICAgICAgICByZXR1cm4gY2FjaGVkU2V0VGltZW91dChmdW4sIDApOwogICAgfSBjYXRjaChlKXsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBXaGVuIHdlIGFyZSBpbiBJLkUuIGJ1dCB0aGUgc2NyaXB0IGhhcyBiZWVuIGV2YWxlZCBzbyBJLkUuIGRvZXNuJ3QgdHJ1c3QgdGhlIGdsb2JhbCBvYmplY3Qgd2hlbiBjYWxsZWQgbm9ybWFsbHkKICAgICAgICAgICAgcmV0dXJuIGNhY2hlZFNldFRpbWVvdXQuY2FsbChudWxsLCBmdW4sIDApOwogICAgICAgIH0gY2F0Y2goZSl7CiAgICAgICAgICAgIC8vIHNhbWUgYXMgYWJvdmUgYnV0IHdoZW4gaXQncyBhIHZlcnNpb24gb2YgSS5FLiB0aGF0IG11c3QgaGF2ZSB0aGUgZ2xvYmFsIG9iamVjdCBmb3IgJ3RoaXMnLCBob3BmdWxseSBvdXIgY29udGV4dCBjb3JyZWN0IG90aGVyd2lzZSBpdCB3aWxsIHRocm93IGEgZ2xvYmFsIGVycm9yCiAgICAgICAgICAgIHJldHVybiBjYWNoZWRTZXRUaW1lb3V0LmNhbGwodGhpcywgZnVuLCAwKTsKICAgICAgICB9CiAgICB9CgoKfQpmdW5jdGlvbiBydW5DbGVhclRpbWVvdXQobWFya2VyKSB7CiAgICBpZiAoY2FjaGVkQ2xlYXJUaW1lb3V0ID09PSBjbGVhclRpbWVvdXQpIHsKICAgICAgICAvL25vcm1hbCBlbnZpcm9tZW50cyBpbiBzYW5lIHNpdHVhdGlvbnMKICAgICAgICByZXR1cm4gY2xlYXJUaW1lb3V0KG1hcmtlcik7CiAgICB9CiAgICAvLyBpZiBjbGVhclRpbWVvdXQgd2Fzbid0IGF2YWlsYWJsZSBidXQgd2FzIGxhdHRlciBkZWZpbmVkCiAgICBpZiAoKGNhY2hlZENsZWFyVGltZW91dCA9PT0gZGVmYXVsdENsZWFyVGltZW91dCB8fCAhY2FjaGVkQ2xlYXJUaW1lb3V0KSAmJiBjbGVhclRpbWVvdXQpIHsKICAgICAgICBjYWNoZWRDbGVhclRpbWVvdXQgPSBjbGVhclRpbWVvdXQ7CiAgICAgICAgcmV0dXJuIGNsZWFyVGltZW91dChtYXJrZXIpOwogICAgfQogICAgdHJ5IHsKICAgICAgICAvLyB3aGVuIHdoZW4gc29tZWJvZHkgaGFzIHNjcmV3ZWQgd2l0aCBzZXRUaW1lb3V0IGJ1dCBubyBJLkUuIG1hZGRuZXNzCiAgICAgICAgcmV0dXJuIGNhY2hlZENsZWFyVGltZW91dChtYXJrZXIpOwogICAgfSBjYXRjaCAoZSl7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gV2hlbiB3ZSBhcmUgaW4gSS5FLiBidXQgdGhlIHNjcmlwdCBoYXMgYmVlbiBldmFsZWQgc28gSS5FLiBkb2Vzbid0ICB0cnVzdCB0aGUgZ2xvYmFsIG9iamVjdCB3aGVuIGNhbGxlZCBub3JtYWxseQogICAgICAgICAgICByZXR1cm4gY2FjaGVkQ2xlYXJUaW1lb3V0LmNhbGwobnVsbCwgbWFya2VyKTsKICAgICAgICB9IGNhdGNoIChlKXsKICAgICAgICAgICAgLy8gc2FtZSBhcyBhYm92ZSBidXQgd2hlbiBpdCdzIGEgdmVyc2lvbiBvZiBJLkUuIHRoYXQgbXVzdCBoYXZlIHRoZSBnbG9iYWwgb2JqZWN0IGZvciAndGhpcycsIGhvcGZ1bGx5IG91ciBjb250ZXh0IGNvcnJlY3Qgb3RoZXJ3aXNlIGl0IHdpbGwgdGhyb3cgYSBnbG9iYWwgZXJyb3IuCiAgICAgICAgICAgIC8vIFNvbWUgdmVyc2lvbnMgb2YgSS5FLiBoYXZlIGRpZmZlcmVudCBydWxlcyBmb3IgY2xlYXJUaW1lb3V0IHZzIHNldFRpbWVvdXQKICAgICAgICAgICAgcmV0dXJuIGNhY2hlZENsZWFyVGltZW91dC5jYWxsKHRoaXMsIG1hcmtlcik7CiAgICAgICAgfQogICAgfQoKCgp9CnZhciBxdWV1ZSA9IFtdOwp2YXIgZHJhaW5pbmcgPSBmYWxzZTsKdmFyIGN1cnJlbnRRdWV1ZTsKdmFyIHF1ZXVlSW5kZXggPSAtMTsKCmZ1bmN0aW9uIGNsZWFuVXBOZXh0VGljaygpIHsKICAgIGlmICghZHJhaW5pbmcgfHwgIWN1cnJlbnRRdWV1ZSkgewogICAgICAgIHJldHVybjsKICAgIH0KICAgIGRyYWluaW5nID0gZmFsc2U7CiAgICBpZiAoY3VycmVudFF1ZXVlLmxlbmd0aCkgewogICAgICAgIHF1ZXVlID0gY3VycmVudFF1ZXVlLmNvbmNhdChxdWV1ZSk7CiAgICB9IGVsc2UgewogICAgICAgIHF1ZXVlSW5kZXggPSAtMTsKICAgIH0KICAgIGlmIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgICBkcmFpblF1ZXVlKCk7CiAgICB9Cn0KCmZ1bmN0aW9uIGRyYWluUXVldWUoKSB7CiAgICBpZiAoZHJhaW5pbmcpIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICB2YXIgdGltZW91dCA9IHJ1blRpbWVvdXQoY2xlYW5VcE5leHRUaWNrKTsKICAgIGRyYWluaW5nID0gdHJ1ZTsKCiAgICB2YXIgbGVuID0gcXVldWUubGVuZ3RoOwogICAgd2hpbGUobGVuKSB7CiAgICAgICAgY3VycmVudFF1ZXVlID0gcXVldWU7CiAgICAgICAgcXVldWUgPSBbXTsKICAgICAgICB3aGlsZSAoKytxdWV1ZUluZGV4IDwgbGVuKSB7CiAgICAgICAgICAgIGlmIChjdXJyZW50UXVldWUpIHsKICAgICAgICAgICAgICAgIGN1cnJlbnRRdWV1ZVtxdWV1ZUluZGV4XS5ydW4oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBxdWV1ZUluZGV4ID0gLTE7CiAgICAgICAgbGVuID0gcXVldWUubGVuZ3RoOwogICAgfQogICAgY3VycmVudFF1ZXVlID0gbnVsbDsKICAgIGRyYWluaW5nID0gZmFsc2U7CiAgICBydW5DbGVhclRpbWVvdXQodGltZW91dCk7Cn0KCnByb2Nlc3MubmV4dFRpY2sgPSBmdW5jdGlvbiAoZnVuKSB7CiAgICB2YXIgYXJncyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSk7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHsKICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBhcmdzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTsKICAgICAgICB9CiAgICB9CiAgICBxdWV1ZS5wdXNoKG5ldyBJdGVtKGZ1biwgYXJncykpOwogICAgaWYgKHF1ZXVlLmxlbmd0aCA9PT0gMSAmJiAhZHJhaW5pbmcpIHsKICAgICAgICBydW5UaW1lb3V0KGRyYWluUXVldWUpOwogICAgfQp9OwoKLy8gdjggbGlrZXMgcHJlZGljdGlibGUgb2JqZWN0cwpmdW5jdGlvbiBJdGVtKGZ1biwgYXJyYXkpIHsKICAgIHRoaXMuZnVuID0gZnVuOwogICAgdGhpcy5hcnJheSA9IGFycmF5Owp9Ckl0ZW0ucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZnVuLmFwcGx5KG51bGwsIHRoaXMuYXJyYXkpOwp9Owpwcm9jZXNzLnRpdGxlID0gJ2Jyb3dzZXInOwpwcm9jZXNzLmJyb3dzZXIgPSB0cnVlOwpwcm9jZXNzLmVudiA9IHt9Owpwcm9jZXNzLmFyZ3YgPSBbXTsKcHJvY2Vzcy52ZXJzaW9uID0gJyc7IC8vIGVtcHR5IHN0cmluZyB0byBhdm9pZCByZWdleHAgaXNzdWVzCnByb2Nlc3MudmVyc2lvbnMgPSB7fTsKCmZ1bmN0aW9uIG5vb3AoKSB7fQoKcHJvY2Vzcy5vbiA9IG5vb3A7CnByb2Nlc3MuYWRkTGlzdGVuZXIgPSBub29wOwpwcm9jZXNzLm9uY2UgPSBub29wOwpwcm9jZXNzLm9mZiA9IG5vb3A7CnByb2Nlc3MucmVtb3ZlTGlzdGVuZXIgPSBub29wOwpwcm9jZXNzLnJlbW92ZUFsbExpc3RlbmVycyA9IG5vb3A7CnByb2Nlc3MuZW1pdCA9IG5vb3A7CnByb2Nlc3MucHJlcGVuZExpc3RlbmVyID0gbm9vcDsKcHJvY2Vzcy5wcmVwZW5kT25jZUxpc3RlbmVyID0gbm9vcDsKCnByb2Nlc3MubGlzdGVuZXJzID0gZnVuY3Rpb24gKG5hbWUpIHsgcmV0dXJuIFtdIH0KCnByb2Nlc3MuYmluZGluZyA9IGZ1bmN0aW9uIChuYW1lKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ3Byb2Nlc3MuYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkJyk7Cn07Cgpwcm9jZXNzLmN3ZCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICcvJyB9Owpwcm9jZXNzLmNoZGlyID0gZnVuY3Rpb24gKGRpcikgewogICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmNoZGlyIGlzIG5vdCBzdXBwb3J0ZWQnKTsKfTsKcHJvY2Vzcy51bWFzayA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gMDsgfTsKCn0se31dLDM5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBpc0J1ZmZlcihhcmcpIHsKICByZXR1cm4gYXJnICYmIHR5cGVvZiBhcmcgPT09ICdvYmplY3QnCiAgICAmJiB0eXBlb2YgYXJnLmNvcHkgPT09ICdmdW5jdGlvbicKICAgICYmIHR5cGVvZiBhcmcuZmlsbCA9PT0gJ2Z1bmN0aW9uJwogICAgJiYgdHlwZW9mIGFyZy5yZWFkVUludDggPT09ICdmdW5jdGlvbic7Cn0KfSx7fV0sNDA6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyBDdXJyZW50bHkgaW4gc3luYyB3aXRoIE5vZGUuanMgbGliL2ludGVybmFsL3V0aWwvdHlwZXMuanMKLy8gaHR0cHM6Ly9naXRodWIuY29tL25vZGVqcy9ub2RlL2NvbW1pdC8xMTJjYzdjMjc1NTEyNTRhYTJiMTcwOThmYjc3NDg2N2YwNWVkMGQ5CgondXNlIHN0cmljdCc7Cgp2YXIgaXNBcmd1bWVudHNPYmplY3QgPSByZXF1aXJlKCdpcy1hcmd1bWVudHMnKTsKdmFyIGlzR2VuZXJhdG9yRnVuY3Rpb24gPSByZXF1aXJlKCdpcy1nZW5lcmF0b3ItZnVuY3Rpb24nKTsKdmFyIHdoaWNoVHlwZWRBcnJheSA9IHJlcXVpcmUoJ3doaWNoLXR5cGVkLWFycmF5Jyk7CnZhciBpc1R5cGVkQXJyYXkgPSByZXF1aXJlKCdpcy10eXBlZC1hcnJheScpOwoKZnVuY3Rpb24gdW5jdXJyeVRoaXMoZikgewogIHJldHVybiBmLmNhbGwuYmluZChmKTsKfQoKdmFyIEJpZ0ludFN1cHBvcnRlZCA9IHR5cGVvZiBCaWdJbnQgIT09ICd1bmRlZmluZWQnOwp2YXIgU3ltYm9sU3VwcG9ydGVkID0gdHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCc7Cgp2YXIgT2JqZWN0VG9TdHJpbmcgPSB1bmN1cnJ5VGhpcyhPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nKTsKCnZhciBudW1iZXJWYWx1ZSA9IHVuY3VycnlUaGlzKE51bWJlci5wcm90b3R5cGUudmFsdWVPZik7CnZhciBzdHJpbmdWYWx1ZSA9IHVuY3VycnlUaGlzKFN0cmluZy5wcm90b3R5cGUudmFsdWVPZik7CnZhciBib29sZWFuVmFsdWUgPSB1bmN1cnJ5VGhpcyhCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mKTsKCmlmIChCaWdJbnRTdXBwb3J0ZWQpIHsKICB2YXIgYmlnSW50VmFsdWUgPSB1bmN1cnJ5VGhpcyhCaWdJbnQucHJvdG90eXBlLnZhbHVlT2YpOwp9CgppZiAoU3ltYm9sU3VwcG9ydGVkKSB7CiAgdmFyIHN5bWJvbFZhbHVlID0gdW5jdXJyeVRoaXMoU3ltYm9sLnByb3RvdHlwZS52YWx1ZU9mKTsKfQoKZnVuY3Rpb24gY2hlY2tCb3hlZFByaW1pdGl2ZSh2YWx1ZSwgcHJvdG90eXBlVmFsdWVPZikgewogIGlmICh0eXBlb2YgdmFsdWUgIT09ICdvYmplY3QnKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIHRyeSB7CiAgICBwcm90b3R5cGVWYWx1ZU9mKHZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0gY2F0Y2goZSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KfQoKZXhwb3J0cy5pc0FyZ3VtZW50c09iamVjdCA9IGlzQXJndW1lbnRzT2JqZWN0OwpleHBvcnRzLmlzR2VuZXJhdG9yRnVuY3Rpb24gPSBpc0dlbmVyYXRvckZ1bmN0aW9uOwpleHBvcnRzLmlzVHlwZWRBcnJheSA9IGlzVHlwZWRBcnJheTsKCi8vIFRha2VuIGZyb20gaGVyZSBhbmQgbW9kaWZpZWQgZm9yIGJldHRlciBicm93c2VyIHN1cHBvcnQKLy8gaHR0cHM6Ly9naXRodWIuY29tL3NpbmRyZXNvcmh1cy9wLWlzLXByb21pc2UvYmxvYi9jZGEzNWE1MTNiZGEwM2Y5NzdhZDVjZGUzYTA3OWQyMzdlODJkN2VmL2luZGV4LmpzCmZ1bmN0aW9uIGlzUHJvbWlzZShpbnB1dCkgewoJcmV0dXJuICgKCQkoCgkJCXR5cGVvZiBQcm9taXNlICE9PSAndW5kZWZpbmVkJyAmJgoJCQlpbnB1dCBpbnN0YW5jZW9mIFByb21pc2UKCQkpIHx8CgkJKAoJCQlpbnB1dCAhPT0gbnVsbCAmJgoJCQl0eXBlb2YgaW5wdXQgPT09ICdvYmplY3QnICYmCgkJCXR5cGVvZiBpbnB1dC50aGVuID09PSAnZnVuY3Rpb24nICYmCgkJCXR5cGVvZiBpbnB1dC5jYXRjaCA9PT0gJ2Z1bmN0aW9uJwoJCSkKCSk7Cn0KZXhwb3J0cy5pc1Byb21pc2UgPSBpc1Byb21pc2U7CgpmdW5jdGlvbiBpc0FycmF5QnVmZmVyVmlldyh2YWx1ZSkgewogIGlmICh0eXBlb2YgQXJyYXlCdWZmZXIgIT09ICd1bmRlZmluZWQnICYmIEFycmF5QnVmZmVyLmlzVmlldykgewogICAgcmV0dXJuIEFycmF5QnVmZmVyLmlzVmlldyh2YWx1ZSk7CiAgfQoKICByZXR1cm4gKAogICAgaXNUeXBlZEFycmF5KHZhbHVlKSB8fAogICAgaXNEYXRhVmlldyh2YWx1ZSkKICApOwp9CmV4cG9ydHMuaXNBcnJheUJ1ZmZlclZpZXcgPSBpc0FycmF5QnVmZmVyVmlldzsKCgpmdW5jdGlvbiBpc1VpbnQ4QXJyYXkodmFsdWUpIHsKICByZXR1cm4gd2hpY2hUeXBlZEFycmF5KHZhbHVlKSA9PT0gJ1VpbnQ4QXJyYXknOwp9CmV4cG9ydHMuaXNVaW50OEFycmF5ID0gaXNVaW50OEFycmF5OwoKZnVuY3Rpb24gaXNVaW50OENsYW1wZWRBcnJheSh2YWx1ZSkgewogIHJldHVybiB3aGljaFR5cGVkQXJyYXkodmFsdWUpID09PSAnVWludDhDbGFtcGVkQXJyYXknOwp9CmV4cG9ydHMuaXNVaW50OENsYW1wZWRBcnJheSA9IGlzVWludDhDbGFtcGVkQXJyYXk7CgpmdW5jdGlvbiBpc1VpbnQxNkFycmF5KHZhbHVlKSB7CiAgcmV0dXJuIHdoaWNoVHlwZWRBcnJheSh2YWx1ZSkgPT09ICdVaW50MTZBcnJheSc7Cn0KZXhwb3J0cy5pc1VpbnQxNkFycmF5ID0gaXNVaW50MTZBcnJheTsKCmZ1bmN0aW9uIGlzVWludDMyQXJyYXkodmFsdWUpIHsKICByZXR1cm4gd2hpY2hUeXBlZEFycmF5KHZhbHVlKSA9PT0gJ1VpbnQzMkFycmF5JzsKfQpleHBvcnRzLmlzVWludDMyQXJyYXkgPSBpc1VpbnQzMkFycmF5OwoKZnVuY3Rpb24gaXNJbnQ4QXJyYXkodmFsdWUpIHsKICByZXR1cm4gd2hpY2hUeXBlZEFycmF5KHZhbHVlKSA9PT0gJ0ludDhBcnJheSc7Cn0KZXhwb3J0cy5pc0ludDhBcnJheSA9IGlzSW50OEFycmF5OwoKZnVuY3Rpb24gaXNJbnQxNkFycmF5KHZhbHVlKSB7CiAgcmV0dXJuIHdoaWNoVHlwZWRBcnJheSh2YWx1ZSkgPT09ICdJbnQxNkFycmF5JzsKfQpleHBvcnRzLmlzSW50MTZBcnJheSA9IGlzSW50MTZBcnJheTsKCmZ1bmN0aW9uIGlzSW50MzJBcnJheSh2YWx1ZSkgewogIHJldHVybiB3aGljaFR5cGVkQXJyYXkodmFsdWUpID09PSAnSW50MzJBcnJheSc7Cn0KZXhwb3J0cy5pc0ludDMyQXJyYXkgPSBpc0ludDMyQXJyYXk7CgpmdW5jdGlvbiBpc0Zsb2F0MzJBcnJheSh2YWx1ZSkgewogIHJldHVybiB3aGljaFR5cGVkQXJyYXkodmFsdWUpID09PSAnRmxvYXQzMkFycmF5JzsKfQpleHBvcnRzLmlzRmxvYXQzMkFycmF5ID0gaXNGbG9hdDMyQXJyYXk7CgpmdW5jdGlvbiBpc0Zsb2F0NjRBcnJheSh2YWx1ZSkgewogIHJldHVybiB3aGljaFR5cGVkQXJyYXkodmFsdWUpID09PSAnRmxvYXQ2NEFycmF5JzsKfQpleHBvcnRzLmlzRmxvYXQ2NEFycmF5ID0gaXNGbG9hdDY0QXJyYXk7CgpmdW5jdGlvbiBpc0JpZ0ludDY0QXJyYXkodmFsdWUpIHsKICByZXR1cm4gd2hpY2hUeXBlZEFycmF5KHZhbHVlKSA9PT0gJ0JpZ0ludDY0QXJyYXknOwp9CmV4cG9ydHMuaXNCaWdJbnQ2NEFycmF5ID0gaXNCaWdJbnQ2NEFycmF5OwoKZnVuY3Rpb24gaXNCaWdVaW50NjRBcnJheSh2YWx1ZSkgewogIHJldHVybiB3aGljaFR5cGVkQXJyYXkodmFsdWUpID09PSAnQmlnVWludDY0QXJyYXknOwp9CmV4cG9ydHMuaXNCaWdVaW50NjRBcnJheSA9IGlzQmlnVWludDY0QXJyYXk7CgpmdW5jdGlvbiBpc01hcFRvU3RyaW5nKHZhbHVlKSB7CiAgcmV0dXJuIE9iamVjdFRvU3RyaW5nKHZhbHVlKSA9PT0gJ1tvYmplY3QgTWFwXSc7Cn0KaXNNYXBUb1N0cmluZy53b3JraW5nID0gKAogIHR5cGVvZiBNYXAgIT09ICd1bmRlZmluZWQnICYmCiAgaXNNYXBUb1N0cmluZyhuZXcgTWFwKCkpCik7CgpmdW5jdGlvbiBpc01hcCh2YWx1ZSkgewogIGlmICh0eXBlb2YgTWFwID09PSAndW5kZWZpbmVkJykgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgcmV0dXJuIGlzTWFwVG9TdHJpbmcud29ya2luZwogICAgPyBpc01hcFRvU3RyaW5nKHZhbHVlKQogICAgOiB2YWx1ZSBpbnN0YW5jZW9mIE1hcDsKfQpleHBvcnRzLmlzTWFwID0gaXNNYXA7CgpmdW5jdGlvbiBpc1NldFRvU3RyaW5nKHZhbHVlKSB7CiAgcmV0dXJuIE9iamVjdFRvU3RyaW5nKHZhbHVlKSA9PT0gJ1tvYmplY3QgU2V0XSc7Cn0KaXNTZXRUb1N0cmluZy53b3JraW5nID0gKAogIHR5cGVvZiBTZXQgIT09ICd1bmRlZmluZWQnICYmCiAgaXNTZXRUb1N0cmluZyhuZXcgU2V0KCkpCik7CmZ1bmN0aW9uIGlzU2V0KHZhbHVlKSB7CiAgaWYgKHR5cGVvZiBTZXQgPT09ICd1bmRlZmluZWQnKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICByZXR1cm4gaXNTZXRUb1N0cmluZy53b3JraW5nCiAgICA/IGlzU2V0VG9TdHJpbmcodmFsdWUpCiAgICA6IHZhbHVlIGluc3RhbmNlb2YgU2V0Owp9CmV4cG9ydHMuaXNTZXQgPSBpc1NldDsKCmZ1bmN0aW9uIGlzV2Vha01hcFRvU3RyaW5nKHZhbHVlKSB7CiAgcmV0dXJuIE9iamVjdFRvU3RyaW5nKHZhbHVlKSA9PT0gJ1tvYmplY3QgV2Vha01hcF0nOwp9CmlzV2Vha01hcFRvU3RyaW5nLndvcmtpbmcgPSAoCiAgdHlwZW9mIFdlYWtNYXAgIT09ICd1bmRlZmluZWQnICYmCiAgaXNXZWFrTWFwVG9TdHJpbmcobmV3IFdlYWtNYXAoKSkKKTsKZnVuY3Rpb24gaXNXZWFrTWFwKHZhbHVlKSB7CiAgaWYgKHR5cGVvZiBXZWFrTWFwID09PSAndW5kZWZpbmVkJykgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgcmV0dXJuIGlzV2Vha01hcFRvU3RyaW5nLndvcmtpbmcKICAgID8gaXNXZWFrTWFwVG9TdHJpbmcodmFsdWUpCiAgICA6IHZhbHVlIGluc3RhbmNlb2YgV2Vha01hcDsKfQpleHBvcnRzLmlzV2Vha01hcCA9IGlzV2Vha01hcDsKCmZ1bmN0aW9uIGlzV2Vha1NldFRvU3RyaW5nKHZhbHVlKSB7CiAgcmV0dXJuIE9iamVjdFRvU3RyaW5nKHZhbHVlKSA9PT0gJ1tvYmplY3QgV2Vha1NldF0nOwp9CmlzV2Vha1NldFRvU3RyaW5nLndvcmtpbmcgPSAoCiAgdHlwZW9mIFdlYWtTZXQgIT09ICd1bmRlZmluZWQnICYmCiAgaXNXZWFrU2V0VG9TdHJpbmcobmV3IFdlYWtTZXQoKSkKKTsKZnVuY3Rpb24gaXNXZWFrU2V0KHZhbHVlKSB7CiAgcmV0dXJuIGlzV2Vha1NldFRvU3RyaW5nKHZhbHVlKTsKfQpleHBvcnRzLmlzV2Vha1NldCA9IGlzV2Vha1NldDsKCmZ1bmN0aW9uIGlzQXJyYXlCdWZmZXJUb1N0cmluZyh2YWx1ZSkgewogIHJldHVybiBPYmplY3RUb1N0cmluZyh2YWx1ZSkgPT09ICdbb2JqZWN0IEFycmF5QnVmZmVyXSc7Cn0KaXNBcnJheUJ1ZmZlclRvU3RyaW5nLndvcmtpbmcgPSAoCiAgdHlwZW9mIEFycmF5QnVmZmVyICE9PSAndW5kZWZpbmVkJyAmJgogIGlzQXJyYXlCdWZmZXJUb1N0cmluZyhuZXcgQXJyYXlCdWZmZXIoKSkKKTsKZnVuY3Rpb24gaXNBcnJheUJ1ZmZlcih2YWx1ZSkgewogIGlmICh0eXBlb2YgQXJyYXlCdWZmZXIgPT09ICd1bmRlZmluZWQnKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICByZXR1cm4gaXNBcnJheUJ1ZmZlclRvU3RyaW5nLndvcmtpbmcKICAgID8gaXNBcnJheUJ1ZmZlclRvU3RyaW5nKHZhbHVlKQogICAgOiB2YWx1ZSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyOwp9CmV4cG9ydHMuaXNBcnJheUJ1ZmZlciA9IGlzQXJyYXlCdWZmZXI7CgpmdW5jdGlvbiBpc0RhdGFWaWV3VG9TdHJpbmcodmFsdWUpIHsKICByZXR1cm4gT2JqZWN0VG9TdHJpbmcodmFsdWUpID09PSAnW29iamVjdCBEYXRhVmlld10nOwp9CmlzRGF0YVZpZXdUb1N0cmluZy53b3JraW5nID0gKAogIHR5cGVvZiBBcnJheUJ1ZmZlciAhPT0gJ3VuZGVmaW5lZCcgJiYKICB0eXBlb2YgRGF0YVZpZXcgIT09ICd1bmRlZmluZWQnICYmCiAgaXNEYXRhVmlld1RvU3RyaW5nKG5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIoMSksIDAsIDEpKQopOwpmdW5jdGlvbiBpc0RhdGFWaWV3KHZhbHVlKSB7CiAgaWYgKHR5cGVvZiBEYXRhVmlldyA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIHJldHVybiBpc0RhdGFWaWV3VG9TdHJpbmcud29ya2luZwogICAgPyBpc0RhdGFWaWV3VG9TdHJpbmcodmFsdWUpCiAgICA6IHZhbHVlIGluc3RhbmNlb2YgRGF0YVZpZXc7Cn0KZXhwb3J0cy5pc0RhdGFWaWV3ID0gaXNEYXRhVmlldzsKCmZ1bmN0aW9uIGlzU2hhcmVkQXJyYXlCdWZmZXJUb1N0cmluZyh2YWx1ZSkgewogIHJldHVybiBPYmplY3RUb1N0cmluZyh2YWx1ZSkgPT09ICdbb2JqZWN0IFNoYXJlZEFycmF5QnVmZmVyXSc7Cn0KaXNTaGFyZWRBcnJheUJ1ZmZlclRvU3RyaW5nLndvcmtpbmcgPSAoCiAgdHlwZW9mIFNoYXJlZEFycmF5QnVmZmVyICE9PSAndW5kZWZpbmVkJyAmJgogIGlzU2hhcmVkQXJyYXlCdWZmZXJUb1N0cmluZyhuZXcgU2hhcmVkQXJyYXlCdWZmZXIoKSkKKTsKZnVuY3Rpb24gaXNTaGFyZWRBcnJheUJ1ZmZlcih2YWx1ZSkgewogIGlmICh0eXBlb2YgU2hhcmVkQXJyYXlCdWZmZXIgPT09ICd1bmRlZmluZWQnKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICByZXR1cm4gaXNTaGFyZWRBcnJheUJ1ZmZlclRvU3RyaW5nLndvcmtpbmcKICAgID8gaXNTaGFyZWRBcnJheUJ1ZmZlclRvU3RyaW5nKHZhbHVlKQogICAgOiB2YWx1ZSBpbnN0YW5jZW9mIFNoYXJlZEFycmF5QnVmZmVyOwp9CmV4cG9ydHMuaXNTaGFyZWRBcnJheUJ1ZmZlciA9IGlzU2hhcmVkQXJyYXlCdWZmZXI7CgpmdW5jdGlvbiBpc0FzeW5jRnVuY3Rpb24odmFsdWUpIHsKICByZXR1cm4gT2JqZWN0VG9TdHJpbmcodmFsdWUpID09PSAnW29iamVjdCBBc3luY0Z1bmN0aW9uXSc7Cn0KZXhwb3J0cy5pc0FzeW5jRnVuY3Rpb24gPSBpc0FzeW5jRnVuY3Rpb247CgpmdW5jdGlvbiBpc01hcEl0ZXJhdG9yKHZhbHVlKSB7CiAgcmV0dXJuIE9iamVjdFRvU3RyaW5nKHZhbHVlKSA9PT0gJ1tvYmplY3QgTWFwIEl0ZXJhdG9yXSc7Cn0KZXhwb3J0cy5pc01hcEl0ZXJhdG9yID0gaXNNYXBJdGVyYXRvcjsKCmZ1bmN0aW9uIGlzU2V0SXRlcmF0b3IodmFsdWUpIHsKICByZXR1cm4gT2JqZWN0VG9TdHJpbmcodmFsdWUpID09PSAnW29iamVjdCBTZXQgSXRlcmF0b3JdJzsKfQpleHBvcnRzLmlzU2V0SXRlcmF0b3IgPSBpc1NldEl0ZXJhdG9yOwoKZnVuY3Rpb24gaXNHZW5lcmF0b3JPYmplY3QodmFsdWUpIHsKICByZXR1cm4gT2JqZWN0VG9TdHJpbmcodmFsdWUpID09PSAnW29iamVjdCBHZW5lcmF0b3JdJzsKfQpleHBvcnRzLmlzR2VuZXJhdG9yT2JqZWN0ID0gaXNHZW5lcmF0b3JPYmplY3Q7CgpmdW5jdGlvbiBpc1dlYkFzc2VtYmx5Q29tcGlsZWRNb2R1bGUodmFsdWUpIHsKICByZXR1cm4gT2JqZWN0VG9TdHJpbmcodmFsdWUpID09PSAnW29iamVjdCBXZWJBc3NlbWJseS5Nb2R1bGVdJzsKfQpleHBvcnRzLmlzV2ViQXNzZW1ibHlDb21waWxlZE1vZHVsZSA9IGlzV2ViQXNzZW1ibHlDb21waWxlZE1vZHVsZTsKCmZ1bmN0aW9uIGlzTnVtYmVyT2JqZWN0KHZhbHVlKSB7CiAgcmV0dXJuIGNoZWNrQm94ZWRQcmltaXRpdmUodmFsdWUsIG51bWJlclZhbHVlKTsKfQpleHBvcnRzLmlzTnVtYmVyT2JqZWN0ID0gaXNOdW1iZXJPYmplY3Q7CgpmdW5jdGlvbiBpc1N0cmluZ09iamVjdCh2YWx1ZSkgewogIHJldHVybiBjaGVja0JveGVkUHJpbWl0aXZlKHZhbHVlLCBzdHJpbmdWYWx1ZSk7Cn0KZXhwb3J0cy5pc1N0cmluZ09iamVjdCA9IGlzU3RyaW5nT2JqZWN0OwoKZnVuY3Rpb24gaXNCb29sZWFuT2JqZWN0KHZhbHVlKSB7CiAgcmV0dXJuIGNoZWNrQm94ZWRQcmltaXRpdmUodmFsdWUsIGJvb2xlYW5WYWx1ZSk7Cn0KZXhwb3J0cy5pc0Jvb2xlYW5PYmplY3QgPSBpc0Jvb2xlYW5PYmplY3Q7CgpmdW5jdGlvbiBpc0JpZ0ludE9iamVjdCh2YWx1ZSkgewogIHJldHVybiBCaWdJbnRTdXBwb3J0ZWQgJiYgY2hlY2tCb3hlZFByaW1pdGl2ZSh2YWx1ZSwgYmlnSW50VmFsdWUpOwp9CmV4cG9ydHMuaXNCaWdJbnRPYmplY3QgPSBpc0JpZ0ludE9iamVjdDsKCmZ1bmN0aW9uIGlzU3ltYm9sT2JqZWN0KHZhbHVlKSB7CiAgcmV0dXJuIFN5bWJvbFN1cHBvcnRlZCAmJiBjaGVja0JveGVkUHJpbWl0aXZlKHZhbHVlLCBzeW1ib2xWYWx1ZSk7Cn0KZXhwb3J0cy5pc1N5bWJvbE9iamVjdCA9IGlzU3ltYm9sT2JqZWN0OwoKZnVuY3Rpb24gaXNCb3hlZFByaW1pdGl2ZSh2YWx1ZSkgewogIHJldHVybiAoCiAgICBpc051bWJlck9iamVjdCh2YWx1ZSkgfHwKICAgIGlzU3RyaW5nT2JqZWN0KHZhbHVlKSB8fAogICAgaXNCb29sZWFuT2JqZWN0KHZhbHVlKSB8fAogICAgaXNCaWdJbnRPYmplY3QodmFsdWUpIHx8CiAgICBpc1N5bWJvbE9iamVjdCh2YWx1ZSkKICApOwp9CmV4cG9ydHMuaXNCb3hlZFByaW1pdGl2ZSA9IGlzQm94ZWRQcmltaXRpdmU7CgpmdW5jdGlvbiBpc0FueUFycmF5QnVmZmVyKHZhbHVlKSB7CiAgcmV0dXJuIHR5cGVvZiBVaW50OEFycmF5ICE9PSAndW5kZWZpbmVkJyAmJiAoCiAgICBpc0FycmF5QnVmZmVyKHZhbHVlKSB8fAogICAgaXNTaGFyZWRBcnJheUJ1ZmZlcih2YWx1ZSkKICApOwp9CmV4cG9ydHMuaXNBbnlBcnJheUJ1ZmZlciA9IGlzQW55QXJyYXlCdWZmZXI7CgpbJ2lzUHJveHknLCAnaXNFeHRlcm5hbCcsICdpc01vZHVsZU5hbWVzcGFjZU9iamVjdCddLmZvckVhY2goZnVuY3Rpb24obWV0aG9kKSB7CiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG1ldGhvZCwgewogICAgZW51bWVyYWJsZTogZmFsc2UsCiAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihtZXRob2QgKyAnIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdXNlcmxhbmQnKTsKICAgIH0KICB9KTsKfSk7Cgp9LHsiaXMtYXJndW1lbnRzIjozMywiaXMtZ2VuZXJhdG9yLWZ1bmN0aW9uIjozNSwiaXMtdHlwZWQtYXJyYXkiOjM2LCJ3aGljaC10eXBlZC1hcnJheSI6NDJ9XSw0MTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CihmdW5jdGlvbiAocHJvY2Vzcyl7KGZ1bmN0aW9uICgpewovLyBDb3B5cmlnaHQgSm95ZW50LCBJbmMuIGFuZCBvdGhlciBOb2RlIGNvbnRyaWJ1dG9ycy4KLy8KLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEKLy8gY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZQovLyAiU29mdHdhcmUiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nCi8vIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwKLy8gZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdAovLyBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUKLy8gZm9sbG93aW5nIGNvbmRpdGlvbnM6Ci8vCi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkCi8vIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgovLwovLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUwovLyBPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GCi8vIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4KLy8gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sCi8vIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUgovLyBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFCi8vIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCgp2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzIHx8CiAgZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhvYmopIHsKICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqKTsKICAgIHZhciBkZXNjcmlwdG9ycyA9IHt9OwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGRlc2NyaXB0b3JzW2tleXNbaV1dID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleXNbaV0pOwogICAgfQogICAgcmV0dXJuIGRlc2NyaXB0b3JzOwogIH07Cgp2YXIgZm9ybWF0UmVnRXhwID0gLyVbc2RqJV0vZzsKZXhwb3J0cy5mb3JtYXQgPSBmdW5jdGlvbihmKSB7CiAgaWYgKCFpc1N0cmluZyhmKSkgewogICAgdmFyIG9iamVjdHMgPSBbXTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIG9iamVjdHMucHVzaChpbnNwZWN0KGFyZ3VtZW50c1tpXSkpOwogICAgfQogICAgcmV0dXJuIG9iamVjdHMuam9pbignICcpOwogIH0KCiAgdmFyIGkgPSAxOwogIHZhciBhcmdzID0gYXJndW1lbnRzOwogIHZhciBsZW4gPSBhcmdzLmxlbmd0aDsKICB2YXIgc3RyID0gU3RyaW5nKGYpLnJlcGxhY2UoZm9ybWF0UmVnRXhwLCBmdW5jdGlvbih4KSB7CiAgICBpZiAoeCA9PT0gJyUlJykgcmV0dXJuICclJzsKICAgIGlmIChpID49IGxlbikgcmV0dXJuIHg7CiAgICBzd2l0Y2ggKHgpIHsKICAgICAgY2FzZSAnJXMnOiByZXR1cm4gU3RyaW5nKGFyZ3NbaSsrXSk7CiAgICAgIGNhc2UgJyVkJzogcmV0dXJuIE51bWJlcihhcmdzW2krK10pOwogICAgICBjYXNlICclaic6CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShhcmdzW2krK10pOwogICAgICAgIH0gY2F0Y2ggKF8pIHsKICAgICAgICAgIHJldHVybiAnW0NpcmN1bGFyXSc7CiAgICAgICAgfQogICAgICBkZWZhdWx0OgogICAgICAgIHJldHVybiB4OwogICAgfQogIH0pOwogIGZvciAodmFyIHggPSBhcmdzW2ldOyBpIDwgbGVuOyB4ID0gYXJnc1srK2ldKSB7CiAgICBpZiAoaXNOdWxsKHgpIHx8ICFpc09iamVjdCh4KSkgewogICAgICBzdHIgKz0gJyAnICsgeDsKICAgIH0gZWxzZSB7CiAgICAgIHN0ciArPSAnICcgKyBpbnNwZWN0KHgpOwogICAgfQogIH0KICByZXR1cm4gc3RyOwp9OwoKCi8vIE1hcmsgdGhhdCBhIG1ldGhvZCBzaG91bGQgbm90IGJlIHVzZWQuCi8vIFJldHVybnMgYSBtb2RpZmllZCBmdW5jdGlvbiB3aGljaCB3YXJucyBvbmNlIGJ5IGRlZmF1bHQuCi8vIElmIC0tbm8tZGVwcmVjYXRpb24gaXMgc2V0LCB0aGVuIGl0IGlzIGEgbm8tb3AuCmV4cG9ydHMuZGVwcmVjYXRlID0gZnVuY3Rpb24oZm4sIG1zZykgewogIGlmICh0eXBlb2YgcHJvY2VzcyAhPT0gJ3VuZGVmaW5lZCcgJiYgcHJvY2Vzcy5ub0RlcHJlY2F0aW9uID09PSB0cnVlKSB7CiAgICByZXR1cm4gZm47CiAgfQoKICAvLyBBbGxvdyBmb3IgZGVwcmVjYXRpbmcgdGhpbmdzIGluIHRoZSBwcm9jZXNzIG9mIHN0YXJ0aW5nIHVwLgogIGlmICh0eXBlb2YgcHJvY2VzcyA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGV4cG9ydHMuZGVwcmVjYXRlKGZuLCBtc2cpLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9OwogIH0KCiAgdmFyIHdhcm5lZCA9IGZhbHNlOwogIGZ1bmN0aW9uIGRlcHJlY2F0ZWQoKSB7CiAgICBpZiAoIXdhcm5lZCkgewogICAgICBpZiAocHJvY2Vzcy50aHJvd0RlcHJlY2F0aW9uKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7CiAgICAgIH0gZWxzZSBpZiAocHJvY2Vzcy50cmFjZURlcHJlY2F0aW9uKSB7CiAgICAgICAgY29uc29sZS50cmFjZShtc2cpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUuZXJyb3IobXNnKTsKICAgICAgfQogICAgICB3YXJuZWQgPSB0cnVlOwogICAgfQogICAgcmV0dXJuIGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfQoKICByZXR1cm4gZGVwcmVjYXRlZDsKfTsKCgp2YXIgZGVidWdzID0ge307CnZhciBkZWJ1Z0VudlJlZ2V4ID0gL14kLzsKCmlmIChwcm9jZXNzLmVudi5OT0RFX0RFQlVHKSB7CiAgdmFyIGRlYnVnRW52ID0gcHJvY2Vzcy5lbnYuTk9ERV9ERUJVRzsKICBkZWJ1Z0VudiA9IGRlYnVnRW52LnJlcGxhY2UoL1t8XFx7fSgpW1xdXiQrPy5dL2csICdcXCQmJykKICAgIC5yZXBsYWNlKC9cKi9nLCAnLionKQogICAgLnJlcGxhY2UoLywvZywgJyR8XicpCiAgICAudG9VcHBlckNhc2UoKTsKICBkZWJ1Z0VudlJlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBkZWJ1Z0VudiArICckJywgJ2knKTsKfQpleHBvcnRzLmRlYnVnbG9nID0gZnVuY3Rpb24oc2V0KSB7CiAgc2V0ID0gc2V0LnRvVXBwZXJDYXNlKCk7CiAgaWYgKCFkZWJ1Z3Nbc2V0XSkgewogICAgaWYgKGRlYnVnRW52UmVnZXgudGVzdChzZXQpKSB7CiAgICAgIHZhciBwaWQgPSBwcm9jZXNzLnBpZDsKICAgICAgZGVidWdzW3NldF0gPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgbXNnID0gZXhwb3J0cy5mb3JtYXQuYXBwbHkoZXhwb3J0cywgYXJndW1lbnRzKTsKICAgICAgICBjb25zb2xlLmVycm9yKCclcyAlZDogJXMnLCBzZXQsIHBpZCwgbXNnKTsKICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgIGRlYnVnc1tzZXRdID0gZnVuY3Rpb24oKSB7fTsKICAgIH0KICB9CiAgcmV0dXJuIGRlYnVnc1tzZXRdOwp9OwoKCi8qKgogKiBFY2hvcyB0aGUgdmFsdWUgb2YgYSB2YWx1ZS4gVHJ5cyB0byBwcmludCB0aGUgdmFsdWUgb3V0CiAqIGluIHRoZSBiZXN0IHdheSBwb3NzaWJsZSBnaXZlbiB0aGUgZGlmZmVyZW50IHR5cGVzLgogKgogKiBAcGFyYW0ge09iamVjdH0gb2JqIFRoZSBvYmplY3QgdG8gcHJpbnQgb3V0LgogKiBAcGFyYW0ge09iamVjdH0gb3B0cyBPcHRpb25hbCBvcHRpb25zIG9iamVjdCB0aGF0IGFsdGVycyB0aGUgb3V0cHV0LgogKi8KLyogbGVnYWN5OiBvYmosIHNob3dIaWRkZW4sIGRlcHRoLCBjb2xvcnMqLwpmdW5jdGlvbiBpbnNwZWN0KG9iaiwgb3B0cykgewogIC8vIGRlZmF1bHQgb3B0aW9ucwogIHZhciBjdHggPSB7CiAgICBzZWVuOiBbXSwKICAgIHN0eWxpemU6IHN0eWxpemVOb0NvbG9yCiAgfTsKICAvLyBsZWdhY3kuLi4KICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+PSAzKSBjdHguZGVwdGggPSBhcmd1bWVudHNbMl07CiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPj0gNCkgY3R4LmNvbG9ycyA9IGFyZ3VtZW50c1szXTsKICBpZiAoaXNCb29sZWFuKG9wdHMpKSB7CiAgICAvLyBsZWdhY3kuLi4KICAgIGN0eC5zaG93SGlkZGVuID0gb3B0czsKICB9IGVsc2UgaWYgKG9wdHMpIHsKICAgIC8vIGdvdCBhbiAib3B0aW9ucyIgb2JqZWN0CiAgICBleHBvcnRzLl9leHRlbmQoY3R4LCBvcHRzKTsKICB9CiAgLy8gc2V0IGRlZmF1bHQgb3B0aW9ucwogIGlmIChpc1VuZGVmaW5lZChjdHguc2hvd0hpZGRlbikpIGN0eC5zaG93SGlkZGVuID0gZmFsc2U7CiAgaWYgKGlzVW5kZWZpbmVkKGN0eC5kZXB0aCkpIGN0eC5kZXB0aCA9IDI7CiAgaWYgKGlzVW5kZWZpbmVkKGN0eC5jb2xvcnMpKSBjdHguY29sb3JzID0gZmFsc2U7CiAgaWYgKGlzVW5kZWZpbmVkKGN0eC5jdXN0b21JbnNwZWN0KSkgY3R4LmN1c3RvbUluc3BlY3QgPSB0cnVlOwogIGlmIChjdHguY29sb3JzKSBjdHguc3R5bGl6ZSA9IHN0eWxpemVXaXRoQ29sb3I7CiAgcmV0dXJuIGZvcm1hdFZhbHVlKGN0eCwgb2JqLCBjdHguZGVwdGgpOwp9CmV4cG9ydHMuaW5zcGVjdCA9IGluc3BlY3Q7CgoKLy8gaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9BTlNJX2VzY2FwZV9jb2RlI2dyYXBoaWNzCmluc3BlY3QuY29sb3JzID0gewogICdib2xkJyA6IFsxLCAyMl0sCiAgJ2l0YWxpYycgOiBbMywgMjNdLAogICd1bmRlcmxpbmUnIDogWzQsIDI0XSwKICAnaW52ZXJzZScgOiBbNywgMjddLAogICd3aGl0ZScgOiBbMzcsIDM5XSwKICAnZ3JleScgOiBbOTAsIDM5XSwKICAnYmxhY2snIDogWzMwLCAzOV0sCiAgJ2JsdWUnIDogWzM0LCAzOV0sCiAgJ2N5YW4nIDogWzM2LCAzOV0sCiAgJ2dyZWVuJyA6IFszMiwgMzldLAogICdtYWdlbnRhJyA6IFszNSwgMzldLAogICdyZWQnIDogWzMxLCAzOV0sCiAgJ3llbGxvdycgOiBbMzMsIDM5XQp9OwoKLy8gRG9uJ3QgdXNlICdibHVlJyBub3QgdmlzaWJsZSBvbiBjbWQuZXhlCmluc3BlY3Quc3R5bGVzID0gewogICdzcGVjaWFsJzogJ2N5YW4nLAogICdudW1iZXInOiAneWVsbG93JywKICAnYm9vbGVhbic6ICd5ZWxsb3cnLAogICd1bmRlZmluZWQnOiAnZ3JleScsCiAgJ251bGwnOiAnYm9sZCcsCiAgJ3N0cmluZyc6ICdncmVlbicsCiAgJ2RhdGUnOiAnbWFnZW50YScsCiAgLy8gIm5hbWUiOiBpbnRlbnRpb25hbGx5IG5vdCBzdHlsaW5nCiAgJ3JlZ2V4cCc6ICdyZWQnCn07CgoKZnVuY3Rpb24gc3R5bGl6ZVdpdGhDb2xvcihzdHIsIHN0eWxlVHlwZSkgewogIHZhciBzdHlsZSA9IGluc3BlY3Quc3R5bGVzW3N0eWxlVHlwZV07CgogIGlmIChzdHlsZSkgewogICAgcmV0dXJuICdcdTAwMWJbJyArIGluc3BlY3QuY29sb3JzW3N0eWxlXVswXSArICdtJyArIHN0ciArCiAgICAgICAgICAgJ1x1MDAxYlsnICsgaW5zcGVjdC5jb2xvcnNbc3R5bGVdWzFdICsgJ20nOwogIH0gZWxzZSB7CiAgICByZXR1cm4gc3RyOwogIH0KfQoKCmZ1bmN0aW9uIHN0eWxpemVOb0NvbG9yKHN0ciwgc3R5bGVUeXBlKSB7CiAgcmV0dXJuIHN0cjsKfQoKCmZ1bmN0aW9uIGFycmF5VG9IYXNoKGFycmF5KSB7CiAgdmFyIGhhc2ggPSB7fTsKCiAgYXJyYXkuZm9yRWFjaChmdW5jdGlvbih2YWwsIGlkeCkgewogICAgaGFzaFt2YWxdID0gdHJ1ZTsKICB9KTsKCiAgcmV0dXJuIGhhc2g7Cn0KCgpmdW5jdGlvbiBmb3JtYXRWYWx1ZShjdHgsIHZhbHVlLCByZWN1cnNlVGltZXMpIHsKICAvLyBQcm92aWRlIGEgaG9vayBmb3IgdXNlci1zcGVjaWZpZWQgaW5zcGVjdCBmdW5jdGlvbnMuCiAgLy8gQ2hlY2sgdGhhdCB2YWx1ZSBpcyBhbiBvYmplY3Qgd2l0aCBhbiBpbnNwZWN0IGZ1bmN0aW9uIG9uIGl0CiAgaWYgKGN0eC5jdXN0b21JbnNwZWN0ICYmCiAgICAgIHZhbHVlICYmCiAgICAgIGlzRnVuY3Rpb24odmFsdWUuaW5zcGVjdCkgJiYKICAgICAgLy8gRmlsdGVyIG91dCB0aGUgdXRpbCBtb2R1bGUsIGl0J3MgaW5zcGVjdCBmdW5jdGlvbiBpcyBzcGVjaWFsCiAgICAgIHZhbHVlLmluc3BlY3QgIT09IGV4cG9ydHMuaW5zcGVjdCAmJgogICAgICAvLyBBbHNvIGZpbHRlciBvdXQgYW55IHByb3RvdHlwZSBvYmplY3RzIHVzaW5nIHRoZSBjaXJjdWxhciBjaGVjay4KICAgICAgISh2YWx1ZS5jb25zdHJ1Y3RvciAmJiB2YWx1ZS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUgPT09IHZhbHVlKSkgewogICAgdmFyIHJldCA9IHZhbHVlLmluc3BlY3QocmVjdXJzZVRpbWVzLCBjdHgpOwogICAgaWYgKCFpc1N0cmluZyhyZXQpKSB7CiAgICAgIHJldCA9IGZvcm1hdFZhbHVlKGN0eCwgcmV0LCByZWN1cnNlVGltZXMpOwogICAgfQogICAgcmV0dXJuIHJldDsKICB9CgogIC8vIFByaW1pdGl2ZSB0eXBlcyBjYW5ub3QgaGF2ZSBwcm9wZXJ0aWVzCiAgdmFyIHByaW1pdGl2ZSA9IGZvcm1hdFByaW1pdGl2ZShjdHgsIHZhbHVlKTsKICBpZiAocHJpbWl0aXZlKSB7CiAgICByZXR1cm4gcHJpbWl0aXZlOwogIH0KCiAgLy8gTG9vayB1cCB0aGUga2V5cyBvZiB0aGUgb2JqZWN0LgogIHZhciBrZXlzID0gT2JqZWN0LmtleXModmFsdWUpOwogIHZhciB2aXNpYmxlS2V5cyA9IGFycmF5VG9IYXNoKGtleXMpOwoKICBpZiAoY3R4LnNob3dIaWRkZW4pIHsKICAgIGtleXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh2YWx1ZSk7CiAgfQoKICAvLyBJRSBkb2Vzbid0IG1ha2UgZXJyb3IgZmllbGRzIG5vbi1lbnVtZXJhYmxlCiAgLy8gaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2llL2R3dzUyc2J0KHY9dnMuOTQpLmFzcHgKICBpZiAoaXNFcnJvcih2YWx1ZSkKICAgICAgJiYgKGtleXMuaW5kZXhPZignbWVzc2FnZScpID49IDAgfHwga2V5cy5pbmRleE9mKCdkZXNjcmlwdGlvbicpID49IDApKSB7CiAgICByZXR1cm4gZm9ybWF0RXJyb3IodmFsdWUpOwogIH0KCiAgLy8gU29tZSB0eXBlIG9mIG9iamVjdCB3aXRob3V0IHByb3BlcnRpZXMgY2FuIGJlIHNob3J0Y3V0dGVkLgogIGlmIChrZXlzLmxlbmd0aCA9PT0gMCkgewogICAgaWYgKGlzRnVuY3Rpb24odmFsdWUpKSB7CiAgICAgIHZhciBuYW1lID0gdmFsdWUubmFtZSA/ICc6ICcgKyB2YWx1ZS5uYW1lIDogJyc7CiAgICAgIHJldHVybiBjdHguc3R5bGl6ZSgnW0Z1bmN0aW9uJyArIG5hbWUgKyAnXScsICdzcGVjaWFsJyk7CiAgICB9CiAgICBpZiAoaXNSZWdFeHAodmFsdWUpKSB7CiAgICAgIHJldHVybiBjdHguc3R5bGl6ZShSZWdFeHAucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsdWUpLCAncmVnZXhwJyk7CiAgICB9CiAgICBpZiAoaXNEYXRlKHZhbHVlKSkgewogICAgICByZXR1cm4gY3R4LnN0eWxpemUoRGF0ZS5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWx1ZSksICdkYXRlJyk7CiAgICB9CiAgICBpZiAoaXNFcnJvcih2YWx1ZSkpIHsKICAgICAgcmV0dXJuIGZvcm1hdEVycm9yKHZhbHVlKTsKICAgIH0KICB9CgogIHZhciBiYXNlID0gJycsIGFycmF5ID0gZmFsc2UsIGJyYWNlcyA9IFsneycsICd9J107CgogIC8vIE1ha2UgQXJyYXkgc2F5IHRoYXQgdGhleSBhcmUgQXJyYXkKICBpZiAoaXNBcnJheSh2YWx1ZSkpIHsKICAgIGFycmF5ID0gdHJ1ZTsKICAgIGJyYWNlcyA9IFsnWycsICddJ107CiAgfQoKICAvLyBNYWtlIGZ1bmN0aW9ucyBzYXkgdGhhdCB0aGV5IGFyZSBmdW5jdGlvbnMKICBpZiAoaXNGdW5jdGlvbih2YWx1ZSkpIHsKICAgIHZhciBuID0gdmFsdWUubmFtZSA/ICc6ICcgKyB2YWx1ZS5uYW1lIDogJyc7CiAgICBiYXNlID0gJyBbRnVuY3Rpb24nICsgbiArICddJzsKICB9CgogIC8vIE1ha2UgUmVnRXhwcyBzYXkgdGhhdCB0aGV5IGFyZSBSZWdFeHBzCiAgaWYgKGlzUmVnRXhwKHZhbHVlKSkgewogICAgYmFzZSA9ICcgJyArIFJlZ0V4cC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWx1ZSk7CiAgfQoKICAvLyBNYWtlIGRhdGVzIHdpdGggcHJvcGVydGllcyBmaXJzdCBzYXkgdGhlIGRhdGUKICBpZiAoaXNEYXRlKHZhbHVlKSkgewogICAgYmFzZSA9ICcgJyArIERhdGUucHJvdG90eXBlLnRvVVRDU3RyaW5nLmNhbGwodmFsdWUpOwogIH0KCiAgLy8gTWFrZSBlcnJvciB3aXRoIG1lc3NhZ2UgZmlyc3Qgc2F5IHRoZSBlcnJvcgogIGlmIChpc0Vycm9yKHZhbHVlKSkgewogICAgYmFzZSA9ICcgJyArIGZvcm1hdEVycm9yKHZhbHVlKTsKICB9CgogIGlmIChrZXlzLmxlbmd0aCA9PT0gMCAmJiAoIWFycmF5IHx8IHZhbHVlLmxlbmd0aCA9PSAwKSkgewogICAgcmV0dXJuIGJyYWNlc1swXSArIGJhc2UgKyBicmFjZXNbMV07CiAgfQoKICBpZiAocmVjdXJzZVRpbWVzIDwgMCkgewogICAgaWYgKGlzUmVnRXhwKHZhbHVlKSkgewogICAgICByZXR1cm4gY3R4LnN0eWxpemUoUmVnRXhwLnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhbHVlKSwgJ3JlZ2V4cCcpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGN0eC5zdHlsaXplKCdbT2JqZWN0XScsICdzcGVjaWFsJyk7CiAgICB9CiAgfQoKICBjdHguc2Vlbi5wdXNoKHZhbHVlKTsKCiAgdmFyIG91dHB1dDsKICBpZiAoYXJyYXkpIHsKICAgIG91dHB1dCA9IGZvcm1hdEFycmF5KGN0eCwgdmFsdWUsIHJlY3Vyc2VUaW1lcywgdmlzaWJsZUtleXMsIGtleXMpOwogIH0gZWxzZSB7CiAgICBvdXRwdXQgPSBrZXlzLm1hcChmdW5jdGlvbihrZXkpIHsKICAgICAgcmV0dXJuIGZvcm1hdFByb3BlcnR5KGN0eCwgdmFsdWUsIHJlY3Vyc2VUaW1lcywgdmlzaWJsZUtleXMsIGtleSwgYXJyYXkpOwogICAgfSk7CiAgfQoKICBjdHguc2Vlbi5wb3AoKTsKCiAgcmV0dXJuIHJlZHVjZVRvU2luZ2xlU3RyaW5nKG91dHB1dCwgYmFzZSwgYnJhY2VzKTsKfQoKCmZ1bmN0aW9uIGZvcm1hdFByaW1pdGl2ZShjdHgsIHZhbHVlKSB7CiAgaWYgKGlzVW5kZWZpbmVkKHZhbHVlKSkKICAgIHJldHVybiBjdHguc3R5bGl6ZSgndW5kZWZpbmVkJywgJ3VuZGVmaW5lZCcpOwogIGlmIChpc1N0cmluZyh2YWx1ZSkpIHsKICAgIHZhciBzaW1wbGUgPSAnXCcnICsgSlNPTi5zdHJpbmdpZnkodmFsdWUpLnJlcGxhY2UoL14ifCIkL2csICcnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvJy9nLCAiXFwnIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcIi9nLCAnIicpICsgJ1wnJzsKICAgIHJldHVybiBjdHguc3R5bGl6ZShzaW1wbGUsICdzdHJpbmcnKTsKICB9CiAgaWYgKGlzTnVtYmVyKHZhbHVlKSkKICAgIHJldHVybiBjdHguc3R5bGl6ZSgnJyArIHZhbHVlLCAnbnVtYmVyJyk7CiAgaWYgKGlzQm9vbGVhbih2YWx1ZSkpCiAgICByZXR1cm4gY3R4LnN0eWxpemUoJycgKyB2YWx1ZSwgJ2Jvb2xlYW4nKTsKICAvLyBGb3Igc29tZSByZWFzb24gdHlwZW9mIG51bGwgaXMgIm9iamVjdCIsIHNvIHNwZWNpYWwgY2FzZSBoZXJlLgogIGlmIChpc051bGwodmFsdWUpKQogICAgcmV0dXJuIGN0eC5zdHlsaXplKCdudWxsJywgJ251bGwnKTsKfQoKCmZ1bmN0aW9uIGZvcm1hdEVycm9yKHZhbHVlKSB7CiAgcmV0dXJuICdbJyArIEVycm9yLnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhbHVlKSArICddJzsKfQoKCmZ1bmN0aW9uIGZvcm1hdEFycmF5KGN0eCwgdmFsdWUsIHJlY3Vyc2VUaW1lcywgdmlzaWJsZUtleXMsIGtleXMpIHsKICB2YXIgb3V0cHV0ID0gW107CiAgZm9yICh2YXIgaSA9IDAsIGwgPSB2YWx1ZS5sZW5ndGg7IGkgPCBsOyArK2kpIHsKICAgIGlmIChoYXNPd25Qcm9wZXJ0eSh2YWx1ZSwgU3RyaW5nKGkpKSkgewogICAgICBvdXRwdXQucHVzaChmb3JtYXRQcm9wZXJ0eShjdHgsIHZhbHVlLCByZWN1cnNlVGltZXMsIHZpc2libGVLZXlzLAogICAgICAgICAgU3RyaW5nKGkpLCB0cnVlKSk7CiAgICB9IGVsc2UgewogICAgICBvdXRwdXQucHVzaCgnJyk7CiAgICB9CiAgfQogIGtleXMuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsKICAgIGlmICgha2V5Lm1hdGNoKC9eXGQrJC8pKSB7CiAgICAgIG91dHB1dC5wdXNoKGZvcm1hdFByb3BlcnR5KGN0eCwgdmFsdWUsIHJlY3Vyc2VUaW1lcywgdmlzaWJsZUtleXMsCiAgICAgICAgICBrZXksIHRydWUpKTsKICAgIH0KICB9KTsKICByZXR1cm4gb3V0cHV0Owp9CgoKZnVuY3Rpb24gZm9ybWF0UHJvcGVydHkoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCB2aXNpYmxlS2V5cywga2V5LCBhcnJheSkgewogIHZhciBuYW1lLCBzdHIsIGRlc2M7CiAgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodmFsdWUsIGtleSkgfHwgeyB2YWx1ZTogdmFsdWVba2V5XSB9OwogIGlmIChkZXNjLmdldCkgewogICAgaWYgKGRlc2Muc2V0KSB7CiAgICAgIHN0ciA9IGN0eC5zdHlsaXplKCdbR2V0dGVyL1NldHRlcl0nLCAnc3BlY2lhbCcpOwogICAgfSBlbHNlIHsKICAgICAgc3RyID0gY3R4LnN0eWxpemUoJ1tHZXR0ZXJdJywgJ3NwZWNpYWwnKTsKICAgIH0KICB9IGVsc2UgewogICAgaWYgKGRlc2Muc2V0KSB7CiAgICAgIHN0ciA9IGN0eC5zdHlsaXplKCdbU2V0dGVyXScsICdzcGVjaWFsJyk7CiAgICB9CiAgfQogIGlmICghaGFzT3duUHJvcGVydHkodmlzaWJsZUtleXMsIGtleSkpIHsKICAgIG5hbWUgPSAnWycgKyBrZXkgKyAnXSc7CiAgfQogIGlmICghc3RyKSB7CiAgICBpZiAoY3R4LnNlZW4uaW5kZXhPZihkZXNjLnZhbHVlKSA8IDApIHsKICAgICAgaWYgKGlzTnVsbChyZWN1cnNlVGltZXMpKSB7CiAgICAgICAgc3RyID0gZm9ybWF0VmFsdWUoY3R4LCBkZXNjLnZhbHVlLCBudWxsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzdHIgPSBmb3JtYXRWYWx1ZShjdHgsIGRlc2MudmFsdWUsIHJlY3Vyc2VUaW1lcyAtIDEpOwogICAgICB9CiAgICAgIGlmIChzdHIuaW5kZXhPZignXG4nKSA+IC0xKSB7CiAgICAgICAgaWYgKGFycmF5KSB7CiAgICAgICAgICBzdHIgPSBzdHIuc3BsaXQoJ1xuJykubWFwKGZ1bmN0aW9uKGxpbmUpIHsKICAgICAgICAgICAgcmV0dXJuICcgICcgKyBsaW5lOwogICAgICAgICAgfSkuam9pbignXG4nKS5zdWJzdHIoMik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0ciA9ICdcbicgKyBzdHIuc3BsaXQoJ1xuJykubWFwKGZ1bmN0aW9uKGxpbmUpIHsKICAgICAgICAgICAgcmV0dXJuICcgICAnICsgbGluZTsKICAgICAgICAgIH0pLmpvaW4oJ1xuJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBzdHIgPSBjdHguc3R5bGl6ZSgnW0NpcmN1bGFyXScsICdzcGVjaWFsJyk7CiAgICB9CiAgfQogIGlmIChpc1VuZGVmaW5lZChuYW1lKSkgewogICAgaWYgKGFycmF5ICYmIGtleS5tYXRjaCgvXlxkKyQvKSkgewogICAgICByZXR1cm4gc3RyOwogICAgfQogICAgbmFtZSA9IEpTT04uc3RyaW5naWZ5KCcnICsga2V5KTsKICAgIGlmIChuYW1lLm1hdGNoKC9eIihbYS16QS1aX11bYS16QS1aXzAtOV0qKSIkLykpIHsKICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyKDEsIG5hbWUubGVuZ3RoIC0gMik7CiAgICAgIG5hbWUgPSBjdHguc3R5bGl6ZShuYW1lLCAnbmFtZScpOwogICAgfSBlbHNlIHsKICAgICAgbmFtZSA9IG5hbWUucmVwbGFjZSgvJy9nLCAiXFwnIikKICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXFwiL2csICciJykKICAgICAgICAgICAgICAgICAucmVwbGFjZSgvKF4ifCIkKS9nLCAiJyIpOwogICAgICBuYW1lID0gY3R4LnN0eWxpemUobmFtZSwgJ3N0cmluZycpOwogICAgfQogIH0KCiAgcmV0dXJuIG5hbWUgKyAnOiAnICsgc3RyOwp9CgoKZnVuY3Rpb24gcmVkdWNlVG9TaW5nbGVTdHJpbmcob3V0cHV0LCBiYXNlLCBicmFjZXMpIHsKICB2YXIgbnVtTGluZXNFc3QgPSAwOwogIHZhciBsZW5ndGggPSBvdXRwdXQucmVkdWNlKGZ1bmN0aW9uKHByZXYsIGN1cikgewogICAgbnVtTGluZXNFc3QrKzsKICAgIGlmIChjdXIuaW5kZXhPZignXG4nKSA+PSAwKSBudW1MaW5lc0VzdCsrOwogICAgcmV0dXJuIHByZXYgKyBjdXIucmVwbGFjZSgvXHUwMDFiXFtcZFxkP20vZywgJycpLmxlbmd0aCArIDE7CiAgfSwgMCk7CgogIGlmIChsZW5ndGggPiA2MCkgewogICAgcmV0dXJuIGJyYWNlc1swXSArCiAgICAgICAgICAgKGJhc2UgPT09ICcnID8gJycgOiBiYXNlICsgJ1xuICcpICsKICAgICAgICAgICAnICcgKwogICAgICAgICAgIG91dHB1dC5qb2luKCcsXG4gICcpICsKICAgICAgICAgICAnICcgKwogICAgICAgICAgIGJyYWNlc1sxXTsKICB9CgogIHJldHVybiBicmFjZXNbMF0gKyBiYXNlICsgJyAnICsgb3V0cHV0LmpvaW4oJywgJykgKyAnICcgKyBicmFjZXNbMV07Cn0KCgovLyBOT1RFOiBUaGVzZSB0eXBlIGNoZWNraW5nIGZ1bmN0aW9ucyBpbnRlbnRpb25hbGx5IGRvbid0IHVzZSBgaW5zdGFuY2VvZmAKLy8gYmVjYXVzZSBpdCBpcyBmcmFnaWxlIGFuZCBjYW4gYmUgZWFzaWx5IGZha2VkIHdpdGggYE9iamVjdC5jcmVhdGUoKWAuCmV4cG9ydHMudHlwZXMgPSByZXF1aXJlKCcuL3N1cHBvcnQvdHlwZXMnKTsKCmZ1bmN0aW9uIGlzQXJyYXkoYXIpIHsKICByZXR1cm4gQXJyYXkuaXNBcnJheShhcik7Cn0KZXhwb3J0cy5pc0FycmF5ID0gaXNBcnJheTsKCmZ1bmN0aW9uIGlzQm9vbGVhbihhcmcpIHsKICByZXR1cm4gdHlwZW9mIGFyZyA9PT0gJ2Jvb2xlYW4nOwp9CmV4cG9ydHMuaXNCb29sZWFuID0gaXNCb29sZWFuOwoKZnVuY3Rpb24gaXNOdWxsKGFyZykgewogIHJldHVybiBhcmcgPT09IG51bGw7Cn0KZXhwb3J0cy5pc051bGwgPSBpc051bGw7CgpmdW5jdGlvbiBpc051bGxPclVuZGVmaW5lZChhcmcpIHsKICByZXR1cm4gYXJnID09IG51bGw7Cn0KZXhwb3J0cy5pc051bGxPclVuZGVmaW5lZCA9IGlzTnVsbE9yVW5kZWZpbmVkOwoKZnVuY3Rpb24gaXNOdW1iZXIoYXJnKSB7CiAgcmV0dXJuIHR5cGVvZiBhcmcgPT09ICdudW1iZXInOwp9CmV4cG9ydHMuaXNOdW1iZXIgPSBpc051bWJlcjsKCmZ1bmN0aW9uIGlzU3RyaW5nKGFyZykgewogIHJldHVybiB0eXBlb2YgYXJnID09PSAnc3RyaW5nJzsKfQpleHBvcnRzLmlzU3RyaW5nID0gaXNTdHJpbmc7CgpmdW5jdGlvbiBpc1N5bWJvbChhcmcpIHsKICByZXR1cm4gdHlwZW9mIGFyZyA9PT0gJ3N5bWJvbCc7Cn0KZXhwb3J0cy5pc1N5bWJvbCA9IGlzU3ltYm9sOwoKZnVuY3Rpb24gaXNVbmRlZmluZWQoYXJnKSB7CiAgcmV0dXJuIGFyZyA9PT0gdm9pZCAwOwp9CmV4cG9ydHMuaXNVbmRlZmluZWQgPSBpc1VuZGVmaW5lZDsKCmZ1bmN0aW9uIGlzUmVnRXhwKHJlKSB7CiAgcmV0dXJuIGlzT2JqZWN0KHJlKSAmJiBvYmplY3RUb1N0cmluZyhyZSkgPT09ICdbb2JqZWN0IFJlZ0V4cF0nOwp9CmV4cG9ydHMuaXNSZWdFeHAgPSBpc1JlZ0V4cDsKZXhwb3J0cy50eXBlcy5pc1JlZ0V4cCA9IGlzUmVnRXhwOwoKZnVuY3Rpb24gaXNPYmplY3QoYXJnKSB7CiAgcmV0dXJuIHR5cGVvZiBhcmcgPT09ICdvYmplY3QnICYmIGFyZyAhPT0gbnVsbDsKfQpleHBvcnRzLmlzT2JqZWN0ID0gaXNPYmplY3Q7CgpmdW5jdGlvbiBpc0RhdGUoZCkgewogIHJldHVybiBpc09iamVjdChkKSAmJiBvYmplY3RUb1N0cmluZyhkKSA9PT0gJ1tvYmplY3QgRGF0ZV0nOwp9CmV4cG9ydHMuaXNEYXRlID0gaXNEYXRlOwpleHBvcnRzLnR5cGVzLmlzRGF0ZSA9IGlzRGF0ZTsKCmZ1bmN0aW9uIGlzRXJyb3IoZSkgewogIHJldHVybiBpc09iamVjdChlKSAmJgogICAgICAob2JqZWN0VG9TdHJpbmcoZSkgPT09ICdbb2JqZWN0IEVycm9yXScgfHwgZSBpbnN0YW5jZW9mIEVycm9yKTsKfQpleHBvcnRzLmlzRXJyb3IgPSBpc0Vycm9yOwpleHBvcnRzLnR5cGVzLmlzTmF0aXZlRXJyb3IgPSBpc0Vycm9yOwoKZnVuY3Rpb24gaXNGdW5jdGlvbihhcmcpIHsKICByZXR1cm4gdHlwZW9mIGFyZyA9PT0gJ2Z1bmN0aW9uJzsKfQpleHBvcnRzLmlzRnVuY3Rpb24gPSBpc0Z1bmN0aW9uOwoKZnVuY3Rpb24gaXNQcmltaXRpdmUoYXJnKSB7CiAgcmV0dXJuIGFyZyA9PT0gbnVsbCB8fAogICAgICAgICB0eXBlb2YgYXJnID09PSAnYm9vbGVhbicgfHwKICAgICAgICAgdHlwZW9mIGFyZyA9PT0gJ251bWJlcicgfHwKICAgICAgICAgdHlwZW9mIGFyZyA9PT0gJ3N0cmluZycgfHwKICAgICAgICAgdHlwZW9mIGFyZyA9PT0gJ3N5bWJvbCcgfHwgIC8vIEVTNiBzeW1ib2wKICAgICAgICAgdHlwZW9mIGFyZyA9PT0gJ3VuZGVmaW5lZCc7Cn0KZXhwb3J0cy5pc1ByaW1pdGl2ZSA9IGlzUHJpbWl0aXZlOwoKZXhwb3J0cy5pc0J1ZmZlciA9IHJlcXVpcmUoJy4vc3VwcG9ydC9pc0J1ZmZlcicpOwoKZnVuY3Rpb24gb2JqZWN0VG9TdHJpbmcobykgewogIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobyk7Cn0KCgpmdW5jdGlvbiBwYWQobikgewogIHJldHVybiBuIDwgMTAgPyAnMCcgKyBuLnRvU3RyaW5nKDEwKSA6IG4udG9TdHJpbmcoMTApOwp9CgoKdmFyIG1vbnRocyA9IFsnSmFuJywgJ0ZlYicsICdNYXInLCAnQXByJywgJ01heScsICdKdW4nLCAnSnVsJywgJ0F1ZycsICdTZXAnLAogICAgICAgICAgICAgICdPY3QnLCAnTm92JywgJ0RlYyddOwoKLy8gMjYgRmViIDE2OjE5OjM0CmZ1bmN0aW9uIHRpbWVzdGFtcCgpIHsKICB2YXIgZCA9IG5ldyBEYXRlKCk7CiAgdmFyIHRpbWUgPSBbcGFkKGQuZ2V0SG91cnMoKSksCiAgICAgICAgICAgICAgcGFkKGQuZ2V0TWludXRlcygpKSwKICAgICAgICAgICAgICBwYWQoZC5nZXRTZWNvbmRzKCkpXS5qb2luKCc6Jyk7CiAgcmV0dXJuIFtkLmdldERhdGUoKSwgbW9udGhzW2QuZ2V0TW9udGgoKV0sIHRpbWVdLmpvaW4oJyAnKTsKfQoKCi8vIGxvZyBpcyBqdXN0IGEgdGhpbiB3cmFwcGVyIHRvIGNvbnNvbGUubG9nIHRoYXQgcHJlcGVuZHMgYSB0aW1lc3RhbXAKZXhwb3J0cy5sb2cgPSBmdW5jdGlvbigpIHsKICBjb25zb2xlLmxvZygnJXMgLSAlcycsIHRpbWVzdGFtcCgpLCBleHBvcnRzLmZvcm1hdC5hcHBseShleHBvcnRzLCBhcmd1bWVudHMpKTsKfTsKCgovKioKICogSW5oZXJpdCB0aGUgcHJvdG90eXBlIG1ldGhvZHMgZnJvbSBvbmUgY29uc3RydWN0b3IgaW50byBhbm90aGVyLgogKgogKiBUaGUgRnVuY3Rpb24ucHJvdG90eXBlLmluaGVyaXRzIGZyb20gbGFuZy5qcyByZXdyaXR0ZW4gYXMgYSBzdGFuZGFsb25lCiAqIGZ1bmN0aW9uIChub3Qgb24gRnVuY3Rpb24ucHJvdG90eXBlKS4gTk9URTogSWYgdGhpcyBmaWxlIGlzIHRvIGJlIGxvYWRlZAogKiBkdXJpbmcgYm9vdHN0cmFwcGluZyB0aGlzIGZ1bmN0aW9uIG5lZWRzIHRvIGJlIHJld3JpdHRlbiB1c2luZyBzb21lIG5hdGl2ZQogKiBmdW5jdGlvbnMgYXMgcHJvdG90eXBlIHNldHVwIHVzaW5nIG5vcm1hbCBKYXZhU2NyaXB0IGRvZXMgbm90IHdvcmsgYXMKICogZXhwZWN0ZWQgZHVyaW5nIGJvb3RzdHJhcHBpbmcgKHNlZSBtaXJyb3IuanMgaW4gcjExNDkwMykuCiAqCiAqIEBwYXJhbSB7ZnVuY3Rpb259IGN0b3IgQ29uc3RydWN0b3IgZnVuY3Rpb24gd2hpY2ggbmVlZHMgdG8gaW5oZXJpdCB0aGUKICogICAgIHByb3RvdHlwZS4KICogQHBhcmFtIHtmdW5jdGlvbn0gc3VwZXJDdG9yIENvbnN0cnVjdG9yIGZ1bmN0aW9uIHRvIGluaGVyaXQgcHJvdG90eXBlIGZyb20uCiAqLwpleHBvcnRzLmluaGVyaXRzID0gcmVxdWlyZSgnaW5oZXJpdHMnKTsKCmV4cG9ydHMuX2V4dGVuZCA9IGZ1bmN0aW9uKG9yaWdpbiwgYWRkKSB7CiAgLy8gRG9uJ3QgZG8gYW55dGhpbmcgaWYgYWRkIGlzbid0IGFuIG9iamVjdAogIGlmICghYWRkIHx8ICFpc09iamVjdChhZGQpKSByZXR1cm4gb3JpZ2luOwoKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKGFkZCk7CiAgdmFyIGkgPSBrZXlzLmxlbmd0aDsKICB3aGlsZSAoaS0tKSB7CiAgICBvcmlnaW5ba2V5c1tpXV0gPSBhZGRba2V5c1tpXV07CiAgfQogIHJldHVybiBvcmlnaW47Cn07CgpmdW5jdGlvbiBoYXNPd25Qcm9wZXJ0eShvYmosIHByb3ApIHsKICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCk7Cn0KCnZhciBrQ3VzdG9tUHJvbWlzaWZpZWRTeW1ib2wgPSB0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyA/IFN5bWJvbCgndXRpbC5wcm9taXNpZnkuY3VzdG9tJykgOiB1bmRlZmluZWQ7CgpleHBvcnRzLnByb21pc2lmeSA9IGZ1bmN0aW9uIHByb21pc2lmeShvcmlnaW5hbCkgewogIGlmICh0eXBlb2Ygb3JpZ2luYWwgIT09ICdmdW5jdGlvbicpCiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgIm9yaWdpbmFsIiBhcmd1bWVudCBtdXN0IGJlIG9mIHR5cGUgRnVuY3Rpb24nKTsKCiAgaWYgKGtDdXN0b21Qcm9taXNpZmllZFN5bWJvbCAmJiBvcmlnaW5hbFtrQ3VzdG9tUHJvbWlzaWZpZWRTeW1ib2xdKSB7CiAgICB2YXIgZm4gPSBvcmlnaW5hbFtrQ3VzdG9tUHJvbWlzaWZpZWRTeW1ib2xdOwogICAgaWYgKHR5cGVvZiBmbiAhPT0gJ2Z1bmN0aW9uJykgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgInV0aWwucHJvbWlzaWZ5LmN1c3RvbSIgYXJndW1lbnQgbXVzdCBiZSBvZiB0eXBlIEZ1bmN0aW9uJyk7CiAgICB9CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZm4sIGtDdXN0b21Qcm9taXNpZmllZFN5bWJvbCwgewogICAgICB2YWx1ZTogZm4sIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogZmFsc2UsIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgfSk7CiAgICByZXR1cm4gZm47CiAgfQoKICBmdW5jdGlvbiBmbigpIHsKICAgIHZhciBwcm9taXNlUmVzb2x2ZSwgcHJvbWlzZVJlamVjdDsKICAgIHZhciBwcm9taXNlID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICBwcm9taXNlUmVzb2x2ZSA9IHJlc29sdmU7CiAgICAgIHByb21pc2VSZWplY3QgPSByZWplY3Q7CiAgICB9KTsKCiAgICB2YXIgYXJncyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgYXJncy5wdXNoKGFyZ3VtZW50c1tpXSk7CiAgICB9CiAgICBhcmdzLnB1c2goZnVuY3Rpb24gKGVyciwgdmFsdWUpIHsKICAgICAgaWYgKGVycikgewogICAgICAgIHByb21pc2VSZWplY3QoZXJyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBwcm9taXNlUmVzb2x2ZSh2YWx1ZSk7CiAgICAgIH0KICAgIH0pOwoKICAgIHRyeSB7CiAgICAgIG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgIHByb21pc2VSZWplY3QoZXJyKTsKICAgIH0KCiAgICByZXR1cm4gcHJvbWlzZTsKICB9CgogIE9iamVjdC5zZXRQcm90b3R5cGVPZihmbiwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG9yaWdpbmFsKSk7CgogIGlmIChrQ3VzdG9tUHJvbWlzaWZpZWRTeW1ib2wpIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShmbiwga0N1c3RvbVByb21pc2lmaWVkU3ltYm9sLCB7CiAgICB2YWx1ZTogZm4sIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogZmFsc2UsIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0pOwogIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydGllcygKICAgIGZuLAogICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhvcmlnaW5hbCkKICApOwp9CgpleHBvcnRzLnByb21pc2lmeS5jdXN0b20gPSBrQ3VzdG9tUHJvbWlzaWZpZWRTeW1ib2wKCmZ1bmN0aW9uIGNhbGxiYWNraWZ5T25SZWplY3RlZChyZWFzb24sIGNiKSB7CiAgLy8gYCFyZWFzb25gIGd1YXJkIGluc3BpcmVkIGJ5IGJsdWViaXJkIChSZWY6IGh0dHBzOi8vZ29vLmdsL3Q1SVM2TSkuCiAgLy8gQmVjYXVzZSBgbnVsbGAgaXMgYSBzcGVjaWFsIGVycm9yIHZhbHVlIGluIGNhbGxiYWNrcyB3aGljaCBtZWFucyAibm8gZXJyb3IKICAvLyBvY2N1cnJlZCIsIHdlIGVycm9yLXdyYXAgc28gdGhlIGNhbGxiYWNrIGNvbnN1bWVyIGNhbiBkaXN0aW5ndWlzaCBiZXR3ZWVuCiAgLy8gInRoZSBwcm9taXNlIHJlamVjdGVkIHdpdGggbnVsbCIgb3IgInRoZSBwcm9taXNlIGZ1bGZpbGxlZCB3aXRoIHVuZGVmaW5lZCIuCiAgaWYgKCFyZWFzb24pIHsKICAgIHZhciBuZXdSZWFzb24gPSBuZXcgRXJyb3IoJ1Byb21pc2Ugd2FzIHJlamVjdGVkIHdpdGggYSBmYWxzeSB2YWx1ZScpOwogICAgbmV3UmVhc29uLnJlYXNvbiA9IHJlYXNvbjsKICAgIHJlYXNvbiA9IG5ld1JlYXNvbjsKICB9CiAgcmV0dXJuIGNiKHJlYXNvbik7Cn0KCmZ1bmN0aW9uIGNhbGxiYWNraWZ5KG9yaWdpbmFsKSB7CiAgaWYgKHR5cGVvZiBvcmlnaW5hbCAhPT0gJ2Z1bmN0aW9uJykgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVGhlICJvcmlnaW5hbCIgYXJndW1lbnQgbXVzdCBiZSBvZiB0eXBlIEZ1bmN0aW9uJyk7CiAgfQoKICAvLyBXZSBETyBOT1QgcmV0dXJuIHRoZSBwcm9taXNlIGFzIGl0IGdpdmVzIHRoZSB1c2VyIGEgZmFsc2Ugc2Vuc2UgdGhhdAogIC8vIHRoZSBwcm9taXNlIGlzIGFjdHVhbGx5IHNvbWVob3cgcmVsYXRlZCB0byB0aGUgY2FsbGJhY2sncyBleGVjdXRpb24KICAvLyBhbmQgdGhhdCB0aGUgY2FsbGJhY2sgdGhyb3dpbmcgd2lsbCByZWplY3QgdGhlIHByb21pc2UuCiAgZnVuY3Rpb24gY2FsbGJhY2tpZmllZCgpIHsKICAgIHZhciBhcmdzID0gW107CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICBhcmdzLnB1c2goYXJndW1lbnRzW2ldKTsKICAgIH0KCiAgICB2YXIgbWF5YmVDYiA9IGFyZ3MucG9wKCk7CiAgICBpZiAodHlwZW9mIG1heWJlQ2IgIT09ICdmdW5jdGlvbicpIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVGhlIGxhc3QgYXJndW1lbnQgbXVzdCBiZSBvZiB0eXBlIEZ1bmN0aW9uJyk7CiAgICB9CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgY2IgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIG1heWJlQ2IuYXBwbHkoc2VsZiwgYXJndW1lbnRzKTsKICAgIH07CiAgICAvLyBJbiB0cnVlIG5vZGUgc3R5bGUgd2UgcHJvY2VzcyB0aGUgY2FsbGJhY2sgb24gYG5leHRUaWNrYCB3aXRoIGFsbCB0aGUKICAgIC8vIGltcGxpY2F0aW9ucyAoc3RhY2ssIGB1bmNhdWdodEV4Y2VwdGlvbmAsIGBhc3luY19ob29rc2ApCiAgICBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmdzKQogICAgICAudGhlbihmdW5jdGlvbihyZXQpIHsgcHJvY2Vzcy5uZXh0VGljayhjYi5iaW5kKG51bGwsIG51bGwsIHJldCkpIH0sCiAgICAgICAgICAgIGZ1bmN0aW9uKHJlaikgeyBwcm9jZXNzLm5leHRUaWNrKGNhbGxiYWNraWZ5T25SZWplY3RlZC5iaW5kKG51bGwsIHJlaiwgY2IpKSB9KTsKICB9CgogIE9iamVjdC5zZXRQcm90b3R5cGVPZihjYWxsYmFja2lmaWVkLCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob3JpZ2luYWwpKTsKICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhjYWxsYmFja2lmaWVkLAogICAgICAgICAgICAgICAgICAgICAgICAgIGdldE93blByb3BlcnR5RGVzY3JpcHRvcnMob3JpZ2luYWwpKTsKICByZXR1cm4gY2FsbGJhY2tpZmllZDsKfQpleHBvcnRzLmNhbGxiYWNraWZ5ID0gY2FsbGJhY2tpZnk7Cgp9KS5jYWxsKHRoaXMpfSkuY2FsbCh0aGlzLHJlcXVpcmUoJ19wcm9jZXNzJykpCn0seyIuL3N1cHBvcnQvaXNCdWZmZXIiOjM5LCIuL3N1cHBvcnQvdHlwZXMiOjQwLCJfcHJvY2VzcyI6MzgsImluaGVyaXRzIjozMn1dLDQyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKKGZ1bmN0aW9uIChnbG9iYWwpeyhmdW5jdGlvbiAoKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIGZvckVhY2ggPSByZXF1aXJlKCdmb3JlYWNoJyk7CnZhciBhdmFpbGFibGVUeXBlZEFycmF5cyA9IHJlcXVpcmUoJ2F2YWlsYWJsZS10eXBlZC1hcnJheXMnKTsKdmFyIGNhbGxCb3VuZCA9IHJlcXVpcmUoJ2NhbGwtYmluZC9jYWxsQm91bmQnKTsKCnZhciAkdG9TdHJpbmcgPSBjYWxsQm91bmQoJ09iamVjdC5wcm90b3R5cGUudG9TdHJpbmcnKTsKdmFyIGhhc1N5bWJvbHMgPSByZXF1aXJlKCdoYXMtc3ltYm9scycpKCk7CnZhciBoYXNUb1N0cmluZ1RhZyA9IGhhc1N5bWJvbHMgJiYgdHlwZW9mIFN5bWJvbC50b1N0cmluZ1RhZyA9PT0gJ3N5bWJvbCc7Cgp2YXIgdHlwZWRBcnJheXMgPSBhdmFpbGFibGVUeXBlZEFycmF5cygpOwoKdmFyICRzbGljZSA9IGNhbGxCb3VuZCgnU3RyaW5nLnByb3RvdHlwZS5zbGljZScpOwp2YXIgdG9TdHJUYWdzID0ge307CnZhciBnT1BEID0gcmVxdWlyZSgnZXMtYWJzdHJhY3QvaGVscGVycy9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3InKTsKdmFyIGdldFByb3RvdHlwZU9mID0gT2JqZWN0LmdldFByb3RvdHlwZU9mOyAvLyByZXF1aXJlKCdnZXRwcm90b3R5cGVvZicpOwppZiAoaGFzVG9TdHJpbmdUYWcgJiYgZ09QRCAmJiBnZXRQcm90b3R5cGVPZikgewoJZm9yRWFjaCh0eXBlZEFycmF5cywgZnVuY3Rpb24gKHR5cGVkQXJyYXkpIHsKCQlpZiAodHlwZW9mIGdsb2JhbFt0eXBlZEFycmF5XSA9PT0gJ2Z1bmN0aW9uJykgewoJCQl2YXIgYXJyID0gbmV3IGdsb2JhbFt0eXBlZEFycmF5XSgpOwoJCQlpZiAoIShTeW1ib2wudG9TdHJpbmdUYWcgaW4gYXJyKSkgewoJCQkJdGhyb3cgbmV3IEV2YWxFcnJvcigndGhpcyBlbmdpbmUgaGFzIHN1cHBvcnQgZm9yIFN5bWJvbC50b1N0cmluZ1RhZywgYnV0ICcgKyB0eXBlZEFycmF5ICsgJyBkb2VzIG5vdCBoYXZlIHRoZSBwcm9wZXJ0eSEgUGxlYXNlIHJlcG9ydCB0aGlzLicpOwoJCQl9CgkJCXZhciBwcm90byA9IGdldFByb3RvdHlwZU9mKGFycik7CgkJCXZhciBkZXNjcmlwdG9yID0gZ09QRChwcm90bywgU3ltYm9sLnRvU3RyaW5nVGFnKTsKCQkJaWYgKCFkZXNjcmlwdG9yKSB7CgkJCQl2YXIgc3VwZXJQcm90byA9IGdldFByb3RvdHlwZU9mKHByb3RvKTsKCQkJCWRlc2NyaXB0b3IgPSBnT1BEKHN1cGVyUHJvdG8sIFN5bWJvbC50b1N0cmluZ1RhZyk7CgkJCX0KCQkJdG9TdHJUYWdzW3R5cGVkQXJyYXldID0gZGVzY3JpcHRvci5nZXQ7CgkJfQoJfSk7Cn0KCnZhciB0cnlUeXBlZEFycmF5cyA9IGZ1bmN0aW9uIHRyeUFsbFR5cGVkQXJyYXlzKHZhbHVlKSB7Cgl2YXIgZm91bmROYW1lID0gZmFsc2U7Cglmb3JFYWNoKHRvU3RyVGFncywgZnVuY3Rpb24gKGdldHRlciwgdHlwZWRBcnJheSkgewoJCWlmICghZm91bmROYW1lKSB7CgkJCXRyeSB7CgkJCQl2YXIgbmFtZSA9IGdldHRlci5jYWxsKHZhbHVlKTsKCQkJCWlmIChuYW1lID09PSB0eXBlZEFycmF5KSB7CgkJCQkJZm91bmROYW1lID0gbmFtZTsKCQkJCX0KCQkJfSBjYXRjaCAoZSkge30KCQl9Cgl9KTsKCXJldHVybiBmb3VuZE5hbWU7Cn07Cgp2YXIgaXNUeXBlZEFycmF5ID0gcmVxdWlyZSgnaXMtdHlwZWQtYXJyYXknKTsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gd2hpY2hUeXBlZEFycmF5KHZhbHVlKSB7CglpZiAoIWlzVHlwZWRBcnJheSh2YWx1ZSkpIHsgcmV0dXJuIGZhbHNlOyB9CglpZiAoIWhhc1RvU3RyaW5nVGFnKSB7IHJldHVybiAkc2xpY2UoJHRvU3RyaW5nKHZhbHVlKSwgOCwgLTEpOyB9CglyZXR1cm4gdHJ5VHlwZWRBcnJheXModmFsdWUpOwp9OwoKfSkuY2FsbCh0aGlzKX0pLmNhbGwodGhpcyx0eXBlb2YgZ2xvYmFsICE9PSAidW5kZWZpbmVkIiA/IGdsb2JhbCA6IHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIiA/IHdpbmRvdyA6IHt9KQp9LHsiYXZhaWxhYmxlLXR5cGVkLWFycmF5cyI6MTcsImNhbGwtYmluZC9jYWxsQm91bmQiOjIwLCJlcy1hYnN0cmFjdC9oZWxwZXJzL2dldE93blByb3BlcnR5RGVzY3JpcHRvciI6MjMsImZvcmVhY2giOjI0LCJoYXMtc3ltYm9scyI6MjgsImlzLXR5cGVkLWFycmF5IjozNn1dLCJtdWRvbSI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewooZnVuY3Rpb24oKSB7CiAgJ3VzZSBzdHJpY3QnOwogIHZhciBEb20sIElOVEVSVEVYVCwgVGV4dCwgZGVidWcsIGlzYSwgbG91cGUsIG1pc2ZpdCwgdHlwZXMsIHZhbGlkYXRlOwoKICBsb3VwZSA9IHJlcXVpcmUoJy4uL2xvdXBlLmpzJyk7CgogIG1pc2ZpdCA9IFN5bWJvbCgnbWlzZml0Jyk7CgogIGRlYnVnID0gY29uc29sZS5kZWJ1ZzsKCiAgKHt0eXBlcywgaXNhLCB2YWxpZGF0ZX0gPSByZXF1aXJlKCcuL3R5cGVzJykpOwoKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgSU5URVJURVhUID0gewogICAgY2FtZWxpemU6IGZ1bmN0aW9uKHRleHQpIHsKICAgICAgLyogdGh4IHRvIGh0dHBzOi8vZ2l0aHViLmNvbS9sb2Rhc2gvbG9kYXNoL2Jsb2IvbWFzdGVyL2NhbWVsQ2FzZS5qcyAqLwogICAgICB2YXIgaSwgaWR4LCByZWYsIHdvcmQsIHdvcmRzOwogICAgICB3b3JkcyA9IHRleHQuc3BsaXQoJy0nKTsKICAgICAgZm9yIChpZHggPSBpID0gMSwgcmVmID0gd29yZHMubGVuZ3RoOyBpIDwgcmVmOyBpZHggPSBpICs9ICsxKSB7CiAgICAgICAgd29yZCA9IHdvcmRzW2lkeF07CiAgICAgICAgaWYgKHdvcmQgPT09ICcnKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgd29yZHNbaWR4XSA9IHdvcmRbMF0udG9VcHBlckNhc2UoKSArIHdvcmQuc2xpY2UoMSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHdvcmRzLmpvaW4oJycpOwogICAgfQogIH07CgogIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIFRleHQgPSBjbGFzcyBUZXh0IHsKICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBycHIoeCkgewogICAgICByZXR1cm4gbG91cGUuaW5zcGVjdCh4KTsKICAgIH0KCiAgICBfcGVuMSh4KSB7CiAgICAgIGlmIChpc2EudGV4dCh4KSkgewogICAgICAgIHJldHVybiB4OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB0aGlzLnJwcih4KTsKICAgICAgfQogICAgfQoKICAgIHBlbiguLi5QKSB7CiAgICAgIHJldHVybiAoUC5tYXAoKHgpID0+IHsKICAgICAgICByZXR1cm4gdGhpcy5fcGVuMSh4KTsKICAgICAgfSkpLmpvaW4oJyAnKTsKICAgIH0KCiAgICBwZW5fZXNjYXBlKC4uLlApIHsKICAgICAgcmV0dXJuIChQLm1hcCgoeCkgPT4gewogICAgICAgIHJldHVybiB0aGlzLl9wZW5fZXNjYXBlMSh4KTsKICAgICAgfSkpLmpvaW4oJyAnKTsKICAgIH0KCiAgICBsb2coLi4uUCkgewogICAgICByZXR1cm4gY29uc29sZS5sb2codGhpcy5wZW4oLi4uUCkpOwogICAgfQoKICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBfcGVuX2VzY2FwZTEoeCkgewogICAgICBpZiAoaXNhLnRleHQoeCkpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZXNjYXBlKHgpOwogICAgICB9CiAgICAgIGlmIChpc2EuZWxlbWVudCh4KSkgewogICAgICAgIHJldHVybiB0aGlzLl9lc2NhcGUoeC5vdXRlckhUTUwpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLnJwcih4KTsKICAgIH0KCiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgX2VzY2FwZSh4KSB7CiAgICAgIHJldHVybiB4LnJlcGxhY2UoLyYvZywgJyZhbXA7JykucmVwbGFjZSgvPC9nLCAnJmx0OycpLnJlcGxhY2UoLz4vZywgJyZndDsnKTsKICAgIH0KCiAgfTsKCiAgRG9tID0gKGZ1bmN0aW9uKCkgewogICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGNsYXNzIERvbSB7IC8vIGV4dGVuZHMgTXVsdGltaXgKICAgICAgLyogaW5zcGlyZWQgYnkgaHR0cDovL3lvdW1pZ2h0bm90bmVlZGpxdWVyeS5jb20KICAgICAgIGFuZCBodHRwczovL2Jsb2cuZ2Fyc3Rhc2lvLmNvbS95b3UtZG9udC1uZWVkLWpxdWVyeSAqLwogICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgcmVhZHkoZikgewogICAgICAgIC8vIHRoeCB0byBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvNzA1MzE5Ny83NTY4MDkxCiAgICAgICAgLy8gZnVuY3Rpb24gcihmKXsvaW4vLnRlc3QoZG9jdW1lbnQucmVhZHlTdGF0ZSk/c2V0VGltZW91dChyLDksZik6ZigpfQogICAgICAgIHZhbGlkYXRlLmZ1bmN0aW9uKGYpOwogICAgICAgIGlmICgvaW4vLnRlc3QoZG9jdW1lbnQucmVhZHlTdGF0ZSkpIHsKICAgICAgICAgIHJldHVybiBzZXRUaW1lb3V0KCgoKSA9PiB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlYWR5KGYpOwogICAgICAgICAgfSksIDkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZigpOwogICAgICB9CgogICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICAvLyBXQVJOSU5HUywgTk9USUZJQ0FUSU9OUwogICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICBfbm90aWZ5KG1lc3NhZ2UpIHsKICAgICAgICB2YXIgYm9keSwgaWQsIG1lc3NhZ2VfYm94LCBtZXNzYWdlX3AsIHN0eWxlOwogICAgICAgIGlkID0gJ21zZ2J4NDk1NzMnOwogICAgICAgIG1lc3NhZ2VfYm94ID0gdGhpcy5zZWxlY3QoYCR7aWR9YCwgbnVsbCk7CiAgICAgICAgaWYgKG1lc3NhZ2VfYm94ID09PSBudWxsKSB7CiAgICAgICAgICBib2R5ID0gdGhpcy5zZWxlY3QoJ2JvZHknLCBudWxsKTsKICAgICAgICAgIC8qIFRBSU5UIGJvZHkgZWxlbWVudCBjYW5ub3QgYmUgZm91bmQgd2hlbiBtZXRob2QgaXMgY2FsbGVkIGJlZm9yZSBkb2N1bWVudCByZWFkeSwgYnV0IHdlIGNvdWxkIHN0aWxsCiAgICAgICAgICAgICAgIGNvbnN0cnVjdCBlbGVtZW50IGltbWVkaWF0ZWx5LCBhcHBlbmQgaXQgb24gZG9jdW1lbnQgcmVhZHkgKi8KICAgICAgICAgIGlmIChib2R5ID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgc3R5bGUgPSAiYmFja2dyb3VuZDojMTgxNzFkOyI7CiAgICAgICAgICBzdHlsZSArPSAicG9zaXRpb246Zml4ZWQ7IjsKICAgICAgICAgIHN0eWxlICs9ICJib3R0b206MG1tOyI7CiAgICAgICAgICBzdHlsZSArPSAiYm9yZGVyOjFtbSBkYXNoZWQgI2UyZmYwMDsiOwogICAgICAgICAgc3R5bGUgKz0gInBhZGRpbmctbGVmdDozbW07IjsKICAgICAgICAgIHN0eWxlICs9ICJwYWRkaW5nLXJpZ2h0OjNtbTsiOwogICAgICAgICAgc3R5bGUgKz0gInBhZGRpbmctYm90dG9tOjNtbTsiOwogICAgICAgICAgc3R5bGUgKz0gImZvbnQtZmFtaWx5OnNhbnMtc2VyaWY7IjsKICAgICAgICAgIHN0eWxlICs9ICJmb250LXdlaWdodDpib2xkICFpbXBvcnRhbnQ7IjsKICAgICAgICAgIHN0eWxlICs9ICJmb250LXNpemU6M21tOyI7CiAgICAgICAgICBzdHlsZSArPSAiY29sb3I6I2UyZmYwMDsiOwogICAgICAgICAgc3R5bGUgKz0gIndpZHRoOjEwMCU7IjsKICAgICAgICAgIHN0eWxlICs9ICJtYXgtaGVpZ2h0OjMwbW07IjsKICAgICAgICAgIHN0eWxlICs9ICJvdmVyZmxvdy15OnNjcm9sbDsiOwogICAgICAgICAgbWVzc2FnZV9ib3ggPSB0aGlzLnBhcnNlX29uZShgPGRpdiBpZD0ke2lkfSBzdHlsZT0nJHtzdHlsZX0nPjwvZGl2PmApOwogICAgICAgICAgdGhpcy5hcHBlbmQoYm9keSwgbWVzc2FnZV9ib3gpOwogICAgICAgIH0KICAgICAgICBtZXNzYWdlX3AgPSAiPHAgc3R5bGU9J3BhZGRpbmctdG9wOjNtbTsnPiI7CiAgICAgICAgbWVzc2FnZV9wICs9ICLimqDvuI8mbmJzcDs8c3Ryb25nPiI7CiAgICAgICAgbWVzc2FnZV9wICs9IMK1LlRFWFQucGVuX2VzY2FwZShtZXNzYWdlKTsKICAgICAgICBtZXNzYWdlX3AgKz0gIjwvc3Ryb25nPjwvcD4iOwogICAgICAgIG1lc3NhZ2VfcCA9IHRoaXMucGFyc2Vfb25lKG1lc3NhZ2VfcCk7CiAgICAgICAgdGhpcy5pbnNlcnRfYXNfbGFzdChtZXNzYWdlX2JveCwgbWVzc2FnZV9wKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgd2FybiguLi5QKSB7CiAgICAgICAgLyogQ29uc3RydWN0IGEgdGV4dCBtZXNzYWdlIGZvciBkaXNwbGF5IGluIGNvbnNvbGUgYW5kIGluIG5vdGlmaWNhdGlvbiBib3gsIGFsb25nc2lkZSB3aXRoIGEgc3RhY2sgdHJhY2UKICAgICAgICAgICB0byBiZSBzaG93biBvbmx5IGluIHRoZSBjb25zb2xlLCBwcmVjZWQgYnkgdGhlIG9yaWdpbmFsIGFyZ3VtZW50cyBhcyBwYXNzZWQgaW50byB0aGlzIGZ1bmN0aW9uLAogICAgICAgICAgIG1lYW5pbmcgdGhhdCBhbnkgRE9NIGVsZW1lbnRzIHdpbGwgYmUgZXhwYW5kYWJsZSBsaW5rcyB0byB0aGVpciB2aXNpYmxlIHJlcHJlc2VudGF0aW9ucyBvbiB0aGUgSFRNTAogICAgICAgICAgIHBhZ2UuICovCiAgICAgICAgdmFyIGVycm9yLCBtZXNzYWdlOwogICAgICAgIG1lc3NhZ2UgPSDCtS5URVhULnBlbiguLi5QKTsKICAgICAgICBlcnJvciA9IG5ldyBFcnJvcihtZXNzYWdlKTsKICAgICAgICBjb25zb2xlLmdyb3VwQ29sbGFwc2VkKFBbMF0pOwogICAgICAgIGNvbnNvbGUud2FybiguLi5QKTsKICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX25vdGlmeShtZXNzYWdlKTsKICAgICAgfQoKICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIC8qIE5PVEUgYMK1LkRPTS5zZWxlY3QoKWAgdG8gYmUgZGVwcmVjYXRlZCBpbiBmYXZvciBvZiBgwrUuRE9NLnNlbGVjdF9maXJzdCgpYCAqLwogICAgICBzZWxlY3Qoc2VsZWN0b3IsIGZhbGxiYWNrID0gbWlzZml0KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0X2ZpcnN0KGRvY3VtZW50LCBzZWxlY3RvciwgZmFsbGJhY2spOwogICAgICB9CgogICAgICBzZWxlY3RfZmlyc3Qoc2VsZWN0b3IsIGZhbGxiYWNrID0gbWlzZml0KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0X2Zyb20oZG9jdW1lbnQsIHNlbGVjdG9yLCBmYWxsYmFjayk7CiAgICAgIH0KCiAgICAgIHNlbGVjdF9hbGwoc2VsZWN0b3IpIHsKICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RfYWxsX2Zyb20oZG9jdW1lbnQsIHNlbGVjdG9yKTsKICAgICAgfQoKICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgLyogTk9URSBgwrUuRE9NLnNlbGVjdF9mcm9tKClgIHRvIGJlIGRlcHJlY2F0ZWQgaW4gZmF2b3Igb2YgYMK1LkRPTS5zZWxlY3RfZmlyc3RfZnJvbSgpYCAqLwogICAgICBzZWxlY3RfZnJvbShlbGVtZW50LCBzZWxlY3RvciwgZmFsbGJhY2sgPSBtaXNmaXQpIHsKICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RfZmlyc3RfZnJvbShlbGVtZW50LCBzZWxlY3RvciwgZmFsbGJhY2spOwogICAgICB9CgogICAgICBzZWxlY3RfZmlyc3RfZnJvbShlbGVtZW50LCBzZWxlY3RvciwgZmFsbGJhY2sgPSBtaXNmaXQpIHsKICAgICAgICB2YXIgUjsKICAgICAgICB2YWxpZGF0ZS5kZWxlbWVudChlbGVtZW50KTsKICAgICAgICB2YWxpZGF0ZS5ub25lbXB0eV90ZXh0KHNlbGVjdG9yKTsKICAgICAgICBpZiAoKFIgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpKSA9PSBudWxsKSB7CiAgICAgICAgICBpZiAoZmFsbGJhY2sgPT09IG1pc2ZpdCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYF7CtURPTS9zZWxlY3RfZnJvbUA3NzU4XiBubyBzdWNoIGVsZW1lbnQ6ICR7wrUuVEVYVC5ycHIoc2VsZWN0b3IpfWApOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZhbGxiYWNrOwogICAgICAgIH0KICAgICAgICByZXR1cm4gUjsKICAgICAgfQoKICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgc2VsZWN0X2FsbF9mcm9tKGVsZW1lbnQsIHNlbGVjdG9yKSB7CiAgICAgICAgdmFsaWRhdGUuZGVsZW1lbnQoZWxlbWVudCk7CiAgICAgICAgdmFsaWRhdGUubm9uZW1wdHlfdGV4dChzZWxlY3Rvcik7CiAgICAgICAgcmV0dXJuIGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICAgIH0KCiAgICAgIC8vIEFycmF5LmZyb20gZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsIHNlbGVjdG9yCgogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIHNlbGVjdF9pZChpZCwgZmFsbGJhY2sgPSBtaXNmaXQpIHsKICAgICAgICB2YXIgUjsKICAgICAgICB2YWxpZGF0ZS5ub25lbXB0eV90ZXh0KGlkKTsKICAgICAgICBpZiAoKFIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkpID09IG51bGwpIHsKICAgICAgICAgIGlmIChmYWxsYmFjayA9PT0gbWlzZml0KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgXsK1RE9NL3NlbGVjdF9pZEA3NzU4XiBubyBlbGVtZW50IHdpdGggSUQ6ICR7wrUuVEVYVC5ycHIoaWQpfWApOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZhbGxiYWNrOwogICAgICAgIH0KICAgICAgICByZXR1cm4gUjsKICAgICAgfQoKICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgbWF0Y2hlc19zZWxlY3RvcihlbGVtZW50LCBzZWxlY3RvcikgewogICAgICAgIGlmICghaXNhLmZ1bmN0aW9uKGVsZW1lbnQgIT0gbnVsbCA/IGVsZW1lbnQubWF0Y2hlcyA6IHZvaWQgMCkpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgXsK1RE9NL3NlbGVjdF9pZEA3NzU4MV4gZXhwZWN0ZWQgZWxlbWVudCB3aXRoIFxgbWF0Y2goKVxgIG1ldGhvZCwgZ290ICR7wrUuVEVYVC5ycHIoZWxlbWVudCl9YCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBlbGVtZW50Lm1hdGNoZXMoc2VsZWN0b3IpOwogICAgICB9CgogICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICBnZXQoZWxlbWVudCwgbmFtZSkgewogICAgICAgIHZhbGlkYXRlLmVsZW1lbnQoZWxlbWVudCk7CiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0QXR0cmlidXRlKG5hbWUpOwogICAgICB9CgogICAgICBnZXRfbnVtZXJpYyhlbGVtZW50LCBuYW1lKSB7CiAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQodGhpcy5nZXQoZWxlbWVudCwgbmFtZSkpOwogICAgICB9CgogICAgICAvLyBXaGVuIGNhbGxlZCB3aXRoIHR3byBhcmd1bWVudHMgYXMgaW4gYHNldCBkaXYsICdiYXInYCwgd2lsbCBzZXQgdmFsdWVzLWxlc3MgYXR0cmlidXRlIChgPGRpdiBiYXI+YCkKICAgICAgc2V0KGVsZW1lbnQsIG5hbWUsIHZhbHVlID0gJycpIHsKICAgICAgICB2YWxpZGF0ZS5lbGVtZW50KGVsZW1lbnQpOwogICAgICAgIHJldHVybiBlbGVtZW50LnNldEF0dHJpYnV0ZShuYW1lLCB2YWx1ZSk7CiAgICAgIH0KCiAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIGdldF9jbGFzc2VzKGVsZW1lbnQpIHsKICAgICAgICB2YWxpZGF0ZS5lbGVtZW50KGVsZW1lbnQpOwogICAgICAgIHJldHVybiBlbGVtZW50LmNsYXNzTGlzdDsKICAgICAgfQoKICAgICAgYWRkX2NsYXNzKGVsZW1lbnQsIG5hbWUpIHsKICAgICAgICB2YWxpZGF0ZS5lbGVtZW50KGVsZW1lbnQpOwogICAgICAgIHJldHVybiBlbGVtZW50LmNsYXNzTGlzdC5hZGQobmFtZSk7CiAgICAgIH0KCiAgICAgIGhhc19jbGFzcyhlbGVtZW50LCBuYW1lKSB7CiAgICAgICAgdmFsaWRhdGUuZWxlbWVudChlbGVtZW50KTsKICAgICAgICByZXR1cm4gZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMobmFtZSk7CiAgICAgIH0KCiAgICAgIHJlbW92ZV9jbGFzcyhlbGVtZW50LCBuYW1lKSB7CiAgICAgICAgdmFsaWRhdGUuZWxlbWVudChlbGVtZW50KTsKICAgICAgICByZXR1cm4gZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKG5hbWUpOwogICAgICB9CgogICAgICB0b2dnbGVfY2xhc3MoZWxlbWVudCwgbmFtZSkgewogICAgICAgIHZhbGlkYXRlLmVsZW1lbnQoZWxlbWVudCk7CiAgICAgICAgcmV0dXJuIGVsZW1lbnQuY2xhc3NMaXN0LnRvZ2dsZShuYW1lKTsKICAgICAgfQoKICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgc3dhcF9jbGFzcyhlbGVtZW50LCBvbGRfbmFtZSwgbmV3X25hbWUpIHsKICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUob2xkX25hbWUpOwogICAgICAgIHJldHVybiBlbGVtZW50LmNsYXNzTGlzdC5hZGQobmV3X25hbWUpOwogICAgICB9CgogICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICBoaWRlKGVsZW1lbnQpIHsKICAgICAgICB2YWxpZGF0ZS5lbGVtZW50KGVsZW1lbnQpOwogICAgICAgIHJldHVybiBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgIH0KCiAgICAgIHNob3coZWxlbWVudCkgewogICAgICAgIHZhbGlkYXRlLmVsZW1lbnQoZWxlbWVudCk7CiAgICAgICAgcmV0dXJuIGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICcnOwogICAgICB9CgogICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICBnZXRfbGl2ZV9zdHlsZXMoZWxlbWVudCkgewogICAgICAgIHJldHVybiBnZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQpOwogICAgICB9CgogICAgICAvKgogICAgICBnbG9iYWxUaGlzLmdldF9zdHlsZSA9ICggZWxlbWVudCwgcHNldWRvX3NlbGVjdG9yLCBhdHRyaWJ1dGVfbmFtZSApIC0+CiAgICAgICAgdW5sZXNzIGF0dHJpYnV0ZV9uYW1lPwogICAgICAgICAgWyBwc2V1ZG9fc2VsZWN0b3IsIGF0dHJpYnV0ZV9uYW1lLCBdID0gWyB1bmRlZmluZWQsIHBzZXVkb19zZWxlY3RvciwgXQogICAgICAgIHN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUgZWxlbWVudCwgcHNldWRvX3NlbGVjdG9yCiAgICAgICAgcmV0dXJuIHN0eWxlLmdldFByb3BlcnR5VmFsdWUgYXR0cmlidXRlX25hbWUKICAgICAgKi8KICAgICAgLyogVEFJTlQgYWxzbyB1c2UgcHNldWRvX3NlbGVjdG9yLCBzZWUgYWJvdmUgKi8KICAgICAgLyogdmFsaWRhdGlvbiBkb25lIGJ5IG1ldGhvZCAqLwogICAgICAvKiB2YWxpZGF0aW9uIGRvbmUgYnkgbWV0aG9kICovICAgICAgZ2V0X3N0eWxlX3ZhbHVlKGVsZW1lbnQsIG5hbWUpIHsKICAgICAgICByZXR1cm4gKGdldENvbXB1dGVkU3R5bGUoZWxlbWVudCkpW25hbWVdOwogICAgICB9CgogICAgICBnZXRfbnVtZXJpY19zdHlsZV92YWx1ZShlbGVtZW50LCBuYW1lKSB7CiAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoKGdldENvbXB1dGVkU3R5bGUoZWxlbWVudCkpW25hbWVdKTsKICAgICAgfQoKICAgICAgLyogdGh4IHRvIGh0dHBzOi8vZGF2aWR3YWxzaC5uYW1lL2Nzcy12YXJpYWJsZXMtamF2YXNjcmlwdCAqLwogICAgICBnZXRfcHJvcF92YWx1ZShlbGVtZW50LCBuYW1lKSB7CiAgICAgICAgcmV0dXJuIChnZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQpKS5nZXRQcm9wZXJ0eVZhbHVlKG5hbWUpOwogICAgICB9CgogICAgICBnZXRfbnVtZXJpY19wcm9wX3ZhbHVlKGVsZW1lbnQsIG5hbWUpIHsKICAgICAgICByZXR1cm4gcGFyc2VGbG9hdCgoZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50KSkuZ2V0UHJvcGVydHlWYWx1ZShuYW1lKSk7CiAgICAgIH0KCiAgICAgIC8qIHRoeCB0byBodHRwczovL2Rhdmlkd2Fsc2gubmFtZS9jc3MtdmFyaWFibGVzLWphdmFzY3JpcHQgKi8KICAgICAgZ2V0X2dsb2JhbF9wcm9wX3ZhbHVlKG5hbWUpIHsKICAgICAgICByZXR1cm4gKGdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQpKS5nZXRQcm9wZXJ0eVZhbHVlKG5hbWUpOwogICAgICB9CgogICAgICBnZXRfbnVtZXJpY19nbG9iYWxfcHJvcF92YWx1ZShuYW1lKSB7CiAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoKGdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQpKS5nZXRQcm9wZXJ0eVZhbHVlKG5hbWUpKTsKICAgICAgfQoKICAgICAgc2V0X2dsb2JhbF9wcm9wX3ZhbHVlKG5hbWUsIHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eShuYW1lLCB2YWx1ZSk7CiAgICAgIH0KCiAgICAgIC8vICMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAvLyBzZXRfcHJvcF9kZWZhdWx0cyA9IC0+CiAgICAgIC8vICAgIyMjIFRoZXJlIHNob3VkIGJlIGEgYmV0dGVyIHdheSB0byBpbmplY3Qgc3R5bGVzICMjIwogICAgICAvLyAgIHJldHVybiBudWxsIGlmIF9zZXRfcHJvcF9kZWZhdWx0cwogICAgICAvLyAgICMgaGVhZF9kb20gPSDCtS5ET00uc2VsZWN0X2ZpcnN0ICdoZWFkJwogICAgICAvLyAgICMgc3R5bGVfdHh0ID0gIiIiCiAgICAgIC8vICAgIyA8c3R5bGU+CiAgICAgIC8vICAgIyAgICogewogICAgICAvLyAgICMgICAgIG91dGxpbmU6ICAgICAgIDJweCBzb2xpZCB5ZWxsb3c7IH0KICAgICAgLy8gICAjICAgPC9zdHlsZT4KICAgICAgLy8gICAjICIiIgogICAgICAvLyAgICMgaGVhZF9kb20uaW5uZXJIVE1MID0gc3R5bGVfdHh0ICsgaGVhZF9kb20uaW5uZXJIVE1MCiAgICAgIC8vICAgdG9waGF0X2RvbSA9IMK1LkRPTS5zZWxlY3RfZmlyc3QgJyN0b3BoYXQnCiAgICAgIC8vICAgwrUuRE9NLmluc2VydF9iZWZvcmUgdG9waGF0X2RvbSwgwrUuRE9NLnBhcnNlX29uZSAiIiIKICAgICAgLy8gICA8c3R5bGU+CiAgICAgIC8vICAgICAqIHsKICAgICAgLy8gICAgICAgb3V0bGluZTogICAgICAgMnB4IHNvbGlkIHllbGxvdzsgfQogICAgICAvLyAgICAgOnJvb3QgewogICAgICAvLyAgICAgICAtLWhzdG4tc2xpZGVyLXRyYWNrLWJnY29sb3I6ICAgIGxpbWU7IH0KICAgICAgLy8gICAgIDwvc3R5bGU+CiAgICAgIC8vICAgIiIiCiAgICAgIC8vICAgcmV0dXJuIG51bGwKCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgc2V0X3N0eWxlX3J1bGUoZWxlbWVudCwgbmFtZSwgdmFsdWUpIHsKICAgICAgICAvKiBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0VsZW1lbnRDU1NJbmxpbmVTdHlsZS9zdHlsZSAqLwogICAgICAgIHZhbGlkYXRlLmVsZW1lbnQoZWxlbWVudCk7CiAgICAgICAgdmFsaWRhdGUubm9uZW1wdHlfdGV4dChuYW1lKTsKICAgICAgICByZXR1cm4gZWxlbWVudC5zdHlsZVtJTlRFUlRFWFQuY2FtZWxpemUobmFtZSldID0gdmFsdWU7CiAgICAgIH0KCiAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAgIC8vIEVMRU1FTlQgQ1JFQVRJT04KICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgcGFyc2Vfb25lKGVsZW1lbnRfaHRtbCkgewogICAgICAgIHZhciBSLCBsZW5ndGg7CiAgICAgICAgUiA9IHRoaXMucGFyc2VfYWxsKGVsZW1lbnRfaHRtbCk7CiAgICAgICAgaWYgKChsZW5ndGggPSBSLmxlbmd0aCkgIT09IDEpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgXsK1RE9NL3BhcnNlX29uZUA3NTU4XiBleHBlY3RlZCBIVE1MIGZvciAxIGVsZW1lbnQgYnV0IGdvdCAke2xlbmd0aH1gKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFJbMF07CiAgICAgIH0KCiAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIHBhcnNlX2FsbChodG1sKSB7CiAgICAgICAgdmFyIFI7CiAgICAgICAgLyogVEFJTlQgcmV0dXJuIEFycmF5IG9yIEhUTUxDb2xsZWN0aW9uPyAqLwogICAgICAgIHZhbGlkYXRlLm5vbmVtcHR5X3RleHQoaHRtbCk7CiAgICAgICAgUiA9IGRvY3VtZW50LmltcGxlbWVudGF0aW9uLmNyZWF0ZUhUTUxEb2N1bWVudCgpOwogICAgICAgIFIuYm9keS5pbm5lckhUTUwgPSBodG1sOwogICAgICAgIHJldHVybiBSLmJvZHkuY2hpbGRyZW47CiAgICAgIH0KCiAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIG5ld19lbGVtZW50KHhuYW1lLCAuLi5QKSB7CiAgICAgICAgLyogVEFJTlQgYW5hbHl6ZSB4bmFtZSAoYSBsYSBgZGl2I2lkNDIuZm9vLmJhcmApIGFzIGRvbmUgaW4gSW50ZXJ0ZXh0LkN1cG9maHRtbCAqLwogICAgICAgIC8qIFRBSU5UIGluIHNvbWUgY2FzZXMgdXNpbmcgaW5uZXJIVE1MLCBkb2N1bWVudEZyYWdtZW50IG1heSBiZSBhZHZhbnRhZ2VvdXMgKi8KICAgICAgICB2YXIgUiwgYXR0cmlidXRlcywgaSwgaywgbGVuLCBwLCB0ZXh0LCB2OwogICAgICAgIFIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHhuYW1lKTsKICAgICAgICBhdHRyaWJ1dGVzID0ge307CiAgICAgICAgdGV4dCA9IG51bGw7CiAgICAgICAgZm9yIChpID0gMCwgbGVuID0gUC5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgcCA9IFBbaV07CiAgICAgICAgICBpZiAoaXNhLnRleHQocCkpIHsKICAgICAgICAgICAgdGV4dCA9IHA7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgYXR0cmlidXRlcyA9IE9iamVjdC5hc3NpZ24oYXR0cmlidXRlcywgcCk7CiAgICAgICAgfQogICAgICAgIGlmICh0ZXh0ICE9IG51bGwpIHsKICAgICAgICAgIC8qIFRBSU5UIGNoZWNrIHR5cGU/ICovICAgICAgICAgIFIudGV4dENvbnRlbnQgPSB0ZXh0OwogICAgICAgIH0KICAgICAgICBmb3IgKGsgaW4gYXR0cmlidXRlcykgewogICAgICAgICAgdiA9IGF0dHJpYnV0ZXNba107CiAgICAgICAgICBSLnNldEF0dHJpYnV0ZShrLCB2KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFI7CiAgICAgIH0KCiAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIGRlZXBfY29weShlbGVtZW50KSB7CiAgICAgICAgcmV0dXJuIGVsZW1lbnQuY2xvbmVOb2RlKHRydWUpOwogICAgICB9CgogICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICAvLyBPVVRFUiwgSU5ORVIgSFRNTAogICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICBnZXRfaW5uZXJfaHRtbChlbGVtZW50KSB7CiAgICAgICAgdmFsaWRhdGUuZWxlbWVudChlbGVtZW50KTsKICAgICAgICByZXR1cm4gZWxlbWVudC5pbm5lckhUTUw7CiAgICAgIH0KCiAgICAgIGdldF9vdXRlcl9odG1sKGVsZW1lbnQpIHsKICAgICAgICB2YWxpZGF0ZS5lbGVtZW50KGVsZW1lbnQpOwogICAgICAgIHJldHVybiBlbGVtZW50Lm91dGVySFRNTDsKICAgICAgfQoKICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICAgLy8gSU5TRVJUSU9OCiAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIGluc2VydChwb3NpdGlvbiwgdGFyZ2V0LCB4KSB7CiAgICAgICAgc3dpdGNoIChwb3NpdGlvbikgewogICAgICAgICAgY2FzZSAnYmVmb3JlJzoKICAgICAgICAgIGNhc2UgJ2JlZm9yZWJlZ2luJzoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5zZXJ0X2JlZm9yZSh0YXJnZXQsIHgpOwogICAgICAgICAgY2FzZSAnYXNfZmlyc3QnOgogICAgICAgICAgY2FzZSAnYWZ0ZXJiZWdpbic6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmluc2VydF9hc19maXJzdCh0YXJnZXQsIHgpOwogICAgICAgICAgY2FzZSAnYXNfbGFzdCc6CiAgICAgICAgICBjYXNlICdiZWZvcmVlbmQnOgogICAgICAgICAgICByZXR1cm4gdGhpcy5pbnNlcnRfYXNfbGFzdCh0YXJnZXQsIHgpOwogICAgICAgICAgY2FzZSAnYWZ0ZXInOgogICAgICAgICAgY2FzZSAnYWZ0ZXJlbmQnOgogICAgICAgICAgICByZXR1cm4gdGhpcy5pbnNlcnRfYWZ0ZXIodGFyZ2V0LCB4KTsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBewrVET00vaW5zZXJ0QDc3NTheIG5vdCBhIHZhbGlkIHBvc2l0aW9uOiAke8K1LlRFWFQucnByKHBvc2l0aW9uKX1gKTsKICAgICAgfQoKICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgLyogTk9URSBwZW5kaW5nIHByYWN0aWNhbCBjb25zaWRlcmF0aW9ucyBhbmQgYmVuY2htYXJrcyB3ZSB3aWxsIHByb2JhYmx5IHJlbW92ZSBvbmUgb2YgdGhlIHR3byBzZXRzCiAgICAgICBvZiBpbnNlcnRpb24gbWV0aG9kcyAqLwogICAgICBpbnNlcnRfYmVmb3JlKHRhcmdldCwgeCkgewogICAgICAgIHZhbGlkYXRlLmVsZW1lbnQodGFyZ2V0KTsKICAgICAgICByZXR1cm4gdGFyZ2V0Lmluc2VydEFkamFjZW50RWxlbWVudCgnYmVmb3JlYmVnaW4nLCB4KTsKICAgICAgfQoKICAgICAgaW5zZXJ0X2FzX2ZpcnN0KHRhcmdldCwgeCkgewogICAgICAgIHZhbGlkYXRlLmVsZW1lbnQodGFyZ2V0KTsKICAgICAgICByZXR1cm4gdGFyZ2V0Lmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIHgpOwogICAgICB9CgogICAgICBpbnNlcnRfYXNfbGFzdCh0YXJnZXQsIHgpIHsKICAgICAgICB2YWxpZGF0ZS5lbGVtZW50KHRhcmdldCk7CiAgICAgICAgcmV0dXJuIHRhcmdldC5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2JlZm9yZWVuZCcsIHgpOwogICAgICB9CgogICAgICBpbnNlcnRfYWZ0ZXIodGFyZ2V0LCB4KSB7CiAgICAgICAgdmFsaWRhdGUuZWxlbWVudCh0YXJnZXQpOwogICAgICAgIHJldHVybiB0YXJnZXQuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmVuZCcsIHgpOwogICAgICB9CgogICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICBiZWZvcmUodGFyZ2V0LCAuLi54KSB7CiAgICAgICAgdmFsaWRhdGUuZWxlbWVudCh0YXJnZXQpOwogICAgICAgIHJldHVybiB0YXJnZXQuYmVmb3JlKC4uLngpOwogICAgICB9CgogICAgICBwcmVwZW5kKHRhcmdldCwgLi4ueCkgewogICAgICAgIHZhbGlkYXRlLmVsZW1lbnQodGFyZ2V0KTsKICAgICAgICByZXR1cm4gdGFyZ2V0LnByZXBlbmQoLi4ueCk7CiAgICAgIH0KCiAgICAgIGFwcGVuZCh0YXJnZXQsIC4uLngpIHsKICAgICAgICB2YWxpZGF0ZS5lbGVtZW50KHRhcmdldCk7CiAgICAgICAgcmV0dXJuIHRhcmdldC5hcHBlbmQoLi4ueCk7CiAgICAgIH0KCiAgICAgIGFmdGVyKHRhcmdldCwgLi4ueCkgewogICAgICAgIHZhbGlkYXRlLmVsZW1lbnQodGFyZ2V0KTsKICAgICAgICByZXR1cm4gdGFyZ2V0LmFmdGVyKC4uLngpOwogICAgICB9CgogICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICAvLyBSRU1PVkFMCiAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIHJlbW92ZShlbGVtZW50KSB7CiAgICAgICAgLyogc2VlIGh0dHA6Ly95b3VtaWdodG5vdG5lZWRqcXVlcnkuY29tLyNyZW1vdmUgKi8KICAgICAgICB2YWxpZGF0ZS5lbGVtZW50KGVsZW1lbnQpOwogICAgICAgIHJldHVybiBlbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWxlbWVudCk7CiAgICAgIH0KCiAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAgIC8vIEdFT01FVFJZCiAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIC8qIE5PVEUgb2JzZXJ2ZSB0aGF0IGBET00uZ2V0X29mZnNldF90b3AoKWAgYW5kIGBlbGVtZW50Lm9mZnNldFRvcGAgYXJlIHR3byBkaWZmZXJlbnQgdGhpbmdzOyB0ZXJtaW5vbG9neQogICAgICAgaXMgY29uZnVzaW5nIGhlcmUsIHNvIGNvbnNpZGVyIHJlbmFtaW5nIHRvIGF2b2lkIGBvZmZzZXRgIGFsdG9nZXRoZXIgKi8KICAgICAgZ2V0X29mZnNldF90b3AoZWxlbWVudCkgewogICAgICAgIHJldHVybiAodGhpcy5nZXRfb2Zmc2V0KGVsZW1lbnQpKS50b3A7CiAgICAgIH0KCiAgICAgIGdldF9vZmZzZXRfbGVmdChlbGVtZW50KSB7CiAgICAgICAgcmV0dXJuICh0aGlzLmdldF9vZmZzZXQoZWxlbWVudCkpLmxlZnQ7CiAgICAgIH0KCiAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIGdldF9vZmZzZXQoZWxlbWVudCkgewogICAgICAgIHZhciByZWN0YW5nbGU7CiAgICAgICAgLyogc2VlIGh0dHA6Ly95b3VtaWdodG5vdG5lZWRqcXVlcnkuY29tLyNvZmZzZXQgKi8KICAgICAgICB2YWxpZGF0ZS5lbGVtZW50KGVsZW1lbnQpOwogICAgICAgIHJlY3RhbmdsZSA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHRvcDogcmVjdGFuZ2xlLnRvcCArIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wLAogICAgICAgICAgbGVmdDogcmVjdGFuZ2xlLmxlZnQgKyBkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQKICAgICAgICB9OwogICAgICB9CgogICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAvKiBzZWUgaHR0cDovL3lvdW1pZ2h0bm90bmVlZGpxdWVyeS5jb20vI2dldF93aWR0aCAqLwogICAgICBnZXRfd2lkdGgoZWxlbWVudCkgewogICAgICAgIHJldHVybiB0aGlzLmdldF9udW1lcmljX3N0eWxlX3ZhbHVlKGVsZW1lbnQsICd3aWR0aCcpOwogICAgICB9CgogICAgICBnZXRfaGVpZ2h0KGVsZW1lbnQpIHsKICAgICAgICByZXR1cm4gdGhpcy5nZXRfbnVtZXJpY19zdHlsZV92YWx1ZShlbGVtZW50LCAnaGVpZ2h0Jyk7CiAgICAgIH0KCiAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAgIC8vIEVWRU5UUwogICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICBvbihlbGVtZW50LCBuYW1lLCBoYW5kbGVyKSB7CiAgICAgICAgLyogVEFJTlQgYWRkIG9wdGlvbnMgKi8KICAgICAgICAvKiBzZWUgaHR0cDovL3lvdW1pZ2h0bm90bmVlZGpxdWVyeS5jb20vI29uLCBodHRwOi8veW91bWlnaHRub3RuZWVkanF1ZXJ5LmNvbS8jZGVsZWdhdGUgKi8KICAgICAgICAvKiBBbHNvIG5vdGUgdGhlIGFkZGl0aW9uIG9mIGEgYHBhc3NpdmU6IGZhbHNlYCBwYXJhbWV0ZXIgKGFzIGluIGBodG1sX2RvbS5hZGRFdmVudExpc3RlbmVyICd3aGVlbCcsIGYsCiAgICAgICAgICAgeyBwYXNzaXZlOiBmYWxzZSwgfWApOyBzZWUgaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzU1NDYxNjMyLzI1NjM2MTsgYXBwYXJlbnRseSBpdCBpcyBhIHJlY2VudGx5CiAgICAgICAgICAgaW50cm9kdWNlZCBmZWF0dXJlIG9mIGJyb3dzZXIgZXZlbnQgcHJvY2Vzc2luZzsgc2VlIGFsc28gW0pRdWVyeSBpc3N1ZSAjMjg3MSAqQWRkIHN1cHBvcnQgZm9yIHBhc3NpdmUKICAgICAgICAgICBldmVudCBsaXN0ZW5lcnMqXShodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L2pxdWVyeS9pc3N1ZXMvMjg3MSksIG9wZW4gYXMgb2YgRGVjIDIwMjAgKi8KICAgICAgICB2YWxpZGF0ZS5kZWxlbWVudChlbGVtZW50KTsKICAgICAgICB2YWxpZGF0ZS5ub25lbXB0eV90ZXh0KG5hbWUpOwogICAgICAgIHZhbGlkYXRlLmZ1bmN0aW9uKGhhbmRsZXIpOwogICAgICAgIHJldHVybiBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIobmFtZSwgaGFuZGxlciwgZmFsc2UpOwogICAgICB9CgogICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICBlbWl0X2N1c3RvbV9ldmVudChuYW1lLCBvcHRpb25zKSB7CiAgICAgICAgLy8gdGh4IHRvIGh0dHBzOi8vd3d3LmphdmFzY3JpcHR0dXRvcmlhbC5uZXQvamF2YXNjcmlwdC1kb20vamF2YXNjcmlwdC1jdXN0b20tZXZlbnRzLwogICAgICAgIC8qIEFjYy4gdG8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0V2ZW50L0V2ZW50LAogICAgICAgICAgIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9DdXN0b21FdmVudC9DdXN0b21FdmVudCwgYWxsb3dhYmxlIGZpZWxkcyBmb3IgYG9wdGlvbnNgCiAgICAgICAgICAgaW5jbHVkZSBgYnViYmxlc2AsIGBjYW5jZWxhYmxlYCwgYGNvbXBvc2VkYCwgYGRldGFpbGA7IHRoZSBsYXN0IG9uZSBtYXkgY29udGFpbiBhcmJpdHJhcnkgZGF0YSBhbmQgY2FuCiAgICAgICAgICAgYmUgcmV0cmlldmVkIGFzIGBldmVudC5kZXRhaWxgLiAqLwogICAgICAgIHZhbGlkYXRlLm5vbmVtcHR5X3RleHQobmFtZSk7CiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KG5hbWUsIG9wdGlvbnMpKTsKICAgICAgfQoKICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICAgLy8gRFJBR0dBQkxFUwogICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICBtYWtlX2RyYWdnYWJsZShlbGVtZW50KSB7CiAgICAgICAgdmFyIGlkLCBvbl9kcmFnX3N0YXJ0LCBvbl9kcm9wOwogICAgICAgIC8qIHRoeCB0byBodHRwOi8vanNmaWRkbGUubmV0L3JvYmVydGMva0t1cUgvCiAgICAgICAgICAgaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzYyMzk4ODIvNzU2ODA5MSAqLwogICAgICAgIHRoaXMuX2F0dGFjaF9kcmFnb3ZlcigpOwogICAgICAgIHRoaXMuX3Bydl9kcmFnZ2FibGVfaWQrKzsKICAgICAgICBpZCA9IHRoaXMuX3Bydl9kcmFnZ2FibGVfaWQ7CiAgICAgICAgdGhpcy5zZXQoZWxlbWVudCwgJ2RyYWdnYWJsZScsIHRydWUpOwogICAgICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgICAgIHRoaXMub24oZWxlbWVudCwgJ2RyYWdzdGFydCcsIG9uX2RyYWdfc3RhcnQgPSBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgdmFyIHN0eWxlLCB4LCB5OwogICAgICAgICAgc3R5bGUgPSDCtS5ET00uZ2V0X2xpdmVfc3R5bGVzKGV2ZW50LnRhcmdldCk7CiAgICAgICAgICB4ID0gKHBhcnNlSW50KHN0eWxlLmxlZnQsIDEwKSkgLSBldmVudC5jbGllbnRYOwogICAgICAgICAgeSA9IChwYXJzZUludChzdHlsZS50b3AsIDEwKSkgLSBldmVudC5jbGllbnRZOwogICAgICAgICAgcmV0dXJuIGV2ZW50LmRhdGFUcmFuc2Zlci5zZXREYXRhKCdhcHBsaWNhdGlvbi9qc29uJywgSlNPTi5zdHJpbmdpZnkoe3gsIHksIGlkfSkpOwogICAgICAgIH0pOwogICAgICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgICAgIHRoaXMub24oZG9jdW1lbnQuYm9keSwgJ2Ryb3AnLCBvbl9kcm9wID0gZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgIHZhciBsZWZ0LCB0b3AsIHRyYW5zZmVyOwogICAgICAgICAgdHJhbnNmZXIgPSBKU09OLnBhcnNlKGV2ZW50LmRhdGFUcmFuc2Zlci5nZXREYXRhKCdhcHBsaWNhdGlvbi9qc29uJykpOwogICAgICAgICAgaWYgKGlkICE9PSB0cmFuc2Zlci5pZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBsZWZ0ID0gZXZlbnQuY2xpZW50WCArIHRyYW5zZmVyLnggKyAncHgnOwogICAgICAgICAgdG9wID0gZXZlbnQuY2xpZW50WSArIHRyYW5zZmVyLnkgKyAncHgnOwogICAgICAgICAgwrUuRE9NLnNldF9zdHlsZV9ydWxlKGVsZW1lbnQsICdsZWZ0JywgbGVmdCk7CiAgICAgICAgICDCtS5ET00uc2V0X3N0eWxlX3J1bGUoZWxlbWVudCwgJ3RvcCcsIHRvcCk7CiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0pOwogICAgICAgIC8vLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICBfYXR0YWNoX2RyYWdvdmVyKCkgewogICAgICAgIHZhciBvbl9kcmFnb3ZlcjsKICAgICAgICAvKiBUQUlOVCBBcHBhcmVudGx5IG5lZWQgZm9yIGNvcnJlY3QgZHJhZ2dpbmcgYmVoYXZpb3IsIGJ1dCB3aGF0IGlmIHdlIHdhbnRlZCB0byBoYW5kbGUgdGhpcyBldmVudD8gKi8KICAgICAgICB0aGlzLm9uKGRvY3VtZW50LmJvZHksICdkcmFnb3ZlcicsIG9uX2RyYWdvdmVyID0gZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5fYXR0YWNoX2RyYWdvdmVyID0gZnVuY3Rpb24oKSB7fTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgIH07CgogICAgLy8uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KICAgIERvbS5wcm90b3R5cGUuX3Bydl9kcmFnZ2FibGVfaWQgPSAwOwoKICAgIHJldHVybiBEb207CgogIH0pLmNhbGwodGhpcyk7CgogIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAvLyBNQUdJQwogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICB0aGlzLl9tYWdpYyA9IFN5bWJvbC5mb3IoJ8K1RE9NJyk7CgogIHRoaXMuVEVYVCA9IG5ldyBUZXh0KCk7CgogIHRoaXMuRE9NID0gbmV3IERvbSgpOwoKICB0aGlzLktCID0gbmV3IChyZXF1aXJlKCcuL2tiJykpLktiKCk7CgogIC8vIG1vZHVsZS5leHBvcnRzLnJwciAgICAgPz0gbW9kdWxlLmV4cG9ydHMuwrUuVEVYVC5ycHIuYmluZCggwrUuVEVYVCApCi8vIG1vZHVsZS5leHBvcnRzLmxvZyAgICAgPz0gbW9kdWxlLmV4cG9ydHMuwrUuVEVYVC5sb2cuYmluZCggwrUuVEVYVCApCi8qCgpodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMTE3OTg4Lzc1NjgwOTEKCmlubmVySFRNTCBpcyByZW1hcmthYmx5IGZhc3QsIGFuZCBpbiBtYW55IGNhc2VzIHlvdSB3aWxsIGdldCB0aGUgYmVzdCByZXN1bHRzIGp1c3Qgc2V0dGluZyB0aGF0IChJIHdvdWxkCmp1c3QgdXNlIGFwcGVuZCkuCgpIb3dldmVyLCBpZiB0aGVyZSBpcyBtdWNoIGFscmVhZHkgaW4gIm15ZGl2IiB0aGVuIHlvdSBhcmUgZm9yY2luZyB0aGUgYnJvd3NlciB0byBwYXJzZSBhbmQgcmVuZGVyIGFsbCBvZgp0aGF0IGNvbnRlbnQgYWdhaW4gKGV2ZXJ5dGhpbmcgdGhhdCB3YXMgdGhlcmUgYmVmb3JlLCBwbHVzIGFsbCBvZiB5b3VyIG5ldyBjb250ZW50KS4gWW91IGNhbiBhdm9pZCB0aGlzIGJ5CmFwcGVuZGluZyBhIGRvY3VtZW50IGZyYWdtZW50IG9udG8gIm15ZGl2IiBpbnN0ZWFkOgoKdmFyIGZyYWcgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CmZyYWcuaW5uZXJIVE1MID0gaHRtbDsKJCgiI215ZGl2IikuYXBwZW5kKGZyYWcpOwpJbiB0aGlzIHdheSwgb25seSB5b3VyIG5ldyBjb250ZW50IGdldHMgcGFyc2VkICh1bmF2b2lkYWJsZSkgYW5kIHRoZSBleGlzdGluZyBjb250ZW50IGRvZXMgbm90LgoKRURJVDogTXkgYmFkLi4uIEkndmUgZGlzY292ZXJlZCB0aGF0IGlubmVySFRNTCBpc24ndCB3ZWxsIHN1cHBvcnRlZCBvbiBkb2N1bWVudCBmcmFnbWVudHMuIFlvdSBjYW4gdXNlIHRoZQpzYW1lIHRlY2huaXF1ZSB3aXRoIGFueSBub2RlIHR5cGUuIEZvciB5b3VyIGV4YW1wbGUsIHlvdSBjb3VsZCBjcmVhdGUgdGhlIHJvb3QgdGFibGUgbm9kZSBhbmQgaW5zZXJ0IHRoZQppbm5lckhUTUwgaW50byB0aGF0OgoKdmFyIGZyYWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0YWJsZScpOwpmcmFnLmlubmVySFRNTCA9IHRhYmxlSW5uZXJIdG1sOwokKCIjbXlkaXYiKS5hcHBlbmQoZnJhZyk7CgoqLwoKfSkuY2FsbCh0aGlzKTsKCgp9LHsiLi4vbG91cGUuanMiOjEyLCIuL2tiIjoxMCwiLi90eXBlcyI6MTF9XX0se30sW10pOwo='></script>
<script>
  globalThis.  = require( 'mudom' );
  .DOM.ready( function(){
    console.log( "^65754^ ready" );
    .body          = .DOM.select_first( 'body'                );
    // .scalingwrap   = .DOM.select_first( 'scalingwrap'         );
    // .outlines      = .DOM.select_first( '#outlines'           );
    } );
  </script>

<style>
  body {
    background-color:       #96f0c93b;
    transform-origin:       0px 0px 0px;
    transform:              scale(1.4157,1.4157);
  }

  .bluish {
    fill:                   blue;
    opacity:                0.8; }

  .greenish {
    fill:                   green;
    opacity:                0.8; }

  .reveal-blocks {                      /* debugging */
    outline:                1px dotted blue;
    overflow:               visible; }

  .yellow-box {
    width:                  10mm;
    height:                 10mm;
    background-color:       yellowgreen; }

  </style>

<body class='reveal-blocks greenish'>


<div id=target></div>

<script>
  const target      = .DOM.select_first( '#target' );
  const yellow_box  = .DOM.parse_one( `<div class='yellow-box'>xxx</div>` );
  .DOM.insert_as_last( target, yellow_box );



  </script>


</body>
